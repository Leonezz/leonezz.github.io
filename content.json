{"meta":{"title":"zhuwenq","subtitle":"","description":"","author":"zhuwenq","url":"https://blog.zhuwenq.cc","root":"/"},"pages":[{"title":"About Me","date":"2021-07-29T06:50:30.000Z","updated":"2023-06-21T06:51:28.948Z","comments":false,"path":"about/index.html","permalink":"https://blog.zhuwenq.cc/about/index.html","excerpt":"","text":"Intro I am currently a postgraduate major in computer science, my research interests include Natural Language Processing, Parameter Efficient Transfer Learning and Information Extraction. I am a person of passion in both technique and life (at least as what I think : ) ), my passion involves modern C++, embedded systems, deep learning, reading books, watching movies, photography and making coffee. I will write here something about programming, reading and learning. Please leave a comment or contact me directly if you have something to share, I appreciate it a lot! I hope you can enjoy my articles here. Best regards! Contact me through: Email: zhuwenqa@outlook.com I will graduate in March next year if it goes well, and I am currently in a job hunting, so please check out my cv if it may. Check out my resume at zhuwenq-resume.netlify.app!"},{"title":"categories","date":"2021-07-23T05:04:34.000Z","updated":"2023-06-21T06:51:28.948Z","comments":false,"path":"categories/index.html","permalink":"https://blog.zhuwenq.cc/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2021-07-23T05:03:33.000Z","updated":"2023-06-21T06:51:28.948Z","comments":false,"path":"tags/index.html","permalink":"https://blog.zhuwenq.cc/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Modern C++ Concurrency Utilities 03: atomic","slug":"Modern-C-Concurrency-Utilities-03-atomic","date":"2023-06-21T06:29:49.000Z","updated":"2023-06-21T06:51:28.832Z","comments":true,"path":"Modern-C-Concurrency-Utilities-03-atomic/","link":"","permalink":"https://blog.zhuwenq.cc/Modern-C-Concurrency-Utilities-03-atomic/","excerpt":"Atomic æä¾›äº†å¼€å‘é«˜æ€§èƒ½æ— é” (lock free) ç»“æ„çš„å·¥å…·å’Œæ¥å£, å¯¹äºå†…ç½®ç±»å‹æˆ–è‡ªå®šä¹‰ç±»å‹, ä¹Ÿå¯ä»¥é€šè¿‡ atomic&lt;&gt; æ¨¡æ¿åŒ…è£…æˆæ”¯æŒåŸå­æ“ä½œçš„ç±»å‹, ä»¥å®ç°å¹¶å‘å®‰å…¨.","text":"Atomic æä¾›äº†å¼€å‘é«˜æ€§èƒ½æ— é” (lock free) ç»“æ„çš„å·¥å…·å’Œæ¥å£, å¯¹äºå†…ç½®ç±»å‹æˆ–è‡ªå®šä¹‰ç±»å‹, ä¹Ÿå¯ä»¥é€šè¿‡ atomic&lt;&gt; æ¨¡æ¿åŒ…è£…æˆæ”¯æŒåŸå­æ“ä½œçš„ç±»å‹, ä»¥å®ç°å¹¶å‘å®‰å…¨. atomic å¼•ç”¨ cppreference çš„è¯´æ³•: std::atomic æ¨¡æ¿çš„æ¯ä¸ªå®ä¾‹åŒ–å’Œå…¨ç‰¹åŒ–éƒ½å®šä¹‰äº†ä¸€ä¸ªåŸå­ç±»å‹. å¦‚æœä¸€ä¸ªçº¿ç¨‹å†™å…¥ä¸€ä¸ªåŸå­å¯¹è±¡çš„åŒæ—¶å¦ä¸€ä¸ªçº¿ç¨‹è¯»å–è¿™ä¸ªåŸå­å¯¹è±¡, å…¶è¡Œä¸ºæ˜¯æ˜ç¡®å®šä¹‰çš„. å¹¶ä¸”, å¯¹åŸå­å¯¹è±¡çš„è®¿é—®å¯èƒ½ä¼šå»ºç«‹çº¿ç¨‹é—´çš„åŒæ­¥å…³ç³», å¹¶å°†å¯¹éåŸå­å†…å­˜çš„è®¿é—®æ’åºä¸ºä¼ å…¥çš„ std::memory_order å‚æ•°æ‰€å®šä¹‰çš„é¡ºåº. (memory_order è¯¦è§ å†…å­˜å±éšœå’Œ-C-å†…å­˜æ¨¡å‹ ) Each instantiation and full specialization of the std::atomic template defines an atomic type. If one thread writes to an atomic object while another thread reads from it, the behavior is well-defined (see memory model for details on data races). In addition, accesses to atomic objects may establish inter-thread synchronization and order non-atomic memory accesses as specified by std::memory_order. æŒ‰ç…§è¿™ä¸ªæè¿°, å¯¹äºä»»æ„çš„è‡ªå®šä¹‰ç±»å‹ (éœ€è¦ CopyConstructible and CopyAssignable), åªè¦ç»™å®ƒå¥—ä¸Š std::atomic è¿™ä¸ª wrapper, å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªåŸå­çš„è¯¥å¯¹è±¡. ä½†éœ€è¦æ³¨æ„çš„æ˜¯, åŸå­å¹¶ä¸æ„å‘³ç€ lock free. C++ ä¼šåœ¨æ¨¡æ¿å®ä¾‹åŒ–æ—¶å†³å®šä¼ å…¥çš„è‡ªå®šä¹‰ç±»å‹æ˜¯å¦å¯ä»¥å®ç° lock free çš„åŸå­æ“ä½œ, å¦‚æœä¸èƒ½, é‚£ä¹ˆå…¶å†…éƒ¨ä»ç„¶æ˜¯é€šè¿‡ mutex ç­‰æœ‰é”ç»“æ„å®ç°åŸå­æ“ä½œ. C++ 11 ä¸­ä¸ºæŒ‡é’ˆç±»å‹æä¾›äº†åç‰¹åŒ–, ä¸º bool ç±»å‹å’Œ æ‰€æœ‰ çš„æ•´å½¢ç±»å‹éƒ½æä¾›äº† atomic æ¨¡æ¿çš„å…¨ç‰¹åŒ–, å®ƒä»¬ä¸­åº”è¯¥å¤šæ•°éƒ½æ˜¯ lock free çš„. C++ 20 åˆ™è¿›ä¸€æ­¥ä¸ºæµ®ç‚¹ç±»å‹æä¾›äº†å…¨ç‰¹åŒ–ä»¥åŠä¸º std::shared_ptr&lt;U&gt; å’Œ std::weak_ptr&lt;U&gt; æä¾›äº†åç‰¹åŒ–, è€Œæ˜¯å¦ lock free åˆ™å–å†³äº U çš„ç±»å‹. ç»†èŠ‚å‚è€ƒ: std::atomic - cppreference.com å¯¹äºä»»æ„çš„ atomic æ¨¡æ¿å®ä¾‹åŒ–æˆ–å…¨ç‰¹åŒ–, å…¶éƒ½ä¼šæä¾›ä»¥ä¸‹æ“ä½œ: is_lock_free: æ£€æŸ¥ atomic å¯¹è±¡æ˜¯å¦æ˜¯ lock free çš„, C++ ä¿è¯ std::atomic_flag ä¸€å®šæ˜¯ lock free çš„, å¯¹äºå…¶ä»–ç±»å‹åœ¨ä¸åŒå¹³å°ä¸Šå¯èƒ½æœ‰ä¸åŒå®ç°. store: åŸå­åœ° ä¸º atomic å¯¹è±¡èµ‹å€¼, å¯ä»¥æŒ‡å®š memory_order load: åŸå­åœ° è¯»å– atomic å¯¹è±¡çš„å€¼, å¯ä»¥æŒ‡å®š memory_order exchange: åŸå­åœ° ä¸º atomic å¯¹è±¡èµ‹å€¼å¹¶è¯»å–å®ƒåŸå…ˆçš„å€¼, æ˜¯ RMW (Read Modify Write) æ“ä½œ. compare_exchange_weak and compare_exchange_strong: åŸå­åœ° åŠ è½½å¹¶ bit wise æ¯”è¾ƒ atomic å¯¹è±¡çš„å€¼å’Œ expected å‚æ•°å€¼ å¦‚æœå®ƒä»¬ä¸ç›¸ç­‰, åˆ™æŠŠ atomic å¯¹è±¡çš„å€¼èµ‹ç»™ expected å‚æ•°(expected æ˜¯ä¸ªå¼•ç”¨), å¹¶è¿”å› false. å¦‚æœå®ƒä»¬ç›¸ç­‰, åˆ™æŠŠ desired å‚æ•°å€¼èµ‹ç»™ atomic å¯¹è±¡. å€¼å¾—æ³¨æ„çš„æ˜¯, weak ç‰ˆæœ¬å’Œ strong ç‰ˆæœ¬æœ‰å¦‚ä¸‹å·®å¼‚: weak ç‰ˆæœ¬å¯èƒ½ä¼š ä¼ªå¤±è´¥ (fail spuriously), ä¹Ÿå°±æ˜¯è¯´, å³ä½¿ atomic å¯¹è±¡çš„å€¼å’Œ expected ç›¸ç­‰, å‡½æ•°ä¹Ÿå¯èƒ½äº§ç”Ÿå®ƒä»¬ä¸ç›¸ç­‰æ—¶çš„è¡Œä¸º (èµ‹å€¼ expected å¹¶è¿”å› false), è€Œ strong ç‰ˆæœ¬ä¸ä¼š. å½“åœ¨å¾ªç¯ä¸­ä½¿ç”¨ CAS æ—¶, weak ç‰ˆæœ¬ä¼šæœ‰æ›´å¥½çš„æ€§èƒ½: 12while(atomic.compare_and_exchange(expected, desired)) ; å¯¹äºä¸€äº›å€¼ç›¸åŒä½†ä½è¡¨ç¤ºå¯èƒ½ä¸åŒ, å³å¤šä¸ªä½è¡¨ç¤ºå¯¹åº”åŒä¸€ä¸ªå€¼çš„ç±»å‹ (å¦‚, æµ®ç‚¹æ•°çš„ NaN æœ‰å¤šä¸ªä½è¡¨ç¤º, ä¸€äº›ç»´æŠ¤äº†å†…éƒ¨çŠ¶æ€ä½†è¿™äº›å†…éƒ¨çŠ¶æ€ä¸å†³å®šå¯¹è±¡çš„å€¼çš„ç±»), é€šå¸¸ä½¿ç”¨ weak ç‰ˆæœ¬æ›´æœ‰æ•ˆ, å› ä¸ºé€šå¸¸å¯¹äºè¿™äº›ç±»çš„ CAS æ“ä½œéƒ½éœ€è¦å¾ªç¯ä»¥ä½¿ä¹‹æ”¶æ•›åˆ°ç¨³å®šçš„ä½è¡¨ç¤º. å¦‚æœå¯ä»¥ä½¿ç”¨ strong ç‰ˆæœ¬çš„ CAS å¹¶ä¸”ä¸éœ€è¦å¾ªç¯æ—¶, strong ç‰ˆæœ¬æ›´åŠ é«˜æ•ˆ. C++ 20 ä¸º atomic å¯¹è±¡å¼•å…¥äº†ä¸‰ä¸ªä¸»åŠ¨å¼çš„çº¿ç¨‹åŒæ­¥æ“ä½œ: wait: é˜»å¡å½“å‰çº¿ç¨‹, ç›´åˆ°: ç›¸åŒçš„ atomic å¯¹è±¡è°ƒç”¨äº† notify å‡½æ•° atomic å¯¹è±¡çš„å€¼ä¸ä¼ å…¥çš„å‚æ•°å€¼ old ä¸åŒ. wait æ–¹æ³•ç”¨äºå¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹æ—¶å®ç°çº¿ç¨‹å¯¹åŸå­å˜é‡å€¼çš„å˜åŒ–ç›‘æµ‹, éœ€è¦æ³¨æ„çš„æ˜¯å…¶ä¸­çš„æ¯”è¾ƒæ˜¯ bit wise æ¯”è¾ƒ. notify_one: å¦‚æœå­˜åœ¨å› åœ¨å½“å‰ atomic å¯¹è±¡ä¸Šè°ƒç”¨ wait å‡½æ•°è€Œé˜»å¡çš„çº¿ç¨‹, é‚£ä¹ˆå°±å”¤é†’ è‡³å°‘ä¸€ä¸ª è¿™æ ·çš„çº¿ç¨‹, å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„çº¿ç¨‹è¯¥å‡½æ•°æ— æ•ˆæœ. notify_all: å”¤é†’æ‰€æœ‰å› åœ¨å½“å‰ atomic å¯¹è±¡ä¸Šè°ƒç”¨ wait å‡½æ•°è€Œé˜»å¡çš„çº¿ç¨‹. å¯¹äºæ ‡å‡†åº“å†…ç½®çš„ç‰¹åŒ–ç‰ˆæœ¬, atomic è¿˜æä¾›äº†ä¸€ç³»åˆ— read, write, RMW æ“ä½œ, åŒ…æ‹¬ç®—æœ¯å’Œé€»è¾‘æ“ä½œ. å¦å¤– atomic æ‰€æœ‰çš„æˆå‘˜å‡½æ•°éƒ½æœ‰å¯¹åº”çš„éæˆå‘˜å‡½æ•°æ¨¡æ¿, å¯ä»¥ä¸ºé atomic ç±»å‹é‡è½½å‡ºå¯¹åº”çš„æ“ä½œ. è¯¦è§: cppreference.com. atomic_ref C++ 20 ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°çš„åŸå­ç±», å®ƒçš„è¯­ä¹‰æ˜¯å¯¹ä¸€ä¸ªéåŸå­å¯¹è±¡çš„ã€Œå¼•ç”¨ã€, ç‰¹æ®Šä¹‹å¤„åœ¨äºé€šè¿‡è¯¥ã€Œå¼•ç”¨ã€è¿›è¡Œçš„æ“ä½œéƒ½æ˜¯åŸå­çš„! è¿™æ„å‘³ç€ atomic_ref ç›¸å½“äºåœ¨å·²æœ‰çš„éåŸå­å¯¹è±¡ä¸Šæ–½åŠ äº†ä¸€ä¸ªæ”¯æŒåŸå­æ“ä½œçš„æ¥å£, è€Œå¹¶éä¸€ä¸ªé€»è¾‘ä¸Šç‹¬ç«‹çš„æ–°å¯¹è±¡. å½“æˆ‘ä»¬åœ¨ç¨‹åºä¸­ä»…åœ¨ä¸€éƒ¨åˆ†åœ°æ–¹éœ€è¦å¯¹å˜é‡æ–½åŠ åŸå­æ“ä½œæ—¶, atomic_ref ååˆ†æœ‰ç”¨: å¦‚æœä½¿ç”¨ atomic, é‚£ä¹ˆå¯¹å…¶çš„è®¿é—®åœ¨æ•´ä¸ªç¨‹åºä¸­éƒ½å¿…ç„¶æ˜¯åŸå­æ€§çš„. æ¢ä¸€ä¸ªè§’åº¦ç†è§£ atomic_ref: å®ƒç›¸å½“äºä¸ºã€ŒåŸå­å¯¹è±¡ã€æä¾›äº†å¼•ç”¨è¯­ä¹‰. C++ 11 ä¸­çš„ atomic å¯¹è±¡æ˜¯å€¼è¯­ä¹‰çš„, å®ƒçš„æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªéåŸå­å¯¹è±¡çš„ã€Œå€¼ã€ï¼Œå¹¶ä¸”åœ¨å†…éƒ¨ç»´æŠ¤è¯¥å€¼. åç»­å¯¹è¯¥åŸå­å˜é‡çš„æ“ä½œå®é™…ä¸Šéƒ½æ˜¯åœ¨æ“ä½œåŸå­å¯¹è±¡æœ¬èº«. è€Œ atomic_ref åˆ™ä¸ç„¶, å®ƒç›¸å½“äºå¹¶ä¸æ‹¥æœ‰èƒŒåçš„éåŸå­å¯¹è±¡, è€Œåªæ˜¯æŒæœ‰å¯¹å…¶çš„ä¸€ä¸ªå¼•ç”¨, ç‰¹æ®Šä¹‹å¤„ä»…åœ¨äºè¿™ä¸ªå¼•ç”¨ä¸Šçš„æ“ä½œéƒ½æ˜¯åŸå­çš„. ä»¥ä¸‹é¢çš„ç¨‹åºä¸ºä¾‹è¯´æ˜ä¸Šè¿°æ¦‚å¿µ: 123456789101112131415// In sequential_fun, there are no concurrent running,// no data races, therefore no need for atomic operationvoid sequential_fun(int&amp; cnt) &#123; ++atomic;&#125;// concurrent_fun will be running in multiple threads,// potentially multiple cores.void concurrent_fun(int&amp; cnt) &#123; std::atomic&lt;int&gt; atomic_cnt&#123;cnt&#125;; // an atomic int with the same value as cnt ++atomic_cnt; // not as expected: the increament should be performed to the reference parameter // unless do this: // cnt = atomic_cnt; // but it is non-atomic and what if the parameter is a large object&#125; ä¸Šé¢çš„ç¨‹åºä¸­, æˆ‘ä»¬ä»…åœ¨å‡½æ•° concurrent_fun ä¸­éœ€è¦åŸå­æ“ä½œ, å¹¶ä¸”åŸå­æ“ä½œçš„ç»“æœæ˜¯é€šè¿‡å¼•ç”¨ä¼ é€’çš„. æ­¤æ—¶ atomic çš„å€¼è¯­ä¹‰å°±è¾ƒä¸ºéº»çƒ¦, æ— æ³•å®‰å…¨é«˜æ•ˆåœ°å®ç°å¯¹å¼•ç”¨çš„ä¿®æ”¹. è€Œ atomic_ref å¯ä»¥èƒœä»»è¿™ç§æƒ…å†µ: 1234void concurrent_fun(int&amp; cnt) &#123; std::atomic_ref&lt;int&gt; atomic_cnt&#123;cnt&#125;; ++cnt; // ok, increament is performed atomically to cnt&#125; é™¤äº†è¯­ä¹‰ä¸Šçš„åŒºåˆ«å¤–, atomic_ref ä¸ atomic åœ¨å½¢å¼ä¸ŠåŒºåˆ«ä¸å¤§, éƒ½æä¾›äº†ç›¸ä¼¼çš„å…¨ç‰¹åŒ–å’Œåç‰¹åŒ–å·²ç»ç›¸ä¼¼çš„æˆå‘˜å‡½æ•°. è¯¦æƒ…å‚è€ƒ: std::atomic_ref - cppreference.com memory_order memory_order æ˜¯ atomic ç›¸å…³æ“ä½œä¸­å¸¸è§çš„å‚æ•°, å®ƒç”¨æ¥æ§åˆ¶åœ¨åŸå­æ“ä½œä¸­å¯¹å†…å­˜ (éåŸå­å¤šçº§ç¼“å­˜ç»“æ„çš„å†…å­˜) çš„è®¿é—®è¿›è¡Œæ’åº. åŒ…æ‹¬å†…å­˜å†™å…¥æ“ä½œæ‰§è¡Œåå¯¹äºå…¶ä»–çº¿ç¨‹çš„å¯è§æ€§é¡ºåº. C++ ä¸­æŠ½è±¡äº† 5 ä¸­ memory_order, è¯¦è§ std::memory_order - cppreference.com, å®ƒä»¬æ˜¯éå¸¸é‡è¦ä¸”å¤æ‚çš„æ¦‚å¿µ, å·²ç»åœ¨æ–‡ç«  å†…å­˜å±éšœå’Œ-C-å†…å­˜æ¨¡å‹ åšäº†åˆæ­¥ä»‹ç». References std::atomic - cppreference.com std::atomic_ref - cppreference.com c++ - What exactly is std::atomic? - Stack Overflow A simple guide to atomics in C++. Thereâ€™s often confusion around whenâ€¦ | by Josh Weinstein | Dev Genius std::atomic_ref - cppreference.com C++20 atomic_ref (mariusbancila.ro)","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://blog.zhuwenq.cc/tags/C/"},{"name":"Concurrency","slug":"Concurrency","permalink":"https://blog.zhuwenq.cc/tags/Concurrency/"},{"name":"atomic","slug":"atomic","permalink":"https://blog.zhuwenq.cc/tags/atomic/"}]},{"title":"Modern C++ Concurrency Utilities 02: CPU Cache and false sharing","slug":"Modern-C-Concurrency-Utilities-02-CPU-Cache-and-false-sharing","date":"2023-06-20T08:15:09.000Z","updated":"2023-06-21T06:51:28.828Z","comments":true,"path":"Modern-C-Concurrency-Utilities-02-CPU-Cache-and-false-sharing/","link":"","permalink":"https://blog.zhuwenq.cc/Modern-C-Concurrency-Utilities-02-CPU-Cache-and-false-sharing/","excerpt":"C++ 17 æä¾›äº†ä¸¤ä¸ªç¼–è¯‘æ—¶å¸¸é‡, ç”¨äºè¡¨ç¤º CPU Cache çš„ä¸€äº›å‚æ•°. åˆç†ä½¿ç”¨è¿™ä¸¤ä¸ªç¼–è¯‘æ—¶å¸¸é‡å¯ä»¥é¿å…åœ¨å¤šçº§ Cache ç»“æ„çš„è®¡ç®—æœºä¸Šå¹¶å‘ç¨‹åºé¢‘ç¹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ä¸åŒæˆå‘˜æ—¶å¯èƒ½å‘ç”Ÿçš„ ä¼ªå…±äº« (false sharing) é—®é¢˜.","text":"C++ 17 æä¾›äº†ä¸¤ä¸ªç¼–è¯‘æ—¶å¸¸é‡, ç”¨äºè¡¨ç¤º CPU Cache çš„ä¸€äº›å‚æ•°. åˆç†ä½¿ç”¨è¿™ä¸¤ä¸ªç¼–è¯‘æ—¶å¸¸é‡å¯ä»¥é¿å…åœ¨å¤šçº§ Cache ç»“æ„çš„è®¡ç®—æœºä¸Šå¹¶å‘ç¨‹åºé¢‘ç¹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ä¸åŒæˆå‘˜æ—¶å¯èƒ½å‘ç”Ÿçš„ ä¼ªå…±äº« (false sharing) é—®é¢˜. è¿™ä¸¤ä¸ªç¼–è¯‘æ—¶å¸¸é‡æ˜¯: 12inline constexpr std::size_t hardware_destrutive_interference_size; // ä¸‹ç®€ç§°: hdisinline constexpr std::size_t hardware_constructive_interence_size; // ä¸‹ç®€ç§°: hcis False sharing é¦–å…ˆè¯´ä¸€è¯´ä»€ä¹ˆæ˜¯ä¼ªå…±äº«. åœ¨ å†…å­˜å±éšœå’Œ-C-å†…å­˜æ¨¡å‹ ä¸­æˆ‘ä»¬çŸ¥é“ç°ä»£ CPU çš„ Cache æ˜¯å¤šçº§å±‚æ¬¡çš„, ä¸åŒçš„ CPU Core å¯èƒ½æŒæœ‰ç‹¬ç«‹çš„ Cache, è¿™ç§ç»“æ„å¾ˆæœ‰å¯èƒ½å‡ºç° Cache ä¸ä¸€è‡´é—®é¢˜. é‚£ä¹ˆå¤šä¸ª Core åŒæ—¶è¯»å†™åŒä¸€ä¸ªå†…å­˜ä½ç½®æ—¶å°±æ˜¯ä¸€ç§ data race. MESI åè®®é€šè¿‡ä¸º Cache line å¼•å…¥å››ç§çŠ¶æ€å¹¶åœ¨éœ€è¦æ—¶å¹¿æ’­æ¶ˆæ¯è§£å†³äº†ç¼“å­˜ä¸€è‡´æ€§çš„é—®é¢˜. å…·ä½“åœ°è¯´, å½“ Core A å’Œ Core B çš„ç‹¬ç«‹ Cache ä¸­éƒ½æŒæœ‰å­—èŠ‚ C çš„ç¼“å­˜æ—¶, å¦‚æœ Core A å†™å…¥å­—èŠ‚ C çš„åŒæ—¶ Core B ä¹Ÿè¦è®¿é—®å­—èŠ‚ C, é‚£ä¹ˆ Core B å¿…é¡»å…ˆ invalidate å­—èŠ‚ C æ‰€åœ¨çš„ Cache line, å¹¶é‡æ–°ä»ä¸‹ä¸€çº§ Cache ä¸­åŠ è½½åŒ…å«å­—èŠ‚ C çš„ Cache line (ç»†èŠ‚å‚è€ƒ: å†…å­˜å±éšœå’Œ-C-å†…å­˜æ¨¡å‹). å€¼å¾—æ³¨æ„çš„æ˜¯, Cache çš„æœ€å°æ“ä½œå•å…ƒæ˜¯ Cache line, è€Œä¸€ä¸ª Cache line é€šå¸¸åŒ…å«å‡ åä¸Šç™¾ä¸ªå­—èŠ‚. é‚£ä¹ˆè€ƒè™‘ä¸€ç§æƒ…å†µ: Core A å’Œ Core B å¹¶å‘è®¿é—® (è¯»å†™) å­—èŠ‚ C å’Œå­—èŠ‚ C çš„ç›¸é‚»å­—èŠ‚ D æ—¶, ä¼šå‘ç”Ÿä»€ä¹ˆ? ç­”æ¡ˆæ˜¾è€Œæ˜“è§, ç›¸é‚»å­—èŠ‚ C å’Œ D ææœ‰å¯èƒ½è¢«åˆ†é…åˆ°åŒä¸€ä¸ª Cache line (ç»†èŠ‚å‚è€ƒ Cache), è¿™å°±é€ æˆæ˜æ˜å¹¶è¡Œç¨‹åºæ²¡æœ‰è®¿é—®åŒä¸€ä¸ªå†…å­˜ä½ç½®, ä¹Ÿå°±æ˜¯å¹¶ä¸å­˜åœ¨ data race, ä½† Core A å’Œ Core B çš„ Cache å´éœ€è¦é¢‘ç¹åœ° invalidate æ•´ä¸ª Cache line å¹¶é‡æ–°åŠ è½½, ç»“æœå°±æ˜¯ç¨‹åºæ‰§è¡Œæ•ˆç‡çš„ä¸‹é™. è¿™å°±æ˜¯ false sharing çš„æƒ…å†µ. Scott Meyers å…³äº CPU Cache çš„ä¸€æ¬¡ talk ä¸­æåˆ°ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­, è¯´æ˜äº† false sharing é—®é¢˜å¯¹å¤šçº¿ç¨‹å¹¶è¡Œç¨‹åº scalability çš„å½±å“. è¯¦æƒ…å‚è€ƒ: https://www.aristeia.com/TalkNotes/codedive-CPUCachesHandouts.pdf How to avoid false sharing çš„é¿å…æ‰‹æ®µä¸»è¦æ˜¯å°†å¯èƒ½åœ¨ä¸åŒ Core ä¸­å¹¶å‘è®¿é—®çš„æ•°æ®å¸ƒå±€æˆåˆé€‚çš„è·ç¦», ä½¿å¾—å®ƒä»¬ä¸å¯èƒ½è¢«å¡åˆ°åŒä¸€ä¸ª Cache line. ä¾‹å¦‚å¯¹äºå¦‚ä¸‹çš„ç»“æ„: 1234struct ConcurrentStruct &#123; int threadA_val&#123;&#125;; int threadB_val&#123;&#125;;&#125;; å¦‚æœæˆå‘˜ threadA_val å’Œ threadB_val åˆ†åˆ«åœ¨ä¸¤ä¸ª Core ä¸­è¢«é¢‘ç¹è¯»å†™, æˆ‘ä»¬å¯ä»¥å°è¯•åœ¨å®ƒä»¬ä¸­é—´æ’å…¥ä¸€äº› padding å­—èŠ‚ä»¥å¼ºè¿«å®ƒä»¬é…åˆ†é…åˆ°ä¸åŒ Cache line (å¯¹äº 64 bytes å¤§å°çš„ cache line): 1234567struct FastConcurrentStruct &#123; const char padding1[60]; int threadA_val&#123;&#125;; const char padding2[60]; int threadB_val&#123;&#125;; const char padding3[60];&#125;; è¿™ç§ padding ä¸ä»…ä½¿å¾— threadA_val å’Œ threadB_val æ— æ³•åŠ è½½åˆ°åŒä¸€ä¸ª Cache line, ä¹Ÿé¿å…äº†å®ƒä»¬å’Œç¨‹åºå…¶å®ƒéƒ¨åˆ†çš„å€¼åŠ è½½åˆ°åŒä¸€ä¸ª cache line. é‚£ä¹ˆåœ¨ä¸åŒ Cache line å¤§å°çš„ CPU ä¸Šå¦‚ä½•å†™å‡ºç»Ÿä¸€çš„é¿å… false sharing çš„ä»£ç å‘¢? æ“ä½œç³»ç»Ÿçš„å†…æ ¸å¯èƒ½ä¼šæä¾›ä¸€äº›ç‰¹æ®Šçš„å®å®šä¹‰. é‚£ä¹ˆå¦‚ä½•å†™å‡ºè·¨æ“ä½œç³»ç»Ÿç»Ÿä¸€çš„ä»£ç å‘¢? è¿™å°±æ˜¯ä¸Šé¢ä»‹ç»çš„ä¸¤ä¸ª C++ ç¼–è¯‘æ—¶å¸¸é‡ hdis, hcis çš„ä½œç”¨. False sharing avoiding in modern C++ å¼•ç”¨ cppreference æä¾›çš„ä¾‹å­: 1234struct keep_apart &#123; alignas(std::hardware_destructive_interference_size) std::atomic&lt;int&gt; cat; alignas(std::hardware_destructive_interference_size) std::atomic&lt;int&gt; dog;&#125;; hdis è¡¨ç¤ºè¦é¿å… false sharing ä¸¤ä¸ªå˜é‡çš„åœ°å€æ‰€éœ€è¦çš„ æœ€å° å·®å€¼. ä¸‹é¢çš„æµ‹è¯•ç¨‹åºè¯´æ˜äº†å®ƒçš„æ•ˆæœ: 123456789101112131415161718192021222324252627282930313233343536#include &lt;iostream&gt;#include &lt;new&gt;struct no_fs &#123; alignas(std::hardware_destructive_interference_size) int a&#123;&#125;; alignas(std::hardware_destructive_interference_size) int b&#123;&#125;;&#125;;struct fs &#123; int a&#123;&#125;; int b&#123;&#125;;&#125;;int main() &#123; no_fs nf&#123;&#125;; std::cout &lt;&lt; &quot;No false sharing: &quot; &lt;&lt; &#x27;\\n&#x27; &lt;&lt; &amp;nf &lt;&lt; &quot;\\n&quot; &lt;&lt; &amp;(nf.a) &lt;&lt; &quot;\\n&quot; &lt;&lt; &amp;(nf.b) &lt;&lt; &quot;\\n&quot; &lt;&lt; std::hardware_destructive_interference_size &lt;&lt; &quot;\\n&quot;; fs f&#123;&#125;; std::cout &lt;&lt; &quot;false sharing: &quot; &lt;&lt; &#x27;\\n&#x27; &lt;&lt; &amp;f &lt;&lt; &quot;\\n&quot; &lt;&lt; &amp;(f.a) &lt;&lt; &quot;\\n&quot; &lt;&lt; &amp;(f.b) &lt;&lt; &quot;\\n&quot;;&#125;/** output:No false sharing: 0x7ffe0174ff000x7ffe0174ff000x7ffe0174ff4064false sharing: 0x7ffe0174fef80x7ffe0174fef80x7ffe0174fefc**/ å¯ä»¥çœ‹å‡ºæµ‹è¯•å¹³å° (https://godbolt.org/z/M3bs16cY6) çš„ Cache line å¤§å°æ˜¯ 64 å­—èŠ‚, å¹¶ä¸” no_fs ç»“æ„ä½“ä¸­çš„æˆå‘˜åœ°å€éƒ½æŒ‰ç…§ 64 å­—èŠ‚å¯¹é½. è€Œ fs ç»“æ„çš„æˆå‘˜åˆ™æ˜¯ trivial layout, å³æˆå‘˜æ˜¯ç´§å¯†æ’åˆ—çš„. å¦å¤–ä¸€ä¸ªå¸¸é‡ hcis è¡¨ç¤º true sharing çš„æœ€å¤§è¿ç»­å†…å­˜é•¿åº¦, å³å¯èƒ½è¢«æ”¾å…¥åŒä¸€ä¸ª cache line çš„æœ€å¤§å­—èŠ‚æ•°. ç”¨äºå¢å¤§æ•´ä¸ªç»“æ„æˆ–è¿ç»­çš„å˜é‡è¢«æ”¾å…¥åŒä¸€ä¸ª cache line çš„å¯èƒ½æ€§, ä¸è¯¦ç»†ä»‹ç», å¯ä»¥å‚è€ƒ cppreference ç»™å‡ºçš„ä¾‹å­: std::hardware_destructive_interference_size, std::hardware_constructive_interference_size - cppreference.com. References Scott Meyers. 2013. Cpu Caches and Why You Care. In code::dive conference. video. slide std::hardware_destructive_interference_size, std::hardware_constructive_interference_size - cppreference.com","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://blog.zhuwenq.cc/tags/C/"},{"name":"CPU Cache","slug":"CPU-Cache","permalink":"https://blog.zhuwenq.cc/tags/CPU-Cache/"},{"name":"Concurrency","slug":"Concurrency","permalink":"https://blog.zhuwenq.cc/tags/Concurrency/"}]},{"title":"Modern C++ Concurrency Utilities 01: thread","slug":"Modern-C-Concurrency-Utilities-01-thread","date":"2023-06-19T14:35:31.000Z","updated":"2023-06-21T06:51:28.828Z","comments":true,"path":"Modern-C-Concurrency-Utilities-01-thread/","link":"","permalink":"https://blog.zhuwenq.cc/Modern-C-Concurrency-Utilities-01-thread/","excerpt":"C++ 11 åŠä¹‹åçš„ç‰ˆæœ¬ä¸­æä¾›äº†ä¸€ç³»åˆ—å¹¶å‘ç¼–ç¨‹çš„å·¥å…·å’Œå¯¹å¹¶å‘æ§åˆ¶åŸè¯­çš„æŠ½è±¡å°è£…, å¦‚ thread, atomic, mutex, condition_varible ç­‰. æœ¬æ–‡ä»‹ç» thread ä»¥åŠ jthread çš„åŸºæœ¬è¯­ä¹‰å’ŒåŠŸèƒ½, å®ƒä»¬åœ¨å®é™…åœºæ™¯ä¸­çš„ best practice å’Œä¸ä¹‹å¯†åˆ‡ç›¸å…³çš„ç¼–ç¨‹æ¨¡å¼ä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´ä¹‹å†….","text":"C++ 11 åŠä¹‹åçš„ç‰ˆæœ¬ä¸­æä¾›äº†ä¸€ç³»åˆ—å¹¶å‘ç¼–ç¨‹çš„å·¥å…·å’Œå¯¹å¹¶å‘æ§åˆ¶åŸè¯­çš„æŠ½è±¡å°è£…, å¦‚ thread, atomic, mutex, condition_varible ç­‰. æœ¬æ–‡ä»‹ç» thread ä»¥åŠ jthread çš„åŸºæœ¬è¯­ä¹‰å’ŒåŠŸèƒ½, å®ƒä»¬åœ¨å®é™…åœºæ™¯ä¸­çš„ best practice å’Œä¸ä¹‹å¯†åˆ‡ç›¸å…³çš„ç¼–ç¨‹æ¨¡å¼ä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´ä¹‹å†…. Thread çº¿ç¨‹æä¾›ä¸€ç§å…è®¸å¤šä¸ªè¿‡ç¨‹å¹¶å‘æ‰§è¡Œçš„æ–¹å¼, C++ ä¸­çš„ thread åˆ™æ˜¯æä¾›ä¸€ç»„å¹³å°æ— å…³çš„æ¥å£, ä¸ºç”¨æˆ·å±è”½äº†ä¸åŒæ“ä½œç³»ç»Ÿæ‰€æä¾›çš„çº¿ç¨‹ API çš„å·®å¼‚. åœ¨ linux æ“ä½œç³»ç»Ÿä¸Š, ä½¿ç”¨ thread çš„ç¨‹åºç¼–è¯‘æ—¶å¾€å¾€éœ€è¦ -lpthread é€‰é¡¹ä»¥æ˜¾å¼é“¾æ¥ pthread (POSIX thread) åº“. thread C++ 11 ä¸­æä¾›çš„ thread ç±»æ¥å—ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡å’Œå‚æ•°ä½œä¸ºæ„é€ å‚æ•°, å¹¶ä¸” thread å¯¹è±¡åœ¨æ„é€ å®Œæˆåç«‹åˆ»å¼€å§‹æ‰§è¡Œ (å°†çº¿ç¨‹æ ‡è®°ä¸º ready çŠ¶æ€ç­‰å¾…æ“ä½œç³»ç»Ÿè°ƒåº¦). ä¼ å…¥ thread æ„é€ å‡½æ•°çš„å¯è°ƒç”¨å¯¹è±¡çš„è¿”å›å€¼ä¼šè¢«å¿½ç•¥, å¹¶ä¸”å¦‚æœè¯¥å¯è°ƒç”¨å¯¹è±¡å¼‚å¸¸ç»ˆæ­¢, è¯¥çº¿ç¨‹ä¼šè°ƒç”¨ std::terminate, å¯¼è‡´è¿›ç¨‹ç»ˆæ­¢. å› æ­¤ä¸åº”è¯¥ä¾èµ–è¿”å›å€¼æˆ–å¼‚å¸¸å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥å’Œé€šä¿¡, å¯ä»¥ä½¿ç”¨ std::promise æˆ– åŒæ­¥ çš„å…±äº«å˜é‡. C++ 11 ä¸­ä¸º thread å¯¹è±¡æä¾›çš„æ§åˆ¶æ“ä½œæå°‘, åªæœ‰ join å’Œ detach ä¸¤ç§: join: é˜»å¡ å½“å‰ çº¿ç¨‹, ç­‰å¾…è°ƒç”¨ join å‡½æ•°çš„é‚£ä¸ª thread å¯¹è±¡ç»“æŸæ‰§è¡Œ detach: å°†è°ƒç”¨ detach å‡½æ•°çš„çº¿ç¨‹ä¸ å½“å‰ çº¿ç¨‹å‰¥ç¦»å¹¶ç‹¬ç«‹æ‰§è¡Œ, å½“å‰çº¿ç¨‹ä¸å†æ‹¥æœ‰è¯¥ thread å¯¹è±¡. å€¼å¾—æ³¨æ„çš„æ˜¯, thread è¿˜æä¾›äº† joinable æ“ä½œ, ç”¨äºæ£€æŸ¥ä¸€ä¸ª thread å¯¹è±¡æ˜¯å¦å¯ä»¥è°ƒç”¨ join å‡½æ•°. è¿™ä¸ªæ£€æŸ¥çš„æ„ä¹‰åœ¨äº, å¯¹äº thread_id ä¸å½“å‰çº¿ç¨‹ç›¸åŒçš„ thread å¯¹è±¡, ä¸€æ—¦è°ƒç”¨ join, è¯¥çº¿ç¨‹å°±ä¼šä¸€ç›´é˜»å¡: join çš„è¯­ä¹‰æ˜¯é˜»å¡ç›´åˆ°è°ƒç”¨è€…æ‰§è¡Œç»“æŸ, è€Œæ‰§è¡Œè€…åˆæ°å¥½æ­£æ˜¯è¿™ä¸ªè¢«é˜»å¡çš„çº¿ç¨‹, é‚£ä¹ˆå®ƒå°†æ°¸è¿œæ— æ³•é†’æ¥. å¹¸è€Œåœ¨ C++ ä¸­æˆ‘ä»¬æ— æ³•å¯¹ joinable() è¿”å› false çš„ thread å¯¹è±¡è°ƒç”¨ join, å¦åˆ™å°†æœ‰å¤šå°‘æ­»é”çš„çº¿ç¨‹å‡ºç°. joinable å‡½æ•°çš„å®ç°å…¶å®éå¸¸ç®€å•, å°±æ˜¯åˆ¤æ–­å½“å‰çº¿ç¨‹å’Œè°ƒç”¨è¯¥å‡½æ•°çš„é‚£ä¸ªå¯¹è±¡çš„ id æ˜¯å¦ç›¸åŒ: this-&gt;get_id() != std::thread::id(). jthread jthread æ˜¯ C++ 20 å¼•å…¥çš„æ–°çº¿ç¨‹ç±», å®ƒçš„åŠŸèƒ½å’Œ thread ä¸€è‡´, å¹¶éæ›´é«˜çº§çš„çº¿ç¨‹, åªæ˜¯å¯¹ thread API ä¸åˆç†çš„è®¾è®¡æä¾›ä¸€ä¸ª wrapper. ä¸ thread ç›¸åŒ, jthread ä¹Ÿæä¾›äº†ç›¸åŒè¯­ä¹‰çš„ join å’Œ detach å‡½æ•°. ä¸åŒçš„æ˜¯, å¯¹äºä¸€ä¸ª thread å¯¹è±¡, å¦‚æœä½ åœ¨å®ƒææ„ä¹‹å‰æ²¡æœ‰è°ƒç”¨ join æˆ– detach å‡½æ•°, é‚£ä¹ˆå®ƒå°±ä¼šåœ¨ææ„å‡½æ•°è°ƒç”¨ terminate ç»ˆæ­¢æ•´ä¸ªè¿›ç¨‹, è¿™å¸¦æ¥å¾ˆå¤šä¸ä¾¿: 1234~thread() &#123; if (joinable()) std::terminate();&#125; è€Œ jthread åˆ™ä¼šåœ¨ææ„å‡½æ•°ä¸­è¯·æ±‚ç»ˆæ­¢è¯¥çº¿ç¨‹å¹¶è‡ªåŠ¨ join: 123456~jthread() &#123; if (joinable()) &#123; request_stop(); join(); &#125;&#125; åŒæ—¶ jthread è¿˜æä¾›äº†ä¸€ä¸ªæ˜¾å¼ç»ˆæ­¢çº¿ç¨‹æ‰§è¡Œçš„æœºåˆ¶, å³ std::stop_source å’Œ std::stop_token. æ¯ä¸ª jthread å¯¹è±¡éƒ½æŒæœ‰ä¸€ä¸ª std::stop_source, å®ƒä»£è¡¨ä¸€ä¸ªå…±äº«çš„ç»ˆæ­¢çŠ¶æ€. åœ¨çº¿ç¨‹å¼€å§‹æ‰§è¡Œæ—¶, jthread ä¼šå°†è¯¥å…±äº«çŠ¶æ€ä¼ å…¥å¯è°ƒç”¨å¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°, è¿™å°±è¦æ±‚å¯è°ƒç”¨å¯¹è±¡çš„æ¥å£æ¥å—ä¸€ä¸ª std::stop_token ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°. å½“å¤–éƒ¨çº¿ç¨‹å¯¹ jthread å¯¹è±¡ request_stop æ—¶, å®é™…ä¸Šå°±æ˜¯åœ¨å°è¯•è®¾ç½® jthread å†…éƒ¨çš„ std::stop_source çŠ¶æ€. éœ€è¦æ³¨æ„çš„æ˜¯, è®¾ç½®äº† std::stop_token å¹¶ä¸ä»£è¡¨çœŸçš„å¯ä»¥åœæ­¢çº¿ç¨‹æ‰§è¡Œ, çœŸæ­£çš„çº¿ç¨‹åœæ­¢é€»è¾‘è¿˜éœ€è¦åœ¨ç”¨æˆ·ä»£ç æ˜¾å¼åœ°è®¾è®¡. ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­: 12345678910111213void f(std::stop_token stop_token, int value) &#123; while (!stop_token.stop_requested()) &#123; std::cout &lt;&lt; value++ &lt;&lt; &#x27; &#x27; &lt;&lt; std::flush; std::this_thread::sleep_for(200ms); &#125; std::cout &lt;&lt; std::endl;&#125;int main() &#123; std::jthread thread(f, 5); // prints 5 6 7 8... for approximately 3 seconds std::this_thread::sleep_for(3s); // The destructor of jthread calls request_stop() and join().&#125; å¦‚æœæ²¡æœ‰ std::this_thread::sleep_for(3s), é‚£ä¹ˆ jtherad å¯¹è±¡ä¼šåœ¨ææ„æ—¶è‡ªåŠ¨ request_stop, ä½¿å¾—å‡½æ•° f åŠæ—¶åœæ­¢, æœ€ç»ˆå¯èƒ½ä¸€ä¸ªæ•°å­—ä¹Ÿä¸ä¼šè¾“å‡º. è€Œè¿™ä¸€è¡Œä¸ºæ˜¯ç”±äº f å‡½æ•°ä¸­æ˜¾å¼åœ°ä»¥ stop_token å‚æ•°çš„çŠ¶æ€ä½œä¸ºå¾ªç¯æ¡ä»¶å®ç°çš„. å…¶ä»–åŠŸèƒ½ yield: è®©å‡º CPU, ç­‰å¾…ä¸‹æ¬¡è°ƒåº¦. æ˜¾ç„¶åœ°, åœ¨æŸäº›æƒ…å†µä¸‹ (å¦‚å½“å‰çº¿ç¨‹æ˜¯å”¯ä¸€çº¿ç¨‹), è¯¥å‡½æ•°æ²¡æœ‰æ•ˆæœ. get_id: è·å–çº¿ç¨‹ id sleep_for: ç¡çœ  (é˜»å¡) ä¸€æ®µæ—¶é—´, ç”±äºè°ƒåº¦ç­–ç•¥è¯¥æ—¶é—´å¯èƒ½æ¯”ä¼ å…¥çš„æ—¶é—´ç¨é•¿ sleep_until: ç¡çœ  (é˜»å¡) ç›´åˆ°ç»™å®šçš„æ—¶é—´ç‚¹, æ—¶é—´ç‚¹å¹¶ ä¸ ä¼šè¢«ç²¾ç¡®éµå®ˆ C++ 20 ä¸­ä¸ºçº¿ç¨‹ç»ˆæ­¢æ‰€æä¾›çš„ä¸‰ä¸ªå·¥å…·: stop_token: ç”¨äºæŸ¥è¯¢æ˜¯å¦æœ‰ stop_request è¢«å‘èµ·çš„æ¥å£ stop_source: ç”¨äºè¡¨ç¤º stop_request çš„è¯·æ±‚æƒ…å†µ stop_callback: ç”¨äºä¸ºçº¿ç¨‹ç»ˆæ­¢æ³¨å†Œ callback çš„æ¥å£ è¿™ä¸‰ä¸ªç±»çš„å®ç°å’Œå…³ç³»æ¯”è¾ƒç®€å•. é¦–å…ˆ stop_token å’Œ stop_source ä¸­éƒ½æŒæœ‰ _Stop_state_ref ç±»å‹çš„æˆå‘˜, è€Œè¿™ä¸ª _Stop_state_ref åˆ™æ˜¯ä¸€ä¸ªå¼•ç”¨è®¡æ•°å‹çš„ pointer wrapper, ç±»ä¼¼ shared_ptr. å…¶å†…éƒ¨æŒæœ‰çš„ _Stop_state_t ç±»å‹çš„æŒ‡é’ˆæŒ‡å‘çš„æ˜¯çœŸæ­£çš„ stop request state. ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºæ˜¯è¿™ä¸ª _Stop_state_t æŒ‡é’ˆå°† stop_token å’Œ stop_source å…³è”èµ·æ¥çš„, å³å®ƒä»¬éƒ½é—´æ¥é€šè¿‡ _Stop_state_ref æŒ‡å‘åŒä¸€ä¸ªä½äºå †ä¸Šçš„ _Stop_state_t. stop_callback åˆ™æ˜¯ä¸€ä¸ª RAII ç±», åœ¨æ„é€ å‡½æ•°ä¸­å®ƒå°†å¯è°ƒç”¨å¯¹è±¡å³ callback æ³¨å†Œåˆ° _Stop_state_t, å¹¶åœ¨ææ„å‡½æ•°ä¸­æ³¨é”€. ä¸”æ³¨å†Œå’Œæ³¨é”€çš„å®ç°åˆ™æ˜¯åœ¨ _Stop_state_t ä¸­æŒæœ‰ä¸€ä¸ªåŒå‘é“¾è¡¨çš„å¤´èŠ‚ç‚¹, åŒå‘é“¾è¡¨çš„èŠ‚ç‚¹å…ƒç´ åˆ™æ˜¯åŒ…è£…ä¸º _Stop_cb çš„ callback æœ¬ä½“, è¿™æ ·å°±å¯ä»¥åœ¨æ³¨å†Œæ—¶æ’å…¥èŠ‚ç‚¹, æ³¨é”€æ—¶åˆ é™¤èŠ‚ç‚¹, stop request æ—¶æ‰§è¡Œé“¾è¡¨ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹. åŒæ—¶æ ‡å‡†ä¿è¯æ‰€æœ‰èŠ‚ç‚¹çš„æ‰§è¡Œæ˜¯åŒæ­¥çš„. References Concurrency support library (since C++11) - cppreference.com c++ - When should you use std:ğŸ§µ:joinable? - Stack Overflow c++ - What is std::jthread in c++20? - Stack Overflow","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://blog.zhuwenq.cc/tags/C/"},{"name":"Concurrency","slug":"Concurrency","permalink":"https://blog.zhuwenq.cc/tags/Concurrency/"},{"name":"thread","slug":"thread","permalink":"https://blog.zhuwenq.cc/tags/thread/"}]},{"title":"C++ storage duration and specifiers","slug":"C-storage-duration-and-specifiers","date":"2023-06-19T08:17:18.000Z","updated":"2023-06-21T06:51:28.780Z","comments":true,"path":"C-storage-duration-and-specifiers/","link":"","permalink":"https://blog.zhuwenq.cc/C-storage-duration-and-specifiers/","excerpt":"å¶ç„¶åœ¨ vscode çš„ä»£ç æç¤ºä¸­çœ‹åˆ°äº† thread_local è¿™ä¸ªå…³é”®å­—, å¿ƒæƒ³ C++ ä¸­ä»€ä¹ˆæ—¶å€™æä¾›äº†è¿™ç§ä¸œè¥¿. ç¿»äº†ä¸‹ cppreference æ‰çŸ¥é“æ—©åœ¨ C++ 11 ä¸­å°±å¼•å…¥äº†è¿™ä¸ªä¿®é¥°ç¬¦, ç”¨äºå£°æ˜çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ. è¶æ­¤æœºä¼šç³»ç»Ÿåœ°çœ‹äº†ä¸‹ C++ å˜é‡çš„ 4 ç§ç”Ÿå‘½å‘¨æœŸ, ç‰¹æ­¤è®°å½•.","text":"å¶ç„¶åœ¨ vscode çš„ä»£ç æç¤ºä¸­çœ‹åˆ°äº† thread_local è¿™ä¸ªå…³é”®å­—, å¿ƒæƒ³ C++ ä¸­ä»€ä¹ˆæ—¶å€™æä¾›äº†è¿™ç§ä¸œè¥¿. ç¿»äº†ä¸‹ cppreference æ‰çŸ¥é“æ—©åœ¨ C++ 11 ä¸­å°±å¼•å…¥äº†è¿™ä¸ªä¿®é¥°ç¬¦, ç”¨äºå£°æ˜çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ. è¶æ­¤æœºä¼šç³»ç»Ÿåœ°çœ‹äº†ä¸‹ C++ å˜é‡çš„ 4 ç§ç”Ÿå‘½å‘¨æœŸ, ç‰¹æ­¤è®°å½•. C++ 11 ä¸­æä¾›å››ç§å˜é‡å­˜å‚¨å‘¨æœŸ, åˆ†åˆ«æ˜¯: automatic: è‡ªåŠ¨å­˜å‚¨å‘¨æœŸ, å˜é‡çš„å­˜å‚¨ç©ºé—´ä¼šåœ¨å…¶æ‰€å¤„çš„ä»£ç å—å¼€å§‹æ—¶åˆ†é…, å¹¶åœ¨ç»“æŸæ—¶é‡Šæ”¾. static: é™æ€å­˜å‚¨å‘¨æœŸ, å˜é‡çš„å­˜å‚¨ç©ºé—´åœ¨ç¨‹åºå¼€å§‹æ—¶åˆ†é…, å¹¶åœ¨ç»“æŸæ—¶é‡Šæ”¾. åœ¨ç¨‹åºè¿è¡Œå‘¨æœŸä¸­è¯¥å˜é‡åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹. thread: çº¿ç¨‹å­˜å‚¨å‘¨æœŸ, å˜é‡çš„å­˜å‚¨ç©ºé—´åœ¨å…¶æ‰€å±çš„çº¿ç¨‹å¯åŠ¨æ—¶åˆ†é…, å¹¶åœ¨çº¿ç¨‹ç»“æŸæ—¶é‡Šæ”¾. æ¯ä¸ªçº¿ç¨‹ä¸­è¯¥å˜é‡éƒ½å­˜åœ¨ä¸€ä¸ªå®ä¾‹. dynamic: åŠ¨æ€å­˜å‚¨å‘¨æœŸ, å˜é‡å­˜å‚¨ç©ºé—´çš„åˆ†é…å’Œé‡Šæ”¾ç”±ç”¨æˆ·ä»£ç æ§åˆ¶. å¯¹äºä¸Šè¿°çš„å­˜å‚¨å‘¨æœŸ, åœ¨ C++ ä¸­å¯ä»¥é€šè¿‡ä»¥ä¸‹çš„ specifiers æ˜¾å¼åœ°å£°æ˜: no specifiers: automatic. åœ¨ C++ ä¸­æ‰€æœ‰å˜é‡é»˜è®¤æ˜¯è‡ªåŠ¨å­˜å‚¨å‘¨æœŸçš„, é™¤éæ˜¯å…¨å±€å˜é‡ (file scope or namespace scope), æˆ–æ˜¾å¼å£°æ˜äº† static/extern çš„å˜é‡. register: automatic. register ä¿®é¥°ç¬¦åªå…è®¸ç”¨åœ¨å±€éƒ¨å˜é‡æˆ–å‡½æ•°å‚æ•°ä¸Š, å®ƒæ˜¯ä¸€ç§ç¼–è¯‘å™¨å»ºè®®, è¯­ä¹‰æ˜¯å»ºè®®ç¼–è¯‘å™¨å°†è¯¥å˜é‡å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ä½œä¸ºä¸€ç§ä¼˜åŒ–. æ­¤ä¿®é¥°ç¬¦åœ¨ C++ 17 ä¸­å·²ç»åºŸå¼ƒ. static: static. static ä¿®é¥°ç¬¦æœ‰å¤šç§è¯­ä¹‰, ç”¨åœ¨ å±€éƒ¨ å˜é‡çš„å£°æ˜ä¸­è¡¨ç¤ºè¯¥å˜é‡å…·æœ‰é™æ€å­˜å‚¨å‘¨æœŸ. extern: ä¸å½±å“å˜é‡çš„å­˜å‚¨å‘¨æœŸ, åªè¡¨ç¤ºè¯¥å˜é‡ (ç¬¦å·) å…·æœ‰ external linkage. ä½†æ˜¯ç”±äº extern å£°æ˜ç¬¦åªèƒ½ç”¨åœ¨å…¨å±€å˜é‡æˆ–å‡½æ•°çš„ å£°æ˜ ä¸­, å› æ­¤å‡¡æ˜¯è¢« extern ä¿®é¥°çš„å˜é‡éƒ½å…·æœ‰ static æˆ– thread å­˜å‚¨å‘¨æœŸ. thread_local: thread. thread_local æ˜¯ C++ 11 ä¸­å¼•å…¥çš„å…³é”®å­—, ç”¨äºä¿®é¥°å…¨å±€å˜é‡, å±€éƒ¨å˜é‡æˆ– é™æ€ æˆå‘˜å˜é‡. è¡¨ç¤ºè¯¥å˜é‡å…·æœ‰ thread å­˜å‚¨å‘¨æœŸ. ç”¨åœ¨å±€éƒ¨å˜é‡ä¸Šæ—¶, éšå«æœ‰ static è¯­ä¹‰. ç”¨åœ¨å…¨å±€å˜é‡ä¸Šæ—¶, å¯ä»¥å’Œ static æˆ– extern åˆç”¨, è¡¨ç¤º internal/external linkage. References Storage class specifiers - cppreference.com","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://blog.zhuwenq.cc/tags/C/"},{"name":"storage duration","slug":"storage-duration","permalink":"https://blog.zhuwenq.cc/tags/storage-duration/"},{"name":"basic concepts","slug":"basic-concepts","permalink":"https://blog.zhuwenq.cc/tags/basic-concepts/"}]},{"title":"C++ black magic: åˆ©ç”¨å‹å…ƒå‡½æ•°å’Œæ˜¾å¼å®ä¾‹åŒ–çªç ´è®¿é—®æƒé™","slug":"C-black-magic-åˆ©ç”¨å‹å…ƒå‡½æ•°å’Œæ˜¾å¼å®ä¾‹åŒ–çªç ´è®¿é—®æƒé™","date":"2023-06-03T14:34:16.000Z","updated":"2023-06-21T06:51:28.780Z","comments":true,"path":"C-black-magic-åˆ©ç”¨å‹å…ƒå‡½æ•°å’Œæ˜¾å¼å®ä¾‹åŒ–çªç ´è®¿é—®æƒé™/","link":"","permalink":"https://blog.zhuwenq.cc/C-black-magic-%E5%88%A9%E7%94%A8%E5%8F%8B%E5%85%83%E5%87%BD%E6%95%B0%E5%92%8C%E6%98%BE%E5%BC%8F%E5%AE%9E%E4%BE%8B%E5%8C%96%E7%AA%81%E7%A0%B4%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90/","excerpt":"C++ ä¸­çš„éç»§æ‰¿ç±»æœ‰ä¸¤ç§è®¿é—®æƒé™, private å’Œ public. ä¸€èˆ¬æ¥è¯´, private åªå…è®¸ç±»å‹å†…éƒ¨ä½¿ç”¨, ä¸å…è®¸å¤–éƒ¨è®¿é—®. ç„¶è€Œ, ç”±äº C++ è¯­è¨€å·¨å¤§çš„å¤æ‚æ€§, è¿™ä¸€çº¦æŸå­˜åœ¨è‹¥å¹²æ¼æ´. ä¸€ç§ç®€å•çš„åšæ³•å°±æ˜¯å‡è®¾ C++ ç¼–è¯‘å™¨ä¸ä¼šå¯¹ç±»å¯¹è±¡çš„å†…å­˜å¸ƒå±€åšå¥‡æ€ªçš„æ‰°åŠ¨, è¿™ä¸€å‡è®¾é€šå¸¸æ˜¯æ­£ç¡®çš„, å› æ­¤å¯ä»¥é€šè¿‡çŒœæµ‹ç§æœ‰æˆå‘˜ç›¸å¯¹å¯¹è±¡æ•´ä½“çš„åœ°å€åç§»é‡è®¿é—®ç§æœ‰æˆå‘˜. æˆ–è€…æ›´åŠ æ–¹ä¾¿åœ°é€šè¿‡å®šä¹‰ä¸€ä¸ªæˆå‘˜å®Œå…¨ç›¸åŒä½†è®¿é—®æƒé™ç›¸åçš„ç±», å¹¶å°†åŸç±»å¯¹è±¡çš„æŒ‡é’ˆè½¬æ¢æˆæ–°ç±»çš„æŒ‡é’ˆçš„æ–¹å¼è®¿é—®åŸç±»å¯¹è±¡çš„ç§æœ‰æŒ‡é’ˆ. è¿™ä¸¤ç§æ–¹æ³•æœ¬è´¨ä¸Šéƒ½åŸºäºã€Œå‡è®¾ã€, å³å‡è®¾ C++ ç¼–è¯‘å™¨ä¸ä¼šå¯¹ç±»å‹çš„æˆå‘˜åšç‰¹æ®Šçš„å¤„ç†. æœ¬æ–‡ä»‹ç»ä¸€ç§æ›´åŠ ä¼˜é›…çš„æ–¹æ³•, å¯ä»¥ç¨³å®šåœ°å®ç°å¯¹ç§æœ‰æˆå‘˜çš„è®¿é—®.","text":"C++ ä¸­çš„éç»§æ‰¿ç±»æœ‰ä¸¤ç§è®¿é—®æƒé™, private å’Œ public. ä¸€èˆ¬æ¥è¯´, private åªå…è®¸ç±»å‹å†…éƒ¨ä½¿ç”¨, ä¸å…è®¸å¤–éƒ¨è®¿é—®. ç„¶è€Œ, ç”±äº C++ è¯­è¨€å·¨å¤§çš„å¤æ‚æ€§, è¿™ä¸€çº¦æŸå­˜åœ¨è‹¥å¹²æ¼æ´. ä¸€ç§ç®€å•çš„åšæ³•å°±æ˜¯å‡è®¾ C++ ç¼–è¯‘å™¨ä¸ä¼šå¯¹ç±»å¯¹è±¡çš„å†…å­˜å¸ƒå±€åšå¥‡æ€ªçš„æ‰°åŠ¨, è¿™ä¸€å‡è®¾é€šå¸¸æ˜¯æ­£ç¡®çš„, å› æ­¤å¯ä»¥é€šè¿‡çŒœæµ‹ç§æœ‰æˆå‘˜ç›¸å¯¹å¯¹è±¡æ•´ä½“çš„åœ°å€åç§»é‡è®¿é—®ç§æœ‰æˆå‘˜. æˆ–è€…æ›´åŠ æ–¹ä¾¿åœ°é€šè¿‡å®šä¹‰ä¸€ä¸ªæˆå‘˜å®Œå…¨ç›¸åŒä½†è®¿é—®æƒé™ç›¸åçš„ç±», å¹¶å°†åŸç±»å¯¹è±¡çš„æŒ‡é’ˆè½¬æ¢æˆæ–°ç±»çš„æŒ‡é’ˆçš„æ–¹å¼è®¿é—®åŸç±»å¯¹è±¡çš„ç§æœ‰æŒ‡é’ˆ. è¿™ä¸¤ç§æ–¹æ³•æœ¬è´¨ä¸Šéƒ½åŸºäºã€Œå‡è®¾ã€, å³å‡è®¾ C++ ç¼–è¯‘å™¨ä¸ä¼šå¯¹ç±»å‹çš„æˆå‘˜åšç‰¹æ®Šçš„å¤„ç†. æœ¬æ–‡ä»‹ç»ä¸€ç§æ›´åŠ ä¼˜é›…çš„æ–¹æ³•, å¯ä»¥ç¨³å®šåœ°å®ç°å¯¹ç§æœ‰æˆå‘˜çš„è®¿é—®. åŸºæœ¬çš„æ€è·¯æ˜¯åˆ©ç”¨å‹å…ƒå‡½æ•°, ç”±äºå‹å…ƒå‡½æ•°è¿™ä¸€ç‰¹æ®Šå‡½æ•°ä¸å±äºæˆå‘˜, è€Œå®ƒåˆå…·æœ‰å°†ç±»å‹çš„æˆå‘˜å¸¦åˆ°å…¨å±€å‘½åç©ºé—´çš„èƒ½åŠ›. å…·ä½“çš„ä»£ç å¦‚ä¸‹: å¯¹äºä¸€ä¸ªå«æœ‰ç§æœ‰æˆå‘˜çš„ç±»: 1234class Private &#123;private: int a = 1;&#125;; æˆ‘ä»¬æƒ³é€šè¿‡ä¸€ä¸ªã€Œå°å·ã€ç±»å·å–å®ƒçš„ç§æœ‰æˆå‘˜: 1234567891011template &lt;auto Member&gt;class theft &#123;&#125;;template &lt;typename T, typename U, T U::*Member&gt;class theft&lt;Member&gt; &#123; friend T&amp; steal(U&amp; u) &#123; return u.*Member; &#125;&#125;;int&amp; steal(Private&amp;); å¯ä»¥çœ‹åˆ°ä¸Šé¢å®šä¹‰çš„ã€Œå°å·ã€ç±»æ˜¯ä¸€ä¸ªæ¨¡æ¿, å®ƒæœ‰ä¸€ä¸ªä¸‡èƒ½çš„ä¸»æ¨¡æ¿, å¯ä»¥åŒ¹é…ä»»æ„ç±»å‹. åŒæ—¶æœ‰ä¸€ä¸ªç‰¹åŒ–æ¨¡æ¿, ç‰¹åŒ–æ¨¡æ¿çš„æ¨¡æ¿å‚æ•° Member è¢«å£°æ˜ä¸ºç±»å‹ä¸ºæŒ‡å‘ç±»å‹ä¸º T çš„å¯¹è±¡çš„æŒ‡é’ˆ, åŒæ—¶è¿™ä¸ª Member æŒ‡é’ˆæŒ‡å‘çš„æ˜¯ç±»å‹ U çš„æˆå‘˜: T U::*Member. åŒæ—¶æ³¨æ„åˆ°, ç‰¹åŒ–çš„ã€Œå°å·ã€æ¨¡æ¿ä¸­æœ‰ä¸€ä¸ªå‹å…ƒå‡½æ•° steal çš„å®šä¹‰, åœ¨è¿™ä¸ªå®šä¹‰ä¸­, å®ƒç›´æ¥è¿”å›äº†å¯¹æœªçŸ¥ç±»å‹ U çš„æœªçŸ¥æˆå‘˜æŒ‡é’ˆ Member è§£å¼•ç”¨çš„ç»“æœ. åŒæ—¶éœ€è¦æ³¨æ„, steal æœ‰ä¸€ä¸ªå…¨å±€ä½œç”¨åŸŸå£°æ˜. æ˜¾ç„¶åœ°, å¦‚æœ Member æŒ‡å‘çš„æ˜¯ç±»å‹ U çš„ç§æœ‰æˆå‘˜, é‚£ä¹ˆã€Œå°å·ã€ç±»å‹å°†æ— æ³•æ„é€ å‡ºå…·ä½“çš„å¯¹è±¡, ç¼–è¯‘å™¨ä¼šåœ¨æ£€æŸ¥åˆ°å¯¹ç§æœ‰æˆå‘˜è®¿é—®çš„æ—¶å€™å‘å‡ºæŠ±æ€¨. ä½† C++ ä¸­å¯ä»¥å¯¹æ¨¡æ¿ç±» æ˜¾ç¤ºå®ä¾‹åŒ–, è€Œä¸”è¿™ä¸ªæ˜¾ç¤ºå®ä¾‹åŒ–è¿‡ç¨‹æ˜¯ä¸ä¼šæ£€æŸ¥æˆå‘˜è®¿é—®æƒé™çš„. å› æ­¤å¦‚æœæˆ‘ä»¬å†™ä¸‹ä¸‹é¢çš„ä»£ç : 1template class theft&lt;&amp;Private::a&gt;; ã€Œå°å·ã€æ¨¡æ¿å°±ä¼šå®ä¾‹åŒ–æˆåŠŸ, æ¨¡æ¿å‚æ•° T, U, Member åˆ†åˆ«ä¼šè¢«æ›¿æ¢ä¸º int, Private, &amp;Private::a. æ­¤æ—¶æˆ‘ä»¬ä»ç„¶æ„é€ è¿™ä¸ªç±», ä½†æ˜¯ä»”ç»†åˆ†æ, åœ¨å®ä¾‹åŒ–æˆåŠŸæ—¶, å‡½æ•° int steal(Private&amp;) æœ‰äº†ä¸€ä¸ªå®šä¹‰, å³å‹å…ƒå®šä¹‰. é‚£ä¹ˆæˆ‘ä»¬åœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶, ç¼–è¯‘å™¨å¯ä»¥æ‰¾åˆ°åˆé€‚çš„å®šä¹‰, è‡ªç„¶ä¸ä¼šå‘å‡ºä»»ä½•æŠ±æ€¨ ! 12345678#include &lt;iostream&gt;using std::cout;int main() &#123; Private p; endl(cout &lt;&lt; steal(p)); // 1 steal(p) = 100; endl(cout &lt;&lt; steal(p)); // 100&#125; æ•´ä¸ªè¿‡ç¨‹å…·æœ‰ä¸€ç§å£°ä¸œå‡»è¥¿çš„æ„Ÿè§‰, ä¸å¤Ÿèªæ˜çš„ç¼–è¯‘å™¨åªèƒ½ç¼´æ¢°æŠ•é™. ä»£ç : https://godbolt.org/z/brs6MPcfc Reference http://eel.is/c++draft/temp.spec#6 https://www.zhihu.com/question/521898260","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"C++ Template","slug":"C-Template","permalink":"https://blog.zhuwenq.cc/tags/C-Template/"},{"name":"é»‘é­”æ³•","slug":"é»‘é­”æ³•","permalink":"https://blog.zhuwenq.cc/tags/%E9%BB%91%E9%AD%94%E6%B3%95/"}]},{"title":"C++ å¯¹è±¡ã€è™šå‡½æ•°ä¸ç»§æ‰¿","slug":"C-å¯¹è±¡ã€è™šå‡½æ•°ä¸ç»§æ‰¿","date":"2023-04-14T08:00:26.000Z","updated":"2023-06-21T06:51:28.780Z","comments":true,"path":"C-å¯¹è±¡ã€è™šå‡½æ•°ä¸ç»§æ‰¿/","link":"","permalink":"https://blog.zhuwenq.cc/C-%E5%AF%B9%E8%B1%A1%E3%80%81%E8%99%9A%E5%87%BD%E6%95%B0%E4%B8%8E%E7%BB%A7%E6%89%BF/","excerpt":"C++ ä¸­ä»¥ç»§æ‰¿çš„æ–¹å¼å®ç°åŠ¨æ€å¤šæ€æ˜¯å­˜åœ¨é¢å¤–å¼€é”€çš„, å…·ä½“åœ°è¯´ï¼ŒC++ å¯¹è±¡ä½¿ç”¨äº†é¢å¤–çš„å†…å­˜ä¿å­˜å…³äºåŸºç±»ä¿¡æ¯æ‰å®ç°äº†è¿è¡Œæ—¶å¤šæ€. ä½†è¿™ç§é¢å¤–ä¿¡æ¯ç©¶ç«Ÿä»¥ä½•ç§æ–¹å¼åœ¨å¯¹è±¡çš„å†…å­˜ä¸­æŠ¥é”™å¯¹æˆ‘æ¥è¯´ä»æ˜¯æœªçŸ¥. å—åˆ°å‰äººæ–‡ç« çš„å¯å‘, æœ¬æ–‡å€ŸåŠ© GDB è°ƒè¯•å™¨ä¸€æ­¥æ­¥åœ°è§‚å¯Ÿè®°å½• C++ å¯¹è±¡çš„å†…å­˜å¸ƒå±€, åŠ›æ±‚ç†è§£å®é™… C++ ç¼–è¯‘å™¨ (gcc 9.4.0) å¯¹ C++ å¯¹è±¡çš„å†…å­˜å¸ƒå±€ä»¥åŠæ´¾ç”Ÿç±»çš„å®ç°.","text":"C++ ä¸­ä»¥ç»§æ‰¿çš„æ–¹å¼å®ç°åŠ¨æ€å¤šæ€æ˜¯å­˜åœ¨é¢å¤–å¼€é”€çš„, å…·ä½“åœ°è¯´ï¼ŒC++ å¯¹è±¡ä½¿ç”¨äº†é¢å¤–çš„å†…å­˜ä¿å­˜å…³äºåŸºç±»ä¿¡æ¯æ‰å®ç°äº†è¿è¡Œæ—¶å¤šæ€. ä½†è¿™ç§é¢å¤–ä¿¡æ¯ç©¶ç«Ÿä»¥ä½•ç§æ–¹å¼åœ¨å¯¹è±¡çš„å†…å­˜ä¸­æŠ¥é”™å¯¹æˆ‘æ¥è¯´ä»æ˜¯æœªçŸ¥. å—åˆ°å‰äººæ–‡ç« çš„å¯å‘, æœ¬æ–‡å€ŸåŠ© GDB è°ƒè¯•å™¨ä¸€æ­¥æ­¥åœ°è§‚å¯Ÿè®°å½• C++ å¯¹è±¡çš„å†…å­˜å¸ƒå±€, åŠ›æ±‚ç†è§£å®é™… C++ ç¼–è¯‘å™¨ (gcc 9.4.0) å¯¹ C++ å¯¹è±¡çš„å†…å­˜å¸ƒå±€ä»¥åŠæ´¾ç”Ÿç±»çš„å®ç°. ä»ç©ºç±»è°ˆèµ· å¯¹äºç©ºçš„ç±», æˆ‘ä»¬éƒ½çŸ¥é“å®ƒç†è®ºä¸Šçš„ size åº”è¯¥æ˜¯ 0, ä½†æ˜¯å®é™…ä½¿ç”¨ sizeof è¿ç®—ç¬¦çš„ç»“æœæ˜¯ 1. è¿™æ˜¯å› ä¸ºä¸ºäº†å®ç°å¯¹å¯¹è±¡çš„å¼•ç”¨, å¯¹è±¡å¿…é¡»åœ¨å†…å­˜ä¸­å æœ‰ä¸€å®šçš„ä½ç½®æ‰èƒ½æ‹¥æœ‰ä¸€ä¸ªåœ°å€. C++ ç¼–è¯‘å™¨å¯¹è¿™ä¸€è¦æ±‚çš„å®ç°å°±æ˜¯ä¸ºç©ºç±»åˆ†é…ä¸€ä¸ªå­—èŠ‚çš„å†…å­˜. 12345678910#include &lt;iostream&gt;using std::cout;class EmptyBase &#123;&#125;;int main() &#123; EmptyBase empty&#123;&#125;; // output: 1 1 cout &lt;&lt; sizeof(EmptyBase) &lt;&lt; &quot; &quot; &lt;&lt; sizeof(empty); return 0;&#125; å¯¹ä¸Šè¿°ä»£ç è°ƒè¯•çš„ç»“æœä¹Ÿæ”¯æŒè¿™ä¸€ç»“è®º: 123456(gdb) p empty$1 = &#123;&lt;No data fields&gt;&#125;(gdb) p sizeof(empty)$2 = 1 # sizeof empty is 1(gdb) p sizeof(EmptyBase)$3 = 1 # sizeof EmptyBase (type) is 1 å½“ç±»å‹éç©ºæ—¶, ä¾‹å¦‚ç±»å‹ä¸­æœ‰æˆå‘˜å˜é‡æ—¶, ç¼–è¯‘å™¨å°±ä¸å†éœ€è¦ç‰¹æ®Šçš„ç©ºå­—èŠ‚ä»¥ç»´æŒå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å­˜åœ¨äº†. 12345678class NonEmptyBase &#123; int i&#123;&#125;; int j&#123;&#125;&#125;;int main() &#123; NonEmptyBase b&#123;&#125;; return 0;&#125; å¯¹è±¡çš„åœ°å€å°±æ˜¯å…¶ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡çš„åœ°å€, å¹¶ä¸”å¯ä»¥çœ‹å‡ºå¯¹äºå¤šä¸ªæˆå‘˜å˜é‡, å…¶åœ°å€æ˜¯æŒ‰ç…§åœ¨ç±»ä¸­å®šä¹‰çš„é¡ºåºè¿ç»­åˆ†é…çš„. 12345678910111213(gdb) p b$3 = &#123; i = 0, j = 0&#125;(gdb) p sizeof b$4 = 8(gdb) p &amp;b$5 = (NonEmptyBase *) 0x7fffffffd7f8(gdb) p &amp;b.i$6 = (int *) 0x7fffffffd7f8(gdb) p &amp;b.j$7 = (int *) 0x7fffffffd7fc è™šå‡½æ•°çš„å½±å“ å½“ç±»çš„å®šä¹‰ä¸­å­˜åœ¨è™šå‡½æ•°æ—¶, ç¼–è¯‘å™¨ä¼šåœ¨å¯¹è±¡çš„å†…å­˜ä¸­é¢å¤–å­˜å‚¨ä¸€ä¸ª vptr(è™šè¡¨æŒ‡é’ˆ), æŒ‡å‘ä¸€ä¸ªè™šå‡½æ•°è¡¨, è™šå‡½æ•°è¡¨ä¸­çš„æ¡ç›®å³è™šå‡½æ•°æŒ‡é’ˆ. 12345678910class EmptyBase &#123; public: virtual void foo() &#123; endl(cout &lt;&lt; &quot;EmptyBase foo&quot;); &#125; virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase bar&quot;); &#125;&#125;;int main()&#123; EmptyBase eb&#123;&#125;; return 0;&#125; å¯¹äºä¸Šé¢å®šä¹‰çš„ EmptyBase, å…¶è¿è¡Œæ—¶è°ƒè¯•ä¿¡æ¯æ˜¯: 12345678(gdb) p eb$1 = &#123; _vptr.EmptyBase = 0x555555557d78 &lt;vtable for EmptyBase+16&gt;&#125;(gdb) p sizeof(eb)$2 = 8(gdb) p &amp;eb$3 = (EmptyBase *) 0x7fffffffd7f8 å¯ä»¥çœ‹å‡ºå¯¹è±¡çš„å†…å­˜ä¸­å­˜æœ‰ä¸€ä¸ª _vptr, å…¶å€¼æ˜¯ä¸€ä¸ª 64 ä½æ•´æ•°, ä»£è¡¨ä¸€ä¸ªåœ°å€. æ‰“å°è¿™ä¸ªåœ°å€å¤„çš„å†…å®¹: 12(gdb) p /a *(void **)0x555555557d78$2 = 0x55555555522a &lt;EmptyBase::foo()&gt; å¯ä»¥çœ‹åˆ°å…¶å†…å®¹æ˜¯ EmptyBase çš„æˆå‘˜å‡½æ•° EmptyBase::foo. è€ƒè™‘åˆ° EmptyBase ä¸­å®šä¹‰äº†ä¸¤ä¸ªè™šå‡½æ•°, çŒœæµ‹ç¬¬äºŒä¸ªè™šå‡½æ•°ä½ç½®åº”è¯¥åœ¨ EmptyBase::foo åé¢: 12$2 = 0x55555555522a &lt;EmptyBase::foo()&gt;(gdb) p /a *(void **)(0x555555557d78 + 8) æ ¹æ®è¿™äº›ä¿¡æ¯å¯ä»¥å¤§è‡´ç”»å‡ºå¯¹è±¡ eb çš„å†…å­˜å¸ƒå±€: æ´¾ç”Ÿç±»çš„å†…å­˜æ¨¡å‹ å­˜åœ¨ç»§æ‰¿å…³ç³»æ—¶, å¯¹è±¡çš„å†…å­˜ä¸­åº”è¯¥å«æœ‰åŸºç±»çš„æˆå‘˜. 123456789101112131415class EmptyBase &#123; public: virtual void foo() &#123; endl(cout &lt;&lt; &quot;EmptyBase foo&quot;); &#125; virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase bar&quot;); &#125;&#125;;class Derived : public EmptyBase &#123; public: void foo() override &#123; endl(cout &lt;&lt; &quot;Derived foo&quot;); &#125;&#125;;int main() &#123; Derived eb&#123;&#125;; return 0;&#125; eb çš„è°ƒè¯•ä¿¡æ¯ä¸º: 123456789(gdb) p eb$4 = &#123; &lt;EmptyBase&gt; = &#123; _vptr.EmptyBase = 0x555555557d60 &lt;vtable for Derived+16&gt; &#125;, &lt;No data fields&gt;&#125;(gdb) p sizeof(eb)$5 = 8(gdb) p &amp;eb$6 = (Derived *) 0x7fffffffd7f8 å¾ˆç®€å•, ä¼¼ä¹ eb ç›´æ¥æŠŠæ´¾ç”Ÿç±»çš„éƒ¨åˆ†æ”¾è¿›è‡ªå·±çš„å†…å­˜. æ‰“å° _vptr æŒ‡å‘çš„è™šè¡¨: 1234(gdb) p /a *(void **)(0x555555557d60)$2 = 0x555555555258 &lt;Derived::foo()&gt;(gdb) p /a *(void **)(0x555555557d60 + 8)$3 = 0x55555555522a &lt;EmptyBase::bar()&gt; å¯ä»¥çœ‹åˆ°å¯¹äºæ´¾ç”Ÿç±»ä¸­æ²¡æœ‰é‡å†™çš„å‡½æ•° EmptyBase::bar, è™šè¡¨ä¸­ä¿å­˜çš„ä»ç„¶æ˜¯æ´¾ç”Ÿç±»çš„å®ç°çš„åœ°å€; è€Œå¯¹äºé‡å†™çš„å‡½æ•° foo, è™šè¡¨ä¸­çš„æ¡ç›®è¢«ä¿®æ”¹ä¸ºäº†æ´¾ç”Ÿç±»çš„å®ç°åœ°å€. æ³¨æ„è¿™ä¸€è¿‡ç¨‹æ˜¯ç¼–è¯‘æ—¶å‘ç”Ÿçš„, å› æ­¤å¯¹ç»§æ‰¿çš„è¿™ç§å½¢å¼çš„ä½¿ç”¨è¿˜ç§°ä¸ä¸Šã€Œå¤šæ€ã€. æ´¾ç”Ÿç±»çš„é override è™šå‡½æ•° éœ€è¦æ³¨æ„çš„æ˜¯, override æ˜¯ä¸€ç§è¯­ä¹‰è€Œéæœºåˆ¶, å¹¶éå£°æ˜ä¸º override çš„å‡½æ•°æ‰æ˜¯é‡å†™å‡½æ•°. å®é™…ä¸Š, åªè¦æ˜¯æ´¾ç”Ÿç±»ä¸­çš„å‡½æ•°å®šä¹‰ (virtual or not) åœ¨åŸºç±»ä¸­å­˜åœ¨åŒåè™šå‡½æ•°, é‚£ä¹ˆè¿™ä¸ªæ´¾ç”Ÿç±»çš„å‡½æ•°å°±è¢«ç§°ä¸º override äº†åŸºç±»ä¸­çš„è™šå‡½æ•°ç‰ˆæœ¬. é‚£ä¹ˆå¯¹äºæ´¾ç”Ÿç±»ä¸­çš„é override è™šå‡½æ•°, C++ æ˜¯å¦‚ä½•å¤„ç†çš„å‘¢? 12345678910111213141516class EmptyBase &#123; public: virtual void foo() &#123; endl(cout &lt;&lt; &quot;EmptyBase foo&quot;); &#125; virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase bar&quot;); &#125;&#125;;class Derived : public EmptyBase &#123; public: void foo() override &#123; endl(cout &lt;&lt; &quot;Derived foo&quot;); &#125; virtual void foobar () &#123;&#125;&#125;;int main() &#123; Derived d; return 0;&#125; ä¸Šé¢çš„å®ç°ä¸­, å‡½æ•° Derived::foobar å°±æ˜¯ä¸€ä¸ªé override è™šå‡½æ•°, æˆ‘ä»¬é€šè¿‡å¯¹è±¡ d æ‰“å°å‡ºå®ƒçš„å†…å­˜å¸ƒå±€: 1234567891011(gdb) p d$1 = &#123; &lt;EmptyBase&gt; = &#123; _vptr.EmptyBase = 0x555555557d50 &lt;vtable for Derived+16&gt; &#125;, &lt;No data fields&gt;&#125;(gdb) p /a *(void **)(0x555555557d50)$2 = 0x55555555529e &lt;Derived::foo()&gt;(gdb) p /a *(void **)(0x555555557d50 + 8)$3 = 0x555555555270 &lt;EmptyBase::bar()&gt;(gdb) p /a *(void **)(0x555555557d50 + 16)$5 = 0x5555555552cc &lt;Derived::foobar()&gt; å¯ä»¥çœ‹å‡º, å†…å­˜ä¸­ä»ç„¶æ˜¯åªæœ‰åŸºç±»çš„è™šè¡¨æŒ‡é’ˆå­˜åœ¨, å¹¶ä¸”éœ€è¡¨ä¸­å­˜åœ¨ 3 ä¸ªå‡½æ•°æŒ‡é’ˆ, åˆ†åˆ«æ˜¯: æ´¾ç”Ÿç±» override çš„ Derived::foo åŸºç±»å®šä¹‰çš„ EmptyBase::Bar æ´¾ç”Ÿç±»ç‰¹æœ‰çš„ Derived::foobar å¯ä»¥å¾—å‡ºç»“è®º: å¯¹äºæ´¾ç”Ÿç±»ä¸­çš„é override è™šå‡½æ•°, C++ çš„å¤„ç†æ–¹å¼æ˜¯å°†å®ƒçš„æŒ‡é’ˆæ”¾åœ¨è™šè¡¨ä¸­åŸºç±»å‡½æ•°æ¡ç›®çš„åé¢. å¤šæ€çš„å®ç° åœ¨ç»§æ‰¿è¿™ä¸€è¯­å¢ƒä¸­, ã€Œå¤šæ€ã€è¿™ä¸€æœ¯è¯­é€šå¸¸æŒ‡è¿è¡Œæ—¶å¤šæ€, å³æŒ‡å‘åŸºç±»çš„æŒ‡é’ˆåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å†³å®šè°ƒç”¨å‡½æ•°çš„å“ªä¸€ä»½å®ç°. ä¸‹é¢æ¨¡æ‹Ÿç±»ä¼¼çš„åœºæ™¯: 1234567891011121314151617181920212223242526class EmptyBase &#123; public: virtual void foo() &#123; endl(cout &lt;&lt; &quot;EmptyBase foo&quot;); &#125; virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase bar&quot;); &#125;&#125;;class Derived : public EmptyBase &#123; public: void foo() override &#123; endl(cout &lt;&lt; &quot;Derived foo&quot;); &#125;&#125;;class Derived2nd : public EmptyBase &#123; public: void bar() override &#123; endl(cout &lt;&lt; &quot;Derived2nd bar&quot;); &#125;&#125;;int main() &#123; EmptyBase* b = new Derived; b-&gt;foo(); b-&gt;bar(); b = new Derived2nd; b-&gt;foo(); b-&gt;bar(); return 0;&#125; ä¸Šé¢çš„å®ç°ä¸­, æ´¾ç”Ÿç±» Derived å’Œ Derived2nd åˆ†åˆ«é‡å†™äº†åŸºç±» EmptyBase çš„ foo å’Œ bar å‡½æ•°. åœ¨ä¸»å‡½æ•°ä¸­, é€šè¿‡ä¸€ä¸ªåŸºç±»çš„æŒ‡é’ˆ b åˆ†åˆ«è°ƒç”¨ b-&gt;foo(), b-&gt;bar(), è¾“å‡ºçš„ç»“æœæ˜¯: 1234Derived fooEmptyBase barEmptyBase fooDerived2nd bar å¯ä»¥çœ‹å‡º, å½“åŸºç±»æŒ‡é’ˆ b æŒ‡å‘çš„æ˜¯ç±»å‹ Derived çš„å¯¹è±¡æ—¶, b-&gt;foo() è°ƒç”¨çš„æ˜¯ Derived::foo, b-&gt;bar() è°ƒç”¨çš„æ˜¯ EmptyBase::bar(). å½“è¿è¡Œæ—¶å°†æŒ‡é’ˆ b æŒ‡å‘ Derived2nd çš„å¯¹è±¡å, å†æ¬¡å¯¹åŒæ ·çš„æŒ‡é’ˆè°ƒç”¨ foo å’Œ bar å‡½æ•°, å®é™…è°ƒç”¨çš„å‡½æ•°å˜ä¸ºäº† EmptyBase::foo(), EmptyBase::bar(). è¿™æ ·åœ¨è¿è¡Œæ—¶å¯ä»¥åŠ¨æ€æ”¹å˜è¢«è°ƒç”¨å‡½æ•°çš„è¡Œä¸ºå³è¿è¡Œæ—¶å¤šæ€. ä¸‹é¢è§‚å¯Ÿ Derived å¯¹è±¡å’Œ Derived2nd å¯¹è±¡çš„å†…å­˜å¸ƒå±€: é¦–å…ˆåœ¨ç¬¬ 19 è¡Œä½ç½®è®¾ç½®æ–­ç‚¹, ç„¶åæ‰“å° b æŒ‡é’ˆ (æ­¤æ—¶æŒ‡å‘ Derived å¯¹è±¡) çš„ä¿¡æ¯ 12345678(gdb) p *b$2 = &#123; _vptr.EmptyBase = 0x555555557d20 &lt;vtable for Derived+16&gt;&#125;(gdb) p /a *(void **)(0x555555557d20)$4 = 0x55555555532a &lt;Derived::foo()&gt;(gdb) p /a *(void **)(0x555555557d20 + 8)$5 = 0x5555555552fc &lt;EmptyBase::bar()&gt; ç„¶ååœ¨ç¬¬ 23 è¡Œä½ç½®è®¾ç½®æ–­ç‚¹, ç»§ç»­æ‰§è¡Œç¨‹åº, æ‰“å° b æŒ‡é’ˆ (æ­¤æ—¶æŒ‡å‘ Derived2nd å¯¹è±¡) çš„ä¿¡æ¯ 1234567$6 = &#123; _vptr.EmptyBase = 0x555555557d00 &lt;vtable for Derived2nd+16&gt;&#125;(gdb) p /a *(void **)(0x555555557d00)$7 = 0x5555555552ce &lt;EmptyBase::foo()&gt;(gdb) p /a *(void **)(0x555555557d00 + 8)$8 = 0x555555555358 &lt;Derived2nd::bar()&gt; å¯ä»¥çœ‹å‡ºä¸Šè¿°å¯¹è±¡å†…å­˜å’Œè™šè¡¨ä¿¡æ¯çš„æ¨¡å¼ä¸ç›´æ¥ä½¿ç”¨å¯¹è±¡æ—¶æ²¡æœ‰åŒºåˆ«. è¿è¡Œæ—¶å¤šæ€çš„å®ç°å¾—ç›Šäºæ¯ä¸ªå¯¹è±¡å†…å­˜ä¸­çš„è™šè¡¨: è°ƒç”¨è™šå‡½æ•°æ—¶, åªéœ€è¦æŸ¥è¯¢è™šè¡¨ç„¶åå†³å®šè¦è°ƒç”¨å“ªä¸ªç‰ˆæœ¬çš„å®ç°å°±å¯ä»¥å®ç°å¤šæ€. ä½¿ç”¨åŸºç±»æŒ‡é’ˆæ—¶, éšç€åŸºç±»æŒ‡é’ˆæ‰€æŒ‡å‘çš„å¯¹è±¡çš„ä¸åŒ, è°ƒç”¨è™šå‡½æ•°æ—¶æ‰€æŸ¥è¯¢çš„è™šè¡¨è‡ªç„¶ä¹Ÿä¸åŒ. æŒ‰é“ç†è¯´, è™šè¡¨å­˜åœ¨äºå¯¹è±¡çš„å†…å­˜ä¸­, é‚£ä¹ˆåªè¦åŠæ—¶æ›´æ–°å¯¹è±¡, ä½¿ç”¨åŸºç±»çš„å¯¹è±¡è€ŒéæŒ‡é’ˆåº”è¯¥ä¹Ÿå¯ä»¥æ˜¯å®ç°è¿è¡Œæ—¶å¤šæ€. å³ä¸‹é¢çš„ä»£ç : 1234567891011int main() &#123; EmptyBase b; b = Derived(); b.foo(); b.bar(); b = Derived2nd(); b.foo(); b.bar(); return 0;&#125; å¯å®é™…ä¸Šä¸Šé¢çš„ä»£ç è¾“å‡ºçš„ç»“æœæ˜¯: 1234EmptyBase fooEmptyBase barEmptyBase fooEmptyBase bar è¿™æ˜¯å› ä¸ºå¤åˆ¶å¯¹è±¡æ—¶, C++ ä¸ä¼šå¤åˆ¶å¯¹è±¡çš„è™šè¡¨æŒ‡é’ˆ, å› æ­¤åªèƒ½å°†æŒ‡é’ˆæŒ‡å‘ä¸åŒçš„æ´¾ç”Ÿç±»å¯¹è±¡, è€Œä¸èƒ½å°†æ´¾ç”Ÿç±»å¯¹è±¡èµ‹å€¼ç»™åŸºç±»å¯¹è±¡å®ç°å¤šæ€. å¤šé‡ç»§æ‰¿çš„æƒ…å†µ å½“ä¸€ä¸ªæ´¾ç”Ÿç±»åŒæ—¶ç»§æ‰¿å¤šä¸ªåŸºç±»æ—¶, æ´¾ç”Ÿç±»çš„è™šè¡¨ä¸­ä¼šåŒæ—¶å­˜åœ¨æ‰€æœ‰åŸºç±»çš„è™šè¡¨æ¡ç›®. 12345678910111213141516171819202122class EmptyBase &#123; public: virtual void foo() &#123; endl(cout &lt;&lt; &quot;EmptyBase foo&quot;); &#125; virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase bar&quot;); &#125;&#125;;class EmptyBase2nd &#123; public: virtual void foo() &#123; endl(cout &lt;&lt; &quot;EmptyBase2nd foo&quot;); &#125; virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase2nd bar&quot;); &#125;&#125;;class Derived : public EmptyBase, public EmptyBase2nd &#123; public: void foo() override &#123; endl(cout &lt;&lt; &quot;Derived foo&quot;); &#125; virtual void foobar() &#123;&#125;&#125;;int main() &#123; Derived d; return 0;&#125; ä¸Šé¢çš„å®ç°å…·æœ‰ä¸‹é¢çš„ç‰¹ç‚¹: æ´¾ç”Ÿç±»åŒæ—¶ç»§æ‰¿ EmptyBase å’Œ EmptyBase2nd EmptyBase å’Œ EmptyBase2nd ä¸­éƒ½å®šä¹‰æœ‰è™šå‡½æ•° foo å’Œ bar æ´¾ç”Ÿç±» Derived ä¸­ override äº†è™šå‡½æ•° foo, å®šä¹‰äº†æ–°çš„è™šå‡½æ•° foobar ä¸‹é¢é€šè¿‡å¯¹è±¡ d è§‚å¯Ÿå…¶å†…å­˜å¸ƒå±€: é¦–å…ˆæ˜¯ d å¯¹è±¡æœ¬èº«, å¯ä»¥çœ‹åˆ°å®ƒå†…éƒ¨æœ‰ä¸¤ä¸ªè™šè¡¨æŒ‡é’ˆ 12345678(gdb) p d$1 = &#123; &lt;EmptyBase&gt; = &#123; _vptr.EmptyBase = 0x555555557d00 &lt;vtable for Derived+16&gt; &#125;, &lt;EmptyBase2nd&gt; = &#123; _vptr.EmptyBase2nd = 0x555555557d28 &lt;vtable for Derived+56&gt; &#125;, &lt;No data fields&gt;&#125; è§‚å¯Ÿç¬¬ä¸€ä¸ªåŸºç±» EmptyBase çš„è™šè¡¨: 123456(gdb) p /a *(void**)(0x555555557d00)$2 = 0x5555555552d8 &lt;Derived::foo()&gt;(gdb) p /a *(void**)(0x555555557d00 + 8)$3 = 0x55555555527c &lt;EmptyBase::bar()&gt;(gdb) p /a *(void**)(0x555555557d00 + 16)$4 = 0x555555555310 &lt;Derived::foobar()&gt; å…¶ä¸­çš„å†…å®¹æ˜¯: è™šå‡½æ•° foo (åœ°å€è¢«æ´¾ç”Ÿç±»çš„ override å®ç°è¦†ç›–) è™šå‡½æ•° bar (åŸºç±»çš„å®ç°) æ´¾ç”Ÿç±»ç‰¹æœ‰çš„è™šå‡½æ•° foobar (æ´¾ç”Ÿç±»çš„è™šå‡½æ•°æ¡ç›®å­˜å‚¨åœ¨ç¬¬ä¸€åŸºç±»çš„è™šè¡¨ä¸­) è§‚å¯Ÿç¬¬äºŒä¸ªåŸºç±» EmptyBase2nd çš„è™šè¡¨: 1234(gdb) p /a *(void**)(0x555555557d28)$6 = 0x555555555306 &lt;_ZThn8_N7Derived3fooEv&gt;(gdb) p /a *(void**)(0x555555557d28 + 8)$7 = 0x5555555552aa &lt;EmptyBase2nd::bar()&gt; æ³¨æ„åˆ°å…¶ä¸­ç¬¬ä¸€ä¸ªæ¡ç›®æ˜¯ä¸€ä¸ªç‰¹æ®Šä¿¡æ¯ &lt;_ZThn8_N7Derived3fooEv&gt;, æ ¹æ®ä¸Šé¢çš„è§‚å¯Ÿå¾—åˆ°çš„ç»éªŒ, è¿™ä¸ªæ¡ç›®æœ¬åº”è¯¥ç”¨æ¥å­˜å‚¨è™šå‡½æ•° foo. ä½†æ˜¯è€ƒè™‘åˆ°è™šå‡½æ•° foo è¢«æ´¾ç”Ÿç±» override, å¹¶ä¸”åœ¨ EmptyBase çš„è™šè¡¨ä¸­å·²ç»å­˜äº† Derived::foo çš„åœ°å€, é‚£ä¹ˆæˆ‘çŒœæƒ³è¿™é‡Œçš„ç‰¹æ®Šä¿¡æ¯æ˜¯æŒ‡å¯¼é€šè¿‡ EmptyBase2nd çš„æŒ‡é’ˆè°ƒç”¨ foo å‡½æ•°æ—¶é‡å®šä½åˆ° Derived::foo ç”¨çš„. è™šè¡¨çš„ç¬¬äºŒä¸ªæ¡ç›®å°±æ¯”è¾ƒç¬¦åˆå¸¸è§„, æ˜¯ EmptyBase2nd::bar çš„åœ°å€. æ€»çš„æ¥è¯´, ä¸Šé¢çš„å¤šé‡ç»§æ‰¿å†…å­˜å¸ƒå±€å¯ä»¥ç®€è¿°ä¸ºä¸‹å›¾: å¤šé‡ç»§æ‰¿çš„æ­§ä¹‰æ€§ ä¸Šé¢å¯¹æ´¾ç”Ÿç±»çš„å†…å­˜æ¨¡å‹çš„åˆ†æçœ‹èµ·æ¥å¾ˆç¾å¥½, ä½†å®é™…ä¸Šå­˜åœ¨ä¸€äº›é—®é¢˜. ä¾‹å¦‚ä¸Šé¢çš„å¤šé‡ç»§æ‰¿ä¾‹å­ä¸­, å¦‚æœæ´¾ç”Ÿç±» Derived çš„å¯¹è±¡ d è°ƒç”¨äº†åŸºç±» EmptyBase å’Œ EmptyBase2nd ä¸­éƒ½å­˜åœ¨å®šä¹‰çš„ bar å‡½æ•°: 1234567891011121314151617181920212223class EmptyBase &#123; public: virtual void foo() &#123; endl(cout &lt;&lt; &quot;EmptyBase foo&quot;); &#125; virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase bar&quot;); &#125;&#125;;class EmptyBase2nd &#123; public: virtual void foo() &#123; endl(cout &lt;&lt; &quot;EmptyBase2nd foo&quot;); &#125; virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase2nd bar&quot;); &#125;&#125;;class Derived : public EmptyBase, public EmptyBase2nd &#123; public: void foo() override &#123; endl(cout &lt;&lt; &quot;Derived foo&quot;); &#125; virtual void foobar() &#123;&#125;&#125;;int main() &#123; Derived d; d.bar(); // Error! return 0;&#125; é‚£ä¹ˆç¼–è¯‘å™¨ä¼šæŠ±æ€¨å®ƒæ— æ³•ç¡®å®šå…·ä½“è¦è°ƒç”¨å“ªä¸€ä¸ª bar çš„å®ç°: 1234567891011121314151617181920212223# error from gcc../polymorphism/polymorphism.cpp: In function â€˜int main()â€™:../polymorphism/polymorphism.cpp:23:5: error: request for member â€˜barâ€™ is ambiguous 23 | d.bar(); | ^~~../polymorphism/polymorphism.cpp:12:16: note: candidates are: â€˜virtual void EmptyBase2nd::bar()â€™ 12 | virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase2nd bar&quot;); &#125; | ^~~../polymorphism/polymorphism.cpp:6:16: note: â€˜virtual void EmptyBase::bar()â€™ 6 | virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase bar&quot;); &#125; | ^~~# error from clang../polymorphism/polymorphism.cpp:23:5: error: member &#x27;bar&#x27; found in multiple base classes of different types d.bar(); ^../polymorphism/polymorphism.cpp:6:16: note: member found by ambiguous name lookup virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase bar&quot;); &#125; ^../polymorphism/polymorphism.cpp:12:16: note: member found by ambiguous name lookup virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase2nd bar&quot;); &#125; ^1 error generated. æ ¹æ®ä¸Šé¢å¯¹å¤šé‡ç»§æ‰¿ä¸‹ Derived ç±»å‹å¯¹è±¡å†…å­˜çš„åˆ†æ, Derived ç±»å‹å¯¹è±¡çš„è™šè¡¨ä¸­åŒæ—¶å­˜åœ¨ EmptyBase::bar å’Œ EmptyBase2nd::bar. å†æ ¹æ® public ç»§æ‰¿çš„è¯­ä¹‰, Derived å¯¹è±¡ä¹Ÿæ˜¯ EmptyBase å¯¹è±¡å’Œ EmptyBase2nd å¯¹è±¡. å› æ­¤ Derived å¯¹è±¡å¯¹å‡½æ•° bar çš„è°ƒç”¨æ˜¯å…·æœ‰æ­§ä¹‰çš„: è°ƒç”¨ä»»ä½•ä¸€ä¸ªè€Œæ”¾å¼ƒå¦ä¸€ä¸ªéƒ½æ˜¯æ²¡æœ‰é“ç†çš„. è±å½¢ç»§æ‰¿ ä¸Šé¢çš„ä¾‹å­æ˜¯æˆ‘ä»¬éè¦åœ¨ä¸¤ä¸ªåŸºç±»ä¸­å®šä¹‰åŒä¸€ä¸ªè™šå‡½æ•°, ç„¶åè¿˜è¦åŒæ—¶ç»§æ‰¿, æœ€è¿‡åˆ†çš„æ˜¯è¿˜è¦ä¸åŠ åŒºåˆ†åœ°è°ƒç”¨, æ˜¯ä¸€ç§åº¸äººè‡ªæ‰°. é‚£ä¹ˆå†çœ‹å¦ä¸€ä¸ªåœºæ™¯: ç±»å‹ EmptyBase æ˜¯åŸºç±», ç±»å‹ MiddleA å’Œ MiddleB éƒ½ç»§æ‰¿ EmptyBase, ç±»å‹ Derived åˆ™å¤šé‡ç»§æ‰¿ MiddleA å’Œ MiddleB. å››ä¸ªç±»å‹çš„ç»§æ‰¿å…³ç³»å½¢æˆäº†ä¸€ä¸ªè±å½¢: å‡è®¾ MiddleA å’Œ MiddleB éƒ½æ˜¯ç©ºç±», é‚£ä¹ˆå°±ä¸å­˜åœ¨ä¸€ä¸ªè™šå‡½æ•°åœ¨ä¸¤ä¸ªåŸºç±»ä¸­å®šä¹‰çš„è¡Œä¸º, ä½†æ˜¯ä¸‹é¢çš„ä»£ç çš„è¡Œä¸ºä»ç„¶å­˜åœ¨é—®é¢˜: 123456789101112131415161718192021222324252627class EmptyBase &#123; public: EmptyBase() &#123; endl(cout &lt;&lt; &quot;Construct EmptyBase&quot;); &#125; ~EmptyBase() &#123; endl(cout &lt;&lt; &quot;Destruct EmptyBase&quot;); &#125; virtual void foo() &#123; endl(cout &lt;&lt; &quot;EmptyBase foo&quot;); &#125; virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase bar&quot;); &#125;&#125;;class MiddleA : public EmptyBase &#123; public: MiddleA() &#123; endl(cout &lt;&lt; &quot;Construct MiddleA&quot;); &#125; ~MiddleA() &#123; endl(cout &lt;&lt; &quot;Destruct MiddleA&quot;); &#125;&#125;;class MiddleB : public EmptyBase &#123; public: MiddleB() &#123; endl(cout &lt;&lt; &quot;Construct MiddleB&quot;); &#125; ~MiddleB() &#123; endl(cout &lt;&lt; &quot;Destruct MiddleB&quot;); &#125;&#125;;class Derived : public MiddleA, public MiddleB &#123;&#125;;int main() &#123; Derived d; // d.foo(); return 0;&#125; ä¸Šé¢çš„ä»£ç è¾“å‡ºä¸º: 12345678Construct EmptyBaseConstruct MiddleAConstruct EmptyBaseConstruct MiddleBDestruct MiddleBDestruct EmptyBaseDestruct MiddleADestruct EmptyBase å¯ä»¥çœ‹å‡º: EmptyBase è¢«æ„é€ å’Œææ„äº†ä¸¤æ¬¡, åˆ†åˆ«æ˜¯åœ¨æ„é€ å’Œææ„åŸºç±» MiddleA çš„éƒ¨åˆ†å’Œ MiddleB çš„éƒ¨åˆ†æ—¶. è¿™ä¸ªè¡Œä¸ºæ˜¯ä¸æ­£ç¡®çš„, å› ä¸ºå¯¹äºä¸€ä¸ªæ´¾ç”Ÿç±»çš„å¯¹è±¡ d, EmptyBase åœ¨è¯­ä¹‰ä¸Šåªæ˜¯å®ƒçš„åŸºç±», d ä¸­ä¸åº”è¯¥æœ‰ä¸¤ä»½ EmptyBase çš„æˆåˆ†. ç„¶è€Œå¦‚æœæˆ‘ä»¬æ·±å…¥è§‚å¯Ÿ d çš„å†…å­˜: 12345678910(gdb) p d$1 = &#123; &lt;MiddleA&gt; = &#123; &lt;EmptyBase&gt; = &#123; _vptr.EmptyBase = 0x555555557c70 &lt;vtable for Derived+16&gt; &#125;, &lt;No data fields&gt;&#125;, &lt;MiddleB&gt; = &#123; &lt;EmptyBase&gt; = &#123; _vptr.EmptyBase = 0x555555557c90 &lt;vtable for Derived+48&gt; &#125;, &lt;No data fields&gt;&#125;, &lt;No data fields&gt;&#125; ç„¶ååˆ†åˆ«è§‚å¯Ÿä¸¤ä¸ªè™šè¡¨çš„æ¡ç›®: 1234567891011# MiddleA::EmptyBase::_vptr.EmptyBase(gdb) p /a *(void **)(0x555555557c70)$2 = 0x55555555531e &lt;EmptyBase::foo()&gt;(gdb) p /a *(void **)(0x555555557c70 + 8)$3 = 0x55555555534c &lt;EmptyBase::bar()&gt;# MiddleB::EmptyBase::_vptr.EmptyBase(gdb) p /a *(void **)(0x555555557c90)$8 = 0x55555555531e &lt;EmptyBase::foo()&gt;(gdb) p /a *(void **)(0x555555557c90 + 8)$9 = 0x55555555534c &lt;EmptyBase::bar()&gt; å°±ä¼šå‘ç° d ä¸­ç¡®å®æ˜¯å­˜äº†ä¸¤ä»½å…³äº EmptyBase çš„ä¿¡æ¯, è¿™æ— ç–‘æ˜¯æ„šè ¢çš„. åŒæ ·çš„, å¦‚æœè°ƒç”¨ EmptyBase çš„ foo å’Œ bar ä¸­ä»»æ„å‡½æ•°, éƒ½ä¼šå¯¼è‡´æ­§ä¹‰æ€§ç¼–è¯‘é”™è¯¯. è™šç»§æ‰¿ å¯¹äºè±å½¢ç»§æ‰¿ä¸­çš„æ­§ä¹‰æ€§é—®é¢˜, C++ æä¾›çš„è§£å†³æ–¹æ¡ˆæ˜¯ è™šç»§æ‰¿, è™šç»§æ‰¿ä½“ç³»ä¸­çš„åŸºç±»è¢«ç§°ä¸ºè™šåŸºç±»: è™šç»§æ‰¿å®ç°çš„è¯­ä¹‰æ˜¯: è™šç»§æ‰¿çš„æ´¾ç”Ÿç±»å£°æ˜å®ƒæ„¿æ„å’Œå½“å‰è™šåŸºç±»çš„å…¶ä»–æ´¾ç”Ÿç±»å…±äº«è™šåŸºç±», å³åœ¨è±å½¢ç»§æ‰¿ä¸­ä¸¤ä¸ªä¸­é—´åŸºç±»å¯ä»¥å…±äº«æ ¹éƒ¨çš„è™šåŸºç±», å› æ­¤è±å½¢ç»§æ‰¿ä¸­ MiddleA å’Œ MiddleB ä½¿ç”¨è™šç»§æ‰¿çš„ç»“æœæ˜¯ Derived å¯¹è±¡ä¸­åªä¼šå­˜åœ¨ä¸€ä»½ EmptyBase çš„æˆåˆ†. 123456789101112131415161718192021222324252627class EmptyBase &#123; public: EmptyBase() &#123; endl(cout &lt;&lt; &quot;Construct EmptyBase&quot;); &#125; ~EmptyBase() &#123; endl(cout &lt;&lt; &quot;Destruct EmptyBase&quot;); &#125; virtual void foo() &#123; endl(cout &lt;&lt; &quot;EmptyBase foo&quot;); &#125; virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase bar&quot;); &#125;&#125;;class MiddleA : virtual public EmptyBase &#123; public: MiddleA() &#123; endl(cout &lt;&lt; &quot;Construct MiddleA&quot;); &#125; ~MiddleA() &#123; endl(cout &lt;&lt; &quot;Destruct MiddleA&quot;); &#125;&#125;;class MiddleB : public virtual EmptyBase &#123; public: MiddleB() &#123; endl(cout &lt;&lt; &quot;Construct MiddleB&quot;); &#125; ~MiddleB() &#123; endl(cout &lt;&lt; &quot;Destruct MiddleB&quot;); &#125;&#125;;class Derived : public MiddleA, public MiddleB &#123;&#125;;int main() &#123; Derived d; d.foo(); // OK return 0;&#125; æ­¤æ—¶å†æŸ¥çœ‹ d çš„å†…å­˜: 1234567(gdb) p d$1 = &#123; &lt;MiddleA&gt; = &#123; &lt;EmptyBase&gt; = &#123; _vptr.EmptyBase = 0x555555557ba0 &lt;vtable for Derived+40&gt; &#125;, &lt;No data fields&gt;&#125;, &lt;MiddleB&gt; = &#123;&lt;No data fields&gt;&#125;, &lt;No data fields&gt;&#125; éå¸¸å®¹æ˜“ç†è§£: ç°åœ¨ d ä¸­åªæœ‰ä¸€ä»½ EmptyBase çš„æˆåˆ†, å­˜å‚¨åœ¨ MiddleA çš„éƒ¨åˆ†ä¸­. è™šç»§æ‰¿çš„ä¸€èˆ¬æ¨¡å‹ æˆ‘ä»¬å·²ç»çŸ¥é“äº†åœ¨è±å½¢ç»§æ‰¿çš„æƒ…å†µä¸‹, è™šç»§æ‰¿æä¾›äº†ä¸€ç§å…±äº«æ ¹éƒ¨è™šåŸºç±»çš„æœºåˆ¶. ä¸Šé¢ç»™å‡ºçš„ä¾‹å­ä¸­, åªæœ‰è™šåŸºç±»ä¸­å­˜åœ¨è™šå‡½æ•°å®šä¹‰, ä¸­é—´åŸºç±»å’Œæ´¾ç”Ÿç±»ä¸­éƒ½æ²¡æœ‰æ•°æ®æˆå‘˜. é‚£ä¹ˆå¯¹äºä¸€èˆ¬çš„è™šç»§æ‰¿, C++ ä¼šå¦‚ä½•æ„å»ºå¯¹è±¡çš„å†…å­˜å‘¢? å•è™šç»§æ‰¿ é¦–å…ˆæ¨¡æ‹Ÿä¸€ç§ç®€å•çš„å•ç»§æ‰¿æƒ…å†µ: 123456789101112131415161718192021class EmptyBase &#123; int i&#123;&#125;; public: EmptyBase() &#123; endl(cout &lt;&lt; &quot;Construct EmptyBase&quot;); &#125; ~EmptyBase() &#123; endl(cout &lt;&lt; &quot;Destruct EmptyBase&quot;); &#125; virtual void foo() &#123; endl(cout &lt;&lt; &quot;EmptyBase foo&quot;); &#125; virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase bar&quot;); &#125;&#125;;class Derived : virtual public EmptyBase &#123; int l&#123;&#125;; virtual void bar() &#123;&#125; virtual void foobar() &#123;&#125;&#125;;int main() &#123; Derived d; d.foo(); // OK return 0;&#125; ä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªæœ‰è™šå‡½æ•°å’Œæˆå‘˜å˜é‡çš„åŸºç±», æ´¾ç”Ÿç±»é€šè¿‡è™šç»§æ‰¿ç»§æ‰¿è¿™ä¸ªåŸºç±», å¹¶ä¸”æ´¾ç”Ÿç±»ä¸­å®šä¹‰äº†: æˆå‘˜å˜é‡ override çš„è™šå‡½æ•° ç‰¹æœ‰çš„è™šå‡½æ•° ä¸‹é¢è§‚å¯Ÿæ´¾ç”Ÿç±»å¯¹è±¡ d çš„å†…å­˜: 12345678910(gdb) p d$1 = &#123; &lt;EmptyBase&gt; = &#123; _vptr.EmptyBase = 0x555555557d00 &lt;vtable for Derived+72&gt;, i = 0 &#125;, members of Derived: _vptr.Derived = 0x555555557cd0 &lt;vtable for Derived+24&gt;, l = 0&#125; å¯ä»¥çœ‹åˆ° Derived å¯¹è±¡ d çš„å†…å­˜ä¸­æœ‰è¿™ä¹ˆå‡ ä¸ªæ¡ç›®: åŸºç±» EmptyBase çš„éƒ¨åˆ† è™šè¡¨æŒ‡é’ˆ _vptr æˆå‘˜å˜é‡ i æ´¾ç”Ÿç±»çš„éƒ¨åˆ† è™šè¡¨æŒ‡é’ˆ _vptr æˆå‘˜å˜é‡ l ä¸ä¸€èˆ¬çš„æ´¾ç”Ÿç±» (éè™šç»§æ‰¿; [[#æ´¾ç”Ÿç±»çš„å†…å­˜æ¨¡å‹]]) ä¸åŒçš„åœ°æ–¹åœ¨äºå†…å­˜ä¸­æœ‰ä¸¤ä¸ªè™šè¡¨æŒ‡é’ˆ. ä¸‹é¢åˆ†åˆ«è§‚å¯Ÿè¿™ä¸¤ä¸ªè™šè¡¨æŒ‡é’ˆæŒ‡å‘çš„è™šè¡¨çš„å†…å®¹: EmptyBase::_vptr.EmptyBase: 12(gdb) p /a *(void **)(0x555555557d00)@2$2 = &#123;0x55555555535a &lt;EmptyBase::foo()&gt;, 0x5555555553c5 &lt;_ZTv0_n32_N7Derived3barEv&gt;&#125; Derived::_vptr.Derived: 12(gdb) p /a *(void **)(0x555555557cd0)@2$3 = &#123;0x5555555553b6 &lt;Derived::bar()&gt;, 0x5555555553d2 &lt;Derived::foobar()&gt;&#125; æ´¾ç”Ÿç±»çš„è™šè¡¨ä¸­å­˜æœ‰æ´¾ç”Ÿç±»å®šä¹‰çš„ä¸¤ä¸ªè™šå‡½æ•°çš„åœ°å€, è€ŒåŸºç±»çš„è™šè¡¨ä¸­åªæœ‰ä¸€ä¸ªè™šå‡½æ•°çš„åœ°å€. è¿™æ˜¯å› ä¸ºè™šåŸºç±»çš„å¦ä¸€ä¸ªè™šå‡½æ•°å·²ç»åœ¨æ´¾ç”Ÿç±»ä¸­ override, å› æ­¤è¿™ä¸ªè™šå‡½æ•°å·²ç»è¢«å­˜åœ¨äº†æ´¾ç”Ÿç±»çš„è™šè¡¨ä¸­, ä¸éœ€è¦åœ¨åŸºç±»çš„è™šè¡¨ä¸­é‡å¤. ä¸ éè™šç»§æ‰¿ çš„æ´¾ç”Ÿç±»å¯¹è±¡å†…å­˜åšä¸€ä¸ªå¯¹æ¯”: ä¸€ä¸ªä¸Šé¢çš„ä¾‹å­æ— æ³•æ­ç¤ºçš„äº‹å®: å®é™…ä¸Š, è™šç»§æ‰¿ä½“ç³»ä¸­, å³ä½¿æ´¾ç”Ÿç±»ä¸­æ²¡æœ‰å®šä¹‰è™šå‡½æ•°, åªè¦å…¶ä¸­æœ‰æˆå‘˜å˜é‡, ç¼–è¯‘å™¨å°±ä¼šä¸ºå…¶åˆ›å»ºè™šè¡¨æŒ‡é’ˆ. æ­¤æ—¶è¯¥è™šè¡¨æŒ‡é’ˆæŒ‡å‘çš„è™šè¡¨æ˜¯ç©ºçš„. è±å½¢ç»§æ‰¿ ä¸Šé¢è®¨è®ºäº†å•è™šç»§æ‰¿ä¸‹æ›´ä¸ºä¸€èˆ¬çš„å†…å­˜æ¨¡å‹, ä¸‹é¢è§‚å¯Ÿæ›´å…·ä¸€èˆ¬æ€§çš„è±å½¢è™šç»§æ‰¿å¯¹è±¡. é¦–å…ˆå®šä¹‰åŸºç±»å’Œæ´¾ç”Ÿç±»éƒ½å«æœ‰æˆå‘˜å˜é‡å’Œä¸€ä¸ª override è™šå‡½æ•°å’Œä¸€ä¸ªç‰¹æœ‰è™šå‡½æ•°çš„è±å½¢è™šç»§æ‰¿æ¨¡å‹: 123456789101112131415161718192021222324252627282930313233343536373839404142class EmptyBase &#123; int i&#123;&#125;; public: EmptyBase() &#123; endl(cout &lt;&lt; &quot;Construct EmptyBase&quot;); &#125; ~EmptyBase() &#123; endl(cout &lt;&lt; &quot;Destruct EmptyBase&quot;); &#125; virtual void foo() &#123; endl(cout &lt;&lt; &quot;EmptyBase foo&quot;); &#125; virtual void bar() &#123; endl(cout &lt;&lt; &quot;EmptyBase bar&quot;); &#125; virtual void func() &#123;&#125; virtual void foobarfunc() &#123;&#125;&#125;;class MiddleA : virtual public EmptyBase &#123; int a&#123;&#125;; public: MiddleA() &#123; endl(cout &lt;&lt; &quot;Construct MiddleA&quot;); &#125; ~MiddleA() &#123; endl(cout &lt;&lt; &quot;Destruct MiddleA&quot;); &#125; virtual void foo() override &#123;&#125; virtual void foobarA() &#123;&#125;&#125;;class MiddleB : public virtual EmptyBase &#123; int b&#123;&#125;; public: MiddleB() &#123; endl(cout &lt;&lt; &quot;Construct MiddleB&quot;); &#125; ~MiddleB() &#123; endl(cout &lt;&lt; &quot;Destruct MiddleB&quot;); &#125; virtual void bar() override &#123;&#125; virtual void foobarB() &#123;&#125;&#125;;class Derived : public MiddleA, public MiddleB &#123; int l&#123;&#125;; virtual void func() &#123;&#125; virtual void foobar() &#123;&#125;&#125;;int main() &#123; Derived d; return 0;&#125; æ³¨æ„åˆ°ä¸Šé¢çš„ç»§æ‰¿ä½“ç³»æœ‰ä»¥ä¸‹ç‰¹ç‚¹: åŸºç±» EmptyBase æœ‰ 4 ä¸ªè™šå‡½æ•°, å…¶ä¸­ä¸‰ä¸ªåˆ†åˆ«è¢«æ´¾ç”Ÿç±» override æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ æ¯ä¸ªæ´¾ç”Ÿç±»éƒ½æœ‰ä¸€ä¸ª override è™šå‡½æ•°å’Œä¸€ä¸ªç‰¹æœ‰çš„è™šå‡½æ•° å¯ä»¥ç”»å‡ºç»§æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º: å¯¹è±¡ d çš„å†…å­˜: 12345678910111213141516171819(gdb) p d$1 = &#123; &lt;MiddleA&gt; = &#123; &lt;EmptyBase&gt; = &#123; _vptr.EmptyBase = 0x555555557b68 &lt;vtable for Derived+144&gt;, i = 0 &#125;, members of MiddleA: _vptr.MiddleA = 0x555555557af0 &lt;vtable for Derived+24&gt;, a = 0 &#125;, &lt;MiddleB&gt; = &#123; members of MiddleB: _vptr.MiddleB = 0x555555557b28 &lt;vtable for Derived+80&gt;, b = 0 &#125;, members of Derived: l = 0&#125; ä¸‰ä¸ªè™šè¡¨æŒ‡é’ˆ, åˆ†åˆ«æ˜¯: è™šåŸºç±»çš„è™šè¡¨æŒ‡é’ˆ MiddleA::EmptyBase._vptr.EmptyBase (å­˜åœ¨äº MiddleA çš„éƒ¨åˆ†) MiddleA çš„è™šè¡¨æŒ‡é’ˆ MiddleA::_vptr.MiddleA MiddleB çš„è™šè¡¨æŒ‡é’ˆ MiddleB::_vptr.MiddleB å¯ä»¥çœ‹å‡ºè™šç»§æ‰¿åŠ æŒä¸‹çš„è±å½¢ç»§æ‰¿å®ç°äº†è™šåŸºç±» EmptyBase çš„å…±äº«, å¹¶ä¸”æ¯ä¸€ä¸ªè™šç»§æ‰¿çš„æ´¾ç”Ÿç±»éƒ½æŒæœ‰è‡ªå·±çš„è™šè¡¨æŒ‡é’ˆ (Derived ä¸æ˜¯è™šç»§æ‰¿, å› æ­¤å®ƒæ²¡æœ‰è‡ªå·±çš„è™šè¡¨æŒ‡é’ˆ). ä¸‹é¢åˆ†åˆ«è§‚å¯Ÿä¸‰ä¸ªè™šè¡¨çš„å†…å®¹: MiddleA::EmptyBase._vptr.EmptyBase: ä»åŸºå€ 0x555555557b68 å‡ºå‘æ‰“å° 12 ä¸ªåœ°å€ (8å­—èŠ‚å¯¹å…¶) çš„å†…å®¹, å‘ç°å…¶ä¸­å«æœ‰å¤§é‡çš„ç‰¹æ®Šä¿¡æ¯ 1234567(gdb) p /a *(void **)(0x555555557b68)@12$12 = &#123;0x555555555493 &lt;_ZTv0_n24_N7MiddleA3fooEv&gt;, 0x555555555591 &lt;_ZTv0_n32_N7MiddleB3barEv&gt;, 0x5555555555bd &lt;_ZTv0_n40_N7Derived4funcEv&gt;, 0x5555555553a2 &lt;EmptyBase::foobarfunc()&gt;, 0x555555557af0 &lt;_ZTV7Derived+24&gt;, 0x555555557bd8 &lt;_ZTC7Derived0_7MiddleA+24&gt;, 0x555555557c18 &lt;_ZTC7Derived0_7MiddleA+88&gt;, 0x555555557c50 &lt;_ZTC7Derived16_7MiddleB+24&gt;, 0x555555557c90 &lt;_ZTC7Derived16_7MiddleB+88&gt;, 0x555555557b68 &lt;_ZTV7Derived+144&gt;, 0x555555557b28 &lt;_ZTV7Derived+80&gt;, 0x20&#125; å…¶ä¸­çš„ 0x5555555553a2 &lt;EmptyBase::foobarfunc()&gt; æ˜¯å¯ä»¥è§£è¯»çš„å‡½æ•°åœ°å€. è¿™é‡Œçš„ç‰¹æ®Šä¿¡æ¯åœ¨æœ¬æ–‡ä¸­ä¸€ç›´é¿å…å¯¹å®ƒè¿›è¡Œè®¨è®º, ä¸»è¦å› ä¸º: ç¬”è€…æ°´å¹³å’Œè§è¯†æœ‰é™, å¯¹å®ƒä»¬æ²¡æœ‰è®¤è¯† è¿™ç±»ä¿¡æ¯å¾ˆå¤§ç¨‹åº¦ä¸Šä¸ç¼–è¯‘å™¨å®ç°å¯¹è±¡å†…å­˜çš„æ–¹å¼æœ‰å…³, ç¬”è€…å¸Œæœ›é¿å…å¯¹è¿™äº›ç‰¹æ®Šå®ç°ç»†èŠ‚çš„è®¨è®º ä½†ç¬”è€…åšä¸€ä¸ªå¤§èƒ†çš„çŒœæµ‹å°±æ˜¯è¿™äº›ä¿¡æ¯å¯èƒ½è·Ÿç±»å‹çš„è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯ (Run time type infomation, RTTI) æœ‰å…³. å¯è§å…³äºè™šå‡½æ•°, è™šåŸºç±» EmptyBase çš„è™šè¡¨ä¸­åªå­˜å‚¨äº†å®ƒç‰¹æœ‰çš„ä¸€ä¸ª. MiddleA::_vptr.MiddleA: æ‰“å°å‘ç°è¿™ä¸ªè™šè¡¨ä¸­æœ‰ 4 ä¸ªæœ‰æ•ˆçš„å‡½æ•°åœ°å€, å¹¶ä¸”ä¸­é—´è¿˜æœ‰å…¶ä»–ä¿¡æ¯ 123(gdb) p /a *(void **)(0x555555557af0)@4$17 = &#123;0x555555555484 &lt;MiddleA::foo()&gt;, 0x5555555554a0 &lt;MiddleA::foobarA()&gt;, 0x5555555555ae &lt;Derived::func()&gt;, 0x5555555555ca &lt;Derived::foobar()&gt;&#125; åˆ†åˆ«æ˜¯ 0x555555555484 &lt;MiddleA::foo()&gt; 0x5555555554a0 &lt;MiddleA::foobarA()&gt; 0x5555555555ae &lt;Derived::func()&gt; 0x5555555555ca &lt;Derived::foobar()&gt; è¿™è¯´æ˜ç¼–è¯‘å™¨å°†æ´¾ç”Ÿç±»çš„è™šå‡½æ•°ä¹Ÿéƒ½æ”¾è¿›äº†å®ƒçš„ MiddleA è™šè¡¨. MiddleB::_vptr.MiddleB: MiddleB çš„è™šè¡¨ä¸­åªæœ‰å®ƒè‡ªå·±çš„ä¸¤ä¸ªè™šå‡½æ•°åœ°å€ 12(gdb) p /a *(void **)(0x555555557b28)@2$20 = &#123;0x555555555582 &lt;MiddleB::bar()&gt;, 0x55555555559e &lt;MiddleB::foobarB()&gt;&#125; æ ¹æ®ä»¥ä¸Šè§‚å¯Ÿå¯ä»¥ç”»å‡ºä¸‹å›¾: éœ€è¦æ³¨æ„çš„æ˜¯, é™¤äº†ä¸Šå›¾ä¸­ EmptyBase çš„è™šè¡¨éƒ¨åˆ†, æœ¬æ–‡ä¸­æ‰€æœ‰è™šè¡¨å›¾ç¤ºéƒ½çœç•¥äº†é™¤è™šå‡½æ•°ä»¥å¤–çš„å…¶ä»–ä¿¡æ¯, ä½†å®é™…çš„è™šè¡¨ä¸­æ˜¯å«æœ‰é™¤è™šå‡½æ•°åœ°å€ä»¥å¤–çš„å¦‚ RTTI ä¿¡æ¯çš„. æ€»ç»“ æœ¬æ–‡ä¸­ç¬”è€…åˆ©ç”¨ GDB è°ƒè¯•å™¨è¿‘è·ç¦»è§‚å¯Ÿäº† C++ å¯¹è±¡åœ¨æ¶‰åŠè™šå‡½æ•°å’Œç»§æ‰¿æ—¶çš„å†…å­˜å¸ƒå±€, ä¸»è¦å…³æ³¨äº†ç¼–è¯‘å™¨å¯¹è™šå‡½æ•°çš„å¤„ç†, ä»¥åŠåŸºäºè™šè¡¨å’Œè™šè¡¨æŒ‡é’ˆå®ç°çš„å¤šæ€æœºåˆ¶. æœ€å, ç¬”è€…åˆ†æäº†è¾ƒä¸ºå¤æ‚çš„å¤šé‡ç»§æ‰¿å’Œè±å½¢ç»§æ‰¿æ¨¡å‹. å¯¹äºè±å½¢ç»§æ‰¿, C++ æä¾›äº†è™šç»§æ‰¿è¯­ä¹‰è§£å†³æ­§ä¹‰æ€§é—®é¢˜, ç¬”è€…å¯¹è¿™ä¸€è¯­ä¹‰çš„å®ç°å’Œè±å½¢ç»§æ‰¿å†…å­˜å¸ƒå±€è¿›è¡Œäº†è§‚å¯Ÿå’Œåˆ†æ. æœ¬æ–‡ä¸»è¦çš„è§‚å¯Ÿæœ‰: å¯¹äºæ²¡æœ‰è™šå‡½æ•°çš„ç±»å‹, å®ƒçš„å¯¹è±¡å†…å­˜ä¸­åªæœ‰è‡ªå·±çš„æˆå‘˜å˜é‡ å¯¹äºæ²¡æœ‰è™šå‡½æ•°çš„æ´¾ç”Ÿç±», å®ƒçš„å¯¹è±¡å†…å­˜å¸ƒå±€ç›¸å½“äºåµŒå¥—çš„ç»“æ„ä½“ å¯¹äºæœ‰è™šå‡½æ•°çš„ç±»å‹, å®ƒçš„å¯¹è±¡å†…å­˜ä¸­å­˜åœ¨ä¸€ä¸ªè™šè¡¨æŒ‡é’ˆ _vptr, æŒ‡å‘ä¸€ä¸ªè™šè¡¨. è™šè¡¨ä¸­çš„æ¡ç›®æ˜¯è¯¥ç±»å‹è™šå‡½æ•°çš„åœ°å€ å¯¹äºæ¶‰åŠè™šå‡½æ•°çš„ éè™šç»§æ‰¿ çš„æ´¾ç”Ÿç±», å®ƒçš„å†…å­˜æ¨¡å‹å’Œä¸æ¶‰åŠè™šå‡½æ•°æ—¶ä¸€è‡´, éƒ½æ˜¯åŒ…å«æœ‰åŸºç±»çš„éƒ¨åˆ†. åªä¸è¿‡åœ¨ åŸºç±» ä¸­æœ‰è™šå‡½æ•°æ—¶, æ´¾ç”Ÿç±»ä¸­çš„è™šå‡½æ•°ä¼šè¢«æ”¾è¿›è™šå‡½æ•°éƒ¨åˆ†çš„è™šè¡¨: å¯¹äºæ´¾ç”Ÿç±»ä¸­çš„ override è™šå‡½æ•°, ç¼–è¯‘å™¨çš„åšæ³•æ˜¯ç›´æ¥ä½¿ç”¨è¯¥ override è™šå‡½æ•°çš„åœ°å€è¦†ç›–åŸºç±»éƒ¨åˆ†è™šè¡¨ä¸­å¯¹åº”çš„æ¡ç›® å¯¹äºæ´¾ç”Ÿç±»ä¸­çš„é override è™šå‡½æ•°, ç¼–è¯‘å™¨çš„åšæ³•æ˜¯ç›´æ¥å°†è¯¥è™šå‡½æ•°çš„åœ°å€æ”¾åœ¨åŸºç±»éƒ¨åˆ†è™šè¡¨çš„åé¢ å¯¹äºå¤šé‡ éè™š ç»§æ‰¿, æ´¾ç”Ÿç±»çš„å†…å­˜å¸ƒå±€æ²¡æœ‰ç‰¹æ®Šæœºåˆ¶: ä»ç„¶æ˜¯æ´¾ç”Ÿç±»ä¸­åŒ…å«æœ‰åŸºç±»çš„éƒ¨åˆ†. å› æ­¤å½“å¤šä¸ªåŸºç±»ä¸­å«æœ‰ç›¸åŒå‡½æ•°ç­¾åçš„è™šå‡½æ•°æ—¶, æ´¾ç”Ÿç±»å¯¹è¯¥å‡½æ•°çš„è°ƒç”¨ä¼šäº§ç”Ÿæ­§ä¹‰. å¯¹äºè±å½¢ éè™š ç»§æ‰¿, å®ƒçš„æ­§ä¹‰æ€§äº§ç”ŸåŸå› å’Œå¤šé‡ç»§æ‰¿ä¸€æ ·: æ ¹éƒ¨åŸºç±»ä¸­çš„è™šå‡½æ•°åœ°å€åŒæ—¶å­˜åœ¨äºä¸­é—´å±‚åŸºç±»çš„è™šè¡¨ä¸­, å› æ­¤æ´¾ç”Ÿç±»å¯¹æ ¹éƒ¨åŸºç±»çš„è™šå‡½æ•°çš„è°ƒç”¨å­˜åœ¨å¤šæ¡è·¯å¾„. å¯¹äºè™šç»§æ‰¿è¯­ä¹‰, åœ¨è±å½¢ç»§æ‰¿æ—¶ C++ åªä¼šåœ¨æ´¾ç”Ÿç±»ä¸­å­˜æ”¾ä¸€ä»½è™šåŸºç±»çš„è™šå‡½æ•°åœ°å€, ä¸€èˆ¬å­˜åœ¨æ´¾ç”Ÿç±»çš„ç¬¬ä¸€é¡ºä½åŸºç±»ä¸­. Reference Zero-overhead principle - cppreference.com c++å¤´è„‘é£æš´-å¤šæ€ã€è™šç»§æ‰¿ã€å¤šé‡ç»§æ‰¿å†…å­˜å¸ƒå±€ - æ˜é‡‘ (juejin.cn) C++ä¸­è™šå‡½æ•°ã€è™šç»§æ‰¿å†…å­˜æ¨¡å‹ - çŸ¥ä¹ (zhihu.com) Derived classes - cppreference.com","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://blog.zhuwenq.cc/tags/C/"},{"name":"å¤šæ€","slug":"å¤šæ€","permalink":"https://blog.zhuwenq.cc/tags/%E5%A4%9A%E6%80%81/"},{"name":"å†…å­˜æ¨¡å‹","slug":"å†…å­˜æ¨¡å‹","permalink":"https://blog.zhuwenq.cc/tags/%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/"}]},{"title":"å†…å­˜å±éšœå’Œ C++ å†…å­˜æ¨¡å‹","slug":"å†…å­˜å±éšœå’Œ-C-å†…å­˜æ¨¡å‹","date":"2023-04-08T14:47:44.000Z","updated":"2023-06-21T06:51:28.936Z","comments":true,"path":"å†…å­˜å±éšœå’Œ-C-å†…å­˜æ¨¡å‹/","link":"","permalink":"https://blog.zhuwenq.cc/%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8C-C-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/","excerpt":"Memory Barrier æ˜¯ CPU æä¾›çš„ä¸€ç§æœºåˆ¶, å®ƒçš„ä½œç”¨æ˜¯åœ¨ç¨‹åºä¸­è®¾ç½®ä¸€ä¸ªå†…å­˜å±éšœ, CPU ä¼šä¿è¯æ‰€æœ‰åœ¨ Memory Barrier ä¹‹å‰çš„ä»£ç å¯¹å†…å­˜çš„è®¿é—® (æ”¹åŠ¨) åœ¨ Memory Barrier ä¹‹åéƒ½æ˜¯å¯è§çš„. è¿™ä¸€ä¿è¯æ®æœ‰ä¸¤æ–¹é¢çš„æ•ˆåº”: æ‰€æœ‰ Memory Barrier ä¹‹åçš„ä»£ç éƒ½ä¸èƒ½è¢«é‡æ’ (Reordering) åˆ° Memory Barrier ä¹‹å‰æ‰§è¡Œ å½“æ‰§è¡Œåˆ° Memory Barrier æ—¶, CPU å¿…é¡»åœ¨æ‰€æœ‰ Core ä¹‹é—´åŒæ­¥ Cache, ä¿è¯æ­¤åˆ»æ‰€æœ‰ Core çœ‹åˆ°çš„å†…å­˜æ˜¯ä¸€è‡´çš„. Memory Order æ˜¯ C++ 11 æä¾›çš„ä¸€ç§å¹¶å‘ç¼–ç¨‹æœºåˆ¶, å®ƒå…è®¸æ˜¾å¼åœ°é™åˆ¶ç¼–è¯‘å™¨/CPU å¯¹æŒ‡ä»¤çš„é‡æ’ (Reordering), ä»¥åŠæ˜¾å¼åœ°æ§åˆ¶å¤šæ ¸ CPU Cache ä¹‹é—´çš„åŒæ­¥. å…¶æ•ˆæœæ˜¯ä½¿å¾—ä¸åŒçº¿ç¨‹/ä¸åŒ CPU Core æ‰€è§‚å¯Ÿåˆ°çš„åŸå­æ“ä½œé™„è¿‘çš„å†…å­˜æ“ä½œå…·æœ‰å¯é¢„æµ‹çš„é¡ºåº.","text":"Memory Barrier æ˜¯ CPU æä¾›çš„ä¸€ç§æœºåˆ¶, å®ƒçš„ä½œç”¨æ˜¯åœ¨ç¨‹åºä¸­è®¾ç½®ä¸€ä¸ªå†…å­˜å±éšœ, CPU ä¼šä¿è¯æ‰€æœ‰åœ¨ Memory Barrier ä¹‹å‰çš„ä»£ç å¯¹å†…å­˜çš„è®¿é—® (æ”¹åŠ¨) åœ¨ Memory Barrier ä¹‹åéƒ½æ˜¯å¯è§çš„. è¿™ä¸€ä¿è¯æ®æœ‰ä¸¤æ–¹é¢çš„æ•ˆåº”: æ‰€æœ‰ Memory Barrier ä¹‹åçš„ä»£ç éƒ½ä¸èƒ½è¢«é‡æ’ (Reordering) åˆ° Memory Barrier ä¹‹å‰æ‰§è¡Œ å½“æ‰§è¡Œåˆ° Memory Barrier æ—¶, CPU å¿…é¡»åœ¨æ‰€æœ‰ Core ä¹‹é—´åŒæ­¥ Cache, ä¿è¯æ­¤åˆ»æ‰€æœ‰ Core çœ‹åˆ°çš„å†…å­˜æ˜¯ä¸€è‡´çš„. Memory Order æ˜¯ C++ 11 æä¾›çš„ä¸€ç§å¹¶å‘ç¼–ç¨‹æœºåˆ¶, å®ƒå…è®¸æ˜¾å¼åœ°é™åˆ¶ç¼–è¯‘å™¨/CPU å¯¹æŒ‡ä»¤çš„é‡æ’ (Reordering), ä»¥åŠæ˜¾å¼åœ°æ§åˆ¶å¤šæ ¸ CPU Cache ä¹‹é—´çš„åŒæ­¥. å…¶æ•ˆæœæ˜¯ä½¿å¾—ä¸åŒçº¿ç¨‹/ä¸åŒ CPU Core æ‰€è§‚å¯Ÿåˆ°çš„åŸå­æ“ä½œé™„è¿‘çš„å†…å­˜æ“ä½œå…·æœ‰å¯é¢„æµ‹çš„é¡ºåº. ä»ç¼–è¯‘å™¨ä¼˜åŒ–è¯´èµ· ä¼—æ‰€å‘¨çŸ¥, ç¼–è¯‘å™¨ä¸ä¼šå¿ å®åœ°å°†ç¨‹åºä»£ç ç¿»è¯‘ä¸ºæœºå™¨ç , è€Œæ˜¯åœ¨éµå®ˆ As-if åŸåˆ™çš„å‰æä¸‹ä½¿ç”¨ä¸€å®šç¨‹åº¦çš„æŒ‡ä»¤é‡æ’ä»¥æé«˜ç¨‹åºæ•ˆç‡. As-if åŸåˆ™æ˜¯æŒ‡ä¼˜åŒ–å‰åçš„ç¨‹åºåœ¨å•çº¿ç¨‹æ‰§è¡Œæ—¶åº”è¯¥å…·æœ‰ç›¸åŒçš„è¡Œä¸º. å› æ­¤, åœ¨å¤šçº¿ç¨‹å¹¶å‘æƒ…å†µä¸‹, æ— æ³•å®Œå…¨å‡å®šç¨‹åºä¸­ä½äºå‰é¢çš„ä»£ç ä¼šå…ˆäºåé¢çš„ä»£ç æ‰§è¡Œ. ä¾‹å¦‚å¦‚ä¸‹çš„ç®€å•ç¨‹åº: 123456int a&#123;&#125;;int b&#123;&#125;;int main()&#123; ++a;++b; a = a + b;&#125; åœ¨ g++ -S p1.cpp -o p1.s -O3 å‘½ä»¤ä¸‹ç¼–è¯‘å¾—åˆ°çš„æ±‡ç¼–ä»£ç  (éƒ¨åˆ†) ä¸º: 123456789main: movl b(%rip), %eax ; move b to %eax movl a(%rip), %edx ; move a to %edx addl $1, %eax ; ++b movl %eax, b(%rip) ; move (b + 1) back to b leal 1(%rax,%rdx), %eax ; move (1 + b + a) to %eax movl %eax, a(%rip) ; move (1 + b + a) to a xorl %eax, %eax ret å¯ä»¥çœ‹å‡º: æ±‡ç¼–ä»£ç é¦–å…ˆè®¡ç®—äº†æ’åœ¨ ++a åé¢çš„ ++b æ±‡ç¼–ä»£ç æ²¡æœ‰è®¡ç®— ++a, è€Œæ˜¯ç›´æ¥è®¡ç®—å‡ºäº† a çš„æœ€ç»ˆå€¼ a = 1 + b + 1 + a å¦‚æœåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹, ä¸€ä¸ªçº¿ç¨‹è¯»åˆ° b è‡ªå¢äº† 1 å°±é”™è¯¯åœ°å‡è®¾ a å·²ç»å®Œæˆäº†è‡ªå¢, é‚£ä¹ˆç¨‹åºçš„è¡Œä¸ºå°±æ— æ³•å®šä¹‰. CPU é‡æ’ å¦ä¸€ä¸ªä¼šé‡æ’æŒ‡ä»¤çš„åœ°æ–¹æ˜¯ CPU æŒ‡ä»¤æ‰§è¡Œæ¨¡å‹. åœ¨ç°ä»£ CPU è®¾è®¡ä¸­, è®¾è®¡è€…åˆ©ç”¨å¾ˆå¤šæœºåˆ¶å¦‚ä¹±åºå‘å°„, åˆ†æ²»é¢„æµ‹ç­‰æé«˜æŒ‡ä»¤æ‰§è¡Œçš„å¹¶è¡Œæ€§. è¿™ç§è®¾è®¡åŠ é€Ÿç¨‹åºæ‰§è¡Œçš„åŒæ—¶ä¹Ÿä½¿å¾—åœ¨å¹¶å‘æƒ…å†µä¸‹ç¨‹åºçš„æŒ‡ä»¤æ‰§è¡Œé¡ºåºä¸å¯é¢„æµ‹. å†…å­˜å¯è§æ€§ CPU Cache çš„å­˜åœ¨ä½¿å¾—æŒ‡ä»¤æ‰§è¡Œçš„ç»“æœ (å†…å­˜çš„å˜åŠ¨) å¯èƒ½ä¸ä¼šç«‹å³è¢«å…¶ä»– CPU Core è§‚å¯Ÿåˆ°. å¯¹è¿™ä¸ªç°è±¡çš„ç†è§£éœ€è¦äº†è§£ CPU Cache çš„æ¶æ„å’Œç¼“å­˜ä¸€è‡´æ€§åè®®. å¤§è‡´åœ°è¯´, CPU ç›´æ¥èƒ½å¤Ÿè®¿é—®çš„ Cache æ˜¯å­˜åœ¨äºæ¯ä¸ª CPU Core ä¸Šçš„, å³, æ¯ä¸ªå†…æ ¸ç‹¬å åœ°ä½¿ç”¨ä¸€ä»½ Cache. è€Œ Cache å®é™…ä¸Šæ˜¯ä¸»å­˜çš„ç¼“å­˜, å³ä¸€ä»½å‰¯æœ¬, é‚£ä¹ˆä¸ºäº†ä¿æŒæ¯ä¸ª CPU Core ä¸­çš„å†…å­˜å‰¯æœ¬æ˜¯ä¸€è‡´çš„, å°±éœ€è¦ä¸€å¥— cache coherence protocol. Cache coherence Protocol å®šä¹‰äº† Cache line (Cache æ“ä½œçš„æœ€å°å•ä½) çš„å‡ ç§çŠ¶æ€, ä»¥åŠ Core ä¹‹é—´æ²Ÿé€šçš„å‡ ç§æ¶ˆæ¯: Cache line çŠ¶æ€: Modified(M): å³å½“å‰çš„ core ä¿®æ”¹äº†è¯¥ cache line, åœ¨å½“å‰çš„ core å°†è¿™ä¸ª cache line åŒæ­¥åˆ° memory ä¹‹å‰, å…¶ä»–çš„ core ä¸èƒ½å†ä¿®æ”¹è¿™ä¸ª cache line å¯¹åº”çš„å†…å­˜ä½ç½® Exclusive(E): å³å½“å‰ core ç¼“å­˜çš„è¿™ä¸ª cache line æ˜¯æœ€æ–°çš„, å½“å‰çš„ core å¯ä»¥ç›´æ¥ modify è¿™ä¸ª cache line è€Œä¸éœ€è¦ç­‰å¾…å…¶ä»– core çš„åŒæ­¥. Share(S): å½“å‰ core ç¼“å­˜çš„è¿™ä¸ª cache line åœ¨å…¶ä»–çš„ core çš„ cache ä¸­ä¹Ÿå­˜åœ¨å‰¯æœ¬, å¦‚æœå½“å‰ core éœ€è¦ä¿®æ”¹è¿™ä¸ª cache line åˆ™éœ€è¦ä¸å…¶ä»– core åŒæ­¥ Invalid(I) è¡¨ç¤ºè¿™ä¸ª cache line æ˜¯ç©ºçš„ Protocol Message: Read: å½“ä¸€ä¸ª core éœ€è¦è¯»æŸä¸ª cache line æ—¶å‘èµ· read æ¶ˆæ¯ Read Response: å¯¹ Read çš„å›åº”, å¯ä»¥æ¥è‡ªå…¶ä»– core çš„ cache ä¹Ÿå¯ä»¥æ¥è‡ª memory. å¦‚æœå…¶ä»– core ä¸­çš„è¯¥ cache line æ˜¯ Modified(M) çŠ¶æ€, åˆ™ç”±è¯¥ core å‘èµ· Read Response. Invalidate: è¯¥æ¶ˆæ¯åŒ…å«ä¸€ä¸ª memory location, æ”¶åˆ°æ­¤æ¶ˆæ¯çš„ core cache éœ€è¦åˆ é™¤åŒ…å«è¯¥ memory location çš„ cache line, å¹¶å“åº”. Invalidate Acknowledge: æ”¶åˆ° Invalidate çš„ Core åˆ é™¤ cache line ä¸­çš„æ•°æ®, ç„¶åå‘å‘èµ·è€…å“åº” Invalidate Acknowledge æ¶ˆæ¯. Read Invalidate: å³ Read å’Œ Invalidate çš„ç»“åˆ. Write back: æ¶ˆæ¯ä¸­åŒ…å«æ•°æ®å’Œåœ°å€, å°†æ•°æ®å†™å…¥å†…å­˜ä¸­ç»™å®šçš„åœ°å€ä½ç½®. é€šè¿‡ä¸Šè¿°çš„ä¸€è‡´æ€§åè®®, å¯ä»¥ä¿è¯æ‰€æœ‰ CPU Core å¯¹ cache line çš„è®¿é—®æ€»æ˜¯ä¸€è‡´çš„: å¦‚æœæŸä¸ª Core A éœ€è¦å†™å…¥ä¸€ä¸ª memory location, è€Œè¿™ä¸ª memory location å­˜åœ¨äºå¦ä¸€ä¸ª Core B çš„ä¸€ä¸ª Modified cache line ä¸­. é‚£ä¹ˆ Core A å°±å¿…é¡»å‘èµ· Invalidate æ¶ˆæ¯, ç„¶åç­‰å¾…æ¥è‡ª Core B çš„ Invalidate Ack åæ‰èƒ½å†™å…¥. Core B æ”¶åˆ° Invalidate æ¶ˆæ¯åéœ€è¦å…ˆå°† cache line invalidate æ‰å†å“åº” Invalidate Ack. ä½†æ˜¯ CPU è®¾è®¡è€…ä¸æ»¡è¶³äºè¿™æ ·çš„ç­‰å¾…, äºæ˜¯ä»–ä»¬åˆå¼•å…¥äº†ä¸¤å±‚ç¼“å­˜, å³ Store Buffer å’Œ Invalidate Queue. Store Buffer ä½äº Core å’Œ Cache ä¹‹é—´. è¿™ä¸€å±‚ buffer æä¾›äº†è¿™æ ·çš„åŠŸèƒ½: å½“ Core A æ‰§è¡Œå†™å…¥æ“ä½œæ—¶, ä¸éœ€è¦ç­‰å¾…æ¥è‡ª Core B çš„ Invalidate Ack æ¶ˆæ¯, è€Œæ˜¯ç›´æ¥å†™å…¥åœ¨ Store Buffer ä¸­, ç„¶åæ‰§è¡Œåç»­çš„æ“ä½œ. ç­‰æ”¶åˆ° Invalidate Ack æ¶ˆæ¯åå†å°† Store Buffer åŒæ­¥åˆ° Cache ä¸­. å€¼å¾—æ³¨æ„çš„æ˜¯, ç”±äº Store Buffer çš„å­˜åœ¨, Core éœ€è¦ load æ•°æ®æ—¶éœ€è¦å…ˆåœ¨ Store Buffer ä¸­æŸ¥æ‰¾ä»¥ä¿è¯ load çš„æ•°æ®æ˜¯æœ€æ–°çš„. è¿™ä¸€è¿‡ç¨‹å«åš Store Forwarding Invalidate Queue ä½äº Core Cache å’Œ memory ä¹‹é—´. å½“ Core A å‘ Core B å‘é€ Invalidate æ¶ˆæ¯æ—¶, Core B å¯ä»¥ç›´æ¥å°†è¯¥æ¶ˆæ¯æ”¾å…¥è‡ªå·±çš„ Invalidate Queue, å¹¶ç«‹å³è¿”å› Invalidate Ack. éœ€è¦æ³¨æ„çš„æ˜¯, å¦‚æœ Core A çš„ Invalidate Queue ä¸­å·²ç»å­˜åœ¨äº†è¯¥ cache line çš„ Invalidate æ¶ˆæ¯, é‚£ä¹ˆå®ƒå¿…é¡»å¤„ç†è¯¥ cache line çš„ Invalidate äº‹ä»¶. æ€»çš„æ¥è¯´, å¸¦æœ‰ Invalidate Queue çš„ Core æä¾›è¿™æ ·ä¸€ç§ä¿è¯: åœ¨ä¼ è¾“ä»»ä½•å…³äºè¯¥ cache line çš„ MESI æ¶ˆæ¯ä¹‹å‰å¤„ç†è¯¥æ¡ç›®. è¿™æ ·çš„ç­–ç•¥è¿›ä¸€æ­¥å‹æ ˆäº† CPU æ€§èƒ½, ä½†æ˜¯å…¶å¸¦æ¥ä¸€äº›é—®é¢˜, ä¾‹å¦‚å¦‚ä¸‹çš„ç¨‹åº: 123456789101112131415#include &lt;assert.h&gt;#include &lt;thread&gt;int a&#123;&#125;;int b&#123;&#125;;void foo() &#123; a = 1; b = 1;&#125;void bar() &#123; while (b == 0) continue; assert(a == 1);&#125; å‡è®¾ Core A ä¸Šè¿è¡Œçš„çº¿ç¨‹ 1 å’Œ Core B ä¸Šçš„çº¿ç¨‹ 2 åˆ†åˆ«è¿è¡Œ foo() å’Œ bar(). é‚£ä¹ˆç†æƒ³æƒ…å†µä¸‹, å½“çº¿ç¨‹ 2 ä» while å¾ªç¯é€€å‡ºæ—¶, å…¨å±€å˜é‡ a çš„å€¼åº”è¯¥å·²ç»å˜ä¸ºäº† 1, å³æ–­è¨€ä¼šæˆåŠŸ. ä½†å®é™…ä¸Š, ç”±äºå†…å­˜å¯è§æ€§ä»¥åŠå¯è§æ€§é¡ºåºçš„ä¸ç¡®å®šæ€§, æ–­è¨€å¯èƒ½ä¼šå¤±è´¥: å‡è®¾æ­¤æ—¶ a ä¸å­˜åœ¨äº Core A çš„ Cache ä¸­, b å­˜åœ¨äº Core A çš„ Cache ä¸­ä¸”çŠ¶æ€ä¸º M. é‚£ä¹ˆ: Core A æ‰§è¡Œ a = 1 ä¹‹åå°† a çš„å€¼æ”¾è¿› Store Buffer, ç„¶åç»§ç»­æ‰§è¡Œ b = 1, å› ä¸º b åœ¨ Core A ä¸Šæ˜¯ M çŠ¶æ€, å› æ­¤å¯¹ b çš„ä¿®æ”¹ä¸éœ€è¦å’Œå…¶ä»– core åŒæ­¥. æ­¤æ—¶ Core B æ‰§è¡Œ while(b == 0) æ—¶å‘ç° b == 1, é‚£ä¹ˆå°±ä¼šé€€å‡ºå¾ªç¯æ‰§è¡Œ assert. ä½†æ­¤æ—¶å¦‚æœ Core A çš„ Store Buffer è¿˜æ²¡æœ‰å°† a çš„å€¼åŒæ­¥åˆ° Cache çš„è¯, Core B è·å–åˆ°çš„ a å€¼å°†ä¸º 0. æ­¤æ—¶ç»“æœä¸ç¬¦åˆé¢„æœŸ. å‡è®¾ Core A åŠæ—¶å°† Store Buffer ä¸­çš„å€¼åˆ·åˆ° Cache ä¸­. é‚£ä¹ˆ Cache ä¼šå‘ Core B å‘é€ Invalidate æ¶ˆæ¯, æé†’å…¶å…³äº a çš„å€¼å·²ç»å¤±æ•ˆ. è¿™ä¸ªæ¶ˆæ¯ä¼š push åˆ° Core B çš„ Invalidate Queue ä¸­ å½“ Core B å‘ç° b == 1 é€€å‡ºå¾ªç¯æ—¶, å¦‚æœå®ƒè¿˜æ²¡æœ‰å¤„ç† Invalidate Queue ä¸­çš„æ¶ˆæ¯, å³ Core B ä¸­ a çš„ Cache Line çŠ¶æ€ä¸ä¸º l, é‚£ä¹ˆ Core B æ­¤æ—¶è·å–åˆ°çš„ a çš„å–å€¼ä»ç„¶æ˜¯ 0. ç»“æœä¸ç¬¦åˆé¢„æœŸ. ä¸Šé¢ä¸¤ç§æƒ…å†µä¸‹ä¸ç¬¦åˆé¢„æœŸçš„è¡Œä¸ºæ˜¯æ— æ³•åœ¨ CPU å±‚é¢è§£å†³çš„: è¯»å–å˜é‡çš„ CPU Core å¹¶ä¸çŸ¥é“è¯»å–çš„å˜é‡ä¸å…¶ä»– Core æœ‰ä»€ä¹ˆå…³ç³». Memory Barrier ä¸ºäº†ä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§, CPU è®¾è®¡è€…æä¾›äº† Memory Barrier æœºåˆ¶. å®ƒå…·ä½“çš„å½¢å¼æ˜¯ä¸€ç§æŒ‡ä»¤, å®ƒçš„æ‰§è¡Œæ•ˆæœæ˜¯å°† Store Buffer å’Œ Invalidate Queue ä¸ Cache åŒæ­¥, å³è¦æ±‚ CPU Core ç«‹å³å¤„ç†è¿™äº›ç¼“å­˜. æ›´å…·ä½“åœ°è¯´, CPU è®¾è®¡è€…ä¸ºè¯»å†™æ“ä½œåˆ†åˆ«å¼•å…¥äº†ä¸åŒçš„ Memory Barrier æŒ‡ä»¤: å¯¹äºè¯»æ“ä½œ, Read Memory Barrier ä¼šå°† Invalidate Queue ä¸ Cache åŒæ­¥ å¯¹äºå†™æ“ä½œ, Write Memory Barrier ä¼šå°† Store Buffer ä¸ Cache åŒæ­¥ Memory Order ç”±äºä»¥ä¸Šçš„åŸå› , å¹¶å‘ç¼–ç¨‹åœ¨æ²¡æœ‰è®¾ç½® Memory Barrier æ—¶éš¾ä»¥è·å–è·¨çº¿ç¨‹ä¸€è‡´çš„å†…å­˜é¡ºåº. C++ å¯¹è¿™äº›ç°ä»£å¤šæ ¸ CPU å¹¶è¡Œè¿è¡Œæ—¶çš„å†…å­˜å¯è§æ€§æä¾›çš„æŠ½è±¡æ˜¯ Memory Order. å…·ä½“åœ°è¯´, C++ æŠ½è±¡äº† 3 ç§å†…å­˜é¡ºåºæ¨¡å‹: Sequential Consistent å³é¡ºåºä¸€è‡´æ€§æ¨¡å‹, è¿™ç§æ¨¡å‹ä¸‹ç¼–è¯‘å™¨å’Œ CPU ä¸¥æ ¼æŒ‰ç…§ä»£ç é¡ºåºç”Ÿæˆå’Œæ‰§è¡ŒæŒ‡ä»¤. åŒæ—¶æ‰€æœ‰çš„å†…æ ¸è§‚å¯Ÿåˆ°çš„å†…å­˜é¡ºåºéƒ½ä¸€è‡´, å³å†…å­˜ä¿®æ”¹çš„é¡ºåºä»¥åŠå¯è§çš„é¡ºåºæ˜¯å…¨å±€ä¸€è‡´çš„ (global memory order) Happens Before å³æŒ‰ç…§ä»£ç é¡ºåº, å¦‚æœè¯­å¥ A åœ¨è¯­å¥ B çš„å‰é¢, é‚£ä¹ˆ è¯­å¥ A çš„æ‰§è¡Œæ‰€äº§ç”Ÿçš„æ•ˆæœéœ€èƒ½å¤Ÿè¢«è¯­å¥ B çš„æ‰§è¡Œè§‚å¯Ÿåˆ°, åˆ™ç§°è¯­å¥ A Happens Before è¯­å¥ B. å€¼å¾—æ³¨æ„çš„æ˜¯ Happens Before å¼ºè°ƒå†…å­˜ä¿®æ”¹çš„å¯è§æ€§é¡ºåº, å¹¶ä¸å¼ºè°ƒ ã€Œå®é™…çš„æ‰§è¡Œé¡ºåºã€. Synchronizes With å¦‚æœçº¿ç¨‹ A ä¸­çš„ä¸€ä¸ª atomic store æ“ä½œæ˜¯ ã€ŒRelease æ“ä½œã€, çº¿ç¨‹ B ç§å¯¹åŒä¸€ä¸ªå˜é‡çš„ atomic load æ“ä½œæ˜¯ ã€ŒAcquire æ“ä½œã€, å¹¶ä¸”çº¿ç¨‹ B ä¸­çš„ load æ“ä½œè¯»å–åˆ°äº†çº¿ç¨‹ A ä¸­çš„ store æ“ä½œæ‰€å†™å…¥çš„å€¼, é‚£ä¹ˆç§°çº¿ç¨‹ A ä¸­çš„ Store æ“ä½œ synchronizes with çº¿ç¨‹ B ä¸­çš„ Load æ“ä½œ. std::atomic å’Œ std::memory_order å¯¹äºä¸Šé¢ä¸‰ç§æŠ½è±¡å†…å­˜é¡ºåºæ¨¡å‹, C++ æ ‡å‡†æä¾›äº† 6 ä¸ª flag ç”¨äºæ§åˆ¶å¯¹ atomic å˜é‡ load å’Œ store æ“ä½œ, ä»¥ä½¿å¾—åŸå­å˜é‡å‘¨å›´çš„å†…å­˜å¯è§æ€§é¡ºåºèƒ½å¤Ÿæ»¡è¶³ä»¥ä¸Šé¡ºåºæ¨¡å‹. memory_order_relaxed(Relaxed Ordering) æ¾æ•£æ¨¡å‹, ç”¨è¯¥ flag æ ‡è®°çš„åŸå­å˜é‡æ“ä½œåªä¿è¯åŸå­å˜é‡æœ¬èº«çš„å†…å­˜ä¸€è‡´æ€§, å¯¹å…¶ä»–å†…å­˜çš„è¯»å†™æ“ä½œæ²¡æœ‰ä»»ä½•çš„åŒæ­¥å’Œé‡æ’é™åˆ¶. memory_order_acquire å’Œ memory_order_release (Acquire-Release Ordering) C++ å€Ÿé‰´ lock çš„ lock å’Œ unlock æ“ä½œ, å¼•å…¥äº†ä¸¤ä¸ªæ¦‚å¿µ: Acquire å’Œ Release. Acquire æ“ä½œæ˜¯ä¸€ç§ load æ“ä½œ, å®ƒä¿è¯è¯¥ load æ“ä½œä¹‹åçš„æ“ä½œä¸ä¼šè¢«é‡æ’åˆ°è¯¥ load æ“ä½œä¹‹å‰. å¦‚æœå¯¹åŒä¸€ä¸ªåŸå­å˜é‡çš„ä¸€ä¸ª Release æ“ä½œ synchronizes with è¯¥ Acquire æ“ä½œ, é‚£ä¹ˆè¿™ä¸ª Release æ“ä½œä¹‹å‰æ‰€æœ‰çš„å†™æ“ä½œå¯¹å†…å­˜çš„å½±å“å¯¹äºè¯¥ Acquire æ“ä½œä»¥åŠä¹‹åçš„æ“ä½œéƒ½å¯è§. Release æ“ä½œæ˜¯ä¸€ç§ store æ“ä½œ, å®ƒä¿è¯è¯¥ store æ“ä½œä¹‹å‰çš„æ“ä½œä¸ä¼šé‡æ’åˆ°è¯¥ store æ“ä½œä¹‹å. Release æ“ä½œå’Œ Acquire æ“ä½œä¸€èˆ¬é…åˆä½¿ç”¨. memory_order_consume Consume æ“ä½œç±»ä¼¼äº Acquire æ“ä½œ, ä¹Ÿæ˜¯ä¸€ç§ load æ“ä½œ, ä½†æ˜¯å…¶è¦æ±‚æ›´åŠ å®½æ¾. ä¸€ä¸ªæŸåŸå­å˜é‡ä¸Šçš„ Consume æ“ä½œä»…èƒ½çœ‹åˆ°å¯¹äº è¯¥åŸå­å˜é‡ä¾èµ–äºçš„å†…å­˜ çš„ä¿®æ”¹, è€Œä¸æ˜¯æ‰€æœ‰å¯¹äºè¯¥åŸå­å˜é‡çš„ Release æ“ä½œä¹‹å‰çš„å†…å­˜ä¿®æ”¹. memory_order_acq_rel è¯¥æ“ä½œç”¨äº read-modify-write æ“ä½œ, å³ä¸€ä¸ªå³è¯»å–, åˆä¿®æ”¹, åˆå†™å…¥çš„åŸå­å˜é‡æ“ä½œ. å®ƒä¿è¯è¯¥ rmw æ“ä½œå‰åçš„è¯­å¥éƒ½ä¸ä¼šè·¨è¶Šè¯¥æ“ä½œè€Œé‡æ’. è¯¥æ“ä½œå…¼å®¹ Acquire å’Œ Store æ“ä½œ, ä¸”æ•´ä½“ä¸Šæ˜¯åŸå­çš„. memory_order_seq_cst(Sequentially Consistent Ordering) å³ Sequential Consistent æ“ä½œ, å¯ä»¥ç”¨äº load/store/read-modify-write æ“ä½œ. ä¸”æ‰€æœ‰æ“ä½œéƒ½ä¿è¯æœ‰åŒå‘å±éšœ (è¯»å†™ memory barrier), æ“ä½œçš„å‰åè¯­å¥éƒ½ä¿è¯ä¸ä¼šé‡æ’, æ‰€æœ‰å˜é‡çš„å†…å­˜å¯è§é¡ºåºå¯¹äºæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯ä¸€è‡´çš„. Conclusion æœ¬æ–‡ä»ç¼–è¯‘å™¨ä¼˜åŒ–ä¼šé‡æ’ç¨‹åºä»£ç çš„æ‰§è¡Œé¡ºåºè¯´èµ·, å¯¹äºä¼šäº§ç”Ÿä»£ç æ‰§è¡Œé¡ºåºå˜åŒ–çš„ ç¼–è¯‘å™¨ä¼˜åŒ– å’Œ CPU reordering è¿›è¡Œäº†è®¨è®º. å¯¹äºä¸€ä¸ªç¡®å®šçš„æŒ‡ä»¤æ‰§è¡Œé¡ºåº, å†…å­˜å¯è§æ€§é¡ºåº ä¹Ÿä¼šå½±å“ç¨‹åºåœ¨ å¹¶å‘ æ—¶çš„è¡Œä¸º. é’ˆå¯¹è¿™ä¸€ç°è±¡, æœ¬æ–‡ä» CPU Cache çš„ç»“æ„å’Œç¼“å­˜ä¸€è‡´æ€§åè®®è¯´èµ·, ä»‹ç»äº†å¼•èµ·å†…å­˜å¯è§æ€§é¡ºåºä¸å®šçš„åŸå› : store buffer å’Œ invalidate queue. é’ˆå¯¹è¿™äº›åŸå› , æœ¬æ–‡ä»‹ç»äº† CPU è®¾è®¡è€…æä¾›çš„ Memory Barrier æŒ‡ä»¤. åŸºäºä¸Šè¿°åŸºç¡€, æœ¬æ–‡ä»‹ç»äº† C++ å¯¹å†…å­˜å¯è§æ€§é¡ºåºçš„æŠ½è±¡: Memory Order, å¹¶åˆ†åˆ«å¯¹ C++ æä¾›çš„ 6 ä¸ª memory order flag å’Œå®ƒä»¬èƒ½å¤Ÿç»„åˆæˆçš„ 3 ç§ memory order model è¿›è¡Œäº†ä»‹ç». References std::memory_order - cppreference.com Paul E McKenney. Is Parallel Programming Hard, And, If So, What Can You Do About It?. ç°ä»£C++çš„å†…å­˜æ¨¡å‹ - çŸ¥ä¹ (zhihu.com) é«˜å¹¶å‘ç¼–ç¨‹â€“å¤šå¤„ç†å™¨ç¼–ç¨‹ä¸­çš„ä¸€è‡´æ€§é—®é¢˜(ä¸Š) - çŸ¥ä¹ (zhihu.com) è°ˆè°ˆ C++ ä¸­çš„å†…å­˜é¡ºåº (Memory Order) - Luyu Huangâ€™s Blog","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://blog.zhuwenq.cc/tags/C/"},{"name":"CPU Cache","slug":"CPU-Cache","permalink":"https://blog.zhuwenq.cc/tags/CPU-Cache/"},{"name":"Concurrency","slug":"Concurrency","permalink":"https://blog.zhuwenq.cc/tags/Concurrency/"},{"name":"Memory Order","slug":"Memory-Order","permalink":"https://blog.zhuwenq.cc/tags/Memory-Order/"}]},{"title":"å…±äº«ç›®æ ‡æ–‡ä»¶/å…±äº«åº“","slug":"å…±äº«ç›®æ ‡æ–‡ä»¶-å…±äº«åº“","date":"2023-04-02T12:08:44.000Z","updated":"2023-06-21T06:51:28.936Z","comments":true,"path":"å…±äº«ç›®æ ‡æ–‡ä»¶-å…±äº«åº“/","link":"","permalink":"https://blog.zhuwenq.cc/%E5%85%B1%E4%BA%AB%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6-%E5%85%B1%E4%BA%AB%E5%BA%93/","excerpt":"å¯¹äºè¢«å¹¿æ³›ä½¿ç”¨çš„æ ‡å‡†åº“æˆ–å…¶ä»–åº“, å¦‚æœä¸€ä¸ªç³»ç»Ÿä¸­å¤šä¸ªç¨‹åºéƒ½åœ¨å¼•ç”¨ç›¸åŒçš„ç¬¦å·, æ­¤æ—¶ä½¿ç”¨é™æ€åº“å°†éœ€è¦ä¸ºæ¯ä¸ªç¨‹åºéƒ½åŠ è½½ä¸€ä»½ç¬¦å·å®šä¹‰çš„ä»£ç å’Œæ•°æ®, è¿™å¯¹å†…å­˜æ˜¯æå¤§çš„æµªè´¹. å…±äº«åº“ (shared library) æ˜¯è§£å†³é™æ€åº“è¿™ä¸€é—®é¢˜çš„äº§ç‰©. å…±äº«åº“æ˜¯ä¸€ä¸ªç›®æ ‡æ¨¡å—, åœ¨è¿è¡Œæˆ–åŠ è½½æ—¶å¯ä»¥è¢«åŠ è½½åˆ°ä»»æ„å†…å­˜åœ°å€, å¹¶å’Œä¸€ä¸ªåœ¨å†…å­˜ä¸­çš„ç¨‹åºé“¾æ¥èµ·æ¥. è¿™ä¸€è¿‡ç¨‹ç§°ä¸ºåŠ¨æ€é“¾æ¥, æ˜¯ç”±ä¸€ä¸ªå«åš åŠ¨æ€é“¾æ¥å™¨ (dynamic linker) çš„ç¨‹åºæ‰§è¡Œçš„.","text":"å¯¹äºè¢«å¹¿æ³›ä½¿ç”¨çš„æ ‡å‡†åº“æˆ–å…¶ä»–åº“, å¦‚æœä¸€ä¸ªç³»ç»Ÿä¸­å¤šä¸ªç¨‹åºéƒ½åœ¨å¼•ç”¨ç›¸åŒçš„ç¬¦å·, æ­¤æ—¶ä½¿ç”¨é™æ€åº“å°†éœ€è¦ä¸ºæ¯ä¸ªç¨‹åºéƒ½åŠ è½½ä¸€ä»½ç¬¦å·å®šä¹‰çš„ä»£ç å’Œæ•°æ®, è¿™å¯¹å†…å­˜æ˜¯æå¤§çš„æµªè´¹. å…±äº«åº“ (shared library) æ˜¯è§£å†³é™æ€åº“è¿™ä¸€é—®é¢˜çš„äº§ç‰©. å…±äº«åº“æ˜¯ä¸€ä¸ªç›®æ ‡æ¨¡å—, åœ¨è¿è¡Œæˆ–åŠ è½½æ—¶å¯ä»¥è¢«åŠ è½½åˆ°ä»»æ„å†…å­˜åœ°å€, å¹¶å’Œä¸€ä¸ªåœ¨å†…å­˜ä¸­çš„ç¨‹åºé“¾æ¥èµ·æ¥. è¿™ä¸€è¿‡ç¨‹ç§°ä¸ºåŠ¨æ€é“¾æ¥, æ˜¯ç”±ä¸€ä¸ªå«åš åŠ¨æ€é“¾æ¥å™¨ (dynamic linker) çš„ç¨‹åºæ‰§è¡Œçš„. åŠ¨æ€é“¾æ¥ åœ¨é“¾æ¥æ—¶, æ–‡ä»¶ç³»ç»Ÿä¸­å¯¹äºä¸€ä¸ªå…±äº«åº“åªæœ‰ä¸€ä»½ .so æ–‡ä»¶, æ‰€æœ‰å¼•ç”¨è¯¥åº“çš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶å…±äº«è¿™ä¸ª .so æ–‡ä»¶ä¸­çš„ä»£ç å’Œæ•°æ®, è€Œä¸æ˜¯åƒå¼•ç”¨é™æ€åº“ä¸€æ ·å°†é™æ€åº“çš„å†…å®¹åµŒå…¥è¿›å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶. åœ¨æ‰§è¡Œæ—¶, ä¸€ä¸ªå…±äº«åº“çš„ .text èŠ‚åœ¨å†…å­˜ä¸­çš„å‰¯æœ¬å¯ä»¥è¢«ä¸åŒçš„è¿›ç¨‹å…±äº« ä¸‹å›¾æ˜¯åŠ¨æ€åº“çš„é“¾æ¥è¿‡ç¨‹: é“¾æ¥å™¨åœ¨æ„é€ å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶æ—¶, æ²¡æœ‰å°†ä»»ä½•åŠ¨æ€åº“çš„ä»£ç å’Œæ•°æ®è¢«å¤åˆ¶è¿›å¯æ‰§è¡Œç›®æ ‡. ä½†é“¾æ¥å™¨éœ€è¦å¤åˆ¶å…³äºé‡å®šä½å’Œç¬¦å·è¡¨çš„ä¿¡æ¯è¿›å…¥å¯æ‰§è¡Œç›®æ ‡, è¿™äº›ä¿¡æ¯æŒ‡å¼•åŠ è½½å™¨è§£æç¨‹åºå¯¹åŠ¨æ€åº“çš„å¼•ç”¨. åœ¨åŠ è½½å’Œè¿è¡Œæ—¶: åŠ è½½å™¨åŠ è½½éƒ¨åˆ†é“¾æ¥çš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ åŠ è½½å™¨ä¼šæ³¨æ„åˆ°éƒ¨åˆ†é“¾æ¥çš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä¸­å­˜åœ¨ä¸€ä¸ª .interp èŠ‚, è¿™ä¸€èŠ‚ä¸­åŒ…å«åŠ¨æ€é“¾æ¥å™¨çš„è·¯å¾„å åŠ¨æ€é“¾æ¥å™¨ä¹Ÿæ˜¯ä¸€ä¸ªå…±äº«åº“ (åœ¨ Linux ç³»ç»Ÿä¸Šæ˜¯ ld-linux.so). åŠ è½½å™¨åŠ è½½å¹¶è¿è¡ŒåŠ¨æ€é“¾æ¥å™¨ åŠ¨æ€é“¾æ¥å™¨æ‰§è¡Œä»¥ä¸‹é‡å®šä½ä»¥å®Œæˆé“¾æ¥: åˆ†åˆ«é‡å®šä½ è¢«å¼•ç”¨çš„å…±äº«åº“ çš„æ–‡æœ¬å’Œæ•°æ® é‡å®šä½å¯æ‰§è¡Œç›®æ ‡ä¸­å¯¹å…±äº«åº“ä¸­ç¬¦å·çš„å¼•ç”¨ åŠ¨æ€é“¾æ¥å™¨å°†æ§åˆ¶æƒä¼ é€’ç»™å¯æ‰§è¡Œç›®æ ‡ç¨‹åº åŠ¨æ€åŠ è½½ é™¤äº†åœ¨é“¾æ¥æ—¶ç”±é“¾æ¥å™¨æä¾›é‡å®šä½ä¿¡æ¯, å¹¶åœ¨è¿è¡Œå‰ç”±åŠ è½½å™¨åŠ è½½, åŠ¨æ€åº“è¿˜å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åŠ è½½, ä¸éœ€è¦é“¾æ¥å™¨çš„é‡å®šä½ä¿¡æ¯ å…·ä½“åœ°è¯´, åŠ¨æ€åŠ è½½æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åœ°è°ƒç”¨åŠ¨æ€é“¾æ¥å™¨æä¾›çš„æ¥å£å®ç°çš„, é€šè¿‡è¿™äº›æ¥å£å¯ä»¥åŠ¨æ€åœ°è°ƒç”¨åŠ¨æ€é“¾æ¥å™¨åœ¨è¿è¡Œæ—¶è§£æå…±äº«åº“. ä¸‹é¢æ˜¯ Linux ç³»ç»Ÿæä¾›çš„ç®€å•æ¥å£: 1234567891011121314151617181920212223242526#include &lt;dlfcn.h&gt;/** @filename: åŠ¨æ€é“¾æ¥åº“è·¯å¾„* @flag: æ‰“å¼€çš„æ¨¡å¼* æ‰“å¼€å’Œé“¾æ¥ä¸€ä¸ªæœ¬åœ°åŠ¨æ€é“¾æ¥åº“, è¿”å›æŒ‡å‘è¯¥åº“çš„å¥æŸ„. æ‰“å¼€å¤±è´¥åˆ™è¿”å› NULL*/void* dlopen(const char* filename, int flag);/** @handle: åŠ¨æ€é“¾æ¥åº“å¥æŸ„* @symbol: ç¬¦å·åç§°* åœ¨ç»™å®šåŠ¨æ€é“¾æ¥åº“å¥æŸ„ä¸­æŸ¥æ‰¾ç»™å®šåç§°çš„ç¬¦å·çš„å¥æŸ„. æŸ¥æ‰¾å¤±è´¥è¿”å› NULL*/void* dlsym(void* handle, char* symbol);/** @handle: è¦å…³é—­çš„åŠ¨æ€é“¾æ¥åº“å¥æŸ„* å¸è½½ä¸€ä¸ªå…±äº«åº“*/int dlclose(void* handle);/** è¿”å›æœ€è¿‘ä¸€æ¬¡è°ƒç”¨ dlopen, dlsym æˆ– dlclose çš„é”™è¯¯*/const char* dlerror(void); ä½ç½®æ— å…³ä»£ç  (Position-Independent Code, PIC) å®ç°å…±äº«åº“çš„ä¸€é¡¹å…³é”®æŠ€æœ¯æ˜¯ä½ç½®æ— å…³ä»£ç , è¿™ç±»ä»£ç å¯ä»¥è¢«åŠ è½½åˆ°å†…å­˜ä¸­çš„ä»»æ„ä½ç½®è€Œæ— éœ€é“¾æ¥å™¨ä¿®æ”¹. GCC ç¼–è¯‘å™¨å¯ä»¥ä½¿ç”¨ -fpic é€‰é¡¹ç”Ÿæˆ PIC ä»£ç . å¯¹äºå…±äº«åº“ä¸­æ¨¡å—å†…éƒ¨å®šä¹‰çš„ç¬¦å·, ç¼–è¯‘å™¨å¯ä»¥ä½¿ç”¨ PC ç›¸å¯¹åç§»åœ°å€ç”Ÿæˆ PIC ä»£ç . ä½†æ˜¯å¯¹äºå…¨å±€ç¬¦å·çš„å¤„ç†åˆ™éœ€è¦ç‰¹æ®ŠæŠ€å·§. PIC æ•°æ®å¼•ç”¨ ç¼–è¯‘å™¨åˆ©ç”¨ä¸€ä¸ªæœ‰è¶£çš„äº‹å®ç”Ÿæˆå¯¹å…¨å±€å˜é‡çš„ PIC å¼•ç”¨: å³æ— è®ºæˆ‘ä»¬åœ¨å†…å­˜ä¸­çš„ä½•å¤„åŠ è½½ä¸€ä¸ªç›®æ ‡æ¨¡å— (åŒ…æ‹¬å…±äº«ç›®æ ‡æ¨¡å—), æ•°æ®æ®µå’Œä»£ç æ®µä¹‹é—´çš„è·ç¦»æ€»æ˜¯ä¿æŒä¸å˜. å› æ­¤, ä»£ç æ®µä¸­çš„ä»»ä½•æŒ‡ä»¤å’Œæ•°æ®æ®µä¸­çš„ä»»ä½•å˜é‡ä¹‹é—´çš„è·ç¦»éƒ½æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶å¸¸é‡. ç¼–è¯‘å™¨åˆ©ç”¨äº†ä¸Šè¿°äº‹å®, å®ƒåœ¨æ•°æ®æ®µå¼€å§‹çš„åœ°æ–¹åˆ›å»ºä¸€ä¸ª å…¨å±€åç§»é‡è¡¨ (Global Offset Table, GOT). åœ¨ GOT ä¸­, æ¯ä¸ªè¢«è¿™ä¸ªç›®æ ‡æ¨¡å—å¼•ç”¨çš„å…¨å±€ç¬¦å·éƒ½æœ‰ä¸€ä¸ª 8 å­—èŠ‚æ¡ç›®. ç¼–è¯‘å™¨è¿˜ä¸ºæ¯ä¸ªæ¡ç›®ç”Ÿæˆä¸€ä¸ªé‡å®šä½è®°å½•. åœ¨åŠ è½½æ—¶, åŠ¨æ€é“¾æ¥å™¨ä¼šé‡å®šä½ GOT ä¸­çš„æ¯ä¸ªæ¡ç›®, ä½¿å®ƒåŒ…å«æ­£ç¡®çš„ç»å¯¹åœ°å€. å¦‚ä¸‹å›¾, ä»£ç æ®µä¸­å¯¹ addcnt çš„åœ°å€çš„è®¿é—®è¢«è®¾ç½®ä¸ºäº† 0x2008b9(%rip), å³ PC æŒ‡é’ˆåç§» 0x2008b9 çš„ä½ç½®, å³ GOT[3]. GOT åœ¨ç¼–è¯‘æ—¶ä¸ä¼šå¡«å……æœ‰æ•ˆçš„å€¼, ä½†åœ¨åŠ è½½æ—¶, åŠ¨æ€é“¾æ¥å™¨ä¼šå°†å…¶å¡«å……ä¸ºåŠ è½½åˆ°å†…å­˜ä¸­çš„åŠ¨æ€è¿æ¥åº“ä¸­å®šä¹‰çš„ç¬¦å·çš„åœ°å€. PIC å‡½æ•°è°ƒç”¨ å¯¹äºå¯¹å…±äº«åº“ä¸­å®šä¹‰çš„å‡½æ•°çš„è°ƒç”¨, PIC ä»£ç ç¼–è¯‘ç³»ç»Ÿä½¿ç”¨ å»¶è¿Ÿç»‘å®š (lazy binding) æŠ€æœ¯è§£æå…¶åœ°å€. å…·ä½“åœ°è¯´, å°±æ˜¯å°†å¯¹å‡½æ•°åœ°å€çš„è§£æå»¶è¿Ÿåˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶. å…¶åŠ¨æœºæ˜¯å¯¹äºå®šä¹‰äº†å¾ˆå¤šä¸ªå‡½æ•°çš„æ ‡å‡†å…±äº«åº“, å…¸å‹çš„ç¨‹åºåªä¼šä½¿ç”¨å…¶ä¸­çš„ä¸€å°éƒ¨åˆ†, å»¶è¿Ÿç»‘å®šå¯ä»¥é¿å…å¯¹æ²¡æœ‰è°ƒç”¨è¿‡çš„å‡½æ•°åœ°å€çš„è§£æ. å»¶è¿Ÿç»‘å®šæ˜¯é€šè¿‡ GOT å’Œ è¿‡ç¨‹è¿æ¥è¡¨ (Procedure Linkage Table, PLT) ä¹‹é—´çš„äº¤äº’å®ç°çš„. PLT æ˜¯ä¸€ä¸ªæ•°ç»„, å…¶ä¸­æ¯ä¸ªæ¡ç›®æ˜¯ä¸€ä¸ª 16 å­—èŠ‚çš„ä»£ç : æ¯ä¸ªå¯¹å…±äº«åº“å‡½æ•°çš„è°ƒç”¨éƒ½æœ‰ä¸€ä¸ªæ¡ç›®, æ¯ä¸ªæ¡ç›®è´Ÿè´£è§£æä¸€ä¸ªå‡½æ•°è°ƒç”¨. PLT[0] æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ¡ç›®, å®ƒè·³è½¬åˆ°åŠ¨æ€é“¾æ¥å™¨. PLT[1] è°ƒç”¨ç³»ç»Ÿå¯åŠ¨å‡½æ•° __libc_start_main, å®ƒåˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒ, è°ƒç”¨ main å‡½æ•°å¹¶å¤„ç†å…¶è¿”å›å€¼. PLT[2] åŠä»¥åçš„æ¡ç›®è°ƒç”¨ç”¨æˆ·ä»£ç ä¸­è°ƒç”¨çš„å‡½æ•° å’Œ PLT è”åˆä½¿ç”¨æ—¶: GOT[0] å’Œ GOT[1] åŒ…å«åŠ¨æ€é“¾æ¥å™¨åœ¨è§£æå‡½æ•°åœ°å€æ—¶ä¼šç”¨åˆ°çš„ä¿¡æ¯ GOT[2] æ˜¯åŠ¨æ€é“¾æ¥å™¨åœ¨ ld-linux.so æ¨¡å—ä¸­çš„å…¥å£ç‚¹. å…¶ä½™çš„æ¯ä¸ªæ¡ç›®å¯¹åº”ä¸€ä¸ªè¢«è°ƒç”¨çš„å‡½æ•°, å…¶åœ°å€åœ¨è¿è¡Œæ—¶è¢«è§£æ. æ¯ä¸ªæ¡ç›®éƒ½æœ‰ä¸€ä¸ªç›¸åŒ¹é…çš„ PLT æ¡ç›®. åˆå§‹æ—¶, æ¯ä¸ª GOT æ¡ç›®éƒ½æŒ‡å‘å¯¹åº”äº PLT æ¡ç›®çš„ç¬¬äºŒæ¡æŒ‡ä»¤ å½“ç¬¬ä¸€æ¬¡è°ƒç”¨ä¸€ä¸ªå…±äº«åº“ä¸­å®šä¹‰çš„å‡½æ•°æ—¶, å»¶è¿Ÿç»‘å®šçš„æµç¨‹å¦‚ä¸‹å›¾: Instead of directly calling addvec, the program calls into PLT[2], which is the PLT entry for addvec. The first PLT instruction does an indirect jump through GOT[4]. Since each GOT entry initially points to the second instruction in its corresponding PLT entry, the indirect jump simply transfers control back to the next instruction in PLT[2] After pushing an ID for addvec (0x1) onto the stack, PLT[2] jumps to PLT[0]. PLT[0] pushes an argument for the dynamic linker indirectly through GOT[1] and then jumps into the dynamic linker indirectly through GOT[2]. The dynamic linker uses the two stack entries to determine the runtime location of addvec, overwrites GOT[4] with this address, and passes control to addvec.","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"CS:APP","slug":"CS-APP","permalink":"https://blog.zhuwenq.cc/tags/CS-APP/"},{"name":"Computer System","slug":"Computer-System","permalink":"https://blog.zhuwenq.cc/tags/Computer-System/"}]},{"title":"å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶","slug":"å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶","date":"2023-04-02T12:03:27.000Z","updated":"2023-06-21T06:51:28.936Z","comments":true,"path":"å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶/","link":"","permalink":"https://blog.zhuwenq.cc/%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6/","excerpt":"é“¾æ¥å™¨ é“¾æ¥ çš„ç»“æœæ˜¯ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶, è¿™ä¸ªç›®æ ‡æ–‡ä»¶ä¸­åŒ…å«å°†ç¨‹åºåŠ è½½åˆ°å†…å­˜å¹¶è¿è¡Œçš„æ‰€æœ‰ä¿¡æ¯. ä¸‹å›¾æ˜¯ä¸€ä¸ª ELF å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶æ‰€åŒ…å«çš„ä¿¡æ¯:","text":"é“¾æ¥å™¨ é“¾æ¥ çš„ç»“æœæ˜¯ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶, è¿™ä¸ªç›®æ ‡æ–‡ä»¶ä¸­åŒ…å«å°†ç¨‹åºåŠ è½½åˆ°å†…å­˜å¹¶è¿è¡Œçš„æ‰€æœ‰ä¿¡æ¯. ä¸‹å›¾æ˜¯ä¸€ä¸ª ELF å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶æ‰€åŒ…å«çš„ä¿¡æ¯: ELF header æè¿°æ–‡ä»¶çš„æ€»ä½“æ ¼å¼, ä»¥åŠç¨‹åºçš„å…¥å£ç‚¹ (entry point), å³ç¨‹åºè¿è¡Œæ—¶æ‰§è¡Œçš„ç¬¬ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ .init èŠ‚å®šä¹‰äº†ä¸€ä¸ª _init å‡½æ•°, ç¨‹åºçš„åˆå§‹åŒ–ä»£ç ä¼šè°ƒç”¨è¯¥å‡½æ•° program header table æè¿°äº†æ–‡ä»¶ä¸­è¿ç»­çš„ç‰‡ (chunk) ä¸è¿ç»­çš„å†…å­˜æ®µä¹‹é—´çš„æ˜ å°„å…³ç³» åŠ è½½ å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶çš„è¿è¡Œç”±åŠ è½½å™¨ (loader) å®Œæˆ. åŠ è½½å™¨å°†å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ä»£ç å’Œæ•°æ®ä»ç£ç›˜å¤åˆ¶åˆ°å†…å­˜, ç„¶åé€šè¿‡è·³è½¬åˆ°ç¨‹åºçš„ç¬¬ä¸€æ¡æŒ‡ä»¤æˆ–å…¥å£ç‚¹è¿è¡Œè¯¥ç¨‹åº. æ¯ä¸ª Linux ç¨‹åºéƒ½æœ‰ä¸€ä¸ªå¦‚ä¸‹å›¾æ‰€ç¤ºçš„è¿è¡Œæ—¶å†…å­˜æ˜ åƒ: åœ¨ Linux x86-64 ä¸­, ä»£ç æ®µæ€»æ˜¯ä» 0x400000 å¤„å¼€å§‹, åé¢æ˜¯æ•°æ®æ®µ (å·²åˆå§‹åŒ–æ•°æ® .data å’Œæœªåˆå§‹åŒ–æ•°æ® .bss). è¿è¡Œæ—¶å †åœ¨æ•°æ®æ®µä¹‹å, é€šè¿‡ malloc å‡½æ•°è°ƒç”¨å‘ä¸Šå¢é•¿. å †ä¹‹åæœ‰ä¸€å—ä¸º åŠ¨æ€åº“ ä¿ç•™çš„å†…å­˜, å…±äº«åº“å°†è¢«åŠ è½½åˆ°è¯¥åŒºåŸŸ. å…¶åæ˜¯ç”¨æˆ·æ ˆåŒº, å…¶æ€»æ˜¯ä»æœ€å¤§çš„åˆæ³•ç”¨æˆ·åœ°å€ (248âˆ’12^{48} - 1248âˆ’1) å¼€å§‹, éšç¨‹åºçš„æ ˆå¸§åˆ†é…å’Œé‡Šæ”¾å‘ä¸‹å¢é•¿æˆ–å‘ä¸Šå›æ”¶. åœ°å€ 2482^{48}248 å¼€å§‹æ˜¯ä¸ºç³»ç»Ÿå†…æ ¸çš„ä»£ç å’Œæ•°æ®ä¿ç•™çš„åŒºåŸŸ ä¸Šé¢å¯¹ç¨‹åºå†…å­˜æ˜ åƒçš„æè¿°å’Œå›¾ç¤ºåœ¨é€»è¾‘ä¸Šæ˜¯æ­£ç¡®çš„, ä½†å®é™…ä¸Šç”±äºå†…å­˜å¯¹å…¶, å†…å­˜ä¿æŠ¤ç­‰çš„è¦æ±‚åœ¨å®ç°ä¸Šç•¥æœ‰ä¸åŒ. å½“è¿è¡Œä¸€ä¸ªç¨‹åºæ—¶, å…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆ: åŠ è½½å™¨ä¸ºç¨‹åºåˆ›å»ºä¸Šå›¾æ‰€ç¤ºçš„å†…å­˜æ˜ åƒ, å¹¶åœ¨ç¨‹åºå¤´éƒ¨è¡¨ (program header table) çš„å¼•å¯¼ä¸‹å®Œæˆç‰‡ (chunk) çš„å¤åˆ¶. éšå, åŠ è½½å™¨è·³è½¬åˆ°ç¨‹åºçš„å…¥å£ç‚¹, å³ _start å‡½æ•°çš„åœ°å€, è¿™ä¸ªå‡½æ•°åœ¨ç³»ç»Ÿç›®æ ‡æ–‡ä»¶ ctrl.o ä¸­å®šä¹‰, _start å‡½æ•°ä¼šè°ƒç”¨ç³»ç»Ÿå¯åŠ¨å‡½æ•° __libc_start_main, è¯¥å‡½æ•°å®šä¹‰åœ¨ libc.so ä¸­, å®ƒä¼šåˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒ, è°ƒç”¨ç”¨æˆ·å±‚çš„ main å‡½æ•°, å¤„ç† main å‡½æ•°çš„è¿”å›å€¼, å¹¶åœ¨éœ€è¦çš„æ—¶å€™å°†æ§åˆ¶è¿˜ç»™å†…æ ¸.","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"CS:APP","slug":"CS-APP","permalink":"https://blog.zhuwenq.cc/tags/CS-APP/"},{"name":"Computer System","slug":"Computer-System","permalink":"https://blog.zhuwenq.cc/tags/Computer-System/"}]},{"title":"å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶","slug":"å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶","date":"2023-04-02T11:19:23.000Z","updated":"2023-06-21T06:51:28.940Z","comments":true,"path":"å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶/","link":"","permalink":"https://blog.zhuwenq.cc/%E5%8F%AF%E9%87%8D%E5%AE%9A%E4%BD%8D%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6/","excerpt":"ç°ä»£ x86-64 ç³»ç»Ÿä½¿ç”¨å¯æ‰§è¡Œå¯é“¾æ¥æ ¼å¼æ–‡ä»¶ (Executable and Linkable Format, ELF) ELF æ–‡ä»¶çš„ç»“æ„:","text":"ç°ä»£ x86-64 ç³»ç»Ÿä½¿ç”¨å¯æ‰§è¡Œå¯é“¾æ¥æ ¼å¼æ–‡ä»¶ (Executable and Linkable Format, ELF) ELF æ–‡ä»¶çš„ç»“æ„: ELF header: ä¸€ä¸ª 16 å­—èŠ‚çš„åºåˆ—æè¿°ç”Ÿæˆè¯¥æ–‡ä»¶çš„ç³»ç»Ÿçš„ å­—é•¿ å’Œ å­—èŠ‚é¡ºåº (å¤§å°ç«¯) å‰©ä¸‹çš„éƒ¨åˆ†åŒ…å«å¸®åŠ©é“¾æ¥å™¨è¯­æ³•åˆ†æå’Œè§£é‡Šç›®æ ‡æ–‡ä»¶çš„ä¿¡æ¯, å¦‚ ELF å¤´çš„å¤§å°, ç›®æ ‡æ–‡ä»¶çš„ç±»å‹ (e.g. å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶/å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶/å…±äº«ç›®æ ‡æ–‡ä»¶), æœºå™¨ç±»å‹ (e.g. x86-64), èŠ‚å¤´éƒ¨è¡¨ (section header table) çš„åç§»åœ°å€, ä»¥åŠèŠ‚å¤´éƒ¨è¡¨çš„æ¡ç›®å¤§å°å’Œæ•°é‡ section: .text: å·²ç¼–è¯‘ç¨‹åºçš„æœºå™¨ä»£ç  (æŒ‡ä»¤) .rodata: åªè¯»æ•°æ® .data: å·²åˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€å˜é‡ .bss: æœªåˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€å˜é‡, ä»¥åŠæ‰€æœ‰è¢«åˆå§‹åŒ–ä¸º 0 çš„å…¨å±€æˆ–é™æ€å˜é‡ .symtab: ç¬¦å·è¡¨, å­˜æ”¾ç¨‹åºä¸­å®šä¹‰å’Œå¼•ç”¨çš„å‡½æ•°å’Œå…¨å±€å˜é‡çš„ä¿¡æ¯ .rel.text: .text èŠ‚ä¸­ä½ç½®çš„åˆ—è¡¨, é“¾æ¥å™¨éœ€è¦ä¿®æ”¹è¿™äº›ä½ç½® .rel.data: è¢«æ¨¡å—å¼•ç”¨æˆ–å®šä¹‰çš„æ‰€æœ‰å…¨å±€å˜é‡çš„é‡å®šä½ä¿¡æ¯ .debug: è°ƒè¯•ç¬¦å·è¡¨, å…¶æ¡ç›®æ˜¯ç¨‹åºä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡å’Œç±»å‹å®šä¹‰, ç¨‹åºä¸­å®šä¹‰å’Œå¼•ç”¨çš„å…¨å±€å˜é‡, ä»¥åŠåŸå§‹çš„ C æ–‡ä»¶. åªæœ‰ä»¥ -g é€‰é¡¹è°ƒç”¨ç¼–è¯‘å™¨æ‰ä¼šå¾—åˆ°è¿™å¼ è¡¨ .line: åŸå§‹ C æ–‡ä»¶ä¸­çš„è¡Œå·å’Œ .text èŠ‚ä¸­æœºå™¨æŒ‡ä»¤ä¹‹é—´çš„æ˜ å°„, åªæœ‰ä»¥ -g é€‰é¡¹è°ƒç”¨ç¼–è¯‘å™¨æ‰ä¼šå¾—åˆ°è¿™å¼ è¡¨ .strtab: ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨, å…¶å†…å®¹åŒ…æ‹¬ .symtab å’Œ .debug èŠ‚ä¸­çš„ç¬¦å·è¡¨, ä»¥åŠèŠ‚å¤´éƒ¨ä¸­çš„èŠ‚åå­—. èŠ‚å¤´éƒ¨è¡¨ (section header table) ç¬¦å·å’Œç¬¦å·è¡¨ æ¯ä¸ª ELF æ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªç¬¦å·è¡¨, åŒ…å«è¯¥æ¨¡å— (æ–‡ä»¶) å®šä¹‰å’Œå¼•ç”¨çš„ç¬¦å·çš„ä¿¡æ¯. é“¾æ¥å™¨è€ƒè™‘ä¸‰ç§ç±»å‹çš„ç¬¦å·: ç”±å½“å‰æ¨¡å—å®šä¹‰çš„å¹¶èƒ½è¢«å…¶ä»–æ¨¡å—å¼•ç”¨çš„ å…¨å±€ç¬¦å·, å¯¹åº”äºéé™æ€çš„å‡½æ•°å’Œå…¨å±€å˜é‡ ç”±å…¶ä»–æ¨¡å—å®šä¹‰å¹¶è¢«å½“å‰æ¨¡å—å¼•ç”¨çš„ å…¨å±€ç¬¦å·, ç§°ä¸º å¤–éƒ¨ç¬¦å·. å¯¹åº”äºå…¶ä»–æ¨¡å—ä¸­å®šä¹‰çš„éé™æ€å‡½æ•°å’Œå…¨å±€å˜é‡ åªè¢«å½“å‰æ¨¡å—å¼•ç”¨å’Œå®šä¹‰çš„ å±€éƒ¨ç¬¦å·, å¯¹åº”äºå¸¦ static å±æ€§çš„å‡½æ•°å’Œå…¨å±€å˜é‡ é‡å®šä½æ¡ç›® (relocation entry) æ±‡ç¼–å™¨ç”Ÿæˆå¯é‡å®šä½ç›®æ ‡æ¨¡å—æ—¶, å®ƒå¹¶ä¸çŸ¥é“è¯¥æ¨¡å—çš„æ•°æ®å’Œä»£ç åœ¨æœ€ç»ˆç¨‹åºä¸­çš„å†…å­˜ä½ç½®, ä¹Ÿä¸çŸ¥é“è¿™ä¸ªæ¨¡å—æ‰€å¼•ç”¨çš„å¤–éƒ¨ç¬¦å· (å‡½æ•°, å…¨å±€å˜é‡) çš„ä½ç½®. å› æ­¤, å½“ç¼–è¯‘å™¨é‡åˆ°ä¸€ä¸ªå¯¹æœªçŸ¥ä½ç½®çš„ç›®æ ‡å¼•ç”¨æ—¶, å®ƒå°±ä¼šç”Ÿæˆä¸€ä¸ª é‡å®šä½æ¡ç›®, å‘Šè¯‰é“¾æ¥å™¨åœ¨é“¾æ¥æ—¶å¦‚ä½•ä¿®æ”¹è¿™ä¸ªå¼•ç”¨. ä»£ç çš„é‡å®šä½æ¡ç›®å­˜åœ¨äº .rel.text èŠ‚, æ•°æ®é‡å®šä½æ¡ç›®å­˜æ”¾åœ¨ .rel.data èŠ‚. ä¸‹é¢æ˜¯é‡å®šä½æ¡ç›®çš„ç»“æ„: 123456typedef struct &#123; long offset; // Offset of the reference to relocate long type: 32, // Relocation type symbol: 32; // Symbol table index long addend; // Constant part of relocation expression&#125; Elf64_Rela; offset: éœ€è¦è¢«ä¿®æ”¹çš„å¼•ç”¨çš„èŠ‚åç§» symbol: éœ€è¦è¢«ä¿®æ”¹çš„å¼•ç”¨åº”è¯¥æŒ‡å‘çš„ç¬¦å· type: å‘ŠçŸ¥é“¾æ¥å™¨åº”è¯¥æ€ä¹ˆä¿®æ”¹æ–°çš„å¼•ç”¨. ä¸¤ç§åŸºæœ¬çš„ç±»å‹: R_X86_64_PC32: ç›¸å¯¹åœ°å€, ä½¿ç”¨ä¸€ä¸ª 32 ä½çš„ç›¸å¯¹ PC çš„åç§»é‡é‡å®šä½ç›®æ ‡å¼•ç”¨, å¦‚ call æŒ‡ä»¤ R_X86_64_32: ç»å¯¹åœ°å€, ä½¿ç”¨ä¸€ä¸ª 32 ä½çš„ç»å¯¹åœ°å€é‡å®šä½ç›®æ ‡å¼•ç”¨ addend: ä¸€äº›ç±»å‹çš„é‡å®šä½éœ€è¦è¯¥å­—æ®µå¯¹è¢«ä¿®æ”¹å¼•ç”¨çš„å€¼åšåç§»è°ƒæ•´","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"CS:APP","slug":"CS-APP","permalink":"https://blog.zhuwenq.cc/tags/CS-APP/"},{"name":"Compute System","slug":"Compute-System","permalink":"https://blog.zhuwenq.cc/tags/Compute-System/"}]},{"title":"Linkage","slug":"Linkage","date":"2023-04-02T11:13:52.000Z","updated":"2023-06-21T06:51:28.828Z","comments":true,"path":"Linkage/","link":"","permalink":"https://blog.zhuwenq.cc/Linkage/","excerpt":"ç¨‹åºä»æºä»£ç åˆ°å¯æ‰§è¡Œæ–‡ä»¶éœ€è¦ç»è¿‡ 4 ä¸ªæ­¥éª¤, é“¾æ¥å°±æ˜¯å…¶ä¸­é‡è¦çš„ä¸€æ­¥. é“¾æ¥å™¨çš„ä¸»è¦å·¥ä½œæ˜¯å°†å…·å¤‡å¼•ç”¨å…³ç³»çš„ä¸åŒç¼–è¯‘å•å…ƒçš„ç¼–è¯‘ç»“æœ (i.e. å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶) ç›¸äº’è¿æ¥, ç»„æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶. é™æ€é“¾æ¥å™¨ä»¥ä¸€ç»„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°ä½œä¸ºè¾“å…¥, ç”Ÿæˆä¸€ä¸ªå®Œå…¨é“¾æ¥çš„, å¯ä»¥åŠ è½½è¿è¡Œçš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶.","text":"ç¨‹åºä»æºä»£ç åˆ°å¯æ‰§è¡Œæ–‡ä»¶éœ€è¦ç»è¿‡ 4 ä¸ªæ­¥éª¤, é“¾æ¥å°±æ˜¯å…¶ä¸­é‡è¦çš„ä¸€æ­¥. é“¾æ¥å™¨çš„ä¸»è¦å·¥ä½œæ˜¯å°†å…·å¤‡å¼•ç”¨å…³ç³»çš„ä¸åŒç¼–è¯‘å•å…ƒçš„ç¼–è¯‘ç»“æœ (i.e. å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶) ç›¸äº’è¿æ¥, ç»„æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶. é™æ€é“¾æ¥å™¨ä»¥ä¸€ç»„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°ä½œä¸ºè¾“å…¥, ç”Ÿæˆä¸€ä¸ªå®Œå…¨é“¾æ¥çš„, å¯ä»¥åŠ è½½è¿è¡Œçš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶. é“¾æ¥å™¨å¿…é¡»å®ç°ä¸¤ä¸ªä¸»è¦åŠŸèƒ½ä»¥å®ç°é“¾æ¥: ç¬¦å·è§£æ (symbol resolution): ç›®æ ‡æ–‡ä»¶ä¸­ä¼šå®šä¹‰å’Œå¼•ç”¨ç¬¦å·, æ¯ä¸ªç¬¦å·å¯¹åº”äºä¸€ä¸ªå‡½æ•°, å…¨å±€å˜é‡æˆ–é™æ€å˜é‡. ç¬¦å·è§£æçš„ç›®çš„æ˜¯å°†ç¬¦å·å¼•ç”¨å’Œç¬¦å·å®šä¹‰å…³è”èµ·æ¥. é‡å®šä½ (relocation): ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨ç”Ÿæˆä» 0 å¼€å§‹çš„ä»£ç å’Œæ•°æ®èŠ‚. é“¾æ¥å™¨éœ€è¦é€šè¿‡å°†æ¯ä¸ªç¬¦å·å®šä¹‰ä¸ä¸€ä¸ªå†…å­˜åœ°å€å…³è”èµ·æ¥å®ç° é‡å®šä½ . éšåé“¾æ¥å™¨éœ€è¦ä¿®æ”¹æ‰€æœ‰å¯¹è¯¥ç¬¦å·å®šä¹‰çš„å¼•ç”¨, ä½¿å…¶æŒ‡å‘è¯¥åœ°å€. é“¾æ¥å™¨ä½¿ç”¨æ±‡ç¼–å™¨æ‰€äº§ç”Ÿçš„ é‡å®šä½æ¡ç›®(relocation entry) è¿›è¡Œè¿™æ ·çš„é‡å®šä½. ç›®æ ‡æ–‡ä»¶ ç›®æ ‡æ–‡ä»¶æœ‰ä¸‰ç§å½¢å¼: å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ å…±äº«ç›®æ ‡æ–‡ä»¶ ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨å¯ä»¥ç”Ÿæˆå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶å’Œå…±äº«ç›®æ ‡æ–‡ä»¶, é“¾æ¥å™¨æ ¹æ®è¿™äº›æ–‡ä»¶ç”Ÿæˆå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ ç¬¦å·è§£æ é“¾æ¥å™¨è¿›è¡Œç¬¦å·è§£æçš„æ–¹æ³•æ˜¯å°†æ¯ä¸ªå¼•ç”¨å’Œå®ƒè¾“å…¥çš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ç¬¦å·è¡¨ä¸­å®šä¹‰çš„ä¸€ä¸ªç¡®å®šç¬¦å·å®šä¹‰å…³è”èµ·æ¥. å…¨å±€ç¬¦å·è§£æ å…¨å±€ç¬¦å·åˆ†ä¸º å¼º å’Œ å¼± ä¸¤ç§: å¼º ç¬¦å·: å‡½æ•°å’Œå·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ å¼± ç¬¦å·: æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ Linux é“¾æ¥å™¨å¯¹äºå¤šé‡å®šä¹‰çš„å…¨å±€ç¬¦å·å¤„ç†è§„åˆ™: ä¸å…è®¸æœ‰å¤šä¸ªåŒåå¼ºç¬¦å· å¦‚æœæœ‰ä¸€ä¸ªå¼ºç¬¦å·å’Œå¤šä¸ªå¼±ç¬¦å·åŒå, é€‰æ‹©å¼ºç¬¦å· å¦‚æœå¤šä¸ªå¼±ç¬¦å·åŒå, ä»ä¸­ä»»é€‰ä¸€ä¸ª å¯¹[[é™æ€åº“]]çš„è§£æ é“¾æ¥å™¨æŒ‰ç…§æ–‡ä»¶åœ¨å‘½ä»¤è¡Œå‚æ•°ä¸­å‡ºç°çš„é¡ºåºä¾æ¬¡è§£æç¬¦å·, å½“æ¶‰åŠé™æ€åº“æ—¶, å…·ä½“åœ°è¯´, é“¾æ¥å™¨ç»´æŠ¤ä¸‰ä¸ªé›†åˆ: å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶é›†åˆ EEE: EEE ä¸­çš„æ–‡ä»¶ä¼šè¢«ç»„åˆæˆå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ æœªè§£æçš„ç¬¦å·é›†åˆ UUU: å³å¼•ç”¨ä½†å°šæœªå‘ç°å®šä¹‰çš„ç¬¦å·é›†åˆ å·²å‘ç°å®šä¹‰çš„ç¬¦å·é›†åˆ DDD: å³åœ¨ä¹‹å‰çš„è¾“å…¥æ–‡ä»¶ä¸­å·²ç»æ‰¾åˆ°å®šä¹‰çš„ç¬¦å·é›†åˆ åˆå§‹æ—¶, ä¸‰ä¸ªé›†åˆå‡ä¸ºç©º: å¯¹äºå‘½ä»¤è¡Œå‚æ•°ä¸­æ¯ä¸ªæ–‡ä»¶ fff, é“¾æ¥å™¨é¦–å…ˆåˆ¤æ–­ fff æ˜¯ ç›®æ ‡æ–‡ä»¶ è¿˜æ˜¯ å­˜æ¡£æ–‡ä»¶ å¦‚æœæ˜¯ ç›®æ ‡æ–‡ä»¶: é“¾æ¥å™¨å°† fff æ·»åŠ åˆ° EEE, åŒæ—¶ä¿®æ”¹ DDD å’Œ UUU åæ˜  fff ä¸­ç¬¦å·çš„å®šä¹‰å’Œå¼•ç”¨ å¦‚æœæ˜¯ å­˜æ¡£æ–‡ä»¶: é“¾æ¥å™¨å°è¯•åŒ¹é… UUU ä¸­æœªè§£æçš„ç¬¦å·å’Œå­˜æ¡£æ–‡ä»¶ fff ä¸­å®šä¹‰çš„ç¬¦å·. å¯¹äº åŒ¹é…åˆ°çš„æ¨¡å— mmm (mmm åœ¨ fff ä¸­è¢«å®šä¹‰ä¸”å…¶å¼•ç”¨å­˜åœ¨äº UUU ä¸­) , é“¾æ¥å™¨å°† mmm æ·»åŠ åˆ° EEE, å¹¶ä¿®æ”¹ UUU å’Œ DDD ä»¥åæ˜  mmm. å¯¹äº æ‰€æœ‰æœªåŒ¹é…åˆ°çš„æ¨¡å— , é“¾æ¥å™¨ç®€å•åœ°ä¸¢å¼ƒè¿™äº›æ¨¡å— é“¾æ¥å™¨å¤„ç†å®Œå‚æ•°ä¸­æ‰€æœ‰çš„æ–‡ä»¶å, å¦‚æœ UUU æ˜¯éç©ºçš„, é‚£ä¹ˆè¯´æ˜å­˜åœ¨è¢«å¼•ç”¨ä½†æœªå®šä¹‰çš„ç¬¦å·, é“¾æ¥å™¨ä¼šè¾“å‡ºé”™è¯¯å¹¶ç»ˆæ­¢. å¦åˆ™é“¾æ¥å™¨ä¼šåˆå¹¶å’Œé‡å®šä½ EEE ä¸­çš„ç›®æ ‡æ–‡ä»¶, æ„å»ºå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ é‡å®šä½ ç¬¦å·è§£æä¹‹å, ä»£ç ä¸­æ¯ä¸ªç¬¦å·çš„å¼•ç”¨å’Œä¸€ä¸ªç¬¦å·å®šä¹‰å…³è”èµ·æ¥. é“¾æ¥å™¨æ­¤æ—¶å°±çŸ¥é“äº†ä»–çš„è¾“å…¥ç›®æ ‡æ¨¡å—ä¸­ä»£ç èŠ‚ (.text) ä»¥åŠæ•°æ®èŠ‚ (.data .rodata) çš„ç¡®åˆ‡å¤§å°, å³å…·å¤‡äº†ä¸ºæ¯ä¸ªç¬¦å·åˆ†é…è¿è¡Œæ—¶åœ°å€çš„ä¿¡æ¯. é‡å®šä½ç”±ä¸¤ä¸ªæ­¥éª¤ç»„æˆ: é‡å®šä½èŠ‚å’Œç¬¦å·å®šä¹‰: é“¾æ¥å™¨å°†æ‰€æœ‰ç›¸åŒç±»å‹çš„èŠ‚åˆå¹¶ä¸ºåŒä¸€ä¸ªèšåˆçš„èŠ‚. å³, æŠŠæ¥è‡ªæ‰€æœ‰è¾“å…¥æ¨¡å—çš„ .text, .data ç­‰åˆ†åˆ«èšåˆä¸ºä¸€ä¸ª. éšå, é“¾æ¥å™¨ä¸ºæ‰€æœ‰çš„èŠ‚ä»¥åŠæ‰€æœ‰çš„ç¬¦å·èµ‹äºˆè¿è¡Œæ—¶å†…å­˜åœ°å€, è¿™ä¸€æ­¥å®Œæˆæ—¶, ç¨‹åºä¸­æ‰€æœ‰çš„æŒ‡ä»¤å’Œå…¨å±€å˜é‡éƒ½è¢«åˆ†é…äº†å”¯ä¸€çš„è¿è¡Œæ—¶åœ°å€. é‡å®šä½èŠ‚ä¸­çš„ç¬¦å·å¼•ç”¨: é“¾æ¥å™¨ä¿®æ”¹ä»£ç èŠ‚å’Œæ•°æ®èŠ‚ä¸­å¯¹æ¯ä¸ªç¬¦å·çš„å¼•ç”¨, ä½¿å¾—å®ƒä»¬æŒ‡å‘æ­£ç¡®çš„è¿è¡Œæ—¶åœ°å€. è¿™ä¸€æ­¥çš„è¿›è¡Œä¾èµ–äºå¯é‡å®šä½ç›®æ ‡æ¨¡å—ä¸­çš„ é‡å®šä½æ¡ç›® (relocation entry) æ•°æ®ç»“æ„","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://blog.zhuwenq.cc/tags/C/"},{"name":"CS:APP","slug":"CS-APP","permalink":"https://blog.zhuwenq.cc/tags/CS-APP/"},{"name":"Compute System","slug":"Compute-System","permalink":"https://blog.zhuwenq.cc/tags/Compute-System/"},{"name":"Linkage","slug":"Linkage","permalink":"https://blog.zhuwenq.cc/tags/Linkage/"}]},{"title":"Cache","slug":"Cache","date":"2023-03-15T14:45:25.000Z","updated":"2023-06-21T06:51:28.784Z","comments":true,"path":"Cache/","link":"","permalink":"https://blog.zhuwenq.cc/Cache/","excerpt":"è®¡ç®—æœºå­˜å‚¨å™¨å…·æœ‰é‡‘å­—å¡”å¼ç»“æ„, å³: è¾ƒé«˜å±‚çš„å­˜å‚¨å™¨å®¹é‡å°é€Ÿåº¦å¿«, ä½å±‚çš„å­˜å‚¨å™¨å®¹é‡å¤§é€Ÿåº¦æ…¢, è®¡ç®—æœºé€šè¿‡ç¼“å­˜çš„æ–¹å¼æé«˜å‚¨å­˜ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½.","text":"è®¡ç®—æœºå­˜å‚¨å™¨å…·æœ‰é‡‘å­—å¡”å¼ç»“æ„, å³: è¾ƒé«˜å±‚çš„å­˜å‚¨å™¨å®¹é‡å°é€Ÿåº¦å¿«, ä½å±‚çš„å­˜å‚¨å™¨å®¹é‡å¤§é€Ÿåº¦æ…¢, è®¡ç®—æœºé€šè¿‡ç¼“å­˜çš„æ–¹å¼æé«˜å‚¨å­˜ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½. ç¼“å­˜å‘½ä¸­: å½“ç¨‹åºéœ€è¦ç¬¬ k+1k+1k+1 å±‚çš„æŸä¸ªæ•°æ®å¯¹è±¡ ddd æ—¶, å®ƒé¦–å…ˆåœ¨å½“å‰å­˜å‚¨åœ¨ç¬¬ kkk å±‚çš„æŸä¸ªå—ä¸­æŸ¥æ‰¾ ddd. å¦‚æœ ddd åˆšå¥½åœ¨ç¬¬ kkk å±‚ä¸­, é‚£ä¹ˆå°±ç§°ä¹‹ä¸ºç¼“å­˜å‘½ä¸­ (cache hit) ç¼“å­˜ä¸å‘½ä¸­: å¦‚æœç¨‹åºåœ¨ç¬¬ kkk å±‚æ²¡æœ‰æ‰¾åˆ°æ•°æ®å¯¹è±¡ ddd, å°±ç§°ä¹‹ä¸º ç¼“å­˜ä¸å‘½ä¸­ (cache miss). ç¼“å­˜ä¸å‘½ä¸­æœ‰ä»¥ä¸‹å‡ ç§: å¼ºåˆ¶æ€§ä¸å‘½ä¸­ (compulsory miss)/å†·ä¸å‘½ä¸­ (cold miss): å½“ç³»ç»Ÿåˆšå¯åŠ¨æ—¶, ç¼“å­˜ä¸€èˆ¬æ˜¯ç©ºçš„, å³ä»»ä½•æ•°æ®å¯¹è±¡çš„è®¿é—®éƒ½ä¼šä¸å‘½ä¸­. è¿™ç§æƒ…å†µç§°ä¸ºå†·ä¸å‘½ä¸­ å†²çªä¸å‘½ä¸­(conflict miss): ç”±äºé«˜å±‚çš„ç¼“å­˜å®¹é‡é€šå¸¸è¿œå°äºä½å±‚çš„å‚¨å­˜å™¨å®¹é‡, ä¸ºäº†å®Œæ•´æ˜ å°„è¾ƒå¤§å®¹é‡çš„ä½å±‚å­˜å‚¨å™¨, é€šå¸¸æ•°æ®å¯¹è±¡åœ¨ç¼“å­˜ä¸­æ”¾ç½®çš„ä½ç½®éœ€è¦ç¬¦åˆæŸç§æ”¾ç½®ç­–ç•¥. å› æ”¾ç½®ç­–ç•¥çš„åŸå› å¯¼è‡´ç¼“å­˜ä¸­å­˜æœ‰å¦ä¸€ä¸ªæ•°æ®å¯¹è±¡å¯¼è‡´çš„ä¸å‘½ä¸­ç§°ä¸ºå†²çªä¸å‘½ä¸­. å®¹é‡ä¸å‘½ä¸­ (capacity miss): ç”±äºç¨‹åºåœ¨æŸä¸ªé˜¶æ®µè®¿é—®çš„æ•°æ®é‡è¿‡å¤§è¶…è¿‡ç¼“å­˜çš„å®¹é‡å¯¼è‡´çš„ä¸å‘½ä¸­ç§°ä¸ºå®¹é‡ä¸å‘½ä¸­ cache ç»„ç»‡ç»“æ„ å¯¹äºä¸€ä¸ªåœ°å€ä¸º mmm ä½çš„è®¡ç®—æœº, æ€»å…±æœ‰ M=2mM=2^mM=2m ä¸ªä¸åŒçš„åœ°å€, å…¶ cache ä¸€èˆ¬ç¬¦åˆä¸‹å›¾çš„ç»„ç»‡ç»“æ„: å…¶ä¸­åŒ…å«ç”± S=2sS=2^sS=2s ä¸ªç¼“å­˜ç»„ (cache set), æ¯ä¸ªç¼“å­˜ç»„åŒ…å« EEE ä¸ªç¼“å­˜è¡Œ (cache line), æ¯ä¸ªç¼“å­˜è¡Œæ˜¯ç”±ä¸€ä¸ª B=2bB=2^bB=2b å­—èŠ‚çš„æ•°æ®å— (block), ä¸€ä¸ªæœ‰æ•ˆä½ (valid bit) å’Œ t=mâˆ’(b+s)t=m-(b+s)t=mâˆ’(b+s) ä¸ª æ ‡è®°ä½ (tag bit) ç»„æˆçš„. å…¶ä¸­æœ‰æ•ˆä½æ ‡è®°ç€è¿™ä¸ªè¡Œæ˜¯å¦å­˜æœ‰æœ‰æ„ä¹‰çš„ä¿¡æ¯, æ ‡è®°ä½æ—¶å½“å‰å—åœ°å€çš„ä¸€ä¸ªå­é›†. cache å—çš„å®šä½è¿‡ç¨‹ å¯¹äº mmm ä½çš„åœ°å€, å…¶è¢«åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†è§£è¯»: ä½äºé«˜ä½éƒ¨åˆ†çš„æ ‡è®°ä½, ä½äºä¸­é—´éƒ¨ä½çš„ç»„ç´¢å¼• (set index) å’Œä½äºä½ä½éƒ¨ä½çš„å—åç§» (block offset). ç»„é€‰æ‹©: é¦–å…ˆå¯¹äºä½äºä¸­é—´éƒ¨ä½çš„ç»„ç´¢å¼• (set index), é€šè¿‡å®ƒå¯ä»¥ç›´æ¥ç´¢å¼•åˆ° cache å—æ‰€åœ¨çš„ cache set è¡ŒåŒ¹é…: å¯¹äºä¸€ä¸ª cache set ä¸­ EEE ä¸ª cache line çš„æ¯ä¸€ä¸ª, é¦–å…ˆæ£€æŸ¥ valid bit æ˜¯å¦è®¾ç½®, åªæœ‰å¯¹äºè®¾ç½®äº† valid bit çš„ cache line, å¦‚æœå…¶ tag bit ä¸åœ°å€é«˜ä½éƒ¨åˆ†çš„ tag bit ç›¸ç¬¦, åˆ™è¯´æ˜è¿™ä¸ª cache line ä¸­å­˜æœ‰è¦å®šä½çš„å—. å­—é€‰æ‹©: å¯¹äºç¡®å®šäº†çš„ cache line, åœ°å€ä½ä½éƒ¨åˆ†çš„ bbb ä½ block offset å¯ä»¥ç›´æ¥å®šä½åˆ°è¦æŸ¥æ‰¾çš„å— å½“å‘ç”Ÿ cache miss æ—¶, å¿…é¡»ä»æ›´ä½ä¸€å±‚çš„å­˜å‚¨å™¨ä¸­å–å‡ºä¸€è¡Œæ•°æ®å¹¶æ”¾åœ¨ç¼“å­˜ä¸­: è¡Œæ›¿æ¢: å¦‚æœå¯¹åº”çš„ç»„ä¸­å­˜åœ¨ä¸€ä¸ªç©ºè¡Œ, é‚£ä¹ˆå¯ä»¥ç›´æ¥å°†æ–°çš„è¡Œå†™å…¥ç©ºè¡Œä¸­. å¦‚æœä¸å­˜åœ¨ç©ºè¡Œ, åˆ™å¿…é¡»æ›¿æ¢ä¸€ä¸ªæœ‰æ•ˆçš„è¡Œ. å¸¸è§çš„æ›¿æ¢ç­–ç•¥æœ‰éšæœºæ›¿æ¢, LRU, LFU ç­‰. å†™å…¥å†…å­˜æ—¶ä¸ cache æœ‰å…³çš„è‹¥å¹²é—®é¢˜ å†™å‘½ä¸­ (write hit), å³è¦å†™å…¥çš„æ•°æ®å¯¹è±¡å­˜åœ¨äº cache ä¸­æ—¶, æœ‰ä¸¤ç§æ•°æ®æ›´æ–°ç­–ç•¥: ç›´å†™ (write through): å³ç«‹å³å°†ä¿®æ”¹åçš„ cache å—å†™åˆ°ä½ä¸€å±‚çš„å­˜å‚¨å™¨ä¸­. è¿™ç§ç­–ç•¥è¾ƒä¸ºç®€å•, ä½†æ˜¯å…¶ä¼šå¼•èµ·å¤§é‡çš„æ€»å†™æµé‡ å†™å› (write back): å³å°½å¯èƒ½è¿Ÿåœ°æ¨è¿Ÿæ›´æ–°, åªåœ¨æ›¿æ¢ç­–ç•¥å³å°†é©±é€è¿™ä¸ªæ›´æ–°è¿‡äº†çš„å—æ—¶æ‰å°†å…¶å†™å…¥åˆ°ä½ä¸€å±‚çš„å­˜å‚¨å™¨ä¸­. è¿™ç§ç­–ç•¥èƒ½å¤Ÿæ˜¾è‘—å‡å°‘æ€»çº¿æµé‡, ä½†å®ƒéœ€è¦æ¯ä¸ª cache line ç»´æŠ¤é¢å¤–çš„çŠ¶æ€ä½ (dirty bit) æ ‡è®°è¿™ä¸ª cache å—æ˜¯å¦è¢«ä¿®æ”¹è¿‡ å†™ä¸å‘½ä¸­ (write miss) æ—¶, å¯¹åº”åœ°ä¹Ÿæœ‰ä¸¤ç§æ•°æ®æ›´æ–°ç­–ç•¥: å†™åˆ†é… (write allocate): åŠ è½½ç›¸åº”çš„æ•°æ®åˆ° cache ä¸­, ç„¶åæ›´æ–° cache å— éå†™åˆ†é… (non-write-allocate): ç»•å¼€ cache, ç›´æ¥å†™å…¥åˆ°ä½ä¸€å±‚çš„å­˜å‚¨å™¨ é€šå¸¸å†™å›ç­–ç•¥ä¸å†™åˆ†é…ç­–ç•¥ä¼šæ­é…ä½¿ç”¨ çœŸå®çš„ cache é€šå¸¸æ¯ä¸ª CPU ä¼šæœ‰ä¸¤ä¸ª L1 cache, ä¸€ä¸ªç”¨äºç¼“å­˜æ•°æ®, ä¸€ä¸ªç”¨äºç¼“å­˜æŒ‡ä»¤; åŒä¸€ä¸ª CPU çš„ä¸¤ä¸ª L1 cache å…±äº«ä¸€ä¸ª L2 cache; æ‰€æœ‰ CPU çš„ L2 cache å…±äº«ä¸€ä¸ª L3 cache.","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"CS:APP","slug":"CS-APP","permalink":"https://blog.zhuwenq.cc/tags/CS-APP/"},{"name":"Compute System","slug":"Compute-System","permalink":"https://blog.zhuwenq.cc/tags/Compute-System/"},{"name":"CPU Cache","slug":"CPU-Cache","permalink":"https://blog.zhuwenq.cc/tags/CPU-Cache/"}]},{"title":"Xv6 Operating system 03-page table","slug":"Xv6-Operating-system-03-page-table","date":"2023-03-09T11:13:11.000Z","updated":"2023-06-21T06:51:28.932Z","comments":true,"path":"Xv6-Operating-system-03-page-table/","link":"","permalink":"https://blog.zhuwenq.cc/Xv6-Operating-system-03-page-table/","excerpt":"é¡µè¡¨æ˜¯æ“ä½œç³»ç»Ÿä¹‹æ‰€ä»¥èƒ½å¤Ÿä¸ºè¿›ç¨‹æä¾›ç‹¬ç«‹çš„åœ°å€ç©ºé—´å’Œå†…å­˜æ‰€ä¾èµ–çš„æœºåˆ¶ã€‚","text":"é¡µè¡¨æ˜¯æ“ä½œç³»ç»Ÿä¹‹æ‰€ä»¥èƒ½å¤Ÿä¸ºè¿›ç¨‹æä¾›ç‹¬ç«‹çš„åœ°å€ç©ºé—´å’Œå†…å­˜æ‰€ä¾èµ–çš„æœºåˆ¶ã€‚ æ“ä½œç³»ç»Ÿä½¿ç”¨é¡µè¡¨ç®¡ç†ç‰©ç†å†…å­˜ï¼Œç”±é¡µè¡¨å†³å®šå†…å­˜åœ°å€çš„æ„ä¹‰ï¼Œä»¥åŠç‰©ç†å†…å­˜çš„è®¿é—®ã€‚ é€šè¿‡é¡µè¡¨æä¾›çš„ä¸­é—´å±‚ï¼Œæ“ä½œç³»ç»Ÿè¿˜å¯ä»¥å®ç°ä¸€äº›é¢å¤–çš„ tricks, ä¾‹å¦‚å°†åŒä¸€å—å†…å­˜æ˜ å°„åˆ°å¤šä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´ (å¦‚æ‰€æœ‰è¿›ç¨‹åœ°å€ç©ºé—´ä¸­éƒ½ä¸€æ ·çš„å†…æ ¸ä»£ç å’Œæ•°æ®åŒº)ï¼Œæˆ–è€…é€šè¿‡æ°¸è¿œä¸æ˜ å°„å†…æ ¸æ‰€åœ¨çš„å†…å­˜å®ç°å†…æ ¸å’Œè¿›ç¨‹ä¹‹é—´çš„éš”ç¦»ã€‚ æ¢é¡µç¡¬ä»¶ xv6 æ“ä½œç³»ç»Ÿæ˜¯ä¸º RISK-V å¤„ç†å™¨è®¾è®¡çš„ï¼Œå› æ­¤è¿™é‡Œæè¿°çš„æ¢é¡µç¡¬ä»¶å¯èƒ½å’Œå…¶ä»–ç³»ç»Ÿçš„æœ‰æ‰€ä¸åŒã€‚ åœ¨ xv6 æ‰€è¿è¡Œåœ¨çš„ Sv39 RISK-V å¤„ç†å™¨ä¸Šï¼Œ64 ä½åœ°å€çš„ä¸­åªæœ‰ä½ 39 ä½è¢«ä½¿ç”¨ï¼Œå…¶ä½™ 25 ä½ç•™ç©ºã€‚ é€»è¾‘ä¸Š ä¸€ä¸ª RISK-V é¡µè¡¨æ˜¯ä¸€ä¸ª 2272^{27}227 é•¿çš„ page table entries(PTE) æ•°ç»„. è€Œæ¯ä¸ª PTE ç”±ä¸€ä¸ª 44 ä½å®½çš„ç‰©ç†é¡µç¼–å· (physical page number, PPN) å’Œä¸€äº›æ ‡å¿—ä½ç»„æˆã€‚ æ¢é¡µç¡¬ä»¶ç¿»è¯‘è™šæ‹Ÿåœ°å€æ—¶ï¼Œåˆ©ç”¨è™šæ‹Ÿåœ°å€ä½ 39 ä½ä¸­çš„é«˜ 27 ä½åœ¨é¡µè¡¨ä¸­å®šä½ PTEï¼Œ ç„¶åå°†æ‰¾åˆ°çš„ PTE çš„ 44 ä½ç‰©ç†é¡µç¼–å·å’Œè™šæ‹Ÿåœ°å€ä½ 39 ä½ä¸­çš„å‰©ä½™ 12 ä½ç»„åˆæˆä¸€ä¸ª 56 ä½çš„ç‰©ç†åœ°å€ã€‚ å®é™…ä¸Š xv6 çš„é¡µè¡¨åœ¨å®ç°ä¸Šå¹¶ä¸æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 2272^27227 çš„æ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸‰çº§çš„æ ‘çŠ¶ç»“æ„. æ•°çš„æ ¹éƒ¨æ˜¯ä¸€ä¸ª 4096 å­—èŠ‚å¤§å°çš„é¡µè¡¨é¡µ (å‚¨å­˜ç€é¡µè¡¨çš„é¡µ), å…¶å†…éƒ¨ä¿å­˜äº† 512 ä¸ª PTEï¼Œå…¶ä¸­æ¯ä¸ª PTE ä¿å­˜äº†ä¸‹ä¸€çº§é¡µè¡¨é¡µçš„ç‰©ç†åœ°å€ã€‚ æ¢é¡µç¡¬ä»¶ä½¿ç”¨è™šæ‹Ÿåœ°å€çš„ 27 ä½é¡µè¡¨åœ°å€çš„é«˜ 9 ä½å®šä½æ ¹é¡µè¡¨ä¸­çš„ PTEï¼Œç„¶åæ ¹æ®è¯¥ PTE å®šä½äºŒçº§é¡µè¡¨ï¼Œç„¶åä½¿ç”¨ä¸­é—´ 9 ä½å®šä½äºŒçº§é¡µè¡¨ä¸­çš„ PTEï¼Œå¹¶æ ¹æ®äºŒçº§é¡µè¡¨ä¸­çš„ PTE å®šä½ä¸‰çº§é¡µè¡¨ï¼Œæœ€åä½¿ç”¨ä½ 9 ä½å®šä½æœ€ç»ˆçš„ PTEã€‚è¯¥æœ€ç»ˆ PTE çš„ 44 ä½åœ°å€ä¼šç”¨æ¥è®¿é—®å®é™…çš„é¡µï¼Œè€Œè™šæ‹Ÿåœ°å€ä¸­å‰©ä½™çš„ 12 ä½ä¼šç”¨æ¥åœ¨è¯¥é¡µä¸­å®šä½å­—èŠ‚ã€‚ å¦‚æœä¸‰çº§ PTE ä¸­ä»»æ„ä¸€ä¸ªä¸å­˜åœ¨ ( æ ¹æ®è™šæ‹Ÿåœ°å€æ£€ç´¢ä¸åˆ° )ï¼Œæ¢é¡µç¡¬ä»¶ä¼šäº§ç”Ÿé¡µé”™è¯¯å¼‚å¸¸ (page-fault exception), å°†ç”±å†…æ ¸è´Ÿè´£å¤„ç†è¯¥å¼‚å¸¸ PTE æ ‡å¿—ä½ æ¯ä¸ª PTE éƒ½åŒ…å«ä¸€ç³»åˆ—æ ‡å¿—ä½ (flags)ï¼Œ æ ‡è¯†ç€è¯¥ PTE ä¸­çš„åœ°å€è¢«å…è®¸çš„ç”¨æ³•ï¼š PTE_V (valid): è¯¥ PTE æ˜¯å¦å¯è§ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½® (not set), å¯¹è¯¥ PTE æŒ‡å‘çš„é¡µçš„å¼•ç”¨ä¼šå¯¼è‡´å¼‚å¸¸ PTE_R (readable): è¯¥ PTE æŒ‡å‘çš„é¡µæ˜¯å¦å¯è¯» PTE_W (writable): è¯¥ PTE æŒ‡å‘çš„é¡µæ˜¯å¦å¯å†™ PTE_X (executable): CPU æ˜¯å¦å¯ä»¥å°†è¯¥ PTE æŒ‡å‘çš„é¡µçš„å†…å®¹è§£é‡Šä¸ºæŒ‡ä»¤å¹¶æ‰§è¡Œ PTE_U (user): è¯¥ PTE æŒ‡å‘çš„é¡µæ˜¯å¦å¯ä»¥ç”±ç”¨æˆ·æ€æŒ‡ä»¤è®¿é—® å†…æ ¸åœ°å€ç©ºé—´ xv6 ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªé¡µè¡¨ï¼Œè¯¥é¡µè¡¨æè¿°äº†è¿›ç¨‹çš„ç”¨æˆ·åœ°å€ç©ºé—´ã€‚æ­¤å¤–ï¼Œxv6 è¿˜ç»´æŠ¤ä¸€ä¸ªé¡µè¡¨ç”¨äºæè¿°å†…æ ¸çš„åœ°å€ç©ºé—´ã€‚ å†…æ ¸å°†é…ç½®è‡ªå·±çš„åœ°å€ç©ºé—´ä½¿å…¶èƒ½å¤Ÿåœ¨å¯é¢„æµ‹çš„åœ°å€ä¸Šè®¿é—®ç‰©ç†å†…å­˜å’Œå…¶ä»–ç¡¬ä»¶è®¾å¤‡ã€‚å³ï¼Œå†…æ ¸ä½¿ç”¨ç›´æ¥æ˜ å°„ (direct mapping) çš„æ–¹å¼è·å– RAM å’Œç¡¬ä»¶è®¾å¤‡å¯„å­˜å™¨çš„è®¿é—®åœ°å€ã€‚ ç›´æ¥æ˜ å°„å³å°†ç¡¬ä»¶è®¾å¤‡çš„åœ°å€æ˜ å°„ä¸ºè·Ÿå®ƒä»¬çš„ç‰©ç†åœ°å€ä¸€æ ·çš„è™šæ‹Ÿåœ°å€ã€‚å¦‚å†…æ ¸æœ¬èº«å°†è‡ªå·±åŠ è½½åˆ°è™šæ‹Ÿå†…å­˜ KERNBASE=0x80000000 çš„ä½ç½®ï¼ŒåŒæ—¶è¯¥åœ°å€æ•°å€¼ä¹Ÿæ˜¯å…¶åœ¨ç‰©ç†å†…å­˜ä¸­çš„ä½ç½®ã€‚ å†…æ ¸åœ°å€ç©ºé—´ä¸­ä¹Ÿæœ‰ä¸€äº›ä¸æ˜¯ç›´æ¥æ˜ å°„çš„è™šæ‹Ÿåœ°å€: é¡¶éƒ¨çš„ trampoline é¡µè¢«æ˜ å°„åˆ°å†…æ ¸åœ°å€ç©ºé—´çš„é¡¶éƒ¨ï¼ŒåŒæ—¶å®ƒä¹Ÿè¢«æ˜ å°„åˆ°ç”¨æˆ·åœ°å€ç©ºé—´çš„é¡¶éƒ¨ã€‚ ==å€¼å¾—æ³¨æ„çš„æ˜¯è¿™ä¸ªé¡µåœ¨ç‰©ç†å†…å­˜ä¸­çš„ä½ç½®åŒæ—¶ä¹Ÿä¼šè¢«å†…æ ¸çš„ç›´æ¥æ˜ å°„æ˜ å°„åœ¨å†…æ ¸ä¸­çš„æŸä¸ªä½ç½®ã€‚ å†…æ ¸æ ˆé¡µ. æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„å†…æ ¸æ ˆï¼Œæ‰€æœ‰çš„å†…æ ¸æ ˆéƒ½ä¼šè¢«æ˜ å°„åœ¨å†…æ ¸åœ°å€ç©ºé—´çš„é«˜å¤„ï¼Œå¹¶ä¸”æ¯ä¸ªå†…æ ¸æ ˆä¸‹æ–¹ä¼šé˜²æ­¢ä¸€ä¸ªé¡µçš„éš”ç¦»åŒºã€‚è¯¥éš”ç¦»é¡µçš„ PTE_V æ²¡æœ‰è®¾ç½®ï¼Œå› æ­¤å½“å†…æ ¸æ ˆæº¢å‡ºåˆ°éš”ç¦»é¡µæ—¶ï¼Œå¯¹ invalid å†…å­˜çš„è®¿é—®ä¼šå¯¼è‡´å¼‚å¸¸ï¼Œå¹¶é€ æˆ kernel panic. å†…æ ¸æ²¡æœ‰å…¨éƒ¨ä½¿ç”¨ç›´æ¥æ˜ å°„è€Œæ˜¯å°†å†…æ ¸æ ˆä»¥åŠ trampoline é¡µæ˜ å°„åˆ°é¡¶éƒ¨ä¸»è¦ç›®çš„æ˜¯æä¾›ä¿æŠ¤æœºåˆ¶ (éš”ç¦»åŒº) ç‰©ç†å†…å­˜åˆ†é… xv6 ä½¿ç”¨é“¾è¡¨ç®¡ç†ç‰©ç†å†…å­˜, ç®¡ç†çš„æœ€å°å•ä½æ˜¯ 4096 å­—èŠ‚å¤§å°çš„é¡µ. å…·ä½“åœ°è¯´, xv6 é€šè¿‡é“¾è¡¨ä¸²èµ·ç‰©ç†å†…å­˜ä¸­æ‰€æœ‰çš„é¡µ (ä»å†…æ ¸åœ°å€çš„ç»“å°¾åˆ°ç‰©ç†å†…å­˜çš„ç»“å°¾) , åˆ†é…å†…å­˜å³ä»é“¾è¡¨ä¸­ç§»é™¤å¯¹åº”çš„é¡µèŠ‚ç‚¹, å›æ”¶å†…å­˜å³å°†å¾…å›æ”¶çš„å†…å­˜åŠ å›åˆ°é“¾è¡¨ è¿›ç¨‹ç©ºé—´(ç”¨æˆ·åœ°å€ç©ºé—´) è¿›ç¨‹çš„åœ°å€ç©ºé—´ä»è™šæ‹Ÿåœ°å€ 0 ä¸€ç›´åˆ° MAXVA. å½“è¿›ç¨‹å‘ xv6 è¦æ±‚æ›´å¤šå†…å­˜æ—¶, xv6 é¦–å…ˆè°ƒç”¨ kalloc åˆ†é…ç‰©ç†é¡µ, éšå xv6 å‘è¿›ç¨‹çš„é¡µè¡¨æ·»åŠ æŒ‡å‘æ–°åˆ†é…çš„ç‰©ç†é¡µçš„ PTE, åŒæ—¶ä¸ºè¿™äº› PTE è®¾ç½®æ ‡å¿—ä½. å¤§å¤šæ•°è¿›ç¨‹ç”¨ä¸åˆ°å…¨éƒ¨çš„åœ°å€ç©ºé—´, xv6 å°†æ²¡æœ‰ä½¿ç”¨çš„ PTE è®¾ç½®æˆä¸å¯ç”¨çŠ¶æ€. é¡µè¡¨ç®¡ç†ç”¨æˆ·åœ°å€ç©ºé—´çš„å‡ ç‚¹å¥½å¤„: ä¸åŒè¿›ç¨‹ç»´æŠ¤ä¸åŒçš„é¡µè¡¨, å¯ä»¥å°†ç”¨æˆ·åœ°å€æ˜ å°„ä¸ºç‰©ç†å†…å­˜ä¸Šä¸åŒçš„é¡µ, ä½¿å¾—æ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰è‡ªå·±çš„ç§æœ‰å†…å­˜. æ¯ä¸ªè¿›ç¨‹éƒ½è®¤ä¸ºè‡ªå·±çš„åœ°å€ç©ºé—´æ˜¯ä» 0 å¼€å§‹ä¸”è¿ç»­çš„, ä½†å®é™…çš„ç‰©ç†å†…å­˜å¯ä»¥æ˜¯ä¸è¿ç»­çš„ å†…æ ¸å¯ä»¥å°†åŒä¸€å—åœ¨æ‰€æœ‰è¿›ç¨‹ä¸­å…±äº«çš„ç‰©ç†å†…å­˜æ˜ å°„åˆ°æ‰€æœ‰è¿›ç¨‹çš„åœ°å€ç©ºé—´, å³åŒä¸€å—ç‰©ç†å†…å­˜å¯ä»¥å‡ºç°åœ¨æ‰€æœ‰è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"Operating System","slug":"Operating-System","permalink":"https://blog.zhuwenq.cc/tags/Operating-System/"},{"name":"xv6","slug":"xv6","permalink":"https://blog.zhuwenq.cc/tags/xv6/"}]},{"title":"C++ æ¨¡æ¿03--åŸºæœ¬æŠ€å·§","slug":"C-æ¨¡æ¿03-åŸºæœ¬æŠ€å·§","date":"2023-03-06T12:04:48.000Z","updated":"2023-06-21T06:51:28.784Z","comments":true,"path":"C-æ¨¡æ¿03-åŸºæœ¬æŠ€å·§/","link":"","permalink":"https://blog.zhuwenq.cc/C-%E6%A8%A1%E6%9D%BF03-%E5%9F%BA%E6%9C%AC%E6%8A%80%E5%B7%A7/","excerpt":"C++ template ä¸­å…³äºå®è·µçš„ä¸€äº›æŠ€å·§å’ŒåŸºç¡€æœºåˆ¶","text":"C++ template ä¸­å…³äºå®è·µçš„ä¸€äº›æŠ€å·§å’ŒåŸºç¡€æœºåˆ¶ typename å…³é”®å­— å½“ä¸€ä¸ªç±»å‹åä¾èµ–äºä¸€ä¸ªæ¨¡æ¿å‚æ•°æ—¶ï¼Œè¯¥ç±»å‹åä¹‹å‰å¿…é¡»ä½¿ç”¨ typename: 12345678910template&lt;typename T&gt;class C &#123; void fun() &#123; // without the typename keywork, // the compiler might think // some_type is a member of T // instead of a type. typename T::some_type* ptr; &#125;&#125; zero-initialization å¯¹äº C++ ä¸­çš„åŸºæœ¬ç±»å‹å¦‚ int, double, å’Œ pointer ç­‰ç±»å‹ï¼Œå®ƒä»¬æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°å› æ­¤ä¸ä¼šè‡ªåŠ¨å°†è‡ªå·±åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚åœ¨éå…¨å±€ä½œç”¨åŸŸä¸‹ï¼Œæœªæ˜¾å¼åˆå§‹åŒ–çš„å±€éƒ¨å˜é‡å…·æœ‰æœªå®šä¹‰çš„å€¼: 1234void func () &#123; int x; // x has undefined value int* ptr; // ptr might point to anywhere instead of nowhere&#125; å› æ­¤åœ¨æ¨¡æ¿ä¸­ï¼Œå¦‚æœéœ€è¦å¯¹æ¨¡æ¿å‚æ•°æä¾›çš„ç±»å‹æ„é€ ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»æ˜¾å¼æŒ‡å®šä¸ºå…¶é»˜è®¤åˆå§‹åŒ–( å¤§æ‹¬å·åˆå§‹åŒ– ): 12345template&lt;typename T&gt;void func () &#123; T t1; // not good, t1 has undefined value T t2&#123;&#125;; // good, t2 is default initialized&#125; å¤§æ‹¬å·åˆå§‹åŒ–æ„å‘³ç€: å¦‚æœå¯¹è±¡ç±»å‹å®šä¹‰æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œåˆ™è°ƒç”¨è¯¥é»˜è®¤æ„é€ å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œåˆ™ä¼šå°è¯•ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨æ„é€ å‡½æ•° å¯¹äºå†…ç½®ç±»å‹ï¼Œæ‰§è¡Œé›¶åˆå§‹åŒ–( zero initialization )ã€‚å³: å¯¹è±¡çš„å€¼è¢«åˆå§‹åŒ–ä¸º 0 (æ•°å€¼ç±»å‹ï¼ŒæŒ‡é’ˆ) æˆ– false (bool ç±»å‹) ä½¿ç”¨ this-&gt; å¯¹äºç»§æ‰¿ä½“ç³»ä¸­çš„ç±»æ¨¡æ¿ï¼Œå¦‚æœåŸºç±»ä¹Ÿæ˜¯ç±»æ¨¡æ¿ä¸”åŸºç±»æ¨¡æ¿ä¾èµ–äºæ´¾ç”Ÿç±»æ¨¡æ¿çš„æ¨¡æ¿å‚æ•°ï¼Œé‚£ä¹ˆå¯¹äºåœ¨åŸºç±»ä¸­å®šä¹‰çš„ç¬¦å·ï¼Œåº”è¯¥æ€»æ˜¯ä½¿ç”¨ this-&gt; æˆ– Base&lt;T&gt;:: æ ‡è¯†: 123456789101112131415template &lt;typename T&gt;class Base &#123;public: void fun();&#125;;template &lt;typename T&gt;class Derived : Base&lt;T&gt; &#123; // Base relies on T of Derivedpublic: void foo()&#123; fun(); // Error, Base&lt;T&gt;::fun() is never considered in symbol resolving process this-&gt;func(); // Ok Base&lt;T&gt;::func(); // Ok &#125;&#125; åŸå§‹æ•°ç»„æˆ–å­—ç¬¦ä¸²å­—é¢é‡ä½œå‚æ•°çš„æ¨¡æ¿ å½“åŸå§‹æ•°ç»„æˆ–å­—ç¬¦ä¸²å­—é¢é‡ä½œå‚æ•°æ—¶ï¼Œå¦‚æœæ¨¡æ¿çš„å‚æ•°ç±»å‹è¢«å£°æ˜ä¸ºå¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆåŸå§‹æ•°ç»„æˆ–å­—ç¬¦ä¸²å­—é¢é‡ä¸ä¼šåœ¨ä¼ å‚è¿‡ç¨‹ä¸­å‘ç”Ÿç±»å‹é€€åŒ–: 1234567891011121314template&lt;typename T, size_t N, size_t M&gt;bool less(T(&amp;a)[N], T(&amp;b)[M]) &#123; for(size_t i = 0; i &lt; N &amp;&amp; i &lt; M; ++i)&#123; if(a[i] &lt; b[i])return true; if(a[i] &gt; b[i])return false; &#125; return N &lt; M;&#125;int x[] = &#123;1, 2, 3&#125;;int y[] = &#123;1, 2, 3, 4, 5&#125;;// both type and length are reserved when passing argumentsless(x, y); æ•°ç»„ä¹Ÿå¯ä»¥ä»¥ä¸å®Œæ•´ç±»å‹çš„å½¢å¼å‡ºç°ï¼Œå³ä¸€ä¸ªæ•°ç»„çš„å£°æ˜ç¬¦å·ä¹Ÿå¯ä»¥ç”¨ä½œæ¨¡æ¿å‚æ•°ã€‚ç”±äºæ•°ç»„å£°æ˜ç¬¦å·å¯ä»¥ä¸æä¾›é•¿åº¦ä¿¡æ¯ï¼Œå› æ­¤ä¸€ä¸ªæ”¯æŒæ‰€æœ‰æ•°ç»„ç±»å‹çš„æ¨¡æ¿å¿…é¡»ä¸ºä¸å®Œæ•´æ•°ç»„(æ— è¾¹ç•Œæ•°ç»„)æä¾›ç‰¹åŒ–: 1234567891011121314151617181920212223242526272829303132333435extern int x[]; // an incomplete type of int []// undefined templatetemplate &lt;typename T&gt;class TemplateForArray;// template 1: for array typetemplate &lt;typename T, std::size_t N&gt;class TemplateForArray&lt;T[N]&gt; &#123;public: static void func() &#123; std::cout &lt;&lt; &quot;for array T[&quot; &lt;&lt; N &lt;&lt; &quot;]&quot;; &#125;&#125;;// template 2: for reference to array typetemplate &lt;typename T, std::size_t N&gt;class TemplateForArray&lt;T (&amp;)[N]&gt; &#123;public: static void func() &#123; std::cout &lt;&lt; &quot;for array T(&amp;)[&quot; &lt;&lt; N &lt;&lt; &quot;]&quot;; &#125;&#125;;// template 3: for incomplete arraytemplate &lt;typename T&gt;class TemplateForArray&lt;T[]&gt; &#123;public: static void func() &#123; std::cout &lt;&lt; &quot;for incomplete array T[]&quot;; &#125;&#125;;int main() &#123; int x[] = &#123;1, 2, 3&#125;; // x is of type int[3] int (&amp;y)[3] = x; // y is of type int(&amp;)[3] extern int z[]; // z in of type int[], which is incomplete TemplateForArray&lt;decltype(x)&gt;::func(); // ok TemplateForArray&lt;decltype(y)&gt;::func(); // ok TemplateForArray&lt;decltype(z)&gt;::func(); // error: incomplete type &#x27;TemplateForArray&lt;int []&gt;&#x27; used in nested name specifier if without template 3&#125; æˆå‘˜æ¨¡æ¿ ç±»/ç±»æ¨¡æ¿çš„æˆå‘˜ä¹Ÿå¯ä»¥è¢«å®šä¹‰æˆæ¨¡æ¿ å¯¹äºç±»æ¨¡æ¿ï¼Œåªæœ‰è¢«ç”¨åˆ°çš„æˆå‘˜å‡½æ•°æ‰ä¼šè¢«å®ä¾‹åŒ– ç±»/ç±»æ¨¡æ¿çš„æˆå‘˜æ¨¡æ¿ä¹Ÿå¯ä»¥è¢«ç‰¹åŒ–(å…¨ç‰¹åŒ–, åç‰¹åŒ–) ç±»/ç±»æ¨¡æ¿çš„ç‰¹æ®Šæˆå‘˜å‡½æ•°ä¹Ÿå¯ä»¥è¢«å®šä¹‰æˆæ¨¡æ¿ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„: æ„é€ å‡½æ•°æ¨¡æ¿æˆ–èµ‹å€¼è¿ç®—ç¬¦æ¨¡æ¿ä¸ä¼šæ›¿æ¢é¢„å®šä¹‰çš„æ„é€ å‡½æ•°æˆ–èµ‹å€¼è¿ç®—ç¬¦ æˆå‘˜æ¨¡æ¿ä¸ç®—åšå¤åˆ¶æˆ–ç§»åŠ¨å¯¹è±¡çš„ç‰¹æ®Šæˆå‘˜å‡½æ•° .template å…³é”®å­— å½“è°ƒç”¨æˆå‘˜æ¨¡æ¿çš„å¯¹è±¡å…¶è‡ªèº«ä¾èµ–äºæ¨¡æ¿å‚æ•°æ—¶ï¼Œç¼–è¯‘å™¨æ— æ³•å°† &lt; è§£ææˆæ¨¡æ¿å‚æ•°åˆ—è¡¨çš„å¼€å§‹ï¼Œå› æ­¤éœ€è¦æ˜¾å¼åœ°ä½¿ç”¨ .template è¡¨ç¤ºæ¨¡æ¿æ„é€ ã€‚ä¾‹å¦‚ï¼š 1234template&lt;unsigned long N&gt;void printBitset ((std::bitset&lt;N&gt; const&amp; bs)) &#123; std::cout &lt;&lt; bs.template to_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt;&gt;();&#125; ä¸Šä¾‹ä¸­ç”±äº bs çš„ç±»å‹ä¾èµ–äºæ¨¡æ¿å‚æ•° N, å› æ­¤å¿…é¡»ç”¨ .template æ‰å¯ä»¥è°ƒç”¨æˆå‘˜æ¨¡æ¿ã€‚ ç±»ä¼¼çš„æ“ä½œè¿˜æœ‰ -&gt;template å’Œ ::template, åº”è¯¥ä»…åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ æ³›å‹ lambda è¡¨è¾¾å¼æ˜¯æˆå‘˜æ¨¡æ¿çš„ wrapper C++ 14 ä¸­å¼•å…¥çš„æ³›å‹ lambda è¡¨è¾¾å¼ä¾‹å¦‚: 123[] (auto a, auto b) &#123; return a + b;&#125;; å®é™…ä¸Šç›¸å½“äº: 12345678class [InnerCompilerID] &#123; // compiler given namepublic: [InnerCompilerID](); template &lt;typename T1, typename T2&gt; auto operator()(T1 a, T2 b) const &#123; return a + b; &#125;&#125;;","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"C++ Template","slug":"C-Template","permalink":"https://blog.zhuwenq.cc/tags/C-Template/"},{"name":"C++","slug":"C","permalink":"https://blog.zhuwenq.cc/tags/C/"}]},{"title":"Xv6 Operating system 02-organization","slug":"xv6-Operating-system-02-organization","date":"2023-03-05T12:15:06.000Z","updated":"2023-06-21T06:51:28.936Z","comments":true,"path":"xv6-Operating-system-02-organization/","link":"","permalink":"https://blog.zhuwenq.cc/xv6-Operating-system-02-organization/","excerpt":"The core functionality of an OS æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒä»»åŠ¡åœ¨äºåŒæ—¶æ”¯æŒå¤šä¸ªæ´»åŠ¨ï¼Œå³ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»å°†ç¡¬ä»¶èµ„æºåˆ†æ—¶å…±äº«ç»™æ‰€æœ‰çš„è¿›ç¨‹ä½¿ç”¨ã€‚ ä¸ºäº†ä¿è¯è¿›ç¨‹çš„æ´»åŠ¨è´¨é‡ï¼Œæ“ä½œç³»ç»Ÿè¿˜å¿…é¡»ä¿è¯è¿›ç¨‹çš„æ‰§è¡Œæ˜¯ ç‹¬ç«‹/å­¤ç«‹(isolation) çš„ï¼Œå³è¿›ç¨‹ä¸ä¼šå› æ„å¤–æˆ–æ¶æ„ç›®çš„ç ´åå…¶ä»–è¿›ç¨‹çš„æ‰§è¡Œï¼Œä»¥åŠä¸ä¼šè¢«å…¶ä»–è¿›ç¨‹ç ´åã€‚ ä¿è¯ç‹¬ç«‹æ€§çš„å‰æä¸‹ï¼Œè¿›ç¨‹ä¹‹é—´åˆç†çš„äº¤äº’å’Œé€šä¿¡ä¹Ÿåº”è¯¥è¢«æ”¯æŒï¼Œå› æ­¤æ“ä½œç³»ç»Ÿåº”è¯¥æä¾› è¿›ç¨‹é—´é€šä¿¡ çš„æ–¹å¼ï¼Œä¾‹å¦‚ pipe æ€»çš„æ¥è¯´ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»ä¸ºè¿›ç¨‹æä¾›ä»¥ä¸‹æœåŠ¡ï¼š æ—¶åˆ†å¤ç”¨ åº•å±‚ç¡¬ä»¶ ç‹¬ç«‹ çš„æ‰§è¡Œç¯å¢ƒ(å†…å­˜ï¼Œå†…æ ¸çŠ¶æ€ç­‰) è¿›ç¨‹ä¹‹é—´çš„åˆæ³• äº¤äº’","text":"The core functionality of an OS æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒä»»åŠ¡åœ¨äºåŒæ—¶æ”¯æŒå¤šä¸ªæ´»åŠ¨ï¼Œå³ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»å°†ç¡¬ä»¶èµ„æºåˆ†æ—¶å…±äº«ç»™æ‰€æœ‰çš„è¿›ç¨‹ä½¿ç”¨ã€‚ ä¸ºäº†ä¿è¯è¿›ç¨‹çš„æ´»åŠ¨è´¨é‡ï¼Œæ“ä½œç³»ç»Ÿè¿˜å¿…é¡»ä¿è¯è¿›ç¨‹çš„æ‰§è¡Œæ˜¯ ç‹¬ç«‹/å­¤ç«‹(isolation) çš„ï¼Œå³è¿›ç¨‹ä¸ä¼šå› æ„å¤–æˆ–æ¶æ„ç›®çš„ç ´åå…¶ä»–è¿›ç¨‹çš„æ‰§è¡Œï¼Œä»¥åŠä¸ä¼šè¢«å…¶ä»–è¿›ç¨‹ç ´åã€‚ ä¿è¯ç‹¬ç«‹æ€§çš„å‰æä¸‹ï¼Œè¿›ç¨‹ä¹‹é—´åˆç†çš„äº¤äº’å’Œé€šä¿¡ä¹Ÿåº”è¯¥è¢«æ”¯æŒï¼Œå› æ­¤æ“ä½œç³»ç»Ÿåº”è¯¥æä¾› è¿›ç¨‹é—´é€šä¿¡ çš„æ–¹å¼ï¼Œä¾‹å¦‚ pipe æ€»çš„æ¥è¯´ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»ä¸ºè¿›ç¨‹æä¾›ä»¥ä¸‹æœåŠ¡ï¼š æ—¶åˆ†å¤ç”¨ åº•å±‚ç¡¬ä»¶ ç‹¬ç«‹ çš„æ‰§è¡Œç¯å¢ƒ(å†…å­˜ï¼Œå†…æ ¸çŠ¶æ€ç­‰) è¿›ç¨‹ä¹‹é—´çš„åˆæ³• äº¤äº’ Abstracting physical resources ä¸ºå®ç°è¿›ç¨‹ä¹‹é—´çš„ç‹¬ç«‹æ€§, æ“ä½œç³»ç»Ÿéœ€è¦å®Œå…¨æ¥ç®¡å¯¹ç³»ç»Ÿç¡¬ä»¶çš„ç®¡ç†ï¼Œåœ¨è¿›ç¨‹å’Œç¡¬ä»¶ä¹‹é—´æä¾›ä¸€å±‚æŠ½è±¡ä¸­é—´å±‚ï¼Œå³å°†ç¡¬ä»¶æŠ½è±¡æˆæœåŠ¡ã€‚åŒæ—¶é˜²æ­¢è¿›ç¨‹ç›´æ¥æ“ä½œç³»ç»Ÿç¡¬ä»¶ã€‚ è¿™æ˜¯å› ä¸ºå¦‚æœè¿›ç¨‹å¯ä»¥ç›´æ¥æ“ä½œç¡¬ä»¶ï¼Œé‚£ä¹ˆåˆ™éœ€è¦è¿›ç¨‹ä¹‹é—´å®ç°å¾ˆå¼ºçš„åè°ƒæˆ–åŒæ­¥æœºåˆ¶æ‰èƒ½å®ç°ç¡¬ä»¶åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´çš„å…±äº«ã€‚ æ¶æ„è¿›ç¨‹é•¿æ—¶é—´å ç”¨ç¡¬ä»¶æˆ–ç ´åç¡¬ä»¶ä¼šç ´åå…¶ä»–è¿›ç¨‹çš„è¿è¡Œ éæ¶æ„è¿›ç¨‹ä¸åè°ƒçš„ç¡¬ä»¶æ“ä½œ (ä¾‹å¦‚æ‰€æœ‰è¿›ç¨‹éƒ½åœ¨ä¸»åŠ¨è®©å‡ºç¡¬ä»¶) ä¹Ÿä¼šå¯¼è‡´è¿›ç¨‹æ— æ³•æ­£å¸¸è¿è¡Œ Storage è¿›ç¨‹ä¸å­˜å‚¨ç¡¬ä»¶çš„äº¤äº’åªèƒ½é€šè¿‡æ“ä½œç³»ç»Ÿæä¾›çš„ open, read, write å’Œ close ç­‰ç³»ç»Ÿè°ƒç”¨è¿›è¡Œï¼Œç”±æ“ä½œç³»ç»Ÿè¿›è¡Œå­˜å‚¨ç¡¬ä»¶(ç£ç›˜ï¼Œå…‰ç›˜ï¼Œç£å¸¦ï¼Œè¿œç¨‹å­˜å‚¨æœåŠ¡)çš„ç®¡ç†å’Œå®é™…çš„ç¡¬ä»¶æ“ä½œã€‚ CPU æ“ä½œç³»ç»Ÿä¼šé€æ˜åœ°åœ¨è¿›ç¨‹ä¹‹é—´åˆ‡æ¢ CPUã€‚å³ï¼Œå°†è¿›ç¨‹åˆ‡å‡º CPU æ˜¯ä¿å­˜å¯„å­˜å™¨ç­‰è¿›ç¨‹ä¸Šä¸‹æ–‡ï¼Œå¹¶åœ¨åˆ‡å›æ—¶é‡æ–°è½½å…¥ä¸Šä¸‹æ–‡ï¼Œå¦‚æ­¤ ä¸Šä¸‹æ–‡åˆ‡æ¢ ä½¿å¾—è¿›ç¨‹å¯¹äº CPU æ—¶åˆ†å¤ç”¨æ²¡æœ‰æ„ŸçŸ¥ï¼Œä¸ä¼šå¹²æ‰°è¿›ç¨‹çš„æ‰§è¡ŒçŠ¶æ€ã€‚ Memory è¿›ç¨‹çš„å†…å­˜ç”± exec ç³»ç»Ÿè°ƒç”¨äº¤ç”±æ“ä½œç³»ç»Ÿå†…æ ¸åˆ†é…ï¼Œè¿›ç¨‹çš„åˆ›å»ºè€…ä¸éœ€è¦å…³å¿ƒè¿›ç¨‹åœ¨ç‰©ç†å†…å­˜ä¸­çš„ä½ç½®ã€‚ User mode, supervisor mode, and system calls ä¸ºå®ç°è¿›ç¨‹çš„å­¤ç«‹æ€§ï¼Œå³ä¿è¯è¿›ç¨‹æ— æ³•æ“ä½œå…¶ä»–è¿›ç¨‹çš„å†…å­˜ï¼Œä»¥åŠä¿è¯è¿›ç¨‹æ— æ³•æ“ä½œç³»ç»Ÿå†…æ ¸çš„å†…å­˜ï¼Œå¿…é¡»åœ¨è¿›ç¨‹ä¹‹é—´è®¾ç½®ç¡¬ä»¶éš”ç¦»ã€‚ ç±»ä¼¼ç›®çš„çš„ç¡¬ä»¶éš”ç¦»å¯ä»¥ç”± CPU æä¾›ï¼Œä»¥ RISC-V ä¸ºä¾‹ï¼ŒCPU æä¾›ä¸‰ç§æŒ‡ä»¤æ‰§è¡Œæ¨¡å¼ï¼šmachine mode, supervisor mode, user mode. machine mode åœ¨ machine mode ä¸‹æ‰§è¡Œçš„æŒ‡ä»¤å…·å¤‡å…¨éƒ¨çš„ç‰¹æƒï¼Œå³å¯ä»¥æ“ä½œä»»æ„è®¾å¤‡ã€‚CPU å¯åŠ¨æ—¶é»˜è®¤å¤„åœ¨ machine mode, åœ¨æ“ä½œç³»ç»Ÿçš„å£°æ˜å‘¨æœŸä¸­ï¼Œmachine mode ä¸€èˆ¬ç”¨æ¥è¿›è¡Œç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹çš„é…ç½®ï¼Œä¹‹åæ“ä½œç³»ç»Ÿå°†åˆ‡æ¢åˆ° supervisor mode supervisor mode åœ¨ supervisor mode ä¸‹ï¼ŒCPU å¯ä»¥æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼šä½¿èƒ½/å¤±èƒ½ä¸­æ–­ï¼Œè¯»å–/å†™å…¥æŒæœ‰é¡µè¡¨åœ°å€çš„å¯„å­˜å™¨ç­‰ã€‚ åœ¨ supervisor mode ä¸‹è¿è¡Œçš„ç¨‹åºä¹Ÿå¯ä»¥ç§°ä¸ºæ˜¯åœ¨ kernel space ä¸­è¿è¡Œ è¿è¡Œåœ¨ kernel space ä¸­çš„ç¨‹åºè¢«ç§°ä¸º kernel kernel is running in kernel space, and there is nothing but the kernel in kernel space. user mode user mode ä¸‹ CPU åªèƒ½æ‰§è¡Œå¦‚ç®—æ•°è¿ç®—ç­‰ç”¨æˆ·æ€æŒ‡ä»¤ã€‚ å¦‚æœ user mode ä¸‹çš„ç¨‹åºè¯•å›¾æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼Œé‚£ä¹ˆ CPU ä¼šåˆ‡æ¢åˆ° supervisor mode å¹¶ç»ˆæ­¢è¯¥ç¨‹åºã€‚ åœ¨ user mode ä¸‹æ‰§è¡Œçš„ç¨‹åºä¹Ÿè¢«ç§°ä¸ºåœ¨ user space ä¸­æ‰§è¡Œ Kernel organization æœ‰å¾ˆå¤šç§ç»„ç»‡æ–¹å¼å¯ä»¥å®ç° OS çš„æ ¸å¿ƒè¦æ±‚ï¼Œä¸¤ç§å¤§çš„åˆ†ç±»æ˜¯å®å†…æ ¸(monolithic kernel) å’Œ å¾®å†…æ ¸(micro kernel). å®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºå“ªäº›ç»„ä»¶è¿è¡Œåœ¨ supervisor mode (kernel space) å…¶ä¸­å®å†…æ ¸æ˜¯ç›®å‰å¤§å¤šæ•° Unix æ“ä½œç³»ç»Ÿå†…æ ¸æ‰€é‡‡ç”¨çš„ç»„ç»‡æ–¹å¼ã€‚ Monolithic Kernel å®å†…æ ¸å³æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½è¿è¡Œåœ¨ kernel space, ä¹Ÿå³æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½å±äºå†…æ ¸çš„ä¸€éƒ¨åˆ†ã€‚ è¿™æ ·çš„ç»„ç»‡æ–¹å¼ä¸‹æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿéƒ¨ä»¶éƒ½å…·å¤‡ç¡¬ä»¶ç‰¹æƒï¼Œå…¶å…·å¤‡å¦‚ä¸‹ä¼˜ç¼ºç‚¹: ä¼˜ç‚¹ï¼š è®¾è®¡æ–¹ä¾¿ï¼Œæ“ä½œç³»ç»Ÿè®¾è®¡è€…ä¸éœ€è¦è€ƒè™‘ä¸åŒæ“ä½œç³»ç»Ÿéƒ¨ä»¶å¯¹ç‰¹æƒæŒ‡ä»¤çš„è¦æ±‚ä¸åŒ åˆ©äºæ“ä½œç³»ç»Ÿç»„ä»¶ä¹‹é—´çš„åä½œï¼Œä¾‹å¦‚è™šæ‹Ÿå†…å­˜éƒ¨ä»¶å’Œæ–‡ä»¶ç³»ç»Ÿéƒ¨ä»¶ä¹‹é—´å¯ä»¥å…±äº«ç¼“å­˜ ç¼ºç‚¹ï¼š æ“ä½œç³»ç»Ÿéƒ¨ä»¶ä¹‹é—´çš„æ¥å£è¾ƒå¤æ‚ï¼Œå› æ­¤ç³»ç»Ÿä¸­å­˜åœ¨ bug çš„å¯èƒ½æ€§æ›´é«˜ ä¸€æ—¦æŸä¸ªéƒ¨ä»¶è¿è¡Œé”™è¯¯ï¼Œç”±äºå…¶è¿è¡Œåœ¨ supervisor mode, é”™è¯¯é€šå¸¸ä¼šå¯¼è‡´æ•´ä¸ªå†…æ ¸ fail, è¿›è€Œå¯¼è‡´è®¡ç®—æœºåœæ­¢è¿è¡Œã€‚ Micro Kernel è€ƒè™‘å®å†…æ ¸çš„ç¼ºç‚¹ï¼Œå³å¤æ‚æ€§å¸¦æ¥çš„å·¥ç¨‹é—®é¢˜ï¼ŒOS è®¾è®¡è€…è€ƒè™‘å°†å†…æ ¸æœ€å°åŒ–ï¼Œå³å°†å¤§éƒ¨åˆ†çš„æ“ä½œç³»ç»Ÿç»„ä»¶ç§»åˆ° user space. è¿™ç§å†…æ ¸ç»„ç»‡æ–¹å¼å³ å¾®å†…æ ¸ åœ¨å¾®å†…æ ¸æ“ä½œç³»ç»Ÿä¸­ï¼Œéƒ¨åˆ†æ“ä½œç³»ç»ŸåŠŸèƒ½ä»¥è¿›ç¨‹çš„å½¢å¼è¿è¡Œåœ¨ user mode ä¸‹ï¼Œè¿™ç§è¿›ç¨‹ç§°ä¸ºæœåŠ¡ Process overview è¿›ç¨‹æ˜¯ Unix æä¾›çš„å­¤ç«‹ (isolation) æ‰§è¡Œå•å…ƒï¼Œè¿›ç¨‹å¯¹æ‰§è¡Œç¨‹åºçš„æŠ½è±¡ä¿è¯äº†ç¨‹åºæ— æ³•ç ´åæˆ–ç›‘è§†å…¶ä»–ç¨‹åºçš„å†…å­˜ï¼ŒCPUï¼Œæ–‡ä»¶æè¿°ç¬¦ç­‰è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ï¼Œæ— æ³•ç ´ç¯å†…æ ¸çš„è¿è¡ŒçŠ¶æ€ã€‚ æ“ä½œç³»ç»Ÿå†…æ ¸é€šè¿‡è¿›ç¨‹è¿™ä¸€æŠ½è±¡ä¸ºæ‰§è¡Œç¨‹åºæä¾›äº†ä¸€ç§å¹»è§‰ï¼šç¨‹åºä¼šå¹»è§‰è‡ªå·±åœ¨ç‹¬å æœºå™¨ç¡¬ä»¶ å®ç°è¿™ä¸€å¹»è§‰æ‰€ä½¿ç”¨çš„æœºåˆ¶åŒ…æ‹¬ user/supervisor mode flag, address spaces, time-slicing of threads Address space æ“ä½œç³»ç»Ÿé€šè¿‡ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ç‹¬ç«‹çš„åœ°å€ç©ºé—´ä¸ºç¨‹åºæä¾›å…¶åœ¨ç‹¬å å†…å­˜çš„å¹»è§‰ã€‚ å…·ä½“åœ°è¯´ï¼Œæ“ä½œç³»ç»Ÿä½¿ç”¨é¡µè¡¨ (page tables) å°†è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„ è™šæ‹Ÿåœ°å€ (virtual address) æ˜ å°„ä¸ºç¡¬ä»¶ä¸Šçš„ ç‰©ç†åœ°å€(physical address) . å…¶ä¸­è™šæ‹Ÿåœ°å€å³ç¨‹åºæŒ‡ä»¤æ“ä½œçš„åœ°å€ï¼Œç‰©ç†åœ°å€åˆ™æ˜¯ CPU åœ¨è®¿å­˜æ—¶å‘ç»™ä¸»å­˜çš„åœ°å€ã€‚ æ“ä½œç³»ç»Ÿå†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„é¡µè¡¨ï¼Œè¯¥é¡µè¡¨å®šä¹‰äº†è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚åœ°å€ç©ºé—´é€šå¸¸ç»„ç»‡å¦‚ä¸‹(ä¸€ä¸ªå…¸å‹ Linux è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œä¸ xv6 å®ç°çš„åœ°å€ç©ºé—´å­˜åœ¨å·®å¼‚)ï¼š Thread è¿›ç¨‹çš„æŒ‡ä»¤æ˜¯ç”± thread æ‰§è¡Œçš„ï¼Œthread å¯ä»¥è¢«æš‚åœå’Œæ¢å¤ã€‚å½“ CPU åœ¨è¿›ç¨‹é—´åˆ‡æ¢æ—¶ï¼Œå…³äºæŒ‡ä»¤æ‰§è¡Œéƒ¨åˆ†çš„åˆ‡æ¢å·¥ä½œå®é™…ä¸Šæ˜¯æš‚åœä¸Šä¸ªè¿›ç¨‹çš„ thread ç„¶åæ¢å¤ä¸‹ä¸ªè¿›ç¨‹çš„ threadã€‚ thread çš„çŠ¶æ€(local variables, function call return addresses) ä¸»è¦å­˜å‚¨åœ¨ thread çš„ stack ä¸­ã€‚è€Œè¿›ç¨‹ç»´æŠ¤ä¸¤ä¸ª stack: user stack å’Œ kernel stack. å½“ process çš„ thread åœ¨æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ user stack, æ­¤æ—¶ kernel stack æ˜¯ç©ºçš„ã€‚å½“è¿›ç¨‹è¿›å…¥å†…æ ¸æ—¶(é€šè¿‡ç³»ç»Ÿè°ƒç”¨æˆ–ä¸­æ–­)ï¼Œå†…æ ¸ä¸­çš„ä»£ç ä¼šåœ¨è¿›ç¨‹çš„ kernel stack ä¸­æ‰§è¡Œï¼Œæ­¤æ—¶è¿›ç¨‹çš„ user stack æ²¡æœ‰è¢«å ç”¨ï¼Œä½†å…¶ä¸­ä»å‚¨å­˜ç€æ•°æ®ã€‚ è¿›ç¨‹çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œuser stack å’Œ kernel stack ä¸€ç›´åœ¨äº¤æ›¿è¢«å ç”¨ã€‚åŒæ—¶ kernel stack ä¸èƒ½ç”±ç”¨æˆ·ä»£ç æ“ä½œï¼Œä»¥é˜²ç”¨æˆ·ä»£ç ç ´åå†…æ ¸ä»£ç çš„æ‰§è¡Œã€‚","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"Operating System","slug":"Operating-System","permalink":"https://blog.zhuwenq.cc/tags/Operating-System/"},{"name":"xv6","slug":"xv6","permalink":"https://blog.zhuwenq.cc/tags/xv6/"}]},{"title":"Xv6 Operating system 01-interface","slug":"xv6-Operating-system-01-interface","date":"2023-03-02T14:36:49.000Z","updated":"2023-06-21T06:51:28.936Z","comments":true,"path":"xv6-Operating-system-01-interface/","link":"","permalink":"https://blog.zhuwenq.cc/xv6-Operating-system-01-interface/","excerpt":"æ“ä½œç³»ç»Ÿçš„èŒè´£æ˜¯åœ¨å¤šä¸ªç¨‹åº(è¿›ç¨‹)ä¹‹é—´å…±äº«è®¡ç®—æœºæä¾›çš„ç‰©ç†èµ„æºï¼Œå¹¶æä¾›ä¸€ç³»åˆ—æ¯”ç›´æ¥æ“ä½œç¡¬ä»¶æ›´æœ‰ç”¨çš„æœåŠ¡ã€‚å…·ä½“åœ°è¯´ï¼Œæ“ä½œç³»ç»Ÿä¸ºè®¡ç®—æœºç¡¬ä»¶æä¾›ä¸€å±‚æŠ½è±¡ï¼Œä½¿è½¯ä»¶ç¨‹åºä¸éœ€è¦å…³å¿ƒç¡¬ä»¶çš„å…·ä½“å®ç°ã€‚æ“ä½œç³»ç»Ÿè¿˜å¿…é¡»é€šè¿‡æŸç§æ—¶åˆ†å¤ç”¨çš„æœºåˆ¶ä½¿å¾—å¤šä¸ªç¨‹åºå¯ä»¥å…±äº«åº•å±‚ç¡¬ä»¶ã€‚æœ€åï¼Œæ“ä½œç³»ç»Ÿä¹Ÿå¿…é¡»ä¸ºä¸åŒç¨‹åºè¿›ç¨‹æä¾›æŸç§é€šä¿¡æœºåˆ¶ã€‚ æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿è¡Œçš„ç¨‹åºè¢«æŠ½è±¡æˆè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹çš„å†…å®¹å³å®ƒæ‰€å ç”¨çš„å†…å­˜åŠå…¶ä»–èµ„æºã€‚å…¶ä¸­ï¼Œåœ¨å†…å­˜ä¸­å­˜æœ‰è¿›ç¨‹çš„æŒ‡ä»¤ï¼Œæ•°æ®ï¼Œå †æ ˆç­‰è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ã€‚æ“ä½œç³»ç»Ÿæ¥å£å³æ“ä½œç³»ç»Ÿå†…æ ¸ä¸ºå…¶ä»–è¿›ç¨‹æä¾›çš„ä¸€ç³»åˆ—æœåŠ¡çš„æ¥å£ï¼Œç§°ä¸ºç³»ç»Ÿè°ƒç”¨ (system call) ã€‚å½“è¿›ç¨‹éœ€è¦è°ƒç”¨ç³»ç»ŸæœåŠ¡æ—¶ï¼Œå…¶åªèƒ½é€šè¿‡è°ƒç”¨æ“ä½œç³»ç»Ÿæ¥å£å®ç°.","text":"æ“ä½œç³»ç»Ÿçš„èŒè´£æ˜¯åœ¨å¤šä¸ªç¨‹åº(è¿›ç¨‹)ä¹‹é—´å…±äº«è®¡ç®—æœºæä¾›çš„ç‰©ç†èµ„æºï¼Œå¹¶æä¾›ä¸€ç³»åˆ—æ¯”ç›´æ¥æ“ä½œç¡¬ä»¶æ›´æœ‰ç”¨çš„æœåŠ¡ã€‚å…·ä½“åœ°è¯´ï¼Œæ“ä½œç³»ç»Ÿä¸ºè®¡ç®—æœºç¡¬ä»¶æä¾›ä¸€å±‚æŠ½è±¡ï¼Œä½¿è½¯ä»¶ç¨‹åºä¸éœ€è¦å…³å¿ƒç¡¬ä»¶çš„å…·ä½“å®ç°ã€‚æ“ä½œç³»ç»Ÿè¿˜å¿…é¡»é€šè¿‡æŸç§æ—¶åˆ†å¤ç”¨çš„æœºåˆ¶ä½¿å¾—å¤šä¸ªç¨‹åºå¯ä»¥å…±äº«åº•å±‚ç¡¬ä»¶ã€‚æœ€åï¼Œæ“ä½œç³»ç»Ÿä¹Ÿå¿…é¡»ä¸ºä¸åŒç¨‹åºè¿›ç¨‹æä¾›æŸç§é€šä¿¡æœºåˆ¶ã€‚ æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿è¡Œçš„ç¨‹åºè¢«æŠ½è±¡æˆè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹çš„å†…å®¹å³å®ƒæ‰€å ç”¨çš„å†…å­˜åŠå…¶ä»–èµ„æºã€‚å…¶ä¸­ï¼Œåœ¨å†…å­˜ä¸­å­˜æœ‰è¿›ç¨‹çš„æŒ‡ä»¤ï¼Œæ•°æ®ï¼Œå †æ ˆç­‰è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ã€‚æ“ä½œç³»ç»Ÿæ¥å£å³æ“ä½œç³»ç»Ÿå†…æ ¸ä¸ºå…¶ä»–è¿›ç¨‹æä¾›çš„ä¸€ç³»åˆ—æœåŠ¡çš„æ¥å£ï¼Œç§°ä¸ºç³»ç»Ÿè°ƒç”¨ (system call) ã€‚å½“è¿›ç¨‹éœ€è¦è°ƒç”¨ç³»ç»ŸæœåŠ¡æ—¶ï¼Œå…¶åªèƒ½é€šè¿‡è°ƒç”¨æ“ä½œç³»ç»Ÿæ¥å£å®ç°. xv6 æä¾›çš„ç³»ç»Ÿè°ƒç”¨æœ‰: ç³»ç»Ÿè°ƒç”¨ æè¿° int fork() åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œè¿”å›å­è¿›ç¨‹çš„PID int exit(int status) ç»ˆæ­¢å½“å‰è¿›ç¨‹ï¼Œå¹¶å°†çŠ¶æ€æŠ¥å‘Šç»™wait()å‡½æ•°ã€‚æ— è¿”å› int wait(int *status) ç­‰å¾…ä¸€ä¸ªå­è¿›ç¨‹é€€å‡º; å°†é€€å‡ºçŠ¶æ€å­˜å…¥*status; è¿”å›å­è¿›ç¨‹PIDã€‚ int kill(int pid) ç»ˆæ­¢å¯¹åº”PIDçš„è¿›ç¨‹ï¼Œè¿”å›0ï¼Œæˆ–è¿”å›-1è¡¨ç¤ºé”™è¯¯ int getpid() è¿”å›å½“å‰è¿›ç¨‹çš„PID int sleep(int n) æš‚åœnä¸ªæ—¶é’ŸèŠ‚æ‹ int exec(char *file, char *argv[]) åŠ è½½ä¸€ä¸ªæ–‡ä»¶å¹¶ä½¿ç”¨å‚æ•°æ‰§è¡Œå®ƒ; åªæœ‰åœ¨å‡ºé”™æ—¶æ‰è¿”å› char *sbrk(int n) æŒ‰n å­—èŠ‚å¢é•¿è¿›ç¨‹çš„å†…å­˜ã€‚è¿”å›æ–°å†…å­˜çš„å¼€å§‹ int open(char *file, int flags) æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼›flagsè¡¨ç¤ºread/writeï¼›è¿”å›ä¸€ä¸ªfdï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰ int write(int fd, char *buf, int n) ä»buf å†™n ä¸ªå­—èŠ‚åˆ°æ–‡ä»¶æè¿°ç¬¦fd; è¿”å›n int read(int fd, char *buf, int n) å°†n ä¸ªå­—èŠ‚è¯»å…¥bufï¼›è¿”å›è¯»å–çš„å­—èŠ‚æ•°ï¼›å¦‚æœæ–‡ä»¶ç»“æŸï¼Œè¿”å›0 int close(int fd) é‡Šæ”¾æ‰“å¼€çš„æ–‡ä»¶fd int dup(int fd) è¿”å›ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼ŒæŒ‡å‘ä¸fd ç›¸åŒçš„æ–‡ä»¶ int pipe(int p[]) åˆ›å»ºä¸€ä¸ªç®¡é“ï¼ŒæŠŠread/writeæ–‡ä»¶æè¿°ç¬¦æ”¾åœ¨p[0]å’Œp[1]ä¸­ int chdir(char *dir) æ”¹å˜å½“å‰çš„å·¥ä½œç›®å½• int mkdir(char *dir) åˆ›å»ºä¸€ä¸ªæ–°ç›®å½• int mknod(char *file, int, int) åˆ›å»ºä¸€ä¸ªè®¾å¤‡æ–‡ä»¶ int fstat(int fd, struct stat *st) å°†æ‰“å¼€æ–‡ä»¶fdçš„ä¿¡æ¯æ”¾å…¥*st int stat(char *file, struct stat *st) å°†æŒ‡å®šåç§°çš„æ–‡ä»¶ä¿¡æ¯æ”¾å…¥*st int link(char *file1, char *file2) ä¸ºæ–‡ä»¶file1åˆ›å»ºå¦ä¸€ä¸ªåç§°(file2) int unlink(char *file) åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ è¿›ç¨‹å’Œå†…å­˜ xv6 çš„è¿›ç¨‹æ‹¥æœ‰ç”¨æˆ·æ€å†…å­˜(æŒ‡ä»¤ï¼Œæ•°æ®ï¼Œå †æ ˆ)å’Œç”±å†…æ ¸ç®¡ç†çš„è¿›ç¨‹çŠ¶æ€ã€‚xv6 åœ¨è¿›ç¨‹ä¹‹é—´æ—¶åˆ†å¤ç”¨å¤„ç†å™¨ï¼Œå³å®ƒé€æ˜åœ°åˆ‡æ¢å¾…æ‰§è¡Œçš„è¿›ç¨‹è¿›å…¥å¤„ç†å™¨æ‰§è¡Œã€‚å½“è¿›ç¨‹è¢«åˆ‡æ¢å‡ºå¤„ç†å™¨ä¸å†æ‰§è¡Œæ—¶ï¼Œxv6 ä¼šä¸ºå…¶ä¿å­˜ CPU å¯„å­˜å™¨(ä¿å­˜ä¸Šä¸‹æ–‡)ï¼Œå¹¶åœ¨è¯¥è¿›ç¨‹ä¸‹æ¬¡æ‰§è¡Œæ—¶å°†ä¿å­˜çš„ CPU å¯„å­˜å™¨é‡æ–°åŠ è½½ (æ¢å¤ä¸Šä¸‹æ–‡)ã€‚æ“ä½œç³»ç»Ÿå†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå³ PID, ä½œä¸ºè¯¥è¿›ç¨‹çš„ç´¢å¼•ã€‚ fork ç³»ç»Ÿè°ƒç”¨ ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ä½¿ç”¨ fork ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ æ–°åˆ›å»ºçš„è¿›ç¨‹å…·æœ‰å’Œ caller process ç›¸åŒçš„å†…å­˜å†…å®¹ï¼Œç§°ä¸ºå­è¿›ç¨‹ fork å‡½æ•°åˆ›å»ºå­è¿›ç¨‹æˆåŠŸåç«‹åˆ»è¿”å›åˆ° caller process ï¼Œè¿”å›å€¼æ˜¯å­è¿›ç¨‹çš„ PIDã€‚åœ¨å­è¿›ç¨‹ä¸­ï¼Œfork è¿”å›å€¼æ˜¯ 0ï¼Œ å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ä¸ºçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹è®¾è®¡ä¸åŒçš„æ‰§è¡Œåˆ†æ”¯ exit ç³»ç»Ÿè°ƒç”¨ ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ä½¿ç”¨ exit ç³»ç»Ÿè°ƒç”¨ç»ˆæ­¢è‡ªå·±çš„æ‰§è¡Œï¼Œå¹¶é‡Šæ”¾è‡ªå·±å ç”¨çš„æ‰€æœ‰èµ„æº exit æ¥å—ä¸€ä¸ªå‚æ•°ç”¨äºæŒ‡ç¤º caller process çš„é€€å‡ºçŠ¶æ€ï¼ŒæŒ‰ç…§æƒ¯ä¾‹ï¼ŒçŠ¶æ€ 0 è¡¨ç¤ºæ­£å¸¸é€€å‡ºï¼ŒçŠ¶æ€ 1 è¡¨ç¤ºè¿›ç¨‹å› é”™è¯¯é€€å‡ºã€‚ wait ç³»ç»Ÿè°ƒç”¨ ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ä½¿ç”¨ wait ç³»ç»Ÿè°ƒç”¨ç­‰å¾…å…¶å­è¿›ç¨‹æ‰§è¡Œå®Œæˆï¼ŒåŒæ—¶é˜»å¡è‡ªå·±çš„æ‰§è¡Œ å¦‚æœ caller process çš„å­è¿›ç¨‹ä¹‹ä¸€é€€å‡ºï¼Œwait è¿”å›é€€å‡ºå­è¿›ç¨‹çš„ PIDï¼Œå¦‚æœ caller process æ²¡æœ‰å­è¿›ç¨‹ï¼Œ wait ç«‹å³è¿”å› -1 wait æ¥å—ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œå­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€å°†è¢«æ‹·è´åˆ°è¯¥æŒ‡é’ˆä½ç½®. å¦‚æœ caller process ä¸å…³å¿ƒå­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼Œå¯ä»¥ä¼ é€’ç©ºæŒ‡é’ˆ (0) exec ç³»ç»Ÿè°ƒç”¨ ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ä½¿ç”¨ exec ç³»ç»Ÿè°ƒç”¨å°†è‡ªå·±çš„è¿›ç¨‹å†…å­˜æ›¿æ¢ä¸ºä»æ–‡ä»¶ç³»ç»Ÿä¸­æ–°åŠ è½½çš„å†…å­˜é•œåƒï¼Œå¹¶ä¿ç•™åŸè¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ã€‚ exec å‡½æ•°æ‰§è¡ŒæˆåŠŸåå¹¶ä¸è¿”å› caller process ï¼Œå®ƒä¼šç›´æ¥æ‰§è¡Œå…¶å†…å­˜ä¸­çš„æŒ‡ä»¤(å³ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½çš„æŒ‡ä»¤). exec åªæœ‰åœ¨é”™è¯¯æ—¶ (åŠ è½½æ–‡ä»¶æˆ–æ›¿æ¢è¿›ç¨‹å†…å­˜æ—¶çš„é”™è¯¯ï¼Œè€Œéæ–°çš„ç¨‹åºæ‰§è¡Œæ—¶çš„é”™è¯¯) æ‰è¿”å›, å› æ­¤ caller process ä¸­ exec å‡½æ•°ä¹‹åçš„ç¨‹åºåº”è¯¥åªæœ‰é”™è¯¯å¤„ç†è¿‡ç¨‹ã€‚ IO å’Œæ–‡ä»¶æè¿°ç¬¦(file descriptors) æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªæ•´æ•°å€¼ï¼Œå…¶ä»£è¡¨ä¸€ä¸ªæŒ‡å‘å†…æ ¸ç®¡ç†çš„å¯¹è±¡çš„æŒ‡é’ˆã€‚è¿›ç¨‹å¯ä»¥é€šè¿‡ open æ–‡ä»¶ã€æ–‡ä»¶å¤¹ã€æˆ–è®¾å¤‡ï¼Œåˆ›å»º pipe, æˆ– dup ä¸€ä¸ªå·²æœ‰çš„æ–‡ä»¶æè¿°ç¬¦æ¥è·å–æ–‡ä»¶æè¿°ç¬¦ã€‚ æ–‡ä»¶æè¿°ç¬¦æ—¨åœ¨æä¾›ä¸€ç§æŠ½è±¡çš„æ¥å£ï¼Œå®ƒä½¿å¾—æ“ä½œç³»ç»Ÿç®¡ç†çš„ IO è®¾å¤‡åœ¨æ¥å£ä¸Šæ²¡æœ‰å·®å¼‚ï¼Œéƒ½æ˜¯å­—èŠ‚æµçš„å½¢å¼ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯æ–‡ä»¶æè¿°ç¬¦çš„ç®¡ç†æ˜¯é€ process çš„ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºæ¯ä¸ª process ç»´æŠ¤ä¸€å¼ æ–‡ä»¶æè¿°ç¬¦è¡¨ã€‚å…¶ä¸­ä¸‰ä¸ªç‰¹æ®Šçš„æ–‡ä»¶æè¿°ç¬¦æ˜¯: 0 ä»£è¡¨æ ‡å‡†è¾“å…¥ (standard input) 1 ä»£è¡¨æ ‡å‡†è¾“å‡º (standard output) 2 ä»£è¡¨æ ‡å‡†é”™è¯¯ (standard error) æ–‡ä»¶æè¿°ç¬¦çš„æ•°å€¼ä¼šé€’å¢åœ°åˆ†é…ï¼Œå³: æ–°è·å–çš„æ–‡ä»¶æè¿°ç¬¦å°†æ€»æ˜¯æ‰€æœ‰æœªå ç”¨æ–‡ä»¶æè¿°ç¬¦ä¸­æ•°å€¼æœ€å°çš„ã€‚ read å’Œ write ç³»ç»Ÿè°ƒç”¨ read å’Œ write ä»æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘çš„å·²æ‰“å¼€çš„æ–‡ä»¶ä¸­è¯»å–æˆ–å‘å…¶å†™å…¥å­—èŠ‚ã€‚ å¯¹äºæŒ‡å‘æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå…¶æ€»æ˜¯å…·å¤‡ä¸€ä¸ªåç§»é‡ offsetï¼Œè¯¥ offset æŒ‡ç¤ºè¯¥ä»è¯¥æ–‡ä»¶è¯»å–æˆ–å‘è¯¥æ–‡ä»¶å†™å…¥çš„å­—èŠ‚èµ·ç‚¹ã€‚ å¯¹äº readï¼Œ read(fd, buf, n) è¡¨ç¤ºä»æ–‡ä»¶æè¿°ç¬¦ fd æŒ‡å‘çš„æ–‡ä»¶ä¸­è¯»å–æœ€å¤š n ä¸ªå­—èŠ‚ï¼Œå¹¶å°†è¯»å–çš„æ•°æ®å¤åˆ¶åˆ°æŒ‡é’ˆ buf æ‰€æŒ‡å‘çš„å†…å­˜ä¸­ï¼ŒåŒæ—¶è¿”å›æœ¬æ¬¡è¯»å–åˆ°çš„å­—èŠ‚é•¿åº¦ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ read ä¼šä»æ–‡ä»¶æè¿°ç¬¦ fd æ‰€å…·å¤‡çš„ offset ä½ç½®å¼€å§‹è¯»å–ï¼Œå¹¶åœ¨è¯»å–åå°† offset çš„å€¼é€’å¢åˆ°æœ¬æ¬¡è¯»å–çš„ç»ˆç‚¹ï¼Œå³ï¼šä¸‹æ¬¡å¯¹ fd çš„è¯»å–å°†ä»æœ¬æ¬¡è¯»å–çš„ç»ˆç‚¹ä¹‹åå¼€å§‹ã€‚å½“ offset åˆ°è¾¾æ–‡ä»¶çš„ç»ˆç‚¹æ—¶ï¼Œæ–°çš„ read è°ƒç”¨å°†è¿”å› 0ï¼Œ ä»£è¡¨æ–‡ä»¶å·²è¯»å–å®Œæ¯•ã€‚ å¯¹äº write, write(fd, buf, n) è¡¨ç¤ºå‘æ–‡ä»¶æè¿°ç¬¦ fd æŒ‡å‘çš„æ–‡ä»¶ä¸­å†™å…¥ n ä¸ªæ¥è‡ªæŒ‡é’ˆ buf æŒ‡å‘çš„å†…å­˜ä½ç½®çš„å­—èŠ‚ã€‚åŒæ ·åœ°ï¼Œwrite ä¼šè¿”å›æœ¬æ¬¡å†™å…¥çš„å­—èŠ‚é•¿åº¦ï¼Œå½“è¿”å›å€¼å°äº n æ—¶ï¼Œä»£è¡¨æœ¬æ¬¡å†™å…¥æœ‰é”™è¯¯å‘ç”Ÿã€‚å¯¹äº offset çš„å¤„ç†ä¹Ÿä¸ read ç±»ä¼¼ï¼šå†™å…¥æ€»æ˜¯ä» offset çš„ä½ç½®å¼€å§‹ï¼Œå¹¶åœ¨ç»“æŸåå°† offset é€’å¢åˆ°æœ¬æ¬¡å†™å…¥çš„ç»ˆç‚¹ã€‚ å…³äºæ–‡ä»¶æè¿°ç¬¦çš„ offset: å¦‚æœä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯ä»å¦ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶æè¿°ç¬¦å¾—åˆ°çš„ï¼Œå³é€šè¿‡ fork å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦è¡¨æˆ– dup å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶æè¿°ç¬¦ä¸åŸæ–‡ä»¶æè¿°å…±äº«åŒä¸€ä¸ª offsetã€‚å¦åˆ™ï¼Œæ–°çš„æ–‡ä»¶æè¿°ç¬¦(å¦‚é€šè¿‡ open åŒä¸€ä¸ªæ–‡ä»¶)å³ä½¿æŒ‡å‘ç›¸åŒçš„ IO è®¾å¤‡ï¼Œä¹Ÿä¸ä¼šå…±äº« offset open ç³»ç»Ÿè°ƒç”¨ open ç³»ç»Ÿè°ƒç”¨æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶å¹¶ä¸ºå…¶åˆ†é…æ–‡ä»¶æè¿°ç¬¦ï¼Œopen(filename, flag) è¡¨ç¤ºä»¥ flag æ¨¡å¼æ‰“å¼€æ–‡ä»¶ filename. å¯é€‰çš„ flag æœ‰ï¼š O_RDONLY: åªè¯»æ¨¡å¼ O_WRONLY: åªå†™æ¨¡å¼ O_RDWR: è¯»å†™æ¨¡å¼ O_CREATE: æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»º O_TRUNC: æˆªæ–­æ¨¡å¼ï¼Œæ‰“å¼€æ—¶å°†æ–‡ä»¶å†…å®¹æ¸…ç©º close ç³»ç»Ÿè°ƒç”¨ close ç³»ç»Ÿè°ƒç”¨é‡Šæ”¾ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å…¶åœ¨åç»­çš„åˆ†é…ä¸­å¯ç”¨ã€‚ æ“ä½œç³»ç»Ÿä¼šä¿è¯æ–°åˆ†é…çš„æ–‡ä»¶æè¿°ç¬¦æ€»æ˜¯æ‰€æœ‰å¯ç”¨æ–‡ä»¶æè¿°ç¬¦ä¸­æ•°å€¼æœ€å°çš„(å¦åˆ™éšç€ç³»ç»Ÿçš„è¿è¡Œï¼Œæ–‡ä»¶æè¿°ç¬¦çš„æ•°å€¼ç»ˆå°†å¯¼è‡´æº¢å‡º) dup ç³»ç»Ÿè°ƒç”¨ dup ç³»ç»Ÿè°ƒç”¨å¤åˆ¶ä¸€ä¸ªå·²æœ‰çš„æ–‡ä»¶æè¿°ç¬¦å¹¶è¿”å›ï¼Œä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦å°†æŒ‡å‘åŒä¸€ä¸ª IO è®¾å¤‡ï¼Œå¹¶å…±äº«ä¸€ä¸ª offset ç®¡é“ (pipe) pipe æ˜¯ä¸€ä¸ªå°å‹å†…æ ¸ç¼“å†²åŒºï¼Œå…¶ä»¥ä¸€å¯¹æ–‡ä»¶æè¿°ç¬¦çš„å½¢å¼æš´éœ²ç»™ç”¨æˆ·è¿›ç¨‹ï¼šä¸€ä¸ªç”¨äºè¯»å–ï¼Œå¦ä¸€ä¸ªç”¨äºå†™å…¥ã€‚è¯»å–ç«¯æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»å–å‘å†™å…¥ç«¯æ–‡ä»¶æè¿°ç¬¦å†™å…¥çš„æ•°æ®ï¼Œå†…æ ¸ä»¥è¿™ç§å½¢å¼å‘ç”¨æˆ·æ€æä¾›äº†ä¸€ç§è·¨è¿›ç¨‹é€šä¿¡çš„æ–¹å¼ã€‚ pipe ä»¥å¦‚ä¸‹æ–¹å¼è°ƒç”¨: 1234int pipefds[2];pipe(pipefds);// pipefds[0] is for reading// pipefds[1] is for writing å€¼å¾—æ³¨æ„çš„æ˜¯ pipe ä»¥é˜»å¡å¼è¯­ä¹‰è¿›è¡Œè¯»å†™ï¼Œå³: å¯¹è¯»å–ç«¯æ–‡ä»¶æè¿°ç¬¦çš„è¯»å–æ“ä½œ (read) ä¼šç­‰å¾…å†™å…¥ç«¯çš„å†™å…¥ã€‚ è¿™ä¸€ç‰¹æ€§è¿˜å¯ä»¥é‡è¿°ä¸ºï¼šå¯¹è¯»å–ç«¯æ–‡ä»¶æ“ä½œç¬¦çš„è¯»å–ä¼šä¸€ç›´é˜»å¡åˆ°å†™å…¥ç«¯æ–‡ä»¶æè¿°ç¬¦æœ‰æ•°æ®å†™å…¥ã€‚å¦ä¸€ç§ç»“æŸè¯»å–ç«¯é˜»å¡çš„æƒ…å†µæ˜¯: æ‰€æœ‰æŒ‡å‘ pipe å†™å…¥ç«¯çš„æ–‡ä»¶æè¿°ç¬¦éƒ½è¢«å…³é—­ï¼Œæ­¤æ—¶å¯¹ pipe è¯»å–ç«¯çš„ read æ“ä½œä¼šè¿”å› 0ï¼Œä¸å¯¹é pipe IO è®¾å¤‡ read æ—¶é‡åˆ° EOF ç›¸ä¼¼ã€‚ è·¨è¿›ç¨‹é€šä¿¡ä¹Ÿå¯ä»¥é€šè¿‡å‘ä¸´æ—¶æ–‡ä»¶è¯»å†™æ•°æ®å®ç°ï¼Œä½† pipe ç›¸æ¯”è¿™ç§æ–¹å¼è‡³å°‘æœ‰ä»¥ä¸‹å››ç‚¹ä¼˜åŠ¿: pipe ä¼šè‡ªåŠ¨æ¸…ç†å…¶ç¼“å†²åŒºï¼Œä¸´æ—¶æ–‡ä»¶åˆ™éœ€è¦åœ¨é€šä¿¡ç»“æŸåæ‰‹åŠ¨å¤„ç† pipe å¯ä»¥ä¼ é€’ä»»æ„é•¿åº¦çš„æ•°æ®ï¼Œä¸´æ—¶æ–‡ä»¶åˆ™å—åˆ°æ–‡ä»¶ç³»ç»Ÿçš„é™åˆ¶ pipe å…è®¸è¯»å†™é˜¶æ®µçš„å¹¶è¡Œæ‰§è¡Œï¼Œä¸´æ—¶æ–‡ä»¶æ–¹æ¡ˆåˆ™éœ€è¦ä¸¤ä¸ªé˜¶æ®µé€ä¸ªæ‰§è¡Œ å½“ä½¿ç”¨ pipe å®ç°è¿›ç¨‹é—´é€šä¿¡æ—¶ï¼Œå…¶é˜»å¡å¼è¯»å†™è¯­ä¹‰å°†æ¯”æ–‡ä»¶çš„éé˜»å¡å¼è¯­ä¹‰æ›´é«˜æ•ˆ å¯¹äº 3, 4ï¼Œä¸€ä¸ªç†è§£æ˜¯: pipe çš„é˜»å¡å¼è¯»å†™ä½¿å¾—è¯»å–ç«¯å¯¹å†™å…¥ç«¯æœ‰æ„ŸçŸ¥ï¼Œå› æ­¤å¯ä»¥åœ¨å†™å…¥ç«¯å†™å…¥ä¸€æ®µæ•°æ®åç«‹åˆ»è¯»å–ï¼Œè€Œä¸ç”¨ç­‰å¾…å…¶å…¨éƒ¨å†™å…¥åå†è¯»å–ï¼Œå› æ­¤æ˜¯å¹¶è¡Œçš„ã€‚è€Œæ–‡ä»¶æ–¹æ¡ˆçš„è¯»å–ç«¯å¯¹æ–‡ä»¶çš„å†™å…¥æ²¡æœ‰æ„ŸçŸ¥ï¼Œå› æ­¤å¿…é¡»ç­‰å¾…å†™å…¥ç«¯å†™å®Œæ•°æ®å¹¶æ˜¾å¼é€šçŸ¥è¯»å–ç«¯æ‰å¯ä»¥è¯»å–ï¼Œå¦åˆ™å¾ˆå¯èƒ½è¯»åˆ°ç¼ºå°‘çš„æˆ–é‡å¤çš„æ•°æ®ã€‚ è¿˜æ˜¯å› ä¸º pipe çš„é˜»å¡è¯»å†™è¯­ä¹‰ï¼Œåœ¨æ„å»ºè·¨è¿›ç¨‹é€šä¿¡ç¨‹åºæ—¶ä¸éœ€è¦åœ¨å¦‚ä½•åŒæ­¥è¯»å†™æ“ä½œä¸ŠèŠ±è´¹åŠŸå¤«ï¼Œå› æ­¤æ›´åŠ é«˜æ•ˆ æ–‡ä»¶ç³»ç»Ÿ(File system) æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶å (file name / file path) åªæ˜¯å¯¹æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶æœ¬ä½“çš„ä¸€ä¸ªå…·åå¼•ç”¨ã€‚æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶æœ¬ä½“å«åš inode. ä¸€ä¸ª inode å¯ä»¥æœ‰å¤šä¸ªæ–‡ä»¶åï¼Œç§°ä¸º links. ä¸€ä¸ª link å³ç›®å½•ä¸­çš„ä¸€ä¸ªæ¡ç›®ï¼ŒåŒ…å«ä¸€ä¸ªæ–‡ä»¶åå’Œä¸€ä¸ªæŒ‡å‘ inode çš„å¼•ç”¨ã€‚ inode æè¿°äº†æ–‡ä»¶çš„å…ƒæ•°æ® metadata, åŒ…æ‹¬æ–‡ä»¶çš„ç±»å‹ (æ–‡ä»¶/ç›®å½•/è®¾å¤‡)ï¼Œé•¿åº¦ï¼Œæ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„åœ°å€ï¼Œè¯¥æ–‡ä»¶çš„ link æ•°ç›®ã€‚ fstat ç³»ç»Ÿè°ƒç”¨ fstat ç³»ç»Ÿè°ƒç”¨é€šè¿‡ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æŸ¥è¯¢è¯¥æ–‡ä»¶æè¿°ç¬¦æ‰€æŒ‡å‘çš„ inode çš„ä¿¡æ¯ï¼Œå…¶ç»“æœä»¥ç»“æ„ä½“ stat çš„å½¢å¼è¿”å›ï¼š 1234567891011#define T_DIR 1#define T_FILE 2#define T_DEVICE 3struct stat &#123; int dev; // disk device of the file system uint ino; // inode number short type; // type of file short nlink; // number of links uint64 size; // size of the file in bytes&#125; chdir, open, mkdir, mknod, link, unlink ç³»ç»Ÿè°ƒç”¨ chdir ç³»ç»Ÿè°ƒç”¨å¯ä»¥æ”¹å˜å½“å‰è¿›ç¨‹æ‰€åœ¨çš„å½“å‰æ–‡ä»¶å¤¹ã€‚å½“è®¡ç®—ç›¸å¯¹è·¯å¾„æ—¶ï¼Œè¿›ç¨‹çš„å½“å‰æ–‡ä»¶å¤¹è¢«ç”¨ä½œå‚ç…§ open ç³»ç»Ÿè°ƒç”¨å½“ä½¿ç”¨ O_CREATE flag æ—¶å¯ä»¥åˆ›å»ºæ–°çš„æ–‡ä»¶ mkdir ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºæ–°çš„æ–‡ä»¶å¤¹ mknod ç³»ç»Ÿè°ƒç”¨äºåˆ›å»ºæ–°çš„å…¶ä»–è®¾å¤‡æ–‡ä»¶ã€‚å…·ä½“åœ°è¯´ï¼Œmknod ä¸ºä¸€ä¸ªå·²æœ‰çš„è®¾å¤‡åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„æŒ‡å‘è¯¥è®¾å¤‡ã€‚ è¯¥è®¾å¤‡çš„ä¸»è®¾å¤‡å·å’Œæ¬¡è®¾å¤‡å·éœ€è¦ä½œä¸ºå‚æ•°ä¼ å…¥ mknod, å¹¶äºæ–°åˆ›å»ºçš„è®¾å¤‡æ–‡ä»¶å…³è”ã€‚è¿™æ ·ä¸€æ¥ï¼Œå½“ç”¨äºè¿›ç¨‹è®¿é—®è¯¥è®¾å¤‡æ–‡ä»¶æ—¶ï¼Œå†…æ ¸ä¼šå°†å¯¹è¯¥è®¾å¤‡æ–‡ä»¶çš„ read å’Œ write ç³»ç»Ÿè°ƒç”¨è½¬å‘ç»™å†…æ ¸ä¸­çš„è®¾å¤‡å®ç°ï¼Œè€Œä¸æ˜¯è°ƒç”¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„å®ç°ã€‚ link ç³»ç»Ÿè°ƒç”¨ä¸ºä¸€ä¸ªå·²æœ‰æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–°çš„ link unlink ç³»ç»Ÿè°ƒç”¨ unlink ç³»ç»Ÿè°ƒç”¨ä»æ–‡ä»¶ç³»ç»Ÿåˆ é™¤ä¸€ä¸ª link åœ¨å…¸å‹ unix ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªæ–‡ä»¶çš„ inode ä»¥åŠæ–‡ä»¶åœ¨ç£ç›˜ä¸­çš„æœ¬ä½“åªæœ‰åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ²¡æœ‰ link æŒ‡å‘è¯¥ inode, å¹¶ä¸”æ‰€æœ‰è¿›ç¨‹ä¸­éƒ½ä¸å­˜åœ¨æŒ‡å‘è¯¥æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦æ—¶æ‰ä¼šè¢«é‡Šæ”¾å’Œåˆ é™¤ã€‚","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"Operating System","slug":"Operating-System","permalink":"https://blog.zhuwenq.cc/tags/Operating-System/"},{"name":"xv6","slug":"xv6","permalink":"https://blog.zhuwenq.cc/tags/xv6/"}]},{"title":"C++ æ¨¡æ¿022-å¯å˜æ¨¡æ¿","slug":"C-æ¨¡æ¿022-å¯å˜æ¨¡æ¿","date":"2023-02-15T08:49:38.000Z","updated":"2023-06-21T06:51:28.784Z","comments":true,"path":"C-æ¨¡æ¿022-å¯å˜æ¨¡æ¿/","link":"","permalink":"https://blog.zhuwenq.cc/C-%E6%A8%A1%E6%9D%BF022-%E5%8F%AF%E5%8F%98%E6%A8%A1%E6%9D%BF/","excerpt":"è‡ª C++ 11ï¼Œ æ¨¡æ¿å¯ä»¥æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼Œè¿™ä¸€ç‰¹æ€§å…è®¸å‘æ¨¡æ¿ä¼ å…¥ä»»æ„æ•°ç›®çš„ä»»æ„ç±»å‹å‚æ•°","text":"è‡ª C++ 11ï¼Œ æ¨¡æ¿å¯ä»¥æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼Œè¿™ä¸€ç‰¹æ€§å…è®¸å‘æ¨¡æ¿ä¼ å…¥ä»»æ„æ•°ç›®çš„ä»»æ„ç±»å‹å‚æ•° å¯å˜å‡½æ•°æ¨¡æ¿ ä¾‹å¦‚ï¼Œå¯ä»¥å®šä¹‰å¦‚ä¸‹å‡½æ•°ä»¥å®ç°ä»»æ„ç±»å‹ä»»æ„å‚æ•°çš„è¾“å‡º: 123456void print() &#123;&#125;template&lt;typename T, Typename... Args&gt;void print(T t, Args... args)&#123; std::cout &lt;&lt; t &lt;&lt; std::endl; print(args...);&#125; å½“ä¼ å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°æ—¶ï¼Œå‚æ•°åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°å°†åŒ¹é…åˆ° T t, å…¶ä½™å‚æ•°åˆ™è¢«èšåˆåœ¨ Args... args ä¸­ï¼Œç§°ä¸ºæ¨¡æ¿å‚æ•°åŒ…. åœ¨ print æ¨¡æ¿å†…, å‡½æ•°ä¼šé€’å½’åœ°è§£åŒ…æ¨¡æ¿å‚æ•°åŒ…å¹¶æ‰§è¡Œå®ä¾‹åŒ–çš„å‡½æ•° å½“æ‰€æœ‰å‚æ•°éƒ½è§£åŒ…å®Œæˆæ—¶, ç©ºçš„å‚æ•°åˆ—è¡¨ä¼šåŒ¹é…åˆ° print çš„éæ¨¡æ¿å®ç°, ä»¥ç»ˆæ­¢é€’å½’ é‡è½½å¯å˜å‚æ•°æ¨¡æ¿ è¦å®ç°å¯å˜å‚æ•°æ¨¡æ¿çš„é€’å½’ç»ˆæ­¢, ä¹Ÿå¯ä»¥ä¸ºå…¶é‡è½½ä¸€ä¸ªéå¯å˜å‚æ•°æ¨¡æ¿: 123456789template&lt;typename T&gt;void print(T t)&#123; std::cout &lt;&lt; t &lt;&lt; std::endl;&#125;template&lt;typename T, typename... Args&gt;void print(T t, Args... args)&#123; print(t); print(args...);&#125; è¿™æ˜¯å› ä¸º, å½“ä¸¤ä¸ªå‡½æ•°æ¨¡æ¿ä»…åŒºåˆ«äºå¯å˜å‚æ•°åŒ…æ—¶, éå¯å˜å‚æ•°æ¨¡æ¿å°†ä¼˜å…ˆè¢«å†³è®®. å› æ­¤å½“å‚æ•°è§£åŒ…åˆ°åªå‰©ä¸‹ä¸€ä¸ªå‚æ•°æ—¶, éå¯å˜å‚æ•°æ¨¡æ¿å°†ä¼˜å…ˆè¢«åŒ¹é… å¯å˜å‚æ•°æ¨¡æ¿çš„ sizeof è¿ç®—ç¬¦ C++ 11 ä¸ºæ¨¡æ¿å‚æ•°åŒ…å¼•å…¥äº†æ–°çš„ sizeof è¿ç®—ç¬¦: 12345template&lt;typename T, typename... Ts&gt;void size(T t, Ts... ts)&#123; sizeof...(Ts); // number of types in Ts sizeof...(ts); // number of values in ts&#125; fold expressions fold expressions æ˜¯ C++ 17 å¼•å…¥çš„ä¸€é¡¹æ–°ç‰¹æ€§ï¼Œå®ƒå…è®¸ä½¿ç”¨äºŒå…ƒè¿ç®—ç¬¦åœ¨æ¨¡æ¿å‚æ•°åŒ…ä¸­çš„æ‰€æœ‰å‚æ•°ä¸Šè®¡ç®—ç»“æœ ä¾‹å¦‚å¦‚ä¸‹çš„å‡½æ•°æ¨¡æ¿ï¼š 1234template&lt;typename... Ts&gt;auto foldSum(Ts... ts)&#123; return (... + ts);&#125; å…¶æ•ˆæœæ˜¯ä» ts ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°åŠ åˆ°å…¶æœ€åä¸€ä¸ªå‚æ•°ï¼Œå³: 1(((ts1 + ts2) + ... )+ tsn) æ³¨æ„å¦‚æœä¼ å…¥çš„å‚æ•°åŒ…ä¸ºç©ºï¼Œé‚£ä¹ˆ fold expression é€šå¸¸ä¸ä¼šé€šè¿‡ç¼–è¯‘(ill-formed)ã€‚ä½†å¯¹äºä»¥ä¸‹æ“ä½œç¬¦ï¼Œå…¶å¯ä»¥è¿”å›ç¡®å®šçš„ç»“æœ: operator result &amp;&amp; true ` , void() fold expression çš„æ‰€æœ‰å½¢å¼: fold expression evaluation (... op pack) (((pack1 op pack2) op pack3) ... op packN) (pack op ...) (pack1 op (... op (packN-1 op packN))) (init op ... op pack) (((init op pack1) op pack2) ... op packN) (pack op ... op init) (pack1 op (... op (packN op init))) å¯å˜ç±»æ¨¡æ¿å’Œå…¶ä»–å¯å˜è¡¨è¾¾å¼ å¯å˜å‚æ•°åŒ…å¯ä»¥å‡ºç°åœ¨: è¡¨è¾¾å¼ ç±»æ¨¡æ¿ using å£°æ˜ deduction guides å¯å˜è¡¨è¾¾å¼ ä¸€äº›ä¾‹å­: æ‰“å°ç¿»å€åçš„å‚æ•°ï¼š 1234template&lt;typename... T&gt;void printDouble(T... args)&#123; print(args + args...);&#125; æ•ˆæœç›¸å½“äº: 12345print( arg1 + arg1, arg2 + arg2, ...); æ³¨æ„åˆ°æ­¤æ—¶ print ä¹Ÿåº”è¯¥æ˜¯ä¸€ä¸ªå¯å˜å‚æ•°æ¨¡æ¿ æ‰“å°åŠ  1 åçš„å‚æ•°ï¼š 12345template&lt;typename... T&gt;void printPlusOne(T... args)&#123; print(args + 1 ...); // or: print((args + 1)...);&#125; ç›¸å½“äº: 12345print( arg1 + 1, arg2 + 1, ...); æ³¨æ„åˆ°æ­¤æ—¶ ... ç¬¦å·ä¸èƒ½ç›´æ¥è·Ÿåœ¨æ•°å­— 1 åé¢ï¼Œéœ€è¦ç©ºå¼€ä¸€ä¸ªç©ºæ ¼ ç¼–è¯‘æ—¶è¡¨è¾¾å¼: 1234template&lt;typename T1, typename... TN&gt;constexpr bool isHoMogeneous(T1, TN...)&#123; return (std::is_same_v&lt;T1, TN&gt; &amp;&amp; ...);&#125; å¯å˜ç´¢å¼• åˆ©ç”¨å¯å˜è¡¨è¾¾å¼ï¼Œå¯ä»¥å®ç°å¯¹ä»»æ„æ•°é‡çš„æ•°ç»„ç´¢å¼•è®¿é—®çš„å‡½æ•°: 1234template&lt;typename Container, typename... Idx&gt;void printElems(Container const&amp; c, Idx... idx)&#123; print(c[idx]...);&#125; æ³¨æ„åˆ°æ­¤æ—¶ä½œä¸ºæ•°ç»„ç´¢å¼•çš„å‚æ•° idx å¯ä»¥æ˜¯ä»»æ„æ•°é‡å’Œä»»æ„ç±»å‹ï¼Œä¹Ÿå¯ä»¥å°†å…¶å£°æ˜ä¸ºéç±»å‹æ¨¡æ¿å‚æ•°ä»¥é™åˆ¶å…¶ç±»å‹: 1234template&lt;std::size_t... idx, typename Container&gt;void printElems(Container const&amp; c)&#123; print(c[idx]...);&#125; å¯ä»¥ä»¥ä¸‹é¢çš„å½¢å¼è°ƒç”¨è¯¥å‡½æ•°: 1printElems&lt;1, 2, 3, 5&gt;(c); // print(c[1], c[2], c[3], c[5]); å¯å˜ç±»æ¨¡æ¿ å…ƒç»„ç±» å…ƒç»„ç±»éœ€è¦èƒ½å¤ŸæŒæœ‰ä»»æ„æ•°é‡ä»»æ„ç±»å‹çš„å€¼: 12template&lt;typename... Elems&gt;class Turple; Variant Variant å¯¹è±¡å¯ä»¥æŒæœ‰é¢„å…ˆå£°æ˜çš„ä»»æ„ç±»å‹çš„å€¼: 12template&lt;typename... Elems&gt;class Variant; è¡¨ç¤ºä»»æ„ä¸‹æ ‡åˆ—è¡¨çš„ç±»å‹ 12template&lt;std::size_t... idx&gt;struct Index &#123;&#125;; æ­¤ç±»å‹å¯ä»¥å°†ä¼ å…¥çš„ä¸‹æ ‡è¡¨ç¤ºä¸ºåˆ—è¡¨, ä½†æ˜¯å…¶å¹¶æœªå®é™…(å†…å­˜ä¸Š)æŒæœ‰è¿™äº›ä¸‹æ ‡å€¼, æ¯•ç«Ÿè¯¥ç±»å‹å®šä¹‰ä¸ºä¸€ä¸ªç©ºçš„ structã€‚ å®ƒçš„è¡¨ç¤ºåŠŸèƒ½å®é™…ä¸Šå‘ç”Ÿåœ¨ç¼–è¯‘æœŸ, å½“è¯¥ç±»å‹çš„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°æ—¶, å®é™…ä¸Šæ˜¯æŸç§ç±»å‹èƒå–åŠŸèƒ½å®ç°äº† Idx çš„ä¼ é€’: 1234template&lt;typename Container, std::size_t... Idx&gt;void printByIdx(Container const&amp; c, Index&lt;Idx...&gt;)&#123; // trait Idx out print(c[Idx]...);&#125; variadic deduction guides å¯¹äºæ¥å—å¯å˜å‚æ•°çš„å‡½æ•°æ¨¡æ¿ï¼Œå½“å…¶éœ€è¦è¿”å›å€¼deduction guide æ—¶ï¼Œdeduction guide ä¹Ÿå¯ä»¥æ˜¯å¯å˜è¡¨è¾¾å¼ã€‚ ä¾‹å¦‚ STL ä¸­å¯¹ std::array æ„é€ å‡½æ•°çš„å£°æ˜: 123456namespace std &#123;template&lt;typename T,typename ... U&gt;array(T, U...) -&gt; array&lt; enable_if_t&lt;(is_same_v&lt;T, U&gt; &amp;&amp; ...), T&gt;, (1 + sizeof...(U))&gt;;&#125; æ­¤å£°æ˜ä¸­ä¸º std::array å®šä¹‰äº†è¿”å›å€¼ deduction guide, å¹¶åœ¨å…¶ä¸­ä½¿ç”¨äº† enable_if, ä»¥å®ç°å½“æ„é€ å‡½æ•°ä¼ å…¥çš„åˆå§‹å€¼ç±»å‹ä¸åŒæ—¶ç¦ç”¨æ„é€ å‡½æ•°. åœ¨æ„é€ å‡½æ•°ä¼ å…¥çš„å¯å˜å‚æ•°åŒ…çš„ç±»å‹åˆ¤æ–­ä¸Šï¼Œè¯¥ deduction guide ä½¿ç”¨äº†å¯å˜è¡¨è¾¾å¼ã€‚ åŒæ—¶åœ¨å‚æ•°åŒ…æ•°é‡çš„è®¡ç®—ä¸Šï¼Œä½¿ç”¨äº†ç”¨äºå¯å˜å‚æ•°åŒ…çš„ sizeof æ“ä½œç¬¦ å¯å˜åŸºç±»å’Œ using å£°æ˜ åœ¨ç»§æ‰¿ä½“ç³»ä¸­åŸºç±»ä¹Ÿå¯ä»¥æ˜¯å¯å˜çš„ï¼Œå³ï¼Œå¯ä»¥é€šè¿‡å‚æ•°åŒ…å®ç°å¯¹ä»»æ„æ•°é‡ä»»æ„ç±»å‹çš„ç»§æ‰¿ã€‚ ä¾‹å¦‚ï¼š 123456789101112131415161718192021222324252627282930313233#include &lt;string&gt;#include &lt;unordered_map&gt;class Customer &#123;private: std::string name;public: Customer(std::string const&amp; n) : name(n) &#123; &#125; std::string getName() const &#123; return name; &#125;&#125;;struct CustomerEq &#123; bool operator() (Customer const&amp; c1, Customer const&amp; c2) const &#123; return c1.getName() == c2.getName(); &#125;&#125;;struct CustomerHash &#123; bool operator() (Customer const&amp; c) const &#123; return std::hash&lt;std::string&gt;(c.getName()); &#125;&#125;;template&lt;typename... Bases&gt;struct Overloader : Bases... &#123; using Bases::operator()...;&#125;;int main() &#123; using CustomOps = Overloader&lt;CustomerEq, CustomerHash&gt;; std::unordered_set&lt;Customer, CustomerHash, CustomerEq&gt; s1; std::unordered_set&lt;Customer, CustomOps, CustomOps&gt; s2;&#125; è¯¥ä¾‹ä¸­ï¼ŒCustomOps é€šè¿‡å¯å˜åŸºç±»åŒæ—¶ç»§æ‰¿äº† CustomerEq å’Œ CustomerHash è¿™ä¸¤ä¸ªå‡½æ•°å¯¹è±¡, å¹¶ä¸”åœ¨å®šä¹‰ä¸­ä½¿ç”¨å¯å˜ using å£°æ˜åŒæ—¶å¯ç”¨äº†ä¸¤ä¸ªåŸºç±»çš„ () æ“ä½œç¬¦ æ­¤æ—¶çš„ CustomOps åŒæ—¶å…·å¤‡äº† CustomerEq å’Œ CustomerHash è¿™ä¸¤ä¸ªå‡½æ•°å¯¹è±¡çš„åŠŸèƒ½. å³é€šè¿‡ CustomOps è°ƒç”¨ () æ“ä½œç¬¦æ—¶ï¼Œå…¶ä¼šæ ¹æ®å‚æ•°è‡ªåŠ¨åŒ¹é…åŸºç±»çš„å®šä¹‰ã€‚ å› æ­¤ï¼Œåœ¨ main å‡½æ•°ä¸­å®šä¹‰çš„ä¸¤ä¸ªè‡ªå®šä¹‰ç›¸ç­‰å’Œå“ˆå¸Œæ“ä½œçš„ unordered_set èƒ½å¤Ÿå®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚ å¯å˜å‚æ•°æ¨¡æ¿ä¸€äº›åœºæ™¯ å¯å˜å‚æ•°æ¨¡æ¿åœ¨æ ‡å‡†æ¨¡æ¿åº“ä¸­åº”ç”¨å¹¿æ³›, ä¸»è¦ç”¨é€”ä½“ç°åœ¨å‚æ•°è½¬å‘ä¸Š åœ¨ä¸€äº›èµ„æºç®¡ç†ç±»ä¸­å…¶å¯ç”¨äºè½¬å‘ä»»æ„æ•°é‡ä»»æ„ç±»å‹çš„å‚æ•°åˆ°è¢«ç®¡ç†å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚ å¦‚: 1auto share_ptr = std::make_shared&lt;std::complex&lt;float&gt;&gt;(1.1, 2.2); å°†å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•°ä¼ é€’è¿› thread å¯¹è±¡: 1std::thread t(f, 1, &quot;hello&quot;); // call f(1, &quot;hello&quot;) in thread t åœ¨å®¹å™¨ä¸­æ¥æ”¶æ„é€ å¯¹è±¡æ‰€éœ€çš„å‚æ•°å¹¶ç›´æ¥æ„é€ å¯¹è±¡(emplace): 12std::vector&lt;std::pair&lt;int, int&gt;&gt; vec;vec.emplace_back(1, 2); // construct std::pair&lt;int, int&gt; &#123;1, 2&#125; in vec å¯¹äºä¼ é€’å‚æ•°çš„å‡½æ•°, å…¶å‚æ•°é€šå¸¸è¢«å£°æ˜ä¸ºä¸‡èƒ½å¼•ç”¨çš„å½¢å¼.","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"C++ Template","slug":"C-Template","permalink":"https://blog.zhuwenq.cc/tags/C-Template/"},{"name":"C++","slug":"C","permalink":"https://blog.zhuwenq.cc/tags/C/"}]},{"title":"C++æ¨¡æ¿021-éç±»å‹æ¨¡æ¿å‚æ•°","slug":"C-æ¨¡æ¿021-éç±»å‹æ¨¡æ¿å‚æ•°","date":"2023-02-14T12:42:15.000Z","updated":"2023-06-21T06:51:28.784Z","comments":true,"path":"C-æ¨¡æ¿021-éç±»å‹æ¨¡æ¿å‚æ•°/","link":"","permalink":"https://blog.zhuwenq.cc/C-%E6%A8%A1%E6%9D%BF021-%E9%9D%9E%E7%B1%BB%E5%9E%8B%E6%A8%A1%E6%9D%BF%E5%8F%82%E6%95%B0/","excerpt":"C++ æ¨¡æ¿çš„å‚æ•°ä¸å¿…æ˜¯ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ç¼–è¯‘æ—¶æ•´å‹å¸¸é‡ã€‚ä¾‹å¦‚æ ‡å‡†æ¨¡æ¿åº“ä¸­çš„ std::array å°±æ¥å—éç±»å‹æ¨¡æ¿å‚æ•°ç”¨äºæè¿°æ•°ç»„çš„é•¿åº¦: std::array&lt;int, 10&gt;","text":"C++ æ¨¡æ¿çš„å‚æ•°ä¸å¿…æ˜¯ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ç¼–è¯‘æ—¶æ•´å‹å¸¸é‡ã€‚ä¾‹å¦‚æ ‡å‡†æ¨¡æ¿åº“ä¸­çš„ std::array å°±æ¥å—éç±»å‹æ¨¡æ¿å‚æ•°ç”¨äºæè¿°æ•°ç»„çš„é•¿åº¦: std::array&lt;int, 10&gt; éç±»å‹å‡½æ•°æ¨¡æ¿å‚æ•° ä¾‹å¦‚ï¼š 1234template&lt;int val, typename T&gt;T addVal(T x)&#123; return x + val;&#125; è¯¥å‡½æ•°æ¨¡æ¿çš„å®ä¾‹å¯ä»¥ä½œä¸ºå¯è°ƒç”¨å¯¹è±¡ä¼ å…¥æ ‡å‡†æ¨¡æ¿åº“ä¸­çš„ç®—æ³•ï¼š 123transform(nums.begin(), nums.end() dest.begin(), addVal&lt;5, int&gt;); éç±»å‹æ¨¡æ¿å‚æ•°çš„é™åˆ¶ åªæœ‰ å¸¸é‡æ•´æ•°å€¼(åŒ…æ‹¬æšä¸¾), æŒ‡é’ˆ(æŒ‡å‘å¯¹è±¡/å‡½æ•°/æˆå‘˜), å·¦å€¼å¼•ç”¨(æŒ‡å‘å¯¹è±¡/å‡½æ•°), std::nullptr_t æµ®ç‚¹æ•°å’Œç±»ç±»å‹å¯¹è±¡ä¸å¯ä»¥åšä¸ºéç±»å‹æ¨¡æ¿å‚æ•° å½“æŒ‡é’ˆæˆ–å¼•ç”¨ä½œä¸ºæ¨¡æ¿å‚æ•°æ—¶ï¼Œå…¶æ‰€æŒ‡å‘çš„å‚æ•°ä¸èƒ½æ˜¯å­—ç¬¦ä¸²å­—é¢é‡, ä¸´æ—¶å˜é‡æˆ–æ•°æ®æˆå‘˜ä»¥åŠå…¶ä»–å­å¯¹åƒ auto ä½œä¸ºéç±»å‹æ¨¡æ¿å‚æ•°çš„ç±»å‹ è‡ª C++ 17 ï¼Œéç±»å‹æ¨¡æ¿å‚æ•°çš„ç±»å‹å¯ä»¥è¢«å£°æ˜ä¸º auto ï¼Œä»¥å®ç°å¯é€‚ç”¨äºæ‰€æœ‰åˆæ³•ç±»å‹çš„æ¨¡æ¿ ä¾‹å¦‚å¯ä»¥å®šä¹‰: 123456template&lt;typename T, auto MaxSize&gt;class Stack &#123;public: using size_type = decltype&lt;MaxSize&gt;; ...&#125; å®šä¹‰ä¸­ Stack çš„å¤§å°ä»¥éç±»å‹æ¨¡æ¿å‚æ•°çš„å½¢å¼ä¼ å…¥ï¼Œä¸”å…¶ç±»å‹è¢«å£°æ˜ä¸º auto. åŒæ—¶ï¼Œåœ¨å®šä¹‰ä¸­å¯ä»¥é€šè¿‡ decltype å–å‡ºå…¶ç±»å‹ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¹Ÿå¯ä»¥å°†éç±»å‹æ¨¡æ¿å‚æ•°çš„ç±»å‹å£°æ˜ä¸º decltype(auto), è¿™æ ·ï¼Œå…¶ç±»å‹å°†å…è®¸è¢«æ¨å¯¼ä¸ºå¼•ç”¨ç±»å‹ï¼š 1234567int i&#123;0&#125;;template&lt;auto I&gt;class A &#123; &#125;;A&lt;i&gt; a; // I is of type inttemplate&lt;decltype(auto) J&gt;class B &#123; &#125;;B&lt;i&gt; b; // J is of type int&amp;","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"C++ Template","slug":"C-Template","permalink":"https://blog.zhuwenq.cc/tags/C-Template/"},{"name":"C++","slug":"C","permalink":"https://blog.zhuwenq.cc/tags/C/"}]},{"title":"C++ æ¨¡æ¿01--æ¨¡æ¿åŸºç¡€","slug":"C-æ¨¡æ¿01-æ¨¡æ¿åŸºç¡€","date":"2022-11-17T13:08:23.000Z","updated":"2023-06-21T06:51:28.784Z","comments":true,"path":"C-æ¨¡æ¿01-æ¨¡æ¿åŸºç¡€/","link":"","permalink":"https://blog.zhuwenq.cc/C-%E6%A8%A1%E6%9D%BF01-%E6%A8%A1%E6%9D%BF%E5%9F%BA%E7%A1%80/","excerpt":"åŒ…æ‹¬å‡½æ•°æ¨¡æ¿, ç±»æ¨¡æ¿, åˆ«åæ¨¡æ¿, å˜é‡æ¨¡æ¿åŸºæœ¬çš„ç”¨æ³•, åç‰¹åŒ–å’Œå…¨ç‰¹åŒ–çš„åŸºæœ¬çŸ¥è¯†, ä»¥åŠç±»å‹æ¨å¯¼çš„åŸºæœ¬ç”¨æ³•.","text":"åŒ…æ‹¬å‡½æ•°æ¨¡æ¿, ç±»æ¨¡æ¿, åˆ«åæ¨¡æ¿, å˜é‡æ¨¡æ¿åŸºæœ¬çš„ç”¨æ³•, åç‰¹åŒ–å’Œå…¨ç‰¹åŒ–çš„åŸºæœ¬çŸ¥è¯†, ä»¥åŠç±»å‹æ¨å¯¼çš„åŸºæœ¬ç”¨æ³•. åŸºæœ¬ç”¨æ³• å‡½æ•°æ¨¡æ¿ å¯¹äºå¸¸ç”¨çš„ max å‡½æ•°, å…¶è¿”å›è¾“å…¥å‚æ•°ä¸­æœ€å¤§çš„é‚£ä¸ª. è¿™ä¸€æ“ä½œå¯¹è®¸å¤šç§ç±»å‹éƒ½é€‚ç”¨, å¦‚æœä¸æƒ³å¯¹æ¯ç§å‚æ•°éƒ½å®ç°ç›¸åŒçš„è¡Œä¸º, å°±éœ€è¦ä½¿ç”¨æ¨¡æ¿æŠ€æœ¯å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¨¡æ¿: 12345// return the max value of the argstemplate&lt;typename T&gt;T max(T a, T b) &#123; return a &lt; b ? b : a;&#125; å¯¹äºä¸Šè¿°å®šä¹‰, æ‰€æœ‰æ”¯æŒ &lt; è¿ç®—ç¬¦çš„ç±»å‹ T éƒ½å¯ä»¥å®ä¾‹åŒ–ä¸€ä¸ª max å‡½æ•°çš„ç‰¹æ®Šç‰ˆæœ¬: 1234567891011121314#include&lt;string&gt;int main () &#123; int i = 42; ::max(7, i); // int max(int ,int ); 42 double f1 = 3.4; double f2 = -6.7; ::max(f1, f2); // double max(double, double); 3.4 std::string s1 = &quot;abc&quot;; std::string s2 = &quot;abcdefg&quot;; ::max(s1, s2); // std::string max(std::string, std::string); abcdefg&#125; æ¨¡æ¿ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªä¸åŒçš„å‚æ•°, ä¾‹å¦‚: 1234template&lt;typename T1, typename T2, typename RT&gt;RT max(T1 a, T2 b)&#123; return a &lt; b ? b : a;&#125; æ­¤ä¾‹ä¸­å¯ä»¥ä¸ºå‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼åˆ†åˆ«è®¾ç½®ä¸€ä¸ªç±»å‹, ä¾‹å¦‚: 1::max&lt;int, double, double&gt;(1, 1.1); é‡è½½ å‡½æ•°æ¨¡æ¿å¯ä»¥è¢«é‡è½½, å³, å¦å¤–å®šä¹‰ä¸€ä¸ªéæ¨¡æ¿å‡½æ•°æˆ–ä¸åŒçš„å‡½æ•°æ¨¡æ¿. å½“è°ƒç”¨æ˜¯çš„å‚æ•°ç±»å‹å®Œç¾åŒ¹é…æ—¶, é‡è½½å†³è®®ä¼šä¼˜å…ˆå†³è®®éæ¨¡æ¿çš„ç‰ˆæœ¬: 1234567891011121314151617181920int max(int a, int b) &#123; return a &lt; b ? b : a;&#125;template&lt;typename T&gt;T max(T a, T b) &#123; return a &lt; b ? b : a;&#125;template&lt;typename RT, typename T1, typename T2&gt;RT max(T1 a, T2 b) &#123; return a &lt; b ? b : a;&#125;int main() &#123; ::max(1, 2); // non-template ::max&lt;&gt;(1, 2); // template; int max&lt;int&gt;(int, int); ::max(1, 2.1); // non-template; ::max&lt;float&gt;(1, 2.1); // template; float max&lt;float, int, float&gt;(int, float);&#125; ç±»æ¨¡æ¿ ç±»å‹çš„å®šä¹‰ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹å‚æ•°åŒ–, ä¾‹å¦‚æ ‡å‡†æ¨¡æ¿åº“ä¸­çš„å®¹å™¨ç±»å‹å°±æ˜¯ç±»æ¨¡æ¿. ä½œä¸ºä¸€ä¸ªä¾‹å­, ä¸‹é¢å®šä¹‰ä¸€ä¸ªç®€å•çš„å®¹å™¨é€‚é…å™¨ Stack: 12345678910111213141516171819202122232425262728293031#include &lt;vector&gt;#include &lt;cassert&gt;template&lt;typename T, typename Cont = std::vector&lt;T&gt;&gt;class Stack &#123;private: Cont elems; // elementspublic: void push(T const&amp; elem); // push element void pop(); // pop element T const&amp; top() const; // return top element bool empty() const &#123; // return whether the stack is empty return elems.empty(); &#125;&#125;;template&lt;typename T, typename Cont&gt;void Stack&lt;T,Cont&gt;::push (T const&amp; elem) &#123; elems.push_back(elem); // append copy of passed elem&#125;template&lt;typename T, typename Cont&gt;void Stack&lt;T,Cont&gt;::pop () &#123; assert(!elems.empty()); elems.pop_back(); // remove last element&#125;template&lt;typename T, typename Cont&gt;T const&amp; Stack&lt;T,Cont&gt;::top () const &#123; assert(!elems.empty()); return elems.back(); // return copy of last element&#125; åˆ«åæ¨¡æ¿ C++ ä¸­çš„ using å…³é”®å­—ä¹Ÿå¯ä»¥æ¨¡æ¿åŒ–: 1234template&lt;typename T&gt;using DequeStack = Stack&lt;T, std::deque&lt;T&gt;&gt;;auto stack = DequeStack&lt;int&gt;; // a stack of int with the base container being a std::deque&lt;int&gt; åˆ«åæ¨¡æ¿è¿˜å¯ä»¥ç”¨æ¥å®šä¹‰æ¨¡æ¿åŒ–çš„æˆå‘˜ç±»å‹, ä¾‹å¦‚å¯¹äºè¿­ä»£å™¨ç±»å‹, å‡å¦‚å­˜åœ¨å®šä¹‰: 12345template&lt;typename T, typename Cont = std::vector&lt;int&gt;&gt;class Stack &#123;public: using iterator = ...;&#125; åˆ™å¯ä»¥é€šè¿‡: 12template&lt;typename T&gt;using StackIterator = typename Stack&lt;T&gt;::iterator; æ¥å®šä¹‰ä»»æ„å…ƒç´ ç±»å‹çš„ Stack è¿­ä»£å™¨ç±»å‹. æ³¨æ„ Stack&lt;T&gt;::iterator å‰é¢çš„ typename ä¸å¯ç¼ºå°‘, å¦åˆ™ç¼–è¯‘å™¨å¹¶ä¸æ•¢å‡è®¾åé¢çš„ä¸œè¥¿æ˜¯ä¸ªç±»å‹. C++14 ä¸­ type traits çš„ _t åç¼€ æ ‡å‡†æ¨¡æ¿åº“ä¸­æœ‰ä¸€ç§ type traits åŸºç¡€è®¾æ–½ç”¨äºå¯¹ç±»å‹è¿›è¡Œæ“ä½œ, å…¶ç»“æœä¹Ÿæ˜¯ä¸€ç§ç±»å‹. åœ¨ C14 ä¹‹å‰, è¿™ç±»è®¾æ–½åªèƒ½é€šè¿‡ std::some_traits&lt;T&gt;::type ä½¿ç”¨. åœ¨ C14 ä¸­, è¿™ç±»è®¾æ–½éƒ½ä½¿ç”¨ _t åç¼€è¿›è¡Œäº†å®šä¹‰: 1234namespace std &#123; template&lt;typename T&gt; using some_traits_t = typename some_trait&lt;T&gt;::type;&#125; è¿™æ ·å°±å¯ä»¥é€šè¿‡ç®€å•ç›´è§‚çš„æ–¹å¼ä½¿ç”¨è¿™ç±»è®¾æ–½: 1std::some_traits_t&lt;T&gt; å˜é‡æ¨¡æ¿ è‡ª C++14, å˜é‡ä¹Ÿå¯ä»¥è¢«å‚æ•°åŒ–å®šä¹‰, ä¾‹å¦‚: 123456template&lt;typename T = long double&gt;constexpr T pi&#123;3.1415926&#125;;std::cout &lt;&lt; pi&lt;&gt; &lt;&lt; std::endl; // outputs a long doublestd::cout &lt;&lt; pi&lt;float&gt; &lt;&lt; std::endl; // outputs a floatstd::cout &lt;&lt; pi &lt;&lt; std::endl;; // Error, you always need to specify the angle brackets æ¨¡æ¿å‚æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨éç±»å‹å‚æ•°: 12345678910111213141516#include&lt;iostream&gt;#include&lt;array&gt;template&lt;int N&gt;std::array&lt;int, N&gt; arr&#123;&#125;;template&lt;auto N&gt;constexpr decltype(N) dval = N;int main() &#123; std::cout &lt;&lt; dval&lt;&#x27;a&#x27;&gt; &lt;&lt; std::endl; arr&lt;10&gt;[0] = 1; for (auto i = 0; i &lt; arr&lt;10&gt;.size(); ++i)&#123; cout &lt;&lt; arr&lt;10&gt;[i] &lt;&lt; std::endl; &#125;&#125; å˜é‡æ¨¡æ¿çš„ä¸€å¤§ç”¨å¤„æ˜¯å¯ä»¥ç”¨æ¥å®šä¹‰ç±»çš„æ•°æ®æˆå‘˜. ä¾‹å¦‚, å¯¹äºæ ‡å‡†æ¨¡æ¿åº“ä¸­çš„å¦ä¸€ç§ type traits åŸºç¡€è®¾æ–½: 123456789namespace std &#123; template&lt;typename T&gt; class numeric_limits &#123; public: ... static constexpr bool is_signed = false; ... &#125;;&#125; å¯¹äºç±»å‹ T, åªèƒ½é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½¿ç”¨è¯¥è®¾æ–½: 1std::numeric_limits&lt;T&gt;::is_signed å¦‚æœå®šä¹‰: 12template&lt;typename T&gt;constexpr bool isSigned = std::numeric_limits&lt;T&gt;::is_signed; å°±å¯ä»¥é€šè¿‡ isSigned&lt;T&gt; ä½¿ç”¨è¯¥è®¾æ–½ã€‚ C++17 ä¸­ type taits çš„ _v åç¼€ åŸºäºå˜é‡æ¨¡æ¿æŠ€æœ¯, C++17 ä¸ºç»“æœä¸ºå€¼çš„ type traits åŸºç¡€è®¾æ–½å®šä¹‰äº† _v åç¼€çš„ç‰ˆæœ¬: 1234namespace std &#123; template&lt;typename T&gt; constexpr bool is_some_traits_v = is_some_traits&lt;T&gt;::value;&#125; åç‰¹åŒ–å’Œå…¨ç‰¹åŒ– ç‰¹åŒ– (Specialization) æ˜¯é’ˆå¯¹ç±»æ¨¡æ¿çš„ä¸€ç§ç”¨æ³•, ä¸å‡½æ•°æ¨¡æ¿å¯ä»¥é‡è½½ç±»ä¼¼, ç±»æ¨¡æ¿çš„ç‰¹åŒ–æä¾›äº†ä¸€ç§ä¸ºç‰¹æ®Šçš„æ¨¡æ¿å‚æ•°æˆ–æ¨¡æ¿å‚æ•°ç»„åˆå®ç°ä¸åŒè¡Œä¸ºçš„ç±»æ¨¡æ¿å®šä¹‰æ–¹æ³•. é€šå¸¸ç±»æ¨¡æ¿çš„ç‰¹åŒ–å¯ä»¥ä¸ºç‰¹æ®Šçš„æ¨¡æ¿å‚æ•°å®šä¹‰æ›´ä¼˜åŒ–çš„ç±»å®ç°, æˆ–è€…ä¿®æ­£åœ¨æŸäº›æ¨¡æ¿å‚æ•°ä¸‹æ¨¡å‹çš„å®šä¹‰æœ‰è¯¯çš„æƒ…å†µ. ä¾‹å¦‚, å¯ä»¥é’ˆå¯¹ POD ç±»å‹æä¾›ç‰¹æ®Šçš„å®¹å™¨å®šä¹‰ä»¥å®ç°æ›´åŠ ç´§å‡‘çš„å†…å­˜å¸ƒå±€å’Œæ›´åŠ å¿«é€Ÿçš„æ•°æ®æ‹·è´. éœ€è¦æ³¨æ„çš„æ˜¯, åœ¨ç±»æ¨¡æ¿çš„ç‰¹åŒ–ä¸­, å…¶æ‰€æœ‰çš„æˆå‘˜éƒ½éœ€è¦æœ‰å¯¹åº”çš„ç‰¹åŒ–å®ç°. å…¨ç‰¹åŒ– (Specialization) ç±»æ¨¡æ¿çš„å…¨ç‰¹åŒ–å£°æ˜ç”±ä¸€ä¸ªç©ºçš„æ¨¡æ¿å‚æ•°åˆ—è¡¨å¼€å¤´: 12template&lt;&gt;class Stack&lt;std::string&gt;; åœ¨å…¨ç‰¹åŒ–æ¨¡æ¿çš„å®ç°ä¸­, æ‰€æœ‰çš„æˆå‘˜ç­¾åç±»ä¼¼äºéç±»æ¨¡æ¿æˆå‘˜çš„ç­¾å, å³ä¸ä»¥ template&lt;&gt; å¼€å¤´: 1void Stack&lt;std::string&gt;::push(std::string const&amp; s); ä»¥ä¸Šå°±æ˜¯ç±»æ¨¡æ¿å…¨ç‰¹åŒ–çš„åŸºæœ¬ç”¨æ³•. åœ¨å®é™…ä½¿ç”¨ä¸­, å¯ä»¥é€šè¿‡å…¨ç‰¹åŒ–ä¸ºç‰¹å®šç±»å‹æä¾›ç‰¹å®šçš„å®ç°. ä¾‹å¦‚åœ¨ä¸€ä¸ªä¾‹å­ä¸­, å¯ä»¥ä¸º std::string ç±»å‹çš„ Stack æä¾›ä¸€ä¸ªä»¥ std::deque ä¸ºåº•å±‚å®¹å™¨çš„ç‰ˆæœ¬: 123456789101112#include&lt;deque&gt;#include&lt;string&gt;template&lt;&gt;class Stack&lt;std::string&gt; &#123;private: std::deque&lt;std::string&gt; elems;public: void push(std::string const&amp;); void pop(); std::string const&amp; top() const; bool empty() const;&#125; åç‰¹åŒ– (Partial Specialization) åç‰¹åŒ–ä¸»è¦ç”¨åœ¨å¤šæ¨¡æ¿å‚æ•°çš„ç±»æ¨¡æ¿ä¸­, å¯ä»¥åˆ©ç”¨åç‰¹åŒ–æŠ€æœ¯ä¸ºå¤šä¸ªæ¨¡æ¿å‚æ•°ä¸­çš„éƒ¨åˆ†æä¾›å…·ä½“çš„ç‰¹åŒ–. åœ¨å•å‚æ•°æ¨¡æ¿ä¸­ä¹Ÿå¯ä»¥å°†ç±»å‹å‚æ•°ç‰¹åä¸ºç‰¹æ®Šçš„å½¢å¼ (å¦‚æŒ‡é’ˆç±»å‹) å°†æ¨¡æ¿å‚æ•°ç‰¹åŒ–ä¸ºç‰¹æ®Šå½¢å¼ 1234template&lt;typename T&gt;class Stack&lt;T*&gt;; // specialization for raw pointerstemplate&lt;typename T1, typename T2&gt;class Widget&lt;T1*, T2*&gt;; // specialization for raw pointers ç‰¹åŒ–éƒ¨åˆ†æ¨¡æ¿å‚æ•° 123456template&lt;typename T1&gt;class Widget&lt;T1, std::string&gt;; // specialization for std::string as T2template&lt;typename T1&gt;class Widget&lt;T1, T1&gt;; // specialization for T1 as T2template&lt;typename T1, typename T2&gt;class Widget&lt;T1*, T2*&gt;; ç±»å‹æ¨å¯¼ (Deduction) C17 å…è®¸å¯¹ç±»å‹æ¨¡æ¿çš„å®ä¾‹åŒ–è¯­å¥çœç•¥æ˜¾ç¤ºçš„æ¨¡æ¿ç±»å‹, C ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ¨å¯¼å®ä¾‹åŒ–çš„æ¨¡æ¿å‚æ•°. ä¾‹å¦‚: 123Stack&lt;int&gt; istack; // stack of intsStack&lt;int&gt; istack2 = istack; // stack of intsStack istack3 = istack; // OK since C++17, stack of ints istack3 çš„å®šä¹‰è¯­å¥ä¸­ä¸éœ€è¦æ˜¾ç¤ºå£°æ˜æ¨¡æ¿å‚æ•° &lt;int&gt;, ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ ¹æ®æ‹·è´å¯¹è±¡çš„ç±»å‹æ¨å¯¼å‡ºæ¨¡æ¿å‚æ•°ä¸º int è¿™ç§çº§åˆ«çš„ç±»å‹æ¨å¯¼æ˜¯ç”±æ„é€ å‡½æ•°çš„å®šä¹‰å†³å®šçš„, å› æ­¤, åªè¦æ„é€ å‡½æ•°æä¾›ç›¸åº”çš„æ”¯æŒ, ç±»ä¼¼ä¸Šé¢ç¤ºä¾‹ä¸­çš„å‚æ•°æ¨å¯¼å¯ä»¥æ¨å¹¿åˆ°ä»»æ„çš„å½¢å¼: 1234567891011template&lt;typename T&gt;class Stack &#123;private: vector&lt;T&gt; elems; // vector as base containerpublic: Stack() = default; Stack(T const&amp; elem) : elems(&#123;elem&#125;) // &#123;&#125; around to initialize vector elems, otherwise wrong constructor will be invoked &#123;&#125;; // support for construction from one element of type T&#125;;Stack s = 0; // stack of int, with one element of value 0 å¯¹å­—ç¬¦ä¸²å­—é¢é‡çš„å¤„ç† ä¸Šé¢çš„ Stack å®šä¹‰æ”¯æŒä»ä»»æ„å•ä¸ªå€¼å®ä¾‹åŒ–æ¨¡æ¿å¹¶åˆå§‹åŒ–å®¹å™¨, å¹¶ä¸”ä¸éœ€è¦æ˜¾ç¤ºä¼ é€’æ¨¡æ¿å‚æ•°. ä½†æ˜¯å½“ä»¥å­—ç¬¦ä¸²å­—é¢é‡å®ä¾‹åŒ–ä¸Šè¿°æ¨¡æ¿æ—¶, ç”±äºå…¶ç‰¹æ®Šçš„ç±»å‹, ä¼šé€ æˆä¸€äº›ç‰¹æ®Šç»“æœ: 1Stack s = &quot;string literal&quot;; // &quot;string literal&quot; is of type `char const[15]`, thus s is of type Stack&lt;char const[15]&gt; è¿™æ˜¯ç”±äºåœ¨ä¸Šé¢çš„æ„é€ å‡½æ•°å®šä¹‰ä¸­, elem è¢«å£°æ˜ä¸ºäº†å¼•ç”¨ç±»å‹, è€Œå¯¹äºå­—ç¬¦ä¸²å­—é¢é‡çš„å¼•ç”¨ç±»å‹, å…¶ä¸ä¼šåƒå€¼ç±»å‹ä¸€æ ·åœ¨å‚æ•°ä¼ é€’çš„è¿‡ç¨‹ä¸­ decay, å› æ­¤å‚æ•° T å°±å¦‚å®åœ°ä¿ç•™äº†å­—ç¬¦æ•°ç»„çš„åŸå§‹ç±»å‹ å¦‚æœä¸Šé¢å¯¹ Stack çš„å®šä¹‰ä¸­æ„é€ å‡½æ•°å®šä¹‰ä¸ºå‚æ•°æŒ‰å€¼ä¼ é€’, s çš„æ¨å¯¼ç±»å‹å°±ä¼šå˜æˆ Stack&lt;char const*&gt;. Deduction Guide ä¸Šé¢å¯¹äºå­—ç¬¦ä¸²å­—é¢é‡çš„å¤„ç†æœ€å¤šå¯ä»¥å°†å…¶å¼•å¯¼ä¸ºæŒ‡é’ˆç±»å‹, è€Œä¸”éœ€è¦æ”¹å˜æ„é€ å‡½æ•°çš„å®šä¹‰. é€šè¿‡åç½®ç±»å‹å£°æ˜çš„è¯­æ³•, åˆ™å¯ä»¥ä¸ºæ„é€ å‡½æ•°æ˜¾ç¤ºå£°æ˜å®ä¾‹åŒ–çš„ç»“æœ. ä¾‹å¦‚æ·»åŠ ä»¥ä¸‹å£°æ˜: 1Stack(char const*) -&gt; Stack&lt;std::string&gt;; å­—ç¬¦ä¸²å­—é¢é‡ä½œä¸ºåˆå§‹åŒ–ç‰©æ—¶å¾—åˆ°çš„å¯¹è±¡ç±»å‹å°±ä¼šæ˜¯ Stack&lt;std::string&gt;. ä½†éœ€è¦æ³¨æ„æ­¤æ—¶æ— æ³•å†ä½¿ç”¨æ‹·è´æ“ä½œç¬¦åˆå§‹åŒ– Stack, è¿™æ˜¯å› ä¸º: 1Stack s = &quot;string literal&quot;; å°† s å®ä¾‹åŒ–ä¸º Stack&lt;std::string&gt;, é‚£ä¹ˆ s çš„å®šä¹‰ä¸­æ„é€ å‡½æ•°å°±å˜ä¸º: 1Stack&lt;std::string&gt;::Stack(std::string const&amp;); æ­¤æ„é€ å‡½æ•°æ— æ³•æ¥çº³å­—ç¬¦ä¸²å­—é¢é‡ä¸ºå‚æ•°. ä¹Ÿå°±æ˜¯è¯´, æ­¤æ—¶æ‹·è´æ“ä½œç¬¦æ‰€åœ¨çš„è¯­å¥å¯¹ç±»æ¨¡æ¿çš„å®ä¾‹åŒ–æ˜¯æˆåŠŸçš„, ä½†è°ƒç”¨æ„é€ å‡½æ•°çš„è¿‡ç¨‹å¤±è´¥äº†. æ­¤å¤±è´¥æ˜¯ç”±äºå¹¶ä¸å­˜åœ¨ä»å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹å³ char const[] å‘ std::string çš„ç›´æ¥è½¬æ¢. å› æ­¤é€šè¿‡ä»¥ä¸‹è¯­å¥å¯ä»¥å®ç°éœ€è¦çš„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–: 1Stack s&#123;&quot;string literal&quot;&#125;; è¿™æ˜¯å› ä¸ºå¤§æ‹¬å·åˆå§‹åŒ–è¯­å¥ä¼šè‡ªåŠ¨ä»¥ä¼ å…¥çš„é‡ä¸ºå‚æ•°è°ƒç”¨ç›®æ ‡ç±»å‹çš„æ„é€ å‡½æ•°, è€Œ std::string æ˜¾ç„¶æ˜¯å­˜åœ¨ä»¥å­—ç¬¦ä¸²å­—é¢é‡ä¸ºå‚æ•°çš„æ„é€ å‡½æ•°çš„.","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"C++ Template","slug":"C-Template","permalink":"https://blog.zhuwenq.cc/tags/C-Template/"},{"name":"C++","slug":"C","permalink":"https://blog.zhuwenq.cc/tags/C/"}]},{"title":"C++ template","slug":"C-template","date":"2022-11-14T08:38:26.000Z","updated":"2023-06-21T06:51:28.780Z","comments":true,"path":"C-template/","link":"","permalink":"https://blog.zhuwenq.cc/C-template/","excerpt":"å¤§æ¦‚åŠä¸ªæœˆå‰åœ¨çœ‹ cppcon 2022 ä¸€ä¸ª talk æ—¶å€™å¶ç„¶å‘ç° Nicolai M. Josuttis è¿™ä¹ˆä¸€ä¸ªæŠ€æœ¯ä½œå®¶, æ‰“ç®—æŠŠä»–çš„ the complete guide ç³»åˆ—, åŒ…æ‹¬ C++ templates: the complete guide, C++ 17: the complete guide å’Œ C++ 20: the complete guide éƒ½çœ‹ä¸€çœ‹ã€‚æœ€è¿‘åˆšè¯»å®Œ C++ templates: the complete guide çš„ç¬¬ä¸€éƒ¨åˆ†ä¹Ÿæ˜¯åŸºç¡€éƒ¨åˆ†çš„ 11 ç« ã€‚ ä¹¦ä¸­è®¸å¤šæ¦‚å¿µä¹Ÿåœ¨åˆ«çš„ä¹¦ä¾‹å¦‚ Effective Modern C++ å‡ºç°è¿‡, è¿™é‡Œæ‰“ç®—å®Œæ•´åœ°å†™å‡ ç¯‡æ–‡ç« ä½œä¸ºæˆ‘å¯¹ C++ template çš„å­¦ä¹ æ€»ç»“, ä¸»è¦è®°å½•ä¸‹é‚£äº›æˆ‘é˜…è¯»æœ¬ä¹¦ä¹‹å‰æœªçŸ¥çš„æ–°çŸ¥è¯†å’Œè™½ç„¶æ˜¯å·²çŸ¥çš„çŸ¥è¯†ä½†å°šæœªè€ƒè™‘è¿‡çš„åœ°æ–¹ã€‚å¸Œæœ›èƒ½å¤Ÿé¡ºåˆ©å®Œæˆè¿™ä¸€ç³»åˆ—ã€‚","text":"å¤§æ¦‚åŠä¸ªæœˆå‰åœ¨çœ‹ cppcon 2022 ä¸€ä¸ª talk æ—¶å€™å¶ç„¶å‘ç° Nicolai M. Josuttis è¿™ä¹ˆä¸€ä¸ªæŠ€æœ¯ä½œå®¶, æ‰“ç®—æŠŠä»–çš„ the complete guide ç³»åˆ—, åŒ…æ‹¬ C++ templates: the complete guide, C++ 17: the complete guide å’Œ C++ 20: the complete guide éƒ½çœ‹ä¸€çœ‹ã€‚æœ€è¿‘åˆšè¯»å®Œ C++ templates: the complete guide çš„ç¬¬ä¸€éƒ¨åˆ†ä¹Ÿæ˜¯åŸºç¡€éƒ¨åˆ†çš„ 11 ç« ã€‚ ä¹¦ä¸­è®¸å¤šæ¦‚å¿µä¹Ÿåœ¨åˆ«çš„ä¹¦ä¾‹å¦‚ Effective Modern C++ å‡ºç°è¿‡, è¿™é‡Œæ‰“ç®—å®Œæ•´åœ°å†™å‡ ç¯‡æ–‡ç« ä½œä¸ºæˆ‘å¯¹ C++ template çš„å­¦ä¹ æ€»ç»“, ä¸»è¦è®°å½•ä¸‹é‚£äº›æˆ‘é˜…è¯»æœ¬ä¹¦ä¹‹å‰æœªçŸ¥çš„æ–°çŸ¥è¯†å’Œè™½ç„¶æ˜¯å·²çŸ¥çš„çŸ¥è¯†ä½†å°šæœªè€ƒè™‘è¿‡çš„åœ°æ–¹ã€‚å¸Œæœ›èƒ½å¤Ÿé¡ºåˆ©å®Œæˆè¿™ä¸€ç³»åˆ—ã€‚ æ‰“ç®—åˆ† 9 éƒ¨åˆ†è®°å½•æˆ‘æ‰€å­¦åˆ°çš„ C++ template çš„çŸ¥è¯†, åˆ†åˆ«æ˜¯: [x] æ¨¡æ¿åŸºç¡€åŒ…æ‹¬å‡½æ•°æ¨¡æ¿, ç±»æ¨¡æ¿, åˆ«åæ¨¡æ¿, å˜é‡æ¨¡æ¿åŸºæœ¬çš„ç”¨æ³•, åç‰¹åŒ–å’Œå…¨ç‰¹åŒ–çš„åŸºæœ¬çŸ¥è¯†, ä»¥åŠç±»å‹æ¨å¯¼çš„åŸºæœ¬ç”¨æ³• [x] éç±»å‹æ¨¡æ¿å‚æ•°å’Œå¯å˜å‚æ•°æ¨¡æ¿åŒ…æ‹¬å°†æ•°å€¼ä½œä¸ºæ¨¡æ¿å‚æ•°çš„æŠ€æœ¯ä»¥åŠå¯å˜å‚æ•°æ¨¡æ¿æŠ€æœ¯, æ¶‰åŠåˆ°åŸºäºå¯å˜å‚æ•°æ¨¡æ¿çš„ç¼–è¯‘æ—¶é€’å½’å’Œå®ƒçš„åº”ç”¨ [x] åŸºæœ¬çš„æ¨¡æ¿ TricksåŒ…æ‹¬æœ¬ä¹¦ä»‹ç»çš„å‡ ç§å¥‡æŠ€æ·«å·§ [ ] ç§»åŠ¨è¯­ä¹‰åŒ…æ‹¬å³å€¼å¼•ç”¨, ä¸‡èƒ½å¼•ç”¨, å®Œç¾è½¬å‘çš„åŸºæœ¬çŸ¥è¯†å’Œåº”ç”¨ [ ] enable_if&lt;&gt; å’Œ SFiNAEåŒ…æ‹¬é€šè¿‡ disable æŸäº›å‚æ•°ç»„åˆçš„æ¨¡æ¿å®ä¾‹åŒ–æ¥æŒ‡å¯¼ç¼–è¯‘å™¨æ›´å¥½åœ°è¿›è¡Œé‡è½½å†³è®®çš„ enable_if&lt;&gt; å’Œå®ƒèƒŒåçš„ SFiNAE æŠ€æœ¯ [ ] å…¶ä»–å€¼å¾—è®¨è®ºçš„åœ°æ–¹åŒ…æ‹¬æŒ‰å€¼ä¼ é€’å‚æ•°å’ŒæŒ‰å¼•ç”¨ä¼ é€’å‚æ•°çš„è®¨è®º, å¯¹å­—ç¬¦ä¸²å­—é¢é‡å‚æ•°å’ŒåŸå§‹æ•°ç»„å‚æ•°çš„å¤„ç† [ ] æ¨¡æ¿å…ƒç¼–ç¨‹åŸºç¡€åŒ…æ‹¬ä½¿ç”¨éç±»å‹æ¨¡æ¿å‚æ•°å’Œç¼–è¯‘æ—¶é€’å½’æŠ€æœ¯çš„æ¨¡æ¿å…ƒç¼–ç¨‹ç¤ºä¾‹, constexpr å…³é”®å­—çš„ä½¿ç”¨, åˆ©ç”¨åç‰¹åŒ–æŠ€æœ¯å®ç°çš„æ‰§è¡Œè·¯å¾„é€‰æ‹©, ç¼–è¯‘æ—¶ if ç­‰ [ ] æ¨¡æ¿å®è·µçŸ¥è¯†åŒ…æ‹¬æ¨¡æ¿å®šä¹‰å’Œå®ç°åˆ†ç¦»å¸¦æ¥çš„é“¾æ¥å™¨é”™è¯¯, è§£å†³ç¼–è¯‘æ—¶é•¿é—®é¢˜çš„é¢„ç¼–è¯‘å¤´æŠ€æœ¯, è§£è¯»ç¼–è¯‘å™¨ä¸ºæ¨¡æ¿ç”Ÿæˆçš„å†—é•¿çš„ error novel æŠ¥é”™ä¿¡æ¯ç­‰ [ ] æ³›å‹åº“åŒ…æ‹¬æ ‡å‡†æ¨¡æ¿åº“æä¾›çš„ä¸€äº›æ³›å‹æ–¹æ³•å’ŒåŒ…æ‹¬ type traits åœ¨å†…çš„æ³›å‹åŸºç¡€è®¾æ–½","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"C++ Template","slug":"C-Template","permalink":"https://blog.zhuwenq.cc/tags/C-Template/"},{"name":"C++","slug":"C","permalink":"https://blog.zhuwenq.cc/tags/C/"}]},{"title":"A random afternoon","slug":"A-random-afternoon","date":"2022-11-05T12:56:06.000Z","updated":"2023-06-21T06:51:28.724Z","comments":true,"path":"A-random-afternoon/","link":"","permalink":"https://blog.zhuwenq.cc/A-random-afternoon/","excerpt":"Shot with Nikon D610.","text":"Shot with Nikon D610.","categories":[{"name":"Photograph","slug":"Photograph","permalink":"https://blog.zhuwenq.cc/categories/Photograph/"}],"tags":[]},{"title":"Somewhere in the campus","slug":"Somewhere-in-the-campus","date":"2022-11-05T12:45:30.000Z","updated":"2023-06-21T06:51:28.884Z","comments":true,"path":"Somewhere-in-the-campus/","link":"","permalink":"https://blog.zhuwenq.cc/Somewhere-in-the-campus/","excerpt":"Shot with Nikon D610.","text":"Shot with Nikon D610.","categories":[{"name":"Photograph","slug":"Photograph","permalink":"https://blog.zhuwenq.cc/categories/Photograph/"}],"tags":[]},{"title":"å›ç­”","slug":"å›ç­”","date":"2022-11-05T09:52:54.000Z","updated":"2023-06-21T06:51:28.940Z","comments":true,"path":"å›ç­”/","link":"","permalink":"https://blog.zhuwenq.cc/%E5%9B%9E%E7%AD%94/","excerpt":"","text":"å‘é„™æ˜¯å‘é„™è€…çš„é€šè¡Œè¯, é«˜å°šæ˜¯é«˜å°šè€…çš„å¢“å¿—é“­, çœ‹å§, åœ¨é‚£é•€é‡‘çš„å¤©ç©ºä¸­, é£˜æ»¡äº†æ­»è€…å¼¯æ›²çš„å€’å½±. å†°å·çºªè¿‡å»äº†, ä¸ºä»€ä¹ˆåˆ°å¤„éƒ½æ˜¯å†°å‡Œ? å¥½æœ›è§’å‘ç°äº†, ä¸ºä»€ä¹ˆæ­»æµ·é‡Œåƒå¸†ç›¸ç«? æˆ‘æ¥åˆ°è¿™ä¸ªä¸–ç•Œä¸Š, åªå¸¦ç€çº¸ã€ç»³ç´¢å’Œèº«å½±, ä¸ºäº†åœ¨å®¡åˆ¤ä¹‹å‰, å®£è¯»é‚£äº›è¢«åˆ¤å†³çš„å£°éŸ³. å‘Šè¯‰ä½ å§ï¼Œä¸–ç•Œ æˆ‘â€”â€”ä¸â€”â€”ç›¸â€”â€”ä¿¡! çºµä½¿ä½ è„šä¸‹æœ‰ä¸€åƒåæŒ‘æˆ˜è€…, é‚£å°±æŠŠæˆ‘ç®—ä½œç¬¬ä¸€åƒé›¶ä¸€å. æˆ‘ä¸ç›¸ä¿¡å¤©æ˜¯è“çš„, æˆ‘ä¸ç›¸ä¿¡é›·çš„å›å£°, æˆ‘ä¸ç›¸ä¿¡æ¢¦æ˜¯å‡çš„, æˆ‘ä¸ç›¸ä¿¡æ­»æ— æŠ¥åº”. å¦‚æœæµ·æ´‹æ³¨å®šè¦å†³å ¤, å°±è®©æ‰€æœ‰çš„è‹¦æ°´éƒ½æ³¨å…¥æˆ‘å¿ƒä¸­, å¦‚æœé™†åœ°æ³¨å®šè¦ä¸Šå‡, å°±è®©äººç±»é‡æ–°é€‰æ‹©ç”Ÿå­˜çš„å³°é¡¶. æ–°çš„è½¬æœºå’Œé—ªé—ªæ˜Ÿæ–—, æ­£åœ¨ç¼€æ»¡æ²¡æœ‰é®æ‹¦çš„å¤©ç©º. é‚£æ˜¯äº”åƒå¹´çš„è±¡å½¢æ–‡å­—, é‚£æ˜¯æœªæ¥äººä»¬å‡è§†çš„çœ¼ç›. åŒ—å²› ã€å›ç­” ã€","categories":[{"name":"poem","slug":"poem","permalink":"https://blog.zhuwenq.cc/categories/poem/"}],"tags":[{"name":"poem","slug":"poem","permalink":"https://blog.zhuwenq.cc/tags/poem/"}]},{"title":"Red","slug":"Red","date":"2022-11-05T09:10:33.000Z","updated":"2023-06-21T06:51:28.836Z","comments":true,"path":"Red/","link":"","permalink":"https://blog.zhuwenq.cc/Red/","excerpt":"Shot with Nikon D610.","text":"Shot with Nikon D610.","categories":[{"name":"Photograph","slug":"Photograph","permalink":"https://blog.zhuwenq.cc/categories/Photograph/"}],"tags":[]},{"title":"å®£å‘Š","slug":"å®£å‘Š","date":"2022-10-28T06:23:51.000Z","updated":"2023-06-21T06:51:28.940Z","comments":true,"path":"å®£å‘Š/","link":"","permalink":"https://blog.zhuwenq.cc/%E5%AE%A3%E5%91%8A/","excerpt":"","text":"ä¹Ÿè®¸æœ€åçš„æ—¶åˆ»åˆ°äº† æˆ‘æ²¡æœ‰ç•™ä¸‹é—å˜± åªç•™ä¸‹ç¬”, ç»™æˆ‘çš„æ¯äº² æˆ‘å¹¶ä¸æ˜¯è‹±é›„ åœ¨æ²¡æœ‰è‹±é›„çš„å¹´ä»£é‡Œ, æˆ‘åªæƒ³åšä¸€ä¸ªäººã€‚ å®é™çš„åœ°å¹³çº¿ åˆ†å¼€äº†ç”Ÿè€…å’Œæ­»è€…çš„è¡Œåˆ— æˆ‘åªèƒ½é€‰æ‹©å¤©ç©º ç»ä¸è·ªåœ¨åœ°ä¸Š ä»¥æ˜¾å‡ºåˆ½å­æ‰‹çš„é«˜å¤§ å¥½é˜»æŒ¡é‚£è‡ªç”±çš„é£ ä»æ˜Ÿæ˜Ÿçš„å¼¹å­”é‡Œ å°†æµå‡ºè¡€çº¢çš„é»æ˜ åŒ—å²› ã€çŒ®ç»™é‡ç½—å…‹ ã€","categories":[{"name":"poem","slug":"poem","permalink":"https://blog.zhuwenq.cc/categories/poem/"}],"tags":[{"name":"poem","slug":"poem","permalink":"https://blog.zhuwenq.cc/tags/poem/"}]},{"title":"BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding","slug":"BERT-Pre-training-of-Deep-Bidirectional-Transformers-for-Language-Understanding","date":"2022-04-23T16:00:00.000Z","updated":"2023-06-21T06:51:28.780Z","comments":true,"path":"BERT-Pre-training-of-Deep-Bidirectional-Transformers-for-Language-Understanding/","link":"","permalink":"https://blog.zhuwenq.cc/BERT-Pre-training-of-Deep-Bidirectional-Transformers-for-Language-Understanding/","excerpt":"Introduction BERT æ˜¯ä¸€ç§æ–°çš„è¯­è¨€è¡¨å¾æ¨¡å‹ï¼Œå®ƒæ˜¯ä¸€ç§åŒå‘ç¼–ç å™¨è¡¨å¾çš„Transformersæ¨¡å‹(Bidirectional Encoder Representions from Transformers) BERT åˆ©ç”¨äº†æ— æ ‡ç­¾é¢„è®­ç»ƒæ–‡æœ¬æ•°æ®çš„å·¦å³ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè®­ç»ƒå‡ºä¸€ä¸ªæ·±åº¦åŒå‘è¡¨å¾æ¨¡å‹ã€‚é¢„è®­ç»ƒåçš„æ¨¡å‹å¯ä»¥é€šè¿‡ä¸€ä¸ªé¢å¤–çš„è¾“å‡ºå±‚å¹¶å¾®è°ƒåˆ°å¤šä¸ªä¸‹æ¸¸ä»»åŠ¡ï¼Œå¹¶å–å¾— state-of-the-art çš„ç»“æœã€‚ æœ¬æ–‡ä¸­ï¼ŒBERTé€šè¿‡ä½¿ç”¨â€œæ©ç è¯­è¨€æ¨¡å‹(Masked Language Model, MLM)â€ä½œä¸ºé¢„è®­ç»ƒç›®æ ‡å‡½æ•°ï¼Œç¼“è§£äº†å•å‘æ€§çº¦æŸï¼Œæ”¹è¿›äº†åŸºäºå¾®è°ƒçš„æ–¹æ³•ã€‚MLMå³éšæœºåœ°å°†è¾“å…¥ä¸­çš„ä¸€äº›tokenæ›¿æ¢ä¸ºæ©ç ï¼Œå¹¶ä¸”ç›®æ ‡æ˜¯åŸºäºä¸Šä¸‹æ–‡é¢„æµ‹è¢«æ©ç ä½ç½®tokençš„åŸå§‹è¯å…¸idã€‚è¿™ç§ç›®æ ‡å‡½æ•°ä½¿è¡¨å¾æœ‰èƒ½åŠ›èåˆå·¦å³ä¸Šä¸‹æ–‡çš„ä¿¡æ¯ï¼Œä»è€Œä½¿è®­ç»ƒä¸€ä¸ªæ·±åº¦åŒå‘Transformeræˆä¸ºå¯èƒ½ã€‚ BERTæ˜¯ç¬¬ä¸€ä¸ªåœ¨å¤§é‡å¥çº§å’Œè¯çº§ä»»åŠ¡ä¸Šå–å¾—æœ€ä¼˜ç»“æœçš„åŸºäºå¾®è°ƒçš„è¡¨å¾æ¨¡å‹ï¼Œä¼˜äºè®¸å¤šç‰¹å®šäºä»»åŠ¡çš„ä½“ç³»ç»“æ„ã€‚","text":"Introduction BERT æ˜¯ä¸€ç§æ–°çš„è¯­è¨€è¡¨å¾æ¨¡å‹ï¼Œå®ƒæ˜¯ä¸€ç§åŒå‘ç¼–ç å™¨è¡¨å¾çš„Transformersæ¨¡å‹(Bidirectional Encoder Representions from Transformers) BERT åˆ©ç”¨äº†æ— æ ‡ç­¾é¢„è®­ç»ƒæ–‡æœ¬æ•°æ®çš„å·¦å³ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè®­ç»ƒå‡ºä¸€ä¸ªæ·±åº¦åŒå‘è¡¨å¾æ¨¡å‹ã€‚é¢„è®­ç»ƒåçš„æ¨¡å‹å¯ä»¥é€šè¿‡ä¸€ä¸ªé¢å¤–çš„è¾“å‡ºå±‚å¹¶å¾®è°ƒåˆ°å¤šä¸ªä¸‹æ¸¸ä»»åŠ¡ï¼Œå¹¶å–å¾— state-of-the-art çš„ç»“æœã€‚ æœ¬æ–‡ä¸­ï¼ŒBERTé€šè¿‡ä½¿ç”¨â€œæ©ç è¯­è¨€æ¨¡å‹(Masked Language Model, MLM)â€ä½œä¸ºé¢„è®­ç»ƒç›®æ ‡å‡½æ•°ï¼Œç¼“è§£äº†å•å‘æ€§çº¦æŸï¼Œæ”¹è¿›äº†åŸºäºå¾®è°ƒçš„æ–¹æ³•ã€‚MLMå³éšæœºåœ°å°†è¾“å…¥ä¸­çš„ä¸€äº›tokenæ›¿æ¢ä¸ºæ©ç ï¼Œå¹¶ä¸”ç›®æ ‡æ˜¯åŸºäºä¸Šä¸‹æ–‡é¢„æµ‹è¢«æ©ç ä½ç½®tokençš„åŸå§‹è¯å…¸idã€‚è¿™ç§ç›®æ ‡å‡½æ•°ä½¿è¡¨å¾æœ‰èƒ½åŠ›èåˆå·¦å³ä¸Šä¸‹æ–‡çš„ä¿¡æ¯ï¼Œä»è€Œä½¿è®­ç»ƒä¸€ä¸ªæ·±åº¦åŒå‘Transformeræˆä¸ºå¯èƒ½ã€‚ BERTæ˜¯ç¬¬ä¸€ä¸ªåœ¨å¤§é‡å¥çº§å’Œè¯çº§ä»»åŠ¡ä¸Šå–å¾—æœ€ä¼˜ç»“æœçš„åŸºäºå¾®è°ƒçš„è¡¨å¾æ¨¡å‹ï¼Œä¼˜äºè®¸å¤šç‰¹å®šäºä»»åŠ¡çš„ä½“ç³»ç»“æ„ã€‚ Background è¯­è¨€æ¨¡å‹é¢„è®­ç»ƒåœ¨æå‡NLPä»»åŠ¡ä¸Šååˆ†æœ‰æ•ˆã€‚åœ¨æŠŠé¢„è®­ç»ƒæ¨¡å‹åº”ç”¨åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸Šï¼Œç›®å‰æœ‰ä¸¤ç§ç­–ç•¥ï¼š feature-based å’Œ fine-tuning ã€‚åŸºäºç‰¹å¾çš„æ–¹æ³•ï¼Œå¦‚ ELMo ï¼Œä½¿ç”¨ç‰¹å®šäºä»»åŠ¡çš„æ¶æ„ä½œä¸ºé¢å¤–çš„ç‰¹å¾ï¼Œå…¶ä¸­åŒ…æ‹¬é¢„è®­ç»ƒè¡¨å¾ã€‚åŸºäºå¾®è°ƒçš„æ–¹æ³•ï¼Œå¦‚ GPT å¼•å…¥äº†æœ€å°ç‰¹å®šäºä»»åŠ¡çš„å‚æ•°ï¼Œå¹¶ä¸”åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸Šé€šè¿‡å¾®è°ƒæ‰€æœ‰çš„é¢„è®­ç»ƒå‚æ•°æ¥è¿›è¡Œè®­ç»ƒã€‚è¿™ä¸¤ç±»æ–¹æ³•åœ¨é¢„è®­ç»ƒæ—¶ä½¿ç”¨åŒæ ·çš„ç›®æ ‡å‡½æ•°ï¼šåˆ©ç”¨å•å‘è¯­è¨€æ¨¡å‹æ¥å­¦ä¹ é€šç”¨è¯­è¨€è¡¨å¾ã€‚ æˆ‘ä»¬è®¤ä¸ºç°æœ‰çš„æŠ€æœ¯é™åˆ¶äº†é¢„è®­ç»ƒè¡¨å¾çš„èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¾®è°ƒçš„æ–¹æ³•ã€‚ä¸»è¦è¡¨ç°åœ¨å•å‘çš„æ ‡å‡†è¯­è¨€æ¨¡å‹é™åˆ¶äº†é¢„è®­ç»ƒæ—¶æ¨¡å‹çš„æ¶æ„é€‰æ‹©ã€‚è¿™æ ·çš„é™åˆ¶å¯¹äºå¥çº§(sentence-level)çš„ä»»åŠ¡é€šå¸¸æ˜¯æ¬¡ä¼˜çš„ï¼Œå¯¹äºè¯çº§(token-level)çš„ä»»åŠ¡é€šå¸¸ååˆ†æœ‰å®³ã€‚ æ— ç›‘ç£çš„å¾®è°ƒæ–¹æ³•ä¸­ï¼Œç”¨äºç”Ÿæˆä¸‹æ–‡tokenè¡¨å¾çš„æ–‡æ¡£æˆ–å¥å­ç¼–ç å™¨ä»æ— æ ‡ç­¾çš„æ–‡æœ¬ä¸­é¢„è®­ç»ƒï¼Œå¹¶é’ˆå¯¹æœ‰ç›‘ç£çš„ä¸‹æ¸¸ä»»åŠ¡è¿›è¡Œå¾®è°ƒã€‚è¿™æ ·åšçš„ä¼˜åŠ¿åœ¨äºåªæœ‰å¾ˆå°‘çš„å‚æ•°éœ€è¦ä»é›¶å¼€å§‹å­¦ä¹ ã€‚åœ¨è¿™ç§æ¨¡å‹çš„é¢„è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä½¿ç”¨è‡ªå·¦å‘å³çš„è¯­è¨€å»ºæ¨¡å’Œè‡ªåŠ¨ç¼–ç å™¨ç›®æ ‡å‡½æ•°ã€‚ BERT BERTæå‡ºçš„æ¡†æ¶åˆ†ä¸ºä¸¤æ­¥ï¼šé¢„è®­ç»ƒå’Œå¾®è°ƒã€‚åœ¨é¢„è®­ç»ƒä¸­ï¼Œæ¨¡å‹é€šè¿‡ä¸åŒçš„é¢„è®­ç»ƒä»»åŠ¡åœ¨æ— æ ‡ç­¾çš„æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒã€‚åœ¨å¾®è°ƒæ—¶ï¼Œæ¨¡å‹é¦–å…ˆä½¿ç”¨é¢„è®­ç»ƒå¾—åˆ°çš„å‚æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶åæ‰€æœ‰çš„å‚æ•°éƒ½ä½¿ç”¨æœ‰æ ‡ç­¾çš„ä¸‹æ¸¸ä»»åŠ¡æ•°æ®è¿›è¡Œå¾®è°ƒã€‚æ¯ä¸€ç§ä¸‹æ¸¸ä»»åŠ¡éƒ½ä½¿ç”¨ç›¸åŒçš„é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶ååˆ†åˆ«å¾®è°ƒã€‚ æ¨¡å‹æ¶æ„ BERTçš„æ¨¡å‹æ¶æ„æ˜¯ä¸€ä¸ªå¤šå±‚åŒå‘Transformerç¼–ç å™¨ã€‚ å‡è®¾å±‚æ•°(å³Transformer blocks)ä¸º LLL ï¼Œéšè—å±‚å°ºå¯¸ä¸º HHHï¼Œself-attention headsæ•°é‡ä¸º AAAã€‚åˆæ­¥è®¾è®¡äº†ä¸¤ç§å°ºå¯¸çš„æ¨¡å‹ï¼š BERTBASE(L=12, H=768, A=12, Total Parameters=110M)\\text{BERT}_\\text{BASE}(\\text{L=12, H=768, A=12, Total Parameters=110M})BERTBASEâ€‹(L=12, H=768, A=12, Total Parameters=110M)å’Œ BERTLARGE(L=24, H=1024, A=16, Total Parameters=340M)\\text{BERT}_\\text{LARGE}(\\text{L=24, H=1024, A=16, Total Parameters=340M})BERTLARGEâ€‹(L=24, H=1024, A=16, Total Parameters=340M) è¾“å…¥è¾“å‡ºè¡¨å¾ é’ˆå¯¹ä¸åŒçš„ä¸‹æ¸¸ä»»åŠ¡éœ€è¦ï¼ŒBERTå¯ä»¥æ¸…æ™°åœ°å°†ä¸€ä¸ªå•ç‹¬çš„å¥å­æˆ–ä¸€ä¸ªå¥å­å¯¹è¡¨ç¤ºä¸ºä¸€ä¸ªåºåˆ—ã€‚å…¶ä¸­ï¼Œå¥å­å¯ä»¥æŒ‡ä¸€æ®µæ–‡æœ¬ä¸­çš„ä»»åŠ¡è·¨åº¦ï¼Œè€Œä¸ä»…ä»…æ˜¯å®é™…çš„è¯­è¨€å¥å­ã€‚ä¸€ä¸ªåºåˆ—æŒ‡è¾“å…¥åˆ°BERTçš„tokenåºåˆ—ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå•ç‹¬çš„å¥å­æˆ–ä¸¤ä¸ªå¥å­æ‰“åŒ…åœ¨ä¸€èµ·ã€‚ æ¯ä¸€ä¸ªåºåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªtokenæ€»æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åˆ†ç±»tokenï¼š[CLS]ï¼Œå¯¹åº”çš„æœ€ç»ˆéšè—çŠ¶æ€ç”¨äºåˆ†ç±»ä»»åŠ¡ä¸­ä½œä¸ºåºåˆ—çš„æ€»ä½“ç±»å‹è¡¨ç¤ºã€‚å¯¹äºæ‰“åŒ…åœ¨ä¸€èµ·çš„å¥å­å¯¹ï¼Œä½¿ç”¨ä¸¤ç§æ–¹æ³•å¯¹å…¶è¿›è¡ŒåŒºåˆ†ï¼š1. å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„token [SEP]ä½œä¸ºåˆ†æ®µæ ‡å¿—ã€‚2. ä¸ºæ¯ä¸ªtokenæ·»åŠ ä¸€ä¸ªå¯å­¦ä¹ çš„embeddingæ¥æŒ‡ç¤ºè¿™ä¸ªtokenå±äºå¥å­Aæˆ–å¥å­B å‡è®¾è¾“å…¥embeddingæ˜¯ EEEï¼Œç‰¹æ®Štoken [CLS]çš„æœ€ç»ˆéšè—å‘é‡æ˜¯ CâˆˆRHC\\in \\mathbb{R}^HCâˆˆRHï¼Œç¬¬ iii ä¸ªè¾“å…¥tokençš„æœ€ç»ˆéšè—å‘é‡ä¸º TiâˆˆRHT_i\\in \\mathbb{R}^HTiâ€‹âˆˆRH å¯¹äºä¸€ä¸ªè¾“å…¥tokenï¼Œå®ƒçš„è¡¨å¾ç”±å¯¹åº”çš„token embedding, åˆ†æ®µembeddingå’Œä½ç½®embeddingçš„åŠ å’Œæ„æˆã€‚ é¢„è®­ç»ƒ BERTçš„é¢„è®­ç»ƒä½¿ç”¨ä¸¤ç§æ— ç›‘ç£ä»»åŠ¡ï¼š Masked LM : ç›´è§‰ä¸Šæ¥è¯´ï¼Œæ·±åº¦åŒå‘æ¨¡å‹æ¯”å•å‘æ¨¡å‹æˆ–è€…ä¸¤ä¸ªå•å‘æ¨¡å‹è¿æ¥çš„æ•ˆæœæ›´å¥½ã€‚ä½†æ˜¯ï¼Œæ ‡å‡†çš„æ¡ä»¶è¯­è¨€æ¨¡å‹åªèƒ½æ˜¯å•å‘çš„ã€‚è¿™æ˜¯å› ä¸ºæ ‡å‡†è¯­è¨€æ¨¡å‹æ˜¯ä»¥é¢„æµ‹å½“å‰è¯ä¸ºç›®æ ‡ï¼Œè€ŒåŒå‘æ¨¡å‹å°†å…è®¸æ¯ä¸ªè¯â€œçœ‹åˆ°è‡ªå·±â€ï¼Œè¿™æ ·æ¨¡å‹å°±å¯ä»¥åœ¨å¤šå±‚ä¸Šä¸‹æ–‡ä¸­ç›´æ¥ç»™å‡ºç›®æ ‡è¯ã€‚ ä¸ºäº†è®­ç»ƒåŒå‘è¡¨å¾ï¼ŒBERTä½¿ç”¨MLMï¼š æ©ç tokenæœ€ç»ˆçš„éšè—å‘é‡è¢«é¦ˆé€åˆ°è¯å…¸ä¸Šçš„è¾“å‡ºsoftmaxä¸­ã€‚ è¿™ç§è®­ç»ƒç›®æ ‡å¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šåœ¨é¢„è®­ç»ƒå’Œå¾®è°ƒä¹‹é—´å½¢æˆäº†å‰²è£‚â€”â€”åœ¨å¾®è°ƒä¸­ä¸å­˜åœ¨æ‰€è°“çš„æ©ç ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯æ€»æ˜¯å°†æ©ç ä½ç½®çš„tokenæ›¿æ¢ä¸º[MASK]ï¼Œè€Œæ˜¯ä»¥ä¸‹è¿°è§„åˆ™è¿›è¡Œæ©ç æ“ä½œï¼š ç„¶åï¼Œ TiT_iTiâ€‹ è¢«ç”¨äºä½¿ç”¨äº¤å‰ç†µé¢„æµ‹åŸå§‹çš„token Next Sentence Prediction, NSP (åç»­çš„å·¥ä½œè®¤ä¸ºè¯¥ä»»åŠ¡æ— æ•ˆ)ï¼š å…·ä½“åœ°è¯´ï¼Œé€‰æ‹©ä¸¤ä¸ªå¥å­Aï¼ŒBä½œä¸ºä¸€ä¸ªé¢„è®­ç»ƒæ ·æœ¬ã€‚50%çš„æ—¶é—´Bæ˜¯Açš„ä¸‹ä¸€å¥(æ ‡è®°ä¸º IsNext\\text{IsNext}IsNext)ï¼Œå¦å¤–50%çš„æ—¶é—´ä¸æ˜¯(æ ‡è®°ä¸º NotNext\\text{NotNext}NotNext)ã€‚ä¸Šæ–‡æ‰€è¿°çš„å¯¹åº”äºç‰¹æ®Štoken [CLS]çš„æœ€ç»ˆéšè—å‘é‡ç”¨äºNSPä»»åŠ¡ï¼Œå…¶å€¼ç»è¿‡softmaxå¾—åˆ°NSPçš„é¢„æµ‹æ¦‚ç‡ã€‚ å¾®è°ƒ å¾®è°ƒçš„è¿‡ç¨‹å³åœ¨é¢„è®­ç»ƒåçš„BERTæ¨¡å‹ä¸Šæ·»åŠ ä¸€ä¸ªç®€å•çš„åˆ†ç±»å±‚ï¼Œç„¶ååœ¨ä¸‹æ¸¸ä»»åŠ¡æ•°æ®ä¸Šè°ƒæ•´æ‰€æœ‰çš„å‚æ•°ã€‚ å¯¹äºæ¯ä¸ªä¸‹æ¸¸ä»»åŠ¡ï¼Œ åªéœ€è¦ç®€å•åœ°æ’å…¥ç‰¹å®šäºä»»åŠ¡çš„è¾“å…¥è¾“å‡ºæ•°æ®å¹¶ç«¯åˆ°ç«¯å¾®è°ƒæ‰€æœ‰çš„å‚æ•°ã€‚ Evaluation","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"PLM","slug":"PLM","permalink":"https://blog.zhuwenq.cc/tags/PLM/"},{"name":"NLP","slug":"NLP","permalink":"https://blog.zhuwenq.cc/tags/NLP/"},{"name":"BERT","slug":"BERT","permalink":"https://blog.zhuwenq.cc/tags/BERT/"}]},{"title":"A Brief Introduction to PLMs","slug":"A-Brief-Introduction-to-PLMs","date":"2022-04-22T08:00:55.000Z","updated":"2023-06-21T06:51:28.712Z","comments":true,"path":"A-Brief-Introduction-to-PLMs/","link":"","permalink":"https://blog.zhuwenq.cc/A-Brief-Introduction-to-PLMs/","excerpt":"Introduction to PLMs","text":"Introduction to PLMs Think Language Modeling as Representation Learning è‡ª [@Bengio2003] å°†å‰é¦ˆç¥ç»ç½‘ç»œå¼•å…¥è‡ªç„¶è¯­è¨€å¤„ç†ä»¥æ¥ï¼Œè¡¨å¾å­¦ä¹ å°±æ˜¯è¯­è¨€å»ºæ¨¡çš„ä¸»è¦æ€æƒ³ã€‚é€šå¸¸è®¤ä¸ºï¼Œå¥½çš„è¯­è¨€è¡¨å¾åº”è¯¥èƒ½å¤Ÿæ•æ‰åˆ°æ–‡æœ¬çš„è¡¨å±‚è¯­æ³•ä¿¡æ¯å’Œéšå¼çš„è¯­ä¹‰çŸ¥è¯†ã€‚åŸºäº [[Attention-is-all-you-need|Transformer]] çš„ PLMs å®é™…ä¸Šå°±æ˜¯åˆ©ç”¨ self-attention çš„åºåˆ—å»ºæ¨¡èƒ½åŠ›å­¦ä¹ ä¸Šä¸‹æ–‡è¡¨å¾ã€‚ å¯¹äºé•¿åº¦ä¸º LLL çš„è‡ªç„¶è¯­è¨€è¯­å¥ s={x1,x2,...,xL}\\mathbf{s}=\\{x_1, x_2, ..., x_L\\}s={x1â€‹,x2â€‹,...,xLâ€‹}, å…¶ä¸­ xix_ixiâ€‹ æ˜¯è‡ªç„¶è¯­è¨€ tokenï¼Œè¡¨å¾è®¡ç®—å³å¦‚ä¸‹çš„è¿‡ç¨‹ï¼š [h1,h2,...,hL]=Encoder(x1,x2,...,xL)[\\mathbf{h}_1, \\mathbf{h}_2, ..., \\mathbf{h}_L] = \\text{Encoder}(\\mathbf{x}_1, \\mathbf{x}_2, ..., \\mathbf{x}_L) [h1â€‹,h2â€‹,...,hLâ€‹]=Encoder(x1â€‹,x2â€‹,...,xLâ€‹) å…¶ä¸­ xi\\mathbf{x}_ixiâ€‹ æ˜¯ token xix_ixiâ€‹ çš„åµŒå…¥å‘é‡ï¼Œhi\\mathbf{h}_ihiâ€‹ æ˜¯ xix_ixiâ€‹ çš„è¡¨å¾ï¼ŒEncoder\\text{Encoder}Encoder æ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œç¼–ç å™¨ã€‚ é€šå¸¸ï¼ŒEncoder\\text{Encoder}Encoder æ˜¯å¤šå±‚å †å ç»“æ„ï¼Œæ ¹æ®æ¯å±‚ä¸­çš„åŸºæœ¬è®¡ç®—å•å…ƒå¯ä»¥å°†å…¶åˆ†ä¸ºä¸‰ç±»ï¼š Convolutional Language Encoder å·ç§¯ç¼–ç å™¨é€šå¸¸ç”¨æ¥æ•æ‰å±€éƒ¨ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå…¶è®¡ç®—è¿‡ç¨‹ä¸ºï¼š hi=CNN(xiâˆ’k:i+k)\\mathbf{h}_i = \\text{CNN}(\\mathbf{x}_{i-k : i+k}) hiâ€‹=CNN(xiâˆ’k:i+kâ€‹) å…¶ä¸­ï¼Œxiâˆ’k:i+k\\mathbf{x}_{i-k:i+k}xiâˆ’k:i+kâ€‹ æ˜¯ token xix_ixiâ€‹ çš„ 2k2k2k é‚»åŸŸå†… tokens åµŒå…¥å‘é‡çš„æ‹¼æ¥çŸ©é˜µï¼Œ2k2k2k æ˜¯å·ç§¯æ ¸çš„å°ºå¯¸ã€‚ä¸éš¾çœ‹å‡ºï¼Œæ¯å±‚çš„å·ç§¯æ“ä½œåªèƒ½æ•æ‰ä¸€ä¸ªæœ‰é™çš„é‚»åŸŸå†…çš„ä¿¡æ¯ï¼Œé•¿ç¨‹ä¿¡æ¯åªèƒ½é€šè¿‡å¤šå±‚å·ç§¯é—´æ¥è·å¾— Recurrent Language Encoder RNN æ˜¯åœ¨ [[Attention-is-all-you-need|Transformer]] ç½‘ç»œä¹‹å‰ NLP çš„ä¸»æµç½‘ç»œç»“æ„ï¼Œç”±äº RNN å­˜åœ¨çš„æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸é—®é¢˜ï¼Œé€šå¸¸ä½¿ç”¨çš„è®¡ç®—å•å…ƒæ˜¯å…¶å˜ä½“ LSTM([@hochreiter1997]) å’Œ GRU([@chung2014]). å…¶è®¡ç®—è¿‡ç¨‹ä¸ºï¼š hi=RNN(hiâˆ’1,xi)\\mathbf{h}_i = \\text{RNN}(\\mathbf{h}_{i-1}, \\mathbf{x}_i) hiâ€‹=RNN(hiâˆ’1â€‹,xiâ€‹) å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºè¾“å…¥åºåˆ—, RNN å¿…é¡»é€ token çš„é¡ºåºè®¡ç®—ï¼šç¬¬ iii ä¸ª token çš„è¡¨å¾è®¡ç®—ä¾èµ–äºç¬¬ iâˆ’1i - 1iâˆ’1 ä¸ª token çš„è¡¨å¾, å› æ­¤æ— æ³•æœ‰æ•ˆå¹¶è¡Œã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒRNN åªèƒ½å»ºæ¨¡å•å‘(L2R)ä¾èµ–ï¼Œé™¤éåŒæ—¶å¯¹é€†åºçš„è¾“å…¥åºåˆ—å†ä½¿ç”¨ä¸€æ¬¡ RNN è®¡ç®—(e.g., [@Peters2018]). Self-Attention Lanugage Encoder Self-Attention mechanism å¯ä»¥ç®€è¿°ä¸ºï¼šåœ¨è¿›è¡Œåºåˆ—è¡¨å¾å­¦ä¹ (åºåˆ—å»ºæ¨¡)æ—¶ï¼Œè®©æ¨¡å‹è‡ªåŠ¨é€‰æ‹©åŸºäºè¯¥åºåˆ— (Self) çš„å“ªäº›éƒ¨åˆ†è¿›è¡Œè®¡ç®—ï¼Œå³ï¼š hi=âˆ‘j=1LÎ±ijxj\\mathbf{h}_i=\\sum_{j=1}^L\\alpha_{ij}\\mathbf{x}_j hiâ€‹=j=1âˆ‘Lâ€‹Î±ijâ€‹xjâ€‹ å…¶ä¸­çš„ xi\\mathbf{x}_ixiâ€‹ æ˜¯åµŒå…¥å‘é‡æˆ–æ¨¡å‹ä¸Šä¸€å±‚çš„è¡¨å¾ï¼Œhi\\mathbf{h}_ihiâ€‹ å¯ä»¥è®¤ä¸ºæ˜¯ç›¸å¯¹äº x\\mathbf{x}x çš„ä¸Šä¸‹æ–‡è¡¨å¾ï¼ŒÎ±ij\\alpha_{ij}Î±ijâ€‹ åˆ™æ˜¯ attention å‚æ•°ï¼Œè¢«è®¤ä¸ºå»ºæ¨¡äº† token iii å’Œ jjj ä¹‹é—´çš„å…³ç³»ã€‚ [Attention-is-all-you-need|Transformer] Layer ç”±ä¸¤ä¸ªå­å±‚ï¼šSelf-Attention Sublayer å’Œ Feed-Forward Sublayer ç»„æˆï¼Œæ¯ä¸ªå­å±‚è¿˜ä½¿ç”¨äº† Residual Connection ([@He2016])å’Œ [[LayerNormalization|Layer Normalization]] ([@Ba2016]). Attention Layer Attention Layer çš„æ ¸å¿ƒåœ¨äºHow to attention: å³å¦‚ä½•è®¡ç®—ä¸Šæ–‡è¯´åˆ°çš„ Î±ij\\alpha_{ij}Î±ijâ€‹. Transformer ä½¿ç”¨ Query-Key-Value(Q, K, V) æ¨¡å‹å®ç° Î±ij\\alpha_{ij}Î±ijâ€‹ çš„è®¡ç®—ã€‚ ä¸‹é¢é¦–å…ˆä»‹ç» Scaled dot-product attention çš„è®¡ç®—è¿‡ç¨‹ï¼Œç„¶åè§£é‡Šå…¶ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Œæœ€åä»‹ç» transformer çš„ attention sublayer ä¸­ä½¿ç”¨çš„ multi-head attention çš„è®¡ç®—è¿‡ç¨‹ã€‚ Scaled dot-product attention é¦–å…ˆè®¡ç®— Q,K,V\\mathbf{Q}, \\mathbf{K}, \\mathbf{V}Q,K,Vï¼š Q,K,V=XWQ,XWK,XWV\\mathbf{Q}, \\mathbf{K}, \\mathbf{V} = \\mathbf{X}\\mathbf{W}^Q, \\mathbf{X}\\mathbf{W}^K, \\mathbf{X}\\mathbf{W}^V Q,K,V=XWQ,XWK,XWV X=concat(x1,x2,...,xL)\\mathbf{X} = \\text{concat}(\\mathbf{x}_1, \\mathbf{x}_2, ..., \\mathbf{x}_L)X=concat(x1â€‹,x2â€‹,...,xLâ€‹) æ˜¯è¾“å…¥æ–‡æœ¬åµŒå…¥å‘é‡çš„æ‹¼æ¥ï¼ŒWQ,WK,WV\\mathbf{W}^Q, \\mathbf{W}^K, \\mathbf{W}^VWQ,WK,WV æ˜¯æŠ•å½±çŸ©é˜µï¼Œä¹Ÿæ˜¯æ¨¡å‹å‚æ•° self-attention é€šè¿‡ä»¥ä¸‹è¿‡ç¨‹è®¡ç®—è¡¨å¾ï¼š H=Attn(Q,K,V)=softmax(QKâŠ¤dk)V\\mathbf{H}=\\text{Attn}(\\mathbf{Q}, \\mathbf{K}, \\mathbf{V}) = \\text{softmax}(\\frac{\\mathbf{QK}^\\top}{\\sqrt{d_k}})\\mathbf{V} H=Attn(Q,K,V)=softmax(dkâ€‹â€‹QKâŠ¤â€‹)V å…¶ä¸­ dkd_kdkâ€‹ æ˜¯æ¨¡å‹ç»´åº¦ï¼ŒHâˆˆRLÃ—dk\\mathbf{H}\\in\\mathbb{R}^{L\\times d_k}HâˆˆRLÃ—dkâ€‹ æ˜¯è¾“å‡ºè¡¨å¾çš„æ‹¼æ¥çŸ©é˜µï¼Œå³ï¼šhi=H[i,:] for iâˆˆ[1,L]\\mathbf{h}_i = \\mathbf{H}[i, :]\\text{ for }i\\in[1, L]hiâ€‹=H[i,:] for iâˆˆ[1,L] ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ å›å¿†ä¸Šæ–‡æ‰€è¯´çš„ attention è¿‡ç¨‹å³é€‰æ‹©åºåˆ—çš„æŸäº›éƒ¨åˆ†çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆ Query-Key-Value æ¨¡å‹åˆ™æ˜¯åœ¨æ¨¡æ‹Ÿè¯¥é€‰æ‹©è¿‡ç¨‹ã€‚ é¦–å…ˆæ˜ç¡®ä¸€ä¸ªæ¦‚å¿µï¼šçŸ©é˜µç›¸ä¹˜å³ç›¸ä¼¼åº¦è®¡ç®—ã€‚ ç„¶åè€ƒè™‘ attention çš„è®¡ç®—è¿‡ç¨‹çš„ç®€åŒ–ç‰ˆï¼š Attn(X)=softmax(XXâŠ¤)X\\text{Attn}(\\mathbf{X}) = \\text{softmax}(\\mathbf{XX}^\\top)\\mathbf{X} Attn(X)=softmax(XXâŠ¤)X å…¶ä¸­ X=[x1;x2;...;xL]\\mathbf{X} = [\\mathbf{x}_1; \\mathbf{x}_2; ...; \\mathbf{x}_L]X=[x1â€‹;x2â€‹;...;xLâ€‹], xi\\mathbf{x}_ixiâ€‹ æ˜¯ dkd_kdkâ€‹ ç»´è¡Œå‘é‡ï¼Œä»£è¡¨ token iii çš„åµŒå…¥å‘é‡ã€‚ åˆ†æå…¶è¡Œä¸ºï¼š XXâŠ¤=[x1x2â‹®xL]â‹…[x1âŠ¤,x2âŠ¤,â‹¯ ,xLâŠ¤]=[x1x1âŠ¤x1x2âŠ¤â‹¯x1xLâŠ¤x2x1âŠ¤x2x2âŠ¤â‹¯x2xLâŠ¤â‹®â‹®â‹±â‹®xLx1âŠ¤xLx2âŠ¤â‹¯xLxLâŠ¤]âˆˆRLÃ—L\\begin{aligned} \\mathbf{XX}^\\top &amp;= \\left[\\begin{matrix} \\mathbf{x}_1\\\\ \\mathbf{x}_2\\\\ \\vdots\\\\ \\mathbf{x}_L \\end{matrix}\\right]\\cdot [\\mathbf{x}_1^\\top, \\mathbf{x}_2^\\top, \\cdots, \\mathbf{x}_L^\\top]\\\\ &amp;=\\left[\\begin{matrix} &amp;\\mathbf{x}_1\\mathbf{x}_1^\\top &amp;\\mathbf{x}_1\\mathbf{x}_2^\\top &amp;\\cdots &amp;\\mathbf{x}_1\\mathbf{x}_L^\\top\\\\ &amp;\\mathbf{x}_2\\mathbf{x}_1^\\top &amp;\\mathbf{x}_2\\mathbf{x}_2^\\top &amp;\\cdots &amp;\\mathbf{x}_2\\mathbf{x}_L^\\top\\\\ &amp;\\vdots &amp;\\vdots &amp;\\ddots &amp;\\vdots\\\\ &amp;\\mathbf{x}_L\\mathbf{x}_1^\\top &amp;\\mathbf{x}_L\\mathbf{x}_2^\\top &amp;\\cdots &amp;\\mathbf{x}_L\\mathbf{x}_L^\\top \\end{matrix}\\right]\\\\ &amp;\\in\\mathbb{R}^{L\\times L} \\end{aligned}XXâŠ¤â€‹=â£â¢â¢â¢â¢â¡â€‹x1â€‹x2â€‹â‹®xLâ€‹â€‹â¦â¥â¥â¥â¥â¤â€‹â‹…[x1âŠ¤â€‹,x2âŠ¤â€‹,â‹¯,xLâŠ¤â€‹]=â£â¢â¢â¢â¢â¡â€‹â€‹x1â€‹x1âŠ¤â€‹x2â€‹x1âŠ¤â€‹â‹®xLâ€‹x1âŠ¤â€‹â€‹x1â€‹x2âŠ¤â€‹x2â€‹x2âŠ¤â€‹â‹®xLâ€‹x2âŠ¤â€‹â€‹â‹¯â‹¯â‹±â‹¯â€‹x1â€‹xLâŠ¤â€‹x2â€‹xLâŠ¤â€‹â‹®xLâ€‹xLâŠ¤â€‹â€‹â¦â¥â¥â¥â¥â¤â€‹âˆˆRLÃ—Lâ€‹ æ˜¾ç„¶, xiâ‹…xjâŠ¤\\mathbf{x}_i\\cdot\\mathbf{x}_j^\\topxiâ€‹â‹…xjâŠ¤â€‹ çš„ç»“æœè¡¨å¾çš„æ˜¯å‘é‡ xi\\mathbf{x}_ixiâ€‹ å’Œ xj\\mathbf{x}_jxjâ€‹ ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚äºæ˜¯ XXijâŠ¤\\mathbf{XX}^\\top_{ij}XXijâŠ¤â€‹ å…·å¤‡äº† Î±ij\\alpha_{ij}Î±ijâ€‹ çš„ä½œç”¨ï¼šæè¿°äº†ç¬¬ i,ji,ji,j ä¸ª token ä¹‹é—´çš„å…³ç³» [[Softmax]] å‡½æ•°å¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ç§å½’ä¸€åŒ–æ‰‹æ®µï¼Œå®ƒå°†ä¸Šè¿°å‘é‡å†…ç§¯çš„ç»“æœå½’ä¸€åŒ–åˆ° (0,1)(0, 1)(0,1) çš„èŒƒå›´å†…ï¼Œä¸”åŒä¸€è¡Œä¸­æ‰€æœ‰å€¼çš„å’Œä¸º 111. è¿™æ ·ï¼Œä¸Šè¿°è¿‡ç¨‹ä¸­ softmax(XXâŠ¤)\\text{softmax}(\\mathbf{XX}^\\top)softmax(XXâŠ¤) çš„ç»“æœå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå½’ä¸€åŒ–çš„åŠ æƒçŸ©é˜µ æœ€åä¸€æ­¥çš„æ„ä¹‰æ˜¯æ˜¾ç„¶çš„ï¼šæ ¹æ®å‰é¢è®¡ç®—çš„åŠ æƒçŸ©é˜µä¸ºè¾“å…¥åºåˆ—çš„åµŒå…¥è®¡ç®—åŠ æƒå’Œï¼Œä½œä¸ºè¾“å‡ºè¡¨å¾, å³ hi=âˆ‘j=1LÎ±ijxj\\mathbf{h}_i = \\sum_{j=1}^L\\alpha_{ij}\\mathbf{x}_jhiâ€‹=âˆ‘j=1Lâ€‹Î±ijâ€‹xjâ€‹ çš„è¿‡ç¨‹. ä¸‹é¢æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿè¯¥è¿‡ç¨‹çš„å›¾ç¤ºï¼š çŸ©é˜µç›¸ä¹˜è®¡ç®—ç›¸ä¼¼åº¦åˆ†æ•°ï¼š softmax å½’ä¸€åŒ–: æ ¹æ®å½’ä¸€åŒ–çš„æ³¨æ„åŠ›åˆ†æ•°è®¡ç®—è¡¨å¾: ä¸‹é¢è§£é‡ŠåŸå§‹è®¡ç®—è¿‡ç¨‹ä¸­çš„ç»†èŠ‚é—®é¢˜ã€‚å¯¹äºåŸå§‹çš„è®¡ç®—è¿‡ç¨‹ï¼Œå…¶ä¸ç®€åŒ–ç‰ˆçš„åŒºåˆ«åœ¨äºï¼š è¾“å…¥è¡¨å¾ç»è¿‡çº¿æ€§æŠ•å½±åå‚ä¸è®¡ç®—ï¼Œè€Œä¸æ˜¯ç›´æ¥è®¡ç®— å­˜åœ¨ä¸€ä¸ªç¼©æ”¾ç³»æ•° dk\\sqrt{d_k}dkâ€‹â€‹ ä¸‹é¢è§£é‡Šå…¶åŸå› ï¼š WQ,WK,WV\\mathbf{W}^Q, \\mathbf{W}^K, \\mathbf{W}^VWQ,WK,WVä¸‰ä¸ªçŸ©é˜µéƒ½æ˜¯ä¸è¾“å…¥ç›¸ä¹˜è€Œèµ·ä½œç”¨ï¼Œå…¶æœ¬è´¨æ˜¯å¯¹è¾“å…¥è¡¨å¾è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œä¸»è¦çš„ä¿¡æ¯ä»ç„¶æ˜¯ X\\mathbf{X}Xï¼Œå…¶æ„ä¹‰åœ¨äº æå‡æ¨¡å‹çš„æ‹Ÿåˆèƒ½åŠ›ã€‚ä¸‰ä¸ªçº¿æ€§å˜æ¢ç›¸å½“äºçº¿æ€§å±‚ï¼Œå±äºç¥ç»ç½‘ç»œçš„ä¸€ç§ã€‚ å¦‚æœä¸ä½¿ç”¨è¿™ä¸‰ä¸ªçº¿æ€§å˜æ¢ï¼ŒXXâŠ¤\\mathbf{XX}^\\topXXâŠ¤ çš„ç»“æœä¸­ï¼ŒXXiiâŠ¤\\mathbf{XX}^\\top_{ii}XXiiâŠ¤â€‹ çš„å€¼ï¼Œå³æ¯ä¸ª token å¯¹è‡ªå·±çš„æ³¨æ„åŠ›å°†ä¼šå¤§å¤§è¶…è¿‡å¯¹å…¶ä»– token çš„æ³¨æ„åŠ›ï¼Œç»è¿‡ [[Softmax|Softmax]] ä¹‹åå…¶ä»– token çš„ attention score ä¼šè¢«ä¸¥é‡æŒ¤å‹ ç¼©æ”¾ç³»æ•° dk\\sqrt{d_k}dkâ€‹â€‹ å¯¹çŸ©é˜µçš„å†…ç§¯è¿›è¡Œç¼©æ”¾ å¦‚æœä¸è¿›è¡Œç¼©æ”¾ï¼Œåœ¨ dkd_kdkâ€‹ å³å‘é‡ç»´åº¦å¾ˆå¤§æ—¶å‘é‡ä¹‹é—´çš„å†…ç§¯ä¹Ÿä¼šå¾ˆå¤§ï¼Œè¿™æ ·ç»è¿‡ [[Softmax|Softmax]] ä¹‹åçš„æ¢¯åº¦ä¼šéå¸¸å°[1]ã€‚ å¦‚ä¸Šå°±æ˜¯ self-attention ä¸­ scaled dot-product attention çš„ä¸»è¦å†…å®¹ï¼Œå®é™…ä¸Š transformer æ¨¡å‹ä¸­ä½¿ç”¨çš„æ˜¯å®ƒçš„ç®€å•å¤åˆï¼šMulti-Head Attention Multi-Head Attention åœ¨ Scaled dot-product attention ä¸­ï¼Œè¾“å…¥è¡¨å¾ç›´æ¥è¢«æŠ•å½±åˆ° dkd_kdkâ€‹ ç»´åº¦çš„ Query, Key, Value å‘é‡ï¼Œç„¶åè¿›è¡Œ self-attention çš„åŠ æƒå¹³å‡è¿‡ç¨‹ã€‚[@Vaswani2017a] è®¤ä¸ºè¿™ä¸ªè¿‡ç¨‹æŠ‘åˆ¶äº†æ¨¡å‹ä»å¤šä¸ªæ–¹é¢æå–æ–‡æœ¬åºåˆ—çš„ç‰¹å¾ï¼Œäºæ˜¯æå‡ºè¿›ä¸€æ­¥åœ¨å¤šä¸ªå­ç©ºé—´ (Multi-Head) ä¸­åˆ†åˆ«è¿›è¡Œ self-attention è®¡ç®—ã€‚ å…·ä½“åœ°è¯´ï¼Œå°±æ˜¯å°† Q,K,V\\mathbf{Q}, \\mathbf{K}, \\mathbf{V}Q,K,V ä¸‰ä¸ªçŸ©é˜µè¿›ä¸€æ­¥æŠ•å½±åˆ° hhh ä¸ªå­ç©ºé—´, ç„¶åè¿›è¡Œ self-attention è®¡ç®—ï¼š headi=Attn(QWiQ,KWiK,VWiV)\\text{head}_i = \\text{Attn}(\\mathbf{QW}_i^Q, \\mathbf{KW}_i^K, \\mathbf{VW}_i^V) headiâ€‹=Attn(QWiQâ€‹,KWiKâ€‹,VWiVâ€‹) å…¶ä¸­ iâˆˆ[1,h]i\\in[1,h]iâˆˆ[1,h], WiQ,WiKâˆˆRdmodelÃ—dk\\mathbf{W}_i^Q, \\mathbf{W}_i^K\\in\\mathbb{R}^{d_\\text{model}\\times d_k}WiQâ€‹,WiKâ€‹âˆˆRdmodelâ€‹Ã—dkâ€‹, WiVâˆˆRdmodelÃ—dv\\mathbf{W}_i^V\\in\\mathbb{R}^{d_\\text{model}\\times d_v}WiVâ€‹âˆˆRdmodelâ€‹Ã—dvâ€‹ Multi-Head Attention ä¸­ dkd_kdkâ€‹, dvd_vdvâ€‹ æ˜¯ä¸€ä¸ªæ¯” dmodeld_\\text{model}dmodelâ€‹ å°çš„å€¼ï¼Œåœ¨ Attention is all you need([@Vaswani2017a])ä¸­, ä½œè€…å– h=8,dk=dv=dmodel/hh=8, d_k=d_v=d_\\text{model}/hh=8,dkâ€‹=dvâ€‹=dmodelâ€‹/h åœ¨ hhh ä¸ªå­ç©ºé—´è¿›è¡Œ self-attention è®¡ç®—å°†å¯¹æ¯ä¸ªè¯è·å¾— hhh ä¸ª dvd_vdvâ€‹ ç»´åº¦çš„è¡¨å¾ï¼ŒMulti-Head Attention å°†å®ƒä»¬æ‹¼æ¥èµ·æ¥å¹¶æŠ•å½±å› dmodeld_\\text{model}dmodelâ€‹ ç»´åº¦ã€‚ MultiHead(Q,K,V)=concat(head1,...,headh)WO\\text{MultiHead}(\\mathbf{Q}, \\mathbf{K}, \\mathbf{V}) = \\text{concat}(\\text{head}_1, ..., \\text{head}_h)\\mathbf{W}_O MultiHead(Q,K,V)=concat(head1â€‹,...,headhâ€‹)WOâ€‹ å…¶ä¸­ WOâˆˆRhdvÃ—dmodel\\mathbf{W}_O\\in\\mathbb{R}^{hd_v\\times d_\\text{model}}WOâ€‹âˆˆRhdvâ€‹Ã—dmodelâ€‹ æ˜¯æŠ•å½±çŸ©é˜µ è‡³æ­¤å°±æ˜¯ Transformer æ¨¡å‹ä¸­å…³äº self-attention sublayer çš„å…¨éƒ¨å†…å®¹ã€‚ Feed-Forward Layer Feed-Forward sublayer æ˜¯ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼Œç”±ä¸¤ä¸ªçº¿æ€§å±‚å’Œ [[ReLU|ReLU]] æ¿€æ´»å‡½æ•°ç»„æˆï¼Œå®ƒå¯¹æ‰€æœ‰ token çš„è¡¨å¾åˆ†åˆ«è¿›è¡ŒåŒç­‰çš„å˜æ¢: FFN(x)=ReLU(xW1+b1)W2+b2\\text{FFN}(\\mathbf{x}) = \\text{ReLU}(\\mathbf{xW}_1 + \\mathbf{b}_1)\\mathbf{W}_2 + \\mathbf{b}_2 FFN(x)=ReLU(xW1â€‹+b1â€‹)W2â€‹+b2â€‹ è™½ç„¶ self-attention æ˜¯ transformer æˆåŠŸçš„å…³é”®ï¼Œä½†æ˜¯ FFN å±‚çš„å‚æ•°å®é™…ä¸Šæ˜¯ self-attention å±‚çš„ä¸¤å€ï¼Œä»¥ Transformer æ¨¡å‹ä¸ºä¾‹ï¼Œ[@Vaswani2017a] ä½¿ç”¨çš„å‚æ•°æ˜¯ dmodel=512d_\\text{model}=512dmodelâ€‹=512, è€Œ FFN å±‚çš„éšè—å±‚ç»´åº¦æ˜¯ dff=2048d_{ff}=2048dffâ€‹=2048ã€‚ä¸€äº›å·¥ä½œè®¤ä¸ºé¢„è®­ç»ƒçš„ transformer æ¨¡å‹ä¸­ FFN å±‚å­˜å‚¨ç€ä¸ä¸‹æ¸¸ä»»åŠ¡ç›¸å…³çš„ä¿¡æ¯, è€Œ self-attention å±‚ä¸­å­˜å‚¨çš„åˆ™æ˜¯æ–‡æœ¬ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆäº¤äº’çš„ä¿¡æ¯ ([@Geva2021], [@He2022]). Residual Connection and Layer Normalization Residual Connection ([@He2016]) å’Œ Layer Normalization ([@Ba2016]) å®é™…ä¸Šéƒ½æ˜¯ä¸ºè§£å†³æ·±åº¦æ¨¡å‹è®­ç»ƒå›°éš¾çš„å®è·µæ€§é—®é¢˜æå‡ºçš„ï¼Œå¹¶æ— ç†è®ºè§£é‡Šã€‚å¯¹äº Residual Connectionï¼Œè‡ª ResNet([@He2016]) ä»¥æ¥ï¼Œå°±ä¸€ç›´æ˜¯æ·±åº¦æ¨¡å‹å¿…å¤‡çš„éƒ¨åˆ†ï¼Œå®ƒä¸»è¦è§£å†³äº†åœ¨è¿‡æ·±çš„æ¨¡å‹ä¸­è®­ç»ƒæ—¶æ¢¯åº¦(ä¿¡æ¯)æ¶ˆå¤±çš„é—®é¢˜ã€‚ å¯¹äº Layer Normalizationï¼Œå®ƒæ˜¯é’ˆå¯¹ Batch Normalization ([@ioffe2015]) æå‡ºçš„ï¼Œè€Œ Normalization æ“ä½œç®€è€Œè¨€ä¹‹å°±æ˜¯å°†ç¥ç»ç½‘ç»œä¸­æ¯å±‚çš„è¾“å‡º(ç¥ç»å…ƒæ¿€æ´»åˆ†æ•°)çš„åˆ†å¸ƒæ¢å¤ä¸ºå‡å€¼ä¸º 000, æ–¹å·®ä¸º 111 çš„æ­£æ€åˆ†å¸ƒï¼Œè§£å†³ [[Interval-Covariate-Shift|Interval Covariate Shift]] é—®é¢˜ã€‚åŒºåˆ«åœ¨äºï¼ŒBatchNormal æ“ä½œæ˜¯å¯¹æ¯ä¸ªéšè—å•å…ƒåœ¨ batch å†…å½’ä¸€åŒ–ï¼Œè¾¾åˆ°æ¯ä¸ªéšè—å•å…ƒåœ¨åŒä¸€ batch å†…å‡åŒ€åˆ†å¸ƒçš„æ•ˆæœ, éœ€è¦åœ¨ä¸€ä¸ªæœ‰è¶³å¤Ÿæ ·æœ¬æ•°é‡çš„ batch ä¸­æ‰èƒ½è¿›è¡Œï¼›è€Œ LayerNormal æ“ä½œæ˜¯å¯¹åŒä¸€å±‚çš„æ‰€æœ‰éšè—å•å…ƒè¿›è¡Œå½’ä¸€åŒ–ï¼Œè¾¾åˆ°åŒä¸€ä¸ªæ ·æœ¬çš„æ‰€æœ‰éšè—å•å…ƒå‡åŒ€åˆ†å¸ƒçš„æ•ˆæœ, å¯ä»¥å¯¹å•ä¸ªæ ·æœ¬è¿›è¡Œã€‚è€Œä¸»æµçš„ NLP æ¨¡å‹å› åºåˆ—é•¿åº¦ä¸ç¡®å®šï¼Œæ— æ³•ç¨³å®šè·å¾—è¶³å¤Ÿçš„ç»Ÿè®¡æ ·æœ¬åªèƒ½ä½¿ç”¨ Layer Normalization æ€»è€Œè¨€ä¹‹ï¼Œç»“åˆäº† Residual Connection å’Œ Layer Normalization çš„ transformer å±‚è®¡ç®—è¿‡ç¨‹ä¸ºï¼š Hattn=LayerNorm(MultiHead(X)+X)Hffn=LayerNorm(FFN(Hattn)+Hattn)\\begin{aligned} \\mathbf{H}_\\text{attn} &amp;= \\text{LayerNorm}(\\text{MultiHead}(\\mathbf{X}) + \\mathbf{X})\\\\ \\mathbf{H}_\\text{ffn} &amp;= \\text{LayerNorm}(\\text{FFN}(\\mathbf{H}_\\text{attn}) + \\mathbf{H}_\\text{attn}) \\end{aligned}Hattnâ€‹Hffnâ€‹â€‹=LayerNorm(MultiHead(X)+X)=LayerNorm(FFN(Hattnâ€‹)+Hattnâ€‹)â€‹ Hffn\\mathbf{H}_\\text{ffn}Hffnâ€‹ å³æœ€ç»ˆçš„è¾“å‡ºè¡¨å¾ã€‚ Why Self-Attention ä»ä¸‰ä¸ªæ–¹é¢è€ƒè™‘ Self-Attention æ›¿ä»£ CNN å’Œ RNN çš„ç›Šå¤„ï¼š æ¯å±‚æ€»çš„è®¡ç®—å¤æ‚åº¦ å¯ä»¥å¹¶è¡ŒåŒ–çš„è®¡ç®—æ¯”ä¾‹ å»ºæ¨¡é•¿è·ç¦»ä¾èµ–æ—¶éœ€è¦çš„è®¡ç®—è·¯å¾„é•¿åº¦ å…¶ä¸­ 3 åœ¨ NLP ä»¥åŠå…¶ä»–åºåˆ—å»ºæ¨¡ä»»åŠ¡ä¸­éå¸¸å…³é”®ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå»ºæ¨¡é•¿è·ç¦»ä¾èµ–éœ€è¦åœ¨ç½‘ç»œä¸­ç»è¿‡çš„è®¡ç®—è·¯å¾„è¶Šå¤šï¼Œä¿¡æ¯æŸå¤±è¶Šä¸¥é‡ï¼Œä¹Ÿå°±è¶Šéš¾å»ºæ¨¡é•¿è·ç¦»ä¾èµ–ã€‚ [@Vaswani2017a] æ€»ç»“çš„ä¸Šè¿°ä¸‰ç‚¹çš„å¯¹æ¯”å¦‚ä¸‹ï¼š PLMs NLP ä»»åŠ¡ä¸­ï¼Œä¼˜è´¨çš„æ•°æ®æ ‡æ³¨é«˜åº¦ä¾èµ–é¢†åŸŸä¸“å®¶çŸ¥è¯†ï¼Œç›´æ¥åœ¨ä»»åŠ¡çš„æ ‡æ³¨æ•°æ®ä¸Šè¿›è¡Œç›‘ç£å­¦ä¹ é€šå¸¸å¾ˆå›°éš¾ï¼Œè€Œä¸”æ— æ³•è¿ç§»åˆ°ä¸åŒé¢†åŸŸã€‚é¢„è®­ç»ƒåˆ™æ˜¯ä¸€ç§è‡ªç›‘ç£å­¦ä¹ ï¼Œåˆ©ç”¨å¤§é‡å­˜åœ¨çš„åŸå§‹è¯­æ–™è¿›è¡Œé€šç”¨çš„è¯­è¨€å»ºæ¨¡ã€‚åœ¨è¶³å¤Ÿå¤§è§„æ¨¡çš„è¯­æ–™åº“ä¸Šé¢„è®­ç»ƒè¿‡çš„è¯­è¨€è¡¨å¾é€šå¸¸è¢«è®¤ä¸ºæœ‰åˆ©äºä¸‹æ¸¸ä»»åŠ¡çš„æ€§èƒ½([@Radford2018])ï¼ŒåŒæ—¶èƒ½å¤Ÿæå‡æ·±åº¦ç¥ç»ç½‘ç»œçš„æ³›åŒ–æ€§([@erhan2010])ã€‚ è¾ƒæ—©çš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹å¦‚ word2vec[@mikolov2013], GloVe[@Pennington2014] ç­‰è¯åµŒå…¥æ¨¡å‹åœ¨è¯­æ–™åº“ä¸Šå°†è¯æ˜ å°„åˆ°å‘é‡ç©ºé—´ï¼Œè®­ç»ƒåçš„è¯åµŒå…¥å¯ä»¥ç”¨åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸Šä»¥æé«˜æ€§èƒ½ã€‚è¿™äº›é™æ€çš„è¯åµŒå…¥ç›¸å½“äºä¸Šä¸‹æ–‡æ— å…³çš„è¯è¡¨å¾ï¼Œæ— æ³•è¡¨ç¤ºè¯çš„å¤šä¹‰æ€§ã€‚è€Œå¤šä¹‰æ€§æ˜¯è‡ªç„¶è¯­è¨€ä¸­å¸¸è§ä¸”é‡è¦çš„ç‰¹å¾ä¹‹ä¸€ï¼Œå› æ­¤åæ¥çš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ä¸»è¦å…³æ³¨äºä¸Šä¸‹æ–‡ç›¸å…³çš„è¯­è¨€è¡¨å¾ã€‚ [@Peters2018] æå‡ºçš„ ELMo ä½¿ç”¨åŒå‘ LSTM ç½‘ç»œè®¡ç®—ä¸Šä¸‹æ–‡è¡¨å¾ï¼ŒELMo ç”Ÿæˆçš„è¡¨å¾ä½œä¸ºç‰¹å¾åœ¨ä¸‹æ¸¸ä»»åŠ¡æ¨¡å‹ä¸­ä½¿ç”¨ï¼Œç›¸å½“äºä»…ä½œä¸ºæ–‡æœ¬ç‰¹å¾æå–å™¨åµŒå…¥åˆ°ä¸‹æ¸¸ä»»åŠ¡æ¨¡å‹ã€‚éšç€ transformer æ¨¡å‹å’Œé¢„è®­ç»ƒ-å¾®è°ƒæ¨¡å¼çš„å‡ºç°ï¼Œä»…ä½œä¸ºç‰¹å¾æå–å™¨çš„é¢„è®­ç»ƒæ¨¡å‹å¾ˆå¿«æ¶ˆå¤±ï¼ŒELMo åŸºæœ¬æˆä¸ºè¿™ç±»é¢„è®­ç»ƒæ¨¡å‹çš„ç»å”±ã€‚ ç»“æ„ åœ¨ transformer æ—¶ä»£ï¼ŒPLM æ ¹æ®æ¨¡å‹æ¶æ„å¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼š Encoder based([BERT-Pre-training-of-Deep-Bidirectional-Transformers-for-Language-Understanding|BERT], [RoBERTa-A-Robustly-Optimized-BERT-Pretraining-Approach|RoBERTa], [XLNet|XLNet].) Decoder based(GPT-1([@Radford2018]), GPT-2([@Radford2019]), GPT-3([@Brown2020]).) Encoder-Decoder based([BART-Denoising-Sequence-to-Sequence-Pre-training-for-Natural-Language-Generation-Translation-and-Comprehension|BART], MASS([@Song2019]).) Encoder based Model Encoder æ¨¡å‹ä½¿ç”¨å¤šå±‚ transformer å¯¹è¾“å…¥åºåˆ—è¿›è¡Œç¼–ç ï¼Œç”ŸæˆåŠ¨æ€çš„ä¸Šä¸‹æ–‡è¯­è¨€è¡¨å¾ã€‚ä¸ä¸Šé¢è®²åˆ°çš„ Self-Attention Encoding è¿‡ç¨‹ä¸€è‡´ Decoder based Model Decoder æ¨¡å‹ä¸ Encoder åªæœ‰è½»å¾®ä¸åŒï¼šEncoder æ¨¡å‹åœ¨è®¡ç®— token è¡¨å¾æ—¶åœ¨æ•´ä¸ªè¾“å…¥åºåˆ—çš„ä¸Šä¸‹æ–‡èŒƒå›´å†…è¿›è¡Œæ³¨æ„åŠ›è®¡ç®—ï¼Œè€Œ Decoder æ¨¡å‹åªåœ¨å½“å‰ token çš„ä¸Šæ–‡è¿›è¡Œæ³¨æ„åŠ›è¿‡ç¨‹ï¼Œå³ Autoregressive è¿‡ç¨‹ã€‚ Encoder-Decoder based Model Encoder-Decoder æ¨¡å‹ç”±ä¸€ä¸ª Encoder å’Œä¸€ä¸ª Decoder ç»„æˆï¼Œé¦–å…ˆåˆ©ç”¨ Encoder ä¸ºè¾“å…¥æ–‡æœ¬ç”Ÿæˆè¡¨å¾ï¼Œç„¶ååœ¨ Decoder ä¸­å¯¹è¯¥è¡¨å¾è¿›è¡Œæ³¨æ„åŠ›è®¡ç®—ã€‚ä¸ Decoder æ¨¡å‹ç›¸ä¼¼ï¼ŒEncoder-Decoder æ¨¡å‹ä¸­çš„ Decoder ä¹Ÿä¼šå¯¹å½“å‰ token çš„ä¸Šæ–‡è¿›è¡Œæ³¨æ„åŠ›è®¡ç®—ã€‚å³ï¼šDecoder åŒæ—¶ä»¥è¾“å…¥æ–‡æœ¬çš„è¡¨å¾å’Œç”Ÿæˆç»“æœçš„ä¸Šæ–‡ä¸ºæ¡ä»¶è¿›è¡Œç”Ÿæˆï¼Œè¿™ä¸€æ¨¡å¼ä¸ç¿»è¯‘ï¼Œæ‘˜è¦ç”Ÿæˆç­‰ seq2seq ä»»åŠ¡ååˆ†å¥‘åˆã€‚ é¢„è®­ç»ƒç›®æ ‡ è¯­è¨€æ¨¡å‹çš„è®­ç»ƒç›®æ ‡åŸºæœ¬å¯ä»¥ç®€å•å½’ä¸ºä»¥æŸç§æ–¹å¼è®¡ç®—æ–‡æœ¬ xxx çš„æ¦‚ç‡ P(x)P(x)P(x)ã€‚åœ¨ PLM ä¸­ä¸»è¦æœ‰ä¸‰ç§é¢„è®­ç»ƒç›®æ ‡ï¼ŒåŸºæœ¬ä¸ä¸Šè¿°ä¸‰ç§æ¨¡å‹ç»“æ„ç›¸å¯¹åº”ã€‚ Autoencoding Modeling Autoencoding Modeling å¸¸ç”¨äº Encoder based Modelï¼Œå¦‚ BERT([@Devlin2019]) ä¸­ä½¿ç”¨çš„ MLMã€‚å®ƒçš„è¿‡ç¨‹å¯ä»¥ç®€è¿°ä¸ºï¼šé¦–å…ˆå‘åŸå§‹æ–‡æœ¬ä¸­æ’å…¥å™ªéŸ³ï¼Œå°†å…¶å˜ä¸ºå—æŸçš„æ–‡æœ¬ï¼Œç„¶åè®­ç»ƒæ¨¡å‹æ¢å¤å—æŸçš„éƒ¨åˆ†ï¼Œè®­ç»ƒçš„æŸå¤±ä»…æ ¹æ®å—æŸéƒ¨åˆ†çš„æ–‡æœ¬è®¡ç®—ï¼ŒæŸå¤±å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸ºï¼š \\mathbfcal{L}_\\text{AE}(\\hat{\\mathbf{X}})=\\sum_{x_i\\in m(\\mathbf{X})}\\log P(x_i|\\mathbf{X}\\backslash m(\\mathbf{X})) å…¶ä¸­ X\\mathbf{X}X æ˜¯è¾“å…¥åºåˆ—ï¼ŒX^\\hat{\\mathbf{X}}X^ æ˜¯åŸå§‹æ–‡æœ¬åºåˆ—ç»è¿‡å™ªéŸ³å‡½æ•°åçš„æ–‡æœ¬åºåˆ— X^=fnoise(X)\\hat{\\mathbf{X}} = f_\\text{noise}(\\mathbf{X})X^=fnoiseâ€‹(X)ï¼Œm(X)m(\\mathbf{X})m(X) æ˜¯è¾“å…¥åºåˆ—ä¸­å—æŸçš„éƒ¨åˆ†ã€‚ Autoregressive Modeling Autoregressive Modeling æœ‰æ—¶ä¹Ÿç§° Standard Language Modeling(SLM)ï¼Œå¸¸åœ¨ Decoder based Model ä¸­ä½¿ç”¨ï¼Œå¦‚ GPT ç³»åˆ—æ¨¡å‹å°±æ˜¯ Autoregressive æ¨¡å‹ã€‚Autoregressive æ¨¡å‹æ˜¯ä¸€ç§å•å‘ç”Ÿæˆæ¨¡å‹ï¼Œå³å®ƒæ ¹æ®ä¸Šæ–‡ä¿¡æ¯è®­ç»ƒæ¨¡å‹ç”Ÿæˆä¸‹ä¸€ä¸ªè¯ï¼Œè®­ç»ƒæŸå¤±ä¸ºï¼š LAR(X)=âˆ‘i=1âˆ£Xâˆ£logâ¡P(xiâˆ£x1,x2,...,xiâˆ’1)\\mathcal{L}_\\text{AR}(\\mathbf{X}) = \\sum_{i=1}^{|\\mathbf{X}|}\\log P(x_i|x_1, x_2, ..., x_{i-1}) LARâ€‹(X)=i=1âˆ‘âˆ£Xâˆ£â€‹logP(xiâ€‹âˆ£x1â€‹,x2â€‹,...,xiâˆ’1â€‹) Sequence-2-Sequence Modeling seq2seq å¸¸ç”¨äº Encoder-Decoder based Modelï¼Œå®ƒçš„è¿‡ç¨‹æ˜¯ Autoencoding å’Œ Autoregressive è¿‡ç¨‹çš„ç»“åˆï¼šé¦–å…ˆå‘è¾“å…¥æ–‡æœ¬åŠ å…¥å™ªéŸ³ï¼Œç„¶åè®­ç»ƒæ¨¡å‹åŸºäºå—æŸçš„æ–‡æœ¬ä½¿ç”¨ç¼–ç å™¨å’Œè§£ç å™¨æ¢å¤å‡ºåŸå§‹æ–‡æœ¬ï¼Œå…¶è®­ç»ƒæŸå¤±æ˜¯æ¢å¤æ–‡æœ¬ä¸åŸå§‹æ–‡æœ¬ä¹‹é—´çš„è´Ÿå¯¹æ•°ä¼¼ç„¶ï¼š LSS=âˆ‘i=1âˆ£Xâˆ£logâ¡P(xiâˆ£X^,x1,x2,...,xiâˆ’1)\\mathcal{L}_{SS} = \\sum_{i=1}^{|\\mathbf{X}|}\\log P(x_i|\\hat{\\mathbf{X}}, x_1, x_2, ..., x_{i-1}) LSSâ€‹=i=1âˆ‘âˆ£Xâˆ£â€‹logP(xiâ€‹âˆ£X^,x1â€‹,x2â€‹,...,xiâˆ’1â€‹) ä¸€äº›å™ªéŸ³å‡½æ•°([@Lewis2019])ï¼š Token Masking: éšæœºé‡‡æ ·ä¸€äº› tokens å¹¶ä½¿ç”¨ [MASK] æ›¿æ¢ Token Deletion: éšæœºåˆ å»ä¸€äº› tokens ï¼Œä¸ Token Masking ç›¸æ¯”ï¼Œè¿™ç§æ–¹æ³•è¿«ä½¿æ¨¡å‹é¢„æµ‹è¢«åˆ é™¤çš„ä½ç½® Text Infilling: éšæœºé‡‡æ ·ä¸€äº›æ–‡æœ¬ç‰‡æ®µï¼Œå¹¶ç”¨é®ç½© [MASK] æ›¿æ¢ã€‚å¯¹äºé•¿åº¦ä¸º 0 çš„æ–‡æœ¬ç‰‡æ®µï¼Œç›¸å½“äºæ’å…¥äº† [MASK] ã€‚è¿™ç§å™ªå£°è¿«ä½¿æ¨¡å‹é¢„æµ‹è¢«æ›¿æ¢çš„æ–‡æœ¬ç‰‡æ®µçš„é•¿åº¦ Sentence Permutation: å°†æ–‡æ¡£æŒ‰ç…§å¥å·åˆ†å‰²æˆä¸åŒçš„å¥å­ï¼Œç„¶åéšæœºæ’åˆ—å¥å­çš„é¡ºåºã€‚è¿™ç§å™ªå£°è¿«ä½¿æ¨¡å‹å­¦ä¹ åŒä¸€æ–‡æ¡£ä¸­å¥å­çš„é¡ºåº Document Rotation: éšæœºé€‰æ‹©ä¸€ä¸ª token ï¼Œç„¶åå°†æ–‡æœ¬æ—‹è½¬åˆ°ä»¥è¿™ä¸ª token ä¸ºå¼€å¤´çš„çŠ¶æ€ã€‚è¿™ç§å™ªå£°è®­ç»ƒæ¨¡å‹è¯†åˆ«æ–‡æœ¬å¼€å¤´çš„èƒ½åŠ› ä¾‹å¦‚å¯¹äºå‡å€¼ä¸º 000, æ–¹å·®ä¸º 111 çš„ dkd_kdkâ€‹ ç»´å‘é‡ q,k\\mathbf{q}, \\mathbf{k}q,k, ä»–ä»¬å†…ç§¯ç»“æœ qâ‹…kâŠ¤\\mathbf{q}\\cdot\\mathbf{k}^\\topqâ‹…kâŠ¤ çš„å‡å€¼ä¸º 000, æ–¹å·®ä¸º dkd_kdkâ€‹. å½“ dkd_kdkâ€‹ å¾ˆå¤§æ—¶, æ„å‘³ç€åˆ†å¸ƒ qâ‹…kâŠ¤\\mathbf{q}\\cdot\\mathbf{k}^\\topqâ‹…kâŠ¤ çš„å€¼é›†ä¸­åœ¨ç»å¯¹å€¼å¤§çš„åŒºåŸŸï¼Œå³ softmax(qâ‹…kâŠ¤)\\text{softmax}(\\mathbf{q}\\cdot\\mathbf{k}^\\top)softmax(qâ‹…kâŠ¤) çš„å¤§éƒ¨åˆ†å€¼ä¹‹é—´çš„æ¢¯åº¦å¾ˆå°ã€‚å› æ­¤éœ€è¦ä»¥ k\\sqrt{k}kâ€‹ è¿›è¡Œç¼©æ”¾ï¼Œä½¿å†…ç§¯ç»“æœçš„æ–¹å·®ä¸º 111 â†©ï¸","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"PLM","slug":"PLM","permalink":"https://blog.zhuwenq.cc/tags/PLM/"}]},{"title":"Transformer Feed-Forward Layers are Key-Value Memories","slug":"Transformer-Feed-Forward-Layers-are-Key-Value-Memories","date":"2022-04-03T06:59:27.000Z","updated":"2023-06-21T06:51:28.928Z","comments":true,"path":"Transformer-Feed-Forward-Layers-are-Key-Value-Memories/","link":"","permalink":"https://blog.zhuwenq.cc/Transformer-Feed-Forward-Layers-are-Key-Value-Memories/","excerpt":"Motivation Transformer æ¨¡å‹ä¸­, FFN å±‚çš„å‚æ•°å  3/2ï¼Œä½†æ˜¯å…¶åœ¨ç½‘ç»œä¸­çš„ä½œç”¨è¿˜æ²¡æœ‰å¾ˆå¥½çš„è¢«ç ”ç©¶å’Œç†è§£ ä½œè€…æå‡º FFN å±‚ç›¸å½“äºç¥ç»è®°å¿†ç³»ç»Ÿï¼Œä»¥ç¬¬ä¸€ä¸ªçŸ©é˜µä¸º keyï¼Œ ç¬¬äºŒä¸ªçŸ©é˜µä¸º value è®°å½•äº†é”®å€¼å¯¹ä¿¡æ¯ã€‚å…¶ä¸­çš„ key æŒ‡äººç±»å¯è§£é‡Šçš„æ–‡æœ¬ç‰¹å¾(è¡¨å±‚çš„æ–‡æœ¬ç»“æ„ç‰¹å¾å’Œæ·±å±‚çš„æ–‡æœ¬è¯­ä¹‰ç‰¹å¾), value åˆ™å¯ä»¥è¯±å¯¼æˆåœ¨è¯å…¸ç©ºé—´ä¸­çš„æ¦‚ç‡åˆ†å¸ƒã€‚","text":"Motivation Transformer æ¨¡å‹ä¸­, FFN å±‚çš„å‚æ•°å  3/2ï¼Œä½†æ˜¯å…¶åœ¨ç½‘ç»œä¸­çš„ä½œç”¨è¿˜æ²¡æœ‰å¾ˆå¥½çš„è¢«ç ”ç©¶å’Œç†è§£ ä½œè€…æå‡º FFN å±‚ç›¸å½“äºç¥ç»è®°å¿†ç³»ç»Ÿï¼Œä»¥ç¬¬ä¸€ä¸ªçŸ©é˜µä¸º keyï¼Œ ç¬¬äºŒä¸ªçŸ©é˜µä¸º value è®°å½•äº†é”®å€¼å¯¹ä¿¡æ¯ã€‚å…¶ä¸­çš„ key æŒ‡äººç±»å¯è§£é‡Šçš„æ–‡æœ¬ç‰¹å¾(è¡¨å±‚çš„æ–‡æœ¬ç»“æ„ç‰¹å¾å’Œæ·±å±‚çš„æ–‡æœ¬è¯­ä¹‰ç‰¹å¾), value åˆ™å¯ä»¥è¯±å¯¼æˆåœ¨è¯å…¸ç©ºé—´ä¸­çš„æ¦‚ç‡åˆ†å¸ƒã€‚ Introduction FFN å±‚çš„è®¡ç®—è¿‡ç¨‹å’Œ Key-value Memories çš„è®¡ç®—è¿‡ç¨‹ç›¸ä¼¼ï¼š FFN å±‚ä¸­çš„ç¬¬ä¸€ä¸ªçŸ©é˜µæ˜¯ç¥ç»é”®å€¼å¯¹è®°å¿†çš„ key çŸ©é˜µï¼Œç¬¬äºŒä¸ªçŸ©é˜µæ˜¯ value çŸ©é˜µã€‚ä½œè€…åœ¨æ­¤ç†è®ºçš„åŸºç¡€ä¸Šè¿›è¡Œäº†å®éªŒï¼Œåˆ†æäº† FFN å±‚ä½œä¸ºè®°å¿†çš„è§‚ç‚¹ä¸‹å…¶ç©¶ç«Ÿè®°å¿†äº†ä»€ä¹ˆä¿¡æ¯ å®éªŒå‘ç° FFN ä¸­çš„ key é€šå¸¸ä¸äººç±»å¯è§£é‡Šçš„æ–‡æœ¬æ¨¡å¼ç›¸å…³ï¼šå³æ–‡æœ¬ç»“æ„æˆ–è¯­ä¹‰ä¸»é¢˜ã€‚è€Œ value å¯ä»¥è¯±å¯¼æˆè¯å…¸ç©ºé—´ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒï¼Œä¸”è¯¥åˆ†å¸ƒä¸ key ä¸­çš„æ–‡æœ¬æ¨¡å¼çš„ä¸‹ä¸€ä¸ªè¯æœ‰å…³ ä½œè€…è¿˜å‘ç°ï¼šTransformer æ¨¡å‹ä¸­æ¯ä¸€å±‚çš„ FFN å±‚éƒ½æœ‰æ•°ç™¾ä¸ªæ¿€æ´»çš„ memories, å³æ•°ç™¾ä¸ªåœ¨è¯å…¸ç©ºé—´ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒï¼Œä½†æ˜¯ transformer å±‚çš„æœ€ç»ˆè¾“å‡ºçš„åˆ†å¸ƒä¸æ¿€æ´»çš„è®°å¿†çš„åˆ†å¸ƒå‡ä¸ç›¸åŒã€‚è¿™æš—ç¤º transformer å±‚ä¹‹é—´çš„ æ®‹å·®ä¿¡æ¯ èµ·åˆ°ä¸»è¦çš„é¢„æµ‹ä½œç”¨ï¼ŒFFN å±‚çš„è¾“å‡ºæ˜¯è¯¥æ®‹å·®ä¿¡æ¯çš„è°ƒæ•´ã€‚ ä¸€äº›ç»“è®º FFN å±‚å¯ä»¥çœ‹ä½œæœªç»å½’ä¸€åŒ–çš„ Key-Value Memories FFN ä¸­çš„ key å¯ä»¥çœ‹ä½œæ˜¯å¯¹è¾“å…¥çš„æ¨¡å¼æ•æ‰ï¼šéƒ¨åˆ† key å‘é‡ä¸è¾“å…¥ x çš„ä¹˜ç§¯è¾ƒå¤§ï¼Œè¯´æ˜è¾“å…¥ x ç¬¦åˆè¯¥ key ä¸­å­˜å‚¨çš„æ¨¡å¼ key ä¸­å­˜å‚¨çš„æ¨¡å¼æ˜¯äººç±»å¯è§£é‡Šçš„ï¼šå®éªŒä¸­å‘ç°è¢«æ¿€æ´»çš„æ¨¡å¼å¯åˆ†ä¸ºæ–‡æœ¬ç»“æ„æˆ–è¯­ä¹‰æ³¨æ„ä¸Šçš„æ¨¡å¼ï¼Œå‡ä¸ºäººç±»å¯è§£é‡Šçš„ æµ…å±‚çš„ key ä¸»è¦æ•æ‰æµ…å±‚çš„ç‰¹å¾ï¼šå®éªŒä¸­å‘ç°æµ…å±‚çš„ key ä¸­ä¸»è¦æ•æ‰çš„æ˜¯æ–‡æœ¬è¡¨å±‚ç‰¹å¾ï¼Œæ·±å±‚çš„ key åˆ™ä¸»è¦æ•æ‰è¯­ä¹‰ç‰¹å¾ values å¯ä»¥è¯±å¯¼æˆè¯å…¸ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒ FFN å±‚å­˜å‚¨çš„ä¿¡æ¯ä¸»è¦æ˜¯å…³äºæ ¹æ®è¾“å…¥ç›´æ¥é¢„æµ‹ä¸‹ä¸€è¯æ¦‚ç‡åˆ†å¸ƒçš„ æ¯ä¸ª è®°å¿†å•å…ƒçš„æ¦‚ç‡åˆ†å¸ƒä¸è¯¥å±‚çš„æœ€ç»ˆè¾“å‡ºé€šå¸¸éƒ½ä¸ç›¸åŒï¼Œå®éªŒå‘ç°æ¯å±‚çš„æœ€ç»ˆè¾“å‡ºé€šå¸¸åå‘æ®‹å·®çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ FFN çš„ä¿¡æ¯ã€‚å³ä½¿å½“æœ€ç»ˆè¾“å‡ºä¸æ®‹å·®ä¸åŒæ—¶(å³æ®‹å·®è¢« FFN æ”¹å˜), æœ€ç»ˆè¾“å‡ºä¹Ÿå¾ˆå°‘ä¼šåå‘ ffn çš„è¾“å‡ºã€‚è¿™æš—ç¤º ffn å±‚å®é™…æ‰®æ¼”ç€å¯¹ æ®‹å·®ä¿¡æ¯ çš„å¦å†³è€…ä½œç”¨ï¼Œå³å®ƒæ™ºèƒ½å¦å†³æ®‹å·®ä¸­çš„ top predictionï¼Œä½¿ä¹‹åå‘å¦ä¸€ä¸ª candidateï¼Œè€Œä¸æ˜¯åå‘ ffn è‡ªå·±çš„ top prediction","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"Interpretability","slug":"Interpretability","permalink":"https://blog.zhuwenq.cc/tags/Interpretability/"},{"name":"FFN","slug":"FFN","permalink":"https://blog.zhuwenq.cc/tags/FFN/"},{"name":"Nueral Memory","slug":"Nueral-Memory","permalink":"https://blog.zhuwenq.cc/tags/Nueral-Memory/"}]},{"title":"Towards a Unified View of Parameter Efficient Transfer Learning","slug":"Towards-a-Unified-View-of-Parameter-Efficient-Transfer-Learning","date":"2022-03-30T07:52:19.000Z","updated":"2023-06-21T06:51:28.924Z","comments":true,"path":"Towards-a-Unified-View-of-Parameter-Efficient-Transfer-Learning/","link":"","permalink":"https://blog.zhuwenq.cc/Towards-a-Unified-View-of-Parameter-Efficient-Transfer-Learning/","excerpt":"ä½œè€…è®¤ä¸ºï¼šç°æœ‰çš„ parameter-efficient tuning æ–¹æ³•è™½ç„¶æœ‰æ•ˆï¼Œä½†æ˜¯å¯¹è¿™äº›æ–¹æ³•ä¸­çœŸæ­£æœ‰æ•ˆçš„è®¾è®¡ä»¥åŠå®ƒä»¬ä¹‹é—´çš„è”ç³»å¾ˆå°‘è¢«ç ”ç©¶å’Œç†è§£ã€‚","text":"ä½œè€…è®¤ä¸ºï¼šç°æœ‰çš„ parameter-efficient tuning æ–¹æ³•è™½ç„¶æœ‰æ•ˆï¼Œä½†æ˜¯å¯¹è¿™äº›æ–¹æ³•ä¸­çœŸæ­£æœ‰æ•ˆçš„è®¾è®¡ä»¥åŠå®ƒä»¬ä¹‹é—´çš„è”ç³»å¾ˆå°‘è¢«ç ”ç©¶å’Œç†è§£ã€‚ ä½œè€…åŸºäºæ­¤ç ”ç©¶äº† adapter, prefix-tuning å’Œ LoRA ç­‰æ–¹æ³•çš„è®¾è®¡é‡ç‚¹å’Œå®ƒä»¬ä¹‹é—´çš„è”ç³»ï¼ŒåŒæ—¶ç ”ç©¶äº†è¿™äº›æ–¹æ³•ä¹‹é—´çš„äº¤æ¢æˆ–ç»„åˆã€‚ ä½œè€…è®¤ä¸ºï¼šparameter-efficient tuning æ–¹æ³•ä¿æŒåŸºæ¨¡å‹å‚æ•°ä¸å˜ï¼Œå…¶æœ¬è´¨ç›¸å½“äºä»¥æŸç§æ–¹å¼ä¿®é¥°åŸºæ¨¡å‹çš„è¡¨å¾ã€‚ä¸»è¦çš„è®¾è®¡åœ¨äºï¼š ç”¨æ¥è®¡ç®—è¡¨å¾ä¿®é¥°çš„æ–¹æ³•(å‡½æ•°) è¿›è¡Œä¿®é¥°çš„ä½ç½® ä¿®é¥°ä¸åŸå§‹è¡¨å¾ä¹‹é—´ç»“åˆçš„æ–¹æ³• parameter-efficient tuning è®¡ç®—è¿‡ç¨‹ Recall Transformer transformer å±‚çš„è®¡ç®—è¿‡ç¨‹å³ä¸€ä¸ª multi-head attention æ¥ä¸€ä¸ª FFN å±‚ attn å±‚è®¡ç®—è¿‡ç¨‹ä¸º: é¦–å…ˆè¾“å…¥æ˜ å°„ä¸ºæ³¨æ„åŠ›çŸ©é˜µ QâˆˆRnÃ—dk\\mathbf{Q}\\in\\mathbb{R}^{n\\times d_k}QâˆˆRnÃ—dkâ€‹, KâˆˆRmÃ—dk\\mathbf{K}\\in\\mathbb{R}^{m\\times d_k}KâˆˆRmÃ—dkâ€‹, VâˆˆRmÃ—dv\\mathbf{V}\\in\\mathbb{R}^{m\\times d_v}VâˆˆRmÃ—dvâ€‹ Attn(Q,K,V)=softmax(QKTdk)â‹…V\\text{Attn}(\\mathbf{Q},\\mathbf{K},\\mathbf{V}) = \\text{softmax}(\\frac{\\mathbf{Q}\\mathbf{K}^T}{\\sqrt{d_k}}) \\cdot \\mathbf{V}Attn(Q,K,V)=softmax(dkâ€‹â€‹QKTâ€‹)â‹…V åœ¨ multi-head attn ä¸­ï¼Œå®é™…æ˜¯åœ¨ NhN_hNhâ€‹ ä¸ª heads ä¸­å¹¶è¡Œè¿›è¡Œä¸Šè¿° attn è®¡ç®—ã€‚ç¬¬ iii ä¸ª head çš„è¾“å…¥ç”±æ³¨æ„åŠ›å‚æ•°çŸ©é˜µ Wqi,Wki,WviâˆˆRdÃ—dh\\mathbf{W}_q^i, \\mathbf{W}_k^i, \\mathbf{W}_v^i\\in\\mathbb{R}^{d\\times d_h}Wqiâ€‹,Wkiâ€‹,Wviâ€‹âˆˆRdÃ—dhâ€‹ åˆ†åˆ«ä¸è¾“å…¥ç›¸ä¹˜å¾—åˆ°ï¼Œå³ï¼š headi=Attn(xWqi,CWki,CWvi)\\text{head}_i = \\text{Attn}(\\mathbf{xW}_q^i, \\mathbf{CW}_k^i, \\mathbf{CW}_v^i)headiâ€‹=Attn(xWqiâ€‹,CWkiâ€‹,CWviâ€‹) å…¶ä¸­ï¼Œx\\mathbf{x}x æ˜¯ query vector, C\\mathbf{C}C æ˜¯æ•´ä¸ªè¾“å…¥åºåˆ—çš„åµŒå…¥ã€‚ multi-head attn å°†æ¯ä¸ª head çš„è®¡ç®—ç»“æœæ‹¼æ¥ï¼Œå¹¶æŠ•å½±åˆ°æ¨¡å‹ç»´åº¦ï¼š MHA(C,x)=Concati=1Nh(headi)Wo\\text{MHA}(\\mathbf{C}, \\mathbf{x}) = \\text{Concat}_{i=1}^{N_h}(\\text{head}_i)\\mathbf{W}_oMHA(C,x)=Concati=1Nhâ€‹â€‹(headiâ€‹)Woâ€‹ å…¶ä¸­ WoâˆˆRdÃ—d\\mathbf{W}_o\\in\\mathbb{R}^{d\\times d}Woâ€‹âˆˆRdÃ—d, dhd_hdhâ€‹ é€šå¸¸æ˜¯ dNh\\frac{d}{N_h}Nhâ€‹dâ€‹, å³ï¼šæ¯ä¸ª head é€šå¸¸æ˜¯åœ¨ä½ç»´ç©ºé—´ä¸Šè¿›è¡Œè®¡ç®—ã€‚ FFN å±‚çš„è®¡ç®—è¿‡ç¨‹ä¸º: FFN(x)=ReLU(xW1+b1)W2+b2\\text{FFN}(\\mathbf{x}) = \\text{ReLU}(\\mathbf{x}W_1 + b_1)W_2 + b_2FFN(x)=ReLU(xW1â€‹+b1â€‹)W2â€‹+b2â€‹ å…¶ä¸­ W1âˆˆRdÃ—dm\\mathbf{W}_1\\in\\mathbb{R}^{d\\times d_m}W1â€‹âˆˆRdÃ—dmâ€‹, W2âˆˆRdmÃ—d\\mathbf{W}_2\\in\\mathbb{R}^{d_m\\times d}W2â€‹âˆˆRdmâ€‹Ã—d, b1âˆˆRdm\\mathbf{b}_1\\in\\mathbb{R}^{d_m}b1â€‹âˆˆRdmâ€‹, b2âˆˆRd\\mathbf{b}_2\\in\\mathbb{R}^{d}b2â€‹âˆˆRd. transformer ä¸­é€šå¸¸åœ¨ FFN å±‚ä½¿ç”¨è¾ƒå¤§çš„ dmd_mdmâ€‹, å¦‚ dm=4dd_m = 4ddmâ€‹=4dã€‚ Adapters(ä¸²è¡Œå¼) adapter é€šå¸¸åœ¨ transformer å±‚ä¹‹é—´æ’å…¥è¾ƒå°çš„ adapter layer, adapter layer é€šå¸¸ç”±ä¸€ä¸ªä¸‹æŠ•å½±å±‚ WdownâˆˆRdÃ—r\\mathbf{W}_\\text{down}\\in\\mathbb{R}^{d\\times r}Wdownâ€‹âˆˆRdÃ—r å°†è¾“å…¥è¡¨å¾ h\\mathbf{h}h æŠ•å½±åˆ°ä½ç»´ç©ºé—´ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªéçº¿æ€§å±‚ f(â‹…)f(\\cdot)f(â‹…), æœ€åé€šè¿‡ä¸€ä¸ªä¸ŠæŠ•å½±å±‚ WupâˆˆRrÃ—d\\mathbf{W}_\\text{up}\\in\\mathbb{R}^{r\\times d}Wupâ€‹âˆˆRrÃ—d å°†è¡¨å¾æ¢å¤åˆ°é«˜ç»´ç©ºé—´ã€‚adapters å±‚é€šå¸¸ä¼šåº”ç”¨æ®‹å·®è¿æ¥ï¼Œä»¥ä¿è¯åˆå§‹çŠ¶æ€ä¸‹çš„æ€§èƒ½ã€‚ hâ†h+f(hWdown)Wup\\mathbf{h}\\leftarrow\\mathbf{h}+f(\\mathbf{hW}_\\text{down})\\mathbf{W}_\\text{up} hâ†h+f(hWdownâ€‹)Wupâ€‹ Prefix-tuning prefix-tuning æ–¹æ³•å³åœ¨æ¯ä¸ª transformer å±‚çš„ multi-head attn è®¡ç®—ä¸­ï¼Œå‘æ¯ä¸ª head çš„ key å’Œ value çŸ©é˜µçš„å‰éƒ¨æ·»åŠ  lll ä¸ªå¯è°ƒçš„å‘é‡ï¼Œå³ prefix å‘é‡ã€‚ å…·ä½“æ¥è¯´ï¼Œprefix-tuning å°†ä¸¤ä¸ªçŸ©é˜µ: Pk,PvâˆˆRlÃ—d\\mathbf{P}_k, \\mathbf{P}_v\\in\\mathbb{R}^{l\\times d}Pkâ€‹,Pvâ€‹âˆˆRlÃ—d åˆ†åˆ«ä¸ key, value çŸ©é˜µ K,V\\mathbf{K}, \\mathbf{V}K,V æ‹¼æ¥ï¼Œåˆ™æ‹¼æ¥åçš„ attn è®¡ç®—è¿‡ç¨‹ä¸ºï¼š headi=Attn(xWqi,concat(Pki,CWki),concat(Pvi,CWvi))\\text{head}_i = \\text{Attn}(\\mathbf{xW}_q^i, \\text{concat}(\\mathbf{P}_k^i, \\mathbf{CW}_k^i), \\text{concat}(\\mathbf{P}_v^i, \\mathbf{CW}_v^i)) headiâ€‹=Attn(xWqiâ€‹,concat(Pkiâ€‹,CWkiâ€‹),concat(Pviâ€‹,CWviâ€‹)) å…¶ä¸­çš„ Pki,PviâˆˆRlÃ—d/Nh\\mathbf{P}_k^i, \\mathbf{P}_v^i\\in\\mathbb{R}^{l\\times d/N_h}Pkiâ€‹,Pviâ€‹âˆˆRlÃ—d/Nhâ€‹, å³ Pk,Pv\\mathbf{P}_k, \\mathbf{P}_vPkâ€‹,Pvâ€‹ åˆ†è§£åˆ° NhN_hNhâ€‹ ä¸ª heads ä¸­ç¬¬ iii ä¸ª head çš„å‘é‡ã€‚ LoRA LoRA é€šè¿‡å‘ transformer layer ä¸­æ’å…¥ä½ç»´çŸ©é˜µï¼Œä»¥ä½ç§©çŸ©é˜µç›¸ä¹˜çš„æ–¹å¼è¿‘ä¼¼åˆ°é«˜ç»´çŸ©é˜µï¼Œå®ç°å¯¹åŸºæ¨¡å‹å‚æ•°çš„ä¿®é¥°ã€‚ å…·ä½“çš„è¯´ï¼Œå¯¹äºä¸€ä¸ªé«˜ç»´åŸºæ¨¡å‹å‚æ•° WâˆˆRdÃ—k\\mathbf{W}\\in\\mathbb{R}^{d\\times k}WâˆˆRdÃ—k, å¯¹å…¶è¿›è¡Œå‚æ•°ä¿®é¥°å¯ä»¥è¡¨ç¤ºä¸ºï¼šW+Î”W\\mathbf{W} + \\Delta\\mathbf{W}W+Î”W. LoRA åˆ™é€šè¿‡ä¸¤ä¸ªä½ç§©çŸ©é˜µè¿‘ä¼¼åœ°å¾—åˆ° Î”W\\Delta\\mathbf{W}Î”Wï¼Œå³ï¼šÎ”W=WdownWup\\Delta\\mathbf{W} = \\mathbf{W}_\\text{down}\\mathbf{W}_\\text{up}Î”W=Wdownâ€‹Wupâ€‹, å…¶ä¸­ WdownâˆˆRdÃ—r\\mathbf{W}_\\text{down}\\in\\mathbb{R}^{d\\times r}Wdownâ€‹âˆˆRdÃ—r, WupâˆˆRrÃ—k\\mathbf{W}_\\text{up}\\in\\mathbb{R}^{r\\times k}Wupâ€‹âˆˆRrÃ—kã€‚ LoRA å°†ä¸Šè¿°å‚æ•°ä¿®é¥°æ–¹æ³•åº”ç”¨åˆ° query å’Œ value çš„æ³¨æ„åŠ›æŠ•å½±å‚æ•° Wq\\mathbf{W}_qWqâ€‹ å’Œ Wv\\mathbf{W}_vWvâ€‹ ä¸Šã€‚LoRA é€šè¿‡å¯¹å‚æ•°çš„ä¿®é¥°å®ç°å¯¹è¡¨å¾çš„ä¿®é¥°ï¼š hâ†h+sâ‹…xWdownWup\\mathbf{h}\\leftarrow\\mathbf{h}+s\\cdot\\mathbf{x}\\mathbf{W}_\\text{down}\\mathbf{W}_\\text{up} hâ†h+sâ‹…xWdownâ€‹Wupâ€‹ å…¶ä¸­ sâ‰¥1s\\geq 1sâ‰¥1 æ˜¯å¯è°ƒçš„ç¼©æ”¾è¶…å‚æ•°ã€‚ åŒºåˆ«å’Œè”ç³» Prefix-tuning ä¸ Adapters head=Attn(Q,concat(Pk,K),concat(Pv,V))=softmax(Qconcat(Pk,K)T)concat(Pv,V)=(1âˆ’Î»(x))softmax(QKT)V+Î»(x)softmax(QPkT)Pv=(1âˆ’Î»(x))Attn(Q,K,V)+Î»(x)Attn(Q,Pk,Pv)\\begin{aligned} \\text{head} &amp;= \\text{Attn}(\\mathbf{Q}, \\text{concat}(\\mathbf{P}_k, \\mathbf{K}), \\text{concat}(\\mathbf{P}_v, \\mathbf{V}))\\\\ &amp;= \\text{softmax}(\\mathbf{Q}\\text{concat}(\\mathbf{P}_k, \\mathbf{K})^T)\\text{concat}(\\mathbf{P}_v, \\mathbf{V})\\\\ &amp;= (1-\\lambda(\\mathbf{x}))\\text{softmax}(\\mathbf{Q}\\mathbf{K}^T)\\mathbf{V}+\\lambda(\\mathbf{x})\\text{softmax}(\\mathbf{Q}\\mathbf{P}_k^T)\\mathbf{P}_v\\\\ &amp;= (1-\\lambda(\\mathbf{x}))\\text{Attn}(\\mathbf{Q}, \\mathbf{K}, \\mathbf{V})+\\lambda(\\mathbf{x})\\text{Attn}(\\mathbf{Q}, \\mathbf{P}_k, \\mathbf{P}_v)\\\\ \\end{aligned}headâ€‹=Attn(Q,concat(Pkâ€‹,K),concat(Pvâ€‹,V))=softmax(Qconcat(Pkâ€‹,K)T)concat(Pvâ€‹,V)=(1âˆ’Î»(x))softmax(QKT)V+Î»(x)softmax(QPkTâ€‹)Pvâ€‹=(1âˆ’Î»(x))Attn(Q,K,V)+Î»(x)Attn(Q,Pkâ€‹,Pvâ€‹)â€‹ å…¶ä¸­çš„ Q=xWq\\mathbf{Q} = \\mathbf{xW}_qQ=xWqâ€‹, K=CWk\\mathbf{K} = \\mathbf{CW}_kK=CWkâ€‹, V=CWv\\mathbf{V} = \\mathbf{CW}_vV=CWvâ€‹, å› æ­¤åˆå¯ä»¥å†™ä¸ºï¼š head=Attn(xWq,concat(Pk,CWk),concat(Pv,CWv))=softmax(xWqconcat(Pk,CWk)T)[PvCWvT]=(1âˆ’Î»(x))softmax(xWqWkTCT)CWv+Î»(x)softmax(xWqPkTPv)=(1âˆ’Î»(x))Attn(xWq,CWk,CWv)âŸstandard attention+Î»(x)Attn(xWq,Pk,Pv)âŸindependent ofC\\begin{aligned} \\text{head} &amp;= \\text{Attn}(\\mathbf{x}\\mathbf{W}_q, \\text{concat}(\\mathbf{P}_k, \\mathbf{CW}_k), \\text{concat}(\\mathbf{P}_v, \\mathbf{CW}_v)) \\\\ &amp;= \\text{softmax}(\\mathbf{xW}_q\\text{concat}(\\mathbf{P}_k, \\mathbf{CW}_k)^T) \\left[ \\begin{matrix} \\mathbf{P}_v \\\\ \\mathbf{CW}_v^T \\end{matrix} \\right]\\\\ &amp;= (1 - \\lambda(\\mathbf{x}))\\text{softmax}(\\mathbf{xW}_q\\mathbf{W}_k^T\\mathbf{C}^T)\\mathbf{CW}_v + \\lambda(\\mathbf{x})\\text{softmax}(\\mathbf{xW}_q\\mathbf{P}_k^T\\mathbf{P}_v)\\\\ &amp;= (1 - \\lambda(\\mathbf{x}))\\underbrace{\\text{Attn}(\\mathbf{xW}_q, \\mathbf{CW}_k, \\mathbf{CW}_v)}_\\text{standard attention} + \\lambda(\\mathbf{x}) \\underbrace{\\text{Attn}(\\mathbf{xW}_q, \\mathbf{P}_k, \\mathbf{P}_v)}_\\text{independent of} \\mathbf{C} \\end{aligned}headâ€‹=Attn(xWqâ€‹,concat(Pkâ€‹,CWkâ€‹),concat(Pvâ€‹,CWvâ€‹))=softmax(xWqâ€‹concat(Pkâ€‹,CWkâ€‹)T)[Pvâ€‹CWvTâ€‹â€‹]=(1âˆ’Î»(x))softmax(xWqâ€‹WkTâ€‹CT)CWvâ€‹+Î»(x)softmax(xWqâ€‹PkTâ€‹Pvâ€‹)=(1âˆ’Î»(x))standard attentionAttn(xWqâ€‹,CWkâ€‹,CWvâ€‹)â€‹â€‹+Î»(x)independent ofAttn(xWqâ€‹,Pkâ€‹,Pvâ€‹)â€‹â€‹Câ€‹ å…¶ä¸­ Î»(x)=Î£iexpâ¡(xWqPkT)iÎ£iexpâ¡(xWqPkT)i+Î£jexpâ¡(xWqWkTCT)j\\lambda(\\mathbf{x}) = \\frac{\\Sigma_i\\exp(\\mathbf{xW}_q\\mathbf{P}_k^T)_i}{\\Sigma_i\\exp(\\mathbf{xW}_q\\mathbf{P}_k^T)_i + \\Sigma_j\\exp(\\mathbf{xW}_q\\mathbf{W}_k^T\\mathbf{C}^T)_j}Î»(x)=Î£iâ€‹exp(xWqâ€‹PkTâ€‹)iâ€‹+Î£jâ€‹exp(xWqâ€‹WkTâ€‹CT)jâ€‹Î£iâ€‹exp(xWqâ€‹PkTâ€‹)iâ€‹â€‹. note: softmax(x)=expâ¡(x)âˆ‘iexpâ¡(x)\\text{softmax}(\\mathbf{x}) = \\frac{\\exp(\\mathbf{x})}{\\sum_i\\exp(\\mathbf{x})}softmax(x)=âˆ‘iâ€‹exp(x)exp(x)â€‹ note: xâˆˆRd,Wq,Wk,WvâˆˆRdÃ—dh,CâˆˆRmÃ—d,Pk,PvâˆˆRlÃ—dh\\mathbf{x}\\in\\mathbb{R}^d, \\mathbf{W}_q, \\mathbf{W}_k, \\mathbf{W}_v\\in\\mathbb{R}^{d\\times d_h}, \\mathbf{C}\\in\\mathbb{R}^{m\\times d}, \\mathbf{P}_k, \\mathbf{P}_v\\in\\mathbb{R}^{l\\times d_h}xâˆˆRd,Wqâ€‹,Wkâ€‹,Wvâ€‹âˆˆRdÃ—dhâ€‹,CâˆˆRmÃ—d,Pkâ€‹,Pvâ€‹âˆˆRlÃ—dhâ€‹, hence: concat(Pk,CWk),concat(Pv,CWv)âˆˆR(l+m)Ã—d\\text{concat}(\\mathbf{P}_k, \\mathbf{CW}_k), \\text{concat}(\\mathbf{P}_v, \\mathbf{CW}_v)\\in\\mathbb{R}^{(l+m)\\times d}concat(Pkâ€‹,CWkâ€‹),concat(Pvâ€‹,CWvâ€‹)âˆˆR(l+m)Ã—d æ³¨æ„åˆ°ä¸Šè¿° head è®¡ç®—ç»“æœä¸­å‰ä¸€é¡¹å³æ­£å¸¸çš„ attn ï¼Œ åä¸€é¡¹ä¸ºç‹¬ç«‹äºè¾“å…¥ C\\mathbf{C}C çš„é€ query x\\mathbf{x}x çš„ attnã€‚å¯çœ‹ä½œå¯¹è¡¨å¾çš„ä¿®é¥°ï¼š hâ†(1âˆ’Î»(x))h+Î»(x)Î”h\\mathbf{h}\\leftarrow(1-\\lambda(\\mathbf{x}))\\mathbf{h} + \\lambda(\\mathbf{x})\\Delta\\mathbf{h} hâ†(1âˆ’Î»(x))h+Î»(x)Î”h å…¶ä¸­: Î”h:=softmax(xWqPkT)Pv\\Delta\\mathbf{h} :=\\text{softmax}(\\mathbf{xW}_q\\mathbf{P}_k^T)\\mathbf{P}_vÎ”h:=softmax(xWqâ€‹PkTâ€‹)Pvâ€‹ å®šä¹‰ W1=WqPkT\\mathbf{W}_1 = \\mathbf{W}_q\\mathbf{P}_k^TW1â€‹=Wqâ€‹PkTâ€‹, W2=Pv\\mathbf{W}_2 = \\mathbf{P}_vW2â€‹=Pvâ€‹, f=softmaxf = \\text{softmax}f=softmax, åˆ™å¯ä»¥å°†ä¸Šå¼é‡å†™ä¸ºï¼š hâ†(1âˆ’Î»(x))h+Î»(x)f(xW1)W2\\mathbf{h}\\leftarrow(1-\\lambda(\\mathbf{x}))\\mathbf{h} + \\lambda(\\mathbf{x})f(\\mathbf{xW}_1)\\mathbf{W}_2 hâ†(1âˆ’Î»(x))h+Î»(x)f(xW1â€‹)W2â€‹ ç›¸åŒä¹‹å¤„ prefix-tuning è®¡ç®—è¿‡ç¨‹ä¸ adapter çš„è®¡ç®—è¿‡ç¨‹ç»“æ„ç›¸ä¼¼ï¼ŒW1âˆˆRdhÃ—l\\mathbf{W}_1\\in\\mathbb{R}^{d_h\\times l}W1â€‹âˆˆRdhâ€‹Ã—l, W2âˆˆlÃ—dh\\mathbf{W}_2\\in\\mathbf{l\\times d_h}W2â€‹âˆˆlÃ—dhâ€‹ èµ·åˆ° adapter ä¸­ Wdown\\mathbf{W}_\\text{down}Wdownâ€‹ å’Œ Wup\\mathbf{W}_\\text{up}Wupâ€‹ çš„ä½œç”¨, lll åˆ™å’Œ adapter ä¸­çš„ rrr ç±»ä¼¼ï¼šæ˜¯è®¡ç®—ä¿®é¥°å‘é‡ Î”h\\Delta\\mathbf{h}Î”h æ—¶çš„ç§©çš„çº¦æŸï¼Œå³ Î”h\\Delta\\mathbf{h}Î”h æ˜¯è‡³å¤š lll ä¸ªå‘é‡çš„çº¿æ€§ç»„åˆ ä¸åŒä¹‹å¤„ åœ¨ä¿®é¥°é¡¹é“¾ç»“åˆä¸Šï¼Œadapter æ²¡æœ‰ç±»ä¼¼ Î»\\lambdaÎ» çš„é—¨æ§è¿‡ç¨‹ prefix-tuning ä½¿ç”¨ PLM layer çš„è¾“å…¥ x\\mathbf{x}x æ¥è®¡ç®— Î”h\\Delta\\mathbf{h}Î”h, adapter ä½¿ç”¨ h\\mathbf{h}h å³ PLM layer çš„è¾“å‡º prefix-tuning åœ¨ multi-head attn çš„æ¯ä¸ª head å†…è¿›è¡Œä¿®é¥°è¿‡ç¨‹ï¼Œadapter å¯ä»¥é€‰æ‹©åœ¨ attn æˆ– FFN çš„è¾“å‡ºè¿›è¡Œä¿®é¥° è®¾è®¡è¦ç‚¹ ç»¼åˆä¸‰ç§æ–¹æ³•çš„è®¡ç®—è¿‡ç¨‹çš„å¼‚åŒï¼Œå¯ä»¥æ€»ç»“å…¶è®¾è®¡è¦ç‚¹å¦‚ä¸‹ï¼š Functional Form: å³ç”¨æ¥è®¡ç®— Î”h\\Delta\\mathbf{h}Î”h çš„å‡½æ•°. ä¸‰ç§æ–¹æ³•éƒ½ä½¿ç”¨ç±»ä¼¼ proj_downâ†’non_linearâ†’proj_up\\text{proj\\_down}\\rightarrow\\text{non\\_linear}\\rightarrow\\text{proj\\_up}proj_downâ†’non_linearâ†’proj_up çš„è¿‡ç¨‹ï¼ŒLoRA ä¸­æ²¡æœ‰ non_linear è¿‡ç¨‹ Modified Representation: å³ä½¿ç”¨ä»€ä¹ˆ hidden state ä½œä¸ºè¾“å…¥æ¥è®¡ç®— Î”h\\Delta\\mathbf{h}Î”h Insertion Form: å³æ·»åŠ çš„æ¨¡å‹å¦‚ä½•æ’å…¥åˆ°åŸºæ¨¡å‹ä¸­ Composition Function: å³ Î”h\\Delta\\mathbf{h}Î”h å¦‚ä½•ä¸åŸºæ¨¡å‹çš„è¡¨å¾ h\\mathbf{h}h ç»„åˆï¼Œå¦‚ adapter é€šè¿‡ç®€å•ç›¸åŠ ï¼Œprefix-tuning é€šè¿‡é—¨æ§ç›¸åŠ , LoRA é€šè¿‡ç¼©æ”¾ç›¸åŠ  ä½œè€…åŸºäºè¿™äº›è®¾è®¡è¦ç‚¹ï¼Œè®¾è®¡äº†ä¸‰ç§ä»–ä»¬çš„ç»„åˆ, ä»¥ç ”ç©¶å“ªä¸ªè®¾è®¡ç»´åº¦å’Œè®¾è®¡æ–¹å¼æœ€ä¸ºæœ‰æ•ˆï¼š Parallel Adapter: å°† prefix-tuning ä»¥ x\\mathbf{x}x ä½œä¸ºè¾“å…¥çš„å¹¶è¡Œæ€§å¼•å…¥ adapter Multi-head Parallel Adapter: å°† prefix-tuning ä½œç”¨åœ¨æ¯ä¸ª head çš„ç‰¹ç‚¹å¼•å…¥ adapter Scaled Parallel Adapter: å°† LoRA çš„ç¼©æ”¾ç›¸åŠ ç»„åˆæ–¹å¼å¼•å…¥ adapter Insertion Form: Sequential or Parallel ä½œè€…ä½¿ç”¨ parallel adapter å’Œ sequential adaper å®éªŒï¼Œç»“æœè¡¨æ˜å¹¶è¡Œè®¾è®¡åœ¨æ‰€æœ‰ bench mark ä¸Šéƒ½ä¼˜äºä¸²è¡Œè®¾è®¡ Where to Modify: Attention or FFN ä½œè€…ä½¿ç”¨å¹¶è¡Œ adapter åˆ†åˆ«ä½œç”¨åœ¨ attention å’Œ FFN çš„æ¨¡å‹ä»¥åŠ prefix-tuning å’Œä½œç”¨åœ¨ FFN å±‚ä¸Šçš„ LoRA è¿›è¡Œå®éªŒï¼Œç»“æœè¡¨æ˜ FFN ä¸Šçš„ä¿®é¥°ä¼˜äº attention ä¸Šçš„ä¿®é¥°ã€‚ä½œè€…è®¤ä¸ºï¼šä¸è®ºä½¿ç”¨ä½•ç§ä¿®é¥°å‡½æ•°å’Œç»„åˆæ–¹å¼ï¼ŒFFN ä¸Šçš„ä¿®é¥°å¯ä»¥æ›´åŠ æœ‰æ•ˆåœ°åˆ©ç”¨æ–°æ·»åŠ çš„å‚æ•° ä½œè€…å¯¹è¿™ä¸€ç°è±¡æå‡ºçŒœæƒ³ï¼šFFN å±‚å­¦ä¹ åˆ°çš„æ˜¯ä»»åŠ¡ç›¸å…³çš„æ–‡æœ¬æ¨¡å¼ç‰¹å¾ï¼Œè€Œ attention å­¦ä¹ åˆ°çš„æ˜¯æ–‡æœ¬ä¹‹é—´çš„äº¤äº’æ¨¡å¼(å³è¿›è¡Œæœ‰æ•ˆè‡ªæ³¨æ„åŠ›è®¡ç®—çš„æ¨¡å¼) è¿›ä¸€æ­¥åœ°ï¼Œä½œè€…å‡å°‘æ·»åŠ çš„å‚æ•°é‡ (0.1%) å‘ç°åœ¨å‚æ•°é‡å°çš„æƒ…å†µä¸‹ attention å±‚çš„ä¿®é¥°æ›´æœ‰æ•ˆã€‚ åŸºäºæ­¤å®éªŒç»“æœï¼Œä½œè€…æå‡ºä¸€æ¡è®¾è®¡åŸåˆ™: åº”è¯¥åœ¨ FFN å±‚çš„ä¿®é¥°ä¸Šä½¿ç”¨æ›´å¤§çš„å‚æ•°é‡ (æ›´å¤§çš„ç»´åº¦æˆ–æ›´æ·±çš„å±‚æ•°) Composition Function ä½œè€…åœ¨ LoRA ä¸Šåšæ¶ˆèå®éªŒï¼Œå¹¶äº scaled parallel adapter æ¯”è¾ƒï¼Œå‘ç°ç¼©æ”¾ç›¸åŠ ä¼˜äºç›´æ¥ç›¸åŠ ï¼Œå¹¶ä¸”ç¼©æ”¾ç³»æ•°çš„é€‰æ‹©å¯¹æ¨¡å‹æ€§èƒ½æœ‰å½±å“ ä½œè€…æœ€ç»ˆç»“åˆæ‰€æœ‰è¢«è®¤ä¸ºæ›´ä¼˜çš„è®¾è®¡è¦ç´ : åŸºäº prefix-tuning (é—¨æ§ç›¸åŠ ), åœ¨ attention å±‚ä½¿ç”¨å°ç»´åº¦çš„ä¿®é¥°å±‚ l=30l=30l=30, åœ¨ FFN å±‚ä½¿ç”¨å¤§ç»´åº¦çš„ä¿®é¥°å±‚ r=512r=512r=512, è®¾è®¡å‡ºæ–°çš„æ¨¡å‹ MAM Adapter","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"Transfer Learning","slug":"Transfer-Learning","permalink":"https://blog.zhuwenq.cc/tags/Transfer-Learning/"},{"name":"Parameter-Efficient","slug":"Parameter-Efficient","permalink":"https://blog.zhuwenq.cc/tags/Parameter-Efficient/"}]},{"title":"Integrating Multimodal Information in Large Pretrained Transformers","slug":"Integrating-Multimodal-Information-in-Large-Pretrained-Transformers","date":"2022-03-23T09:20:49.000Z","updated":"2023-06-21T06:51:28.792Z","comments":true,"path":"Integrating-Multimodal-Information-in-Large-Pretrained-Transformers/","link":"","permalink":"https://blog.zhuwenq.cc/Integrating-Multimodal-Information-in-Large-Pretrained-Transformers/","excerpt":"ä½œè€…åŸºäºä¸€ç§è§‚ç‚¹ï¼šç»“åˆå¤šæ¨¡æ€ä¿¡æ¯çš„è¯­è¨€è¡¨å¾ä¸ä¸ç»“åˆå¤šæ¨¡æ€ä¿¡æ¯çš„è¯­è¨€è¡¨å¾åœ¨è¡¨å¾ç©ºé—´ä¸­çš„ä½ç½®ä¸åŒï¼Œå› æ­¤ï¼Œå¯ä»¥å°†å¤šæ¨¡æ€ä¿¡æ¯è§†ä¸ºè¡¨å¾ç©ºé—´ä¸­çš„ ç§»ä½å‘é‡ï¼Œä¸ä¸ç»“åˆå¤šæ¨¡æ€ä¿¡æ¯çš„è¯­è¨€è¡¨å¾å‘é‡ç›¸åŠ å¯ä»¥å¾—åˆ°å‘é‡ç©ºé—´ä¸­çš„æœ€ç»ˆä½ç½®ã€‚","text":"ä½œè€…åŸºäºä¸€ç§è§‚ç‚¹ï¼šç»“åˆå¤šæ¨¡æ€ä¿¡æ¯çš„è¯­è¨€è¡¨å¾ä¸ä¸ç»“åˆå¤šæ¨¡æ€ä¿¡æ¯çš„è¯­è¨€è¡¨å¾åœ¨è¡¨å¾ç©ºé—´ä¸­çš„ä½ç½®ä¸åŒï¼Œå› æ­¤ï¼Œå¯ä»¥å°†å¤šæ¨¡æ€ä¿¡æ¯è§†ä¸ºè¡¨å¾ç©ºé—´ä¸­çš„ ç§»ä½å‘é‡ï¼Œä¸ä¸ç»“åˆå¤šæ¨¡æ€ä¿¡æ¯çš„è¯­è¨€è¡¨å¾å‘é‡ç›¸åŠ å¯ä»¥å¾—åˆ°å‘é‡ç©ºé—´ä¸­çš„æœ€ç»ˆä½ç½®ã€‚ Multimodal Adaptation Gate(MAG) ä½œè€…åŸºäºä¸Šè¿°è§‚ç‚¹ï¼Œè®¾è®¡äº†å¤šæ¨¡æ€èåˆæ¶æ„ MAG ç»“åˆ BERT å’Œ XLNet åœ¨æƒ…æ„Ÿåˆ†ç±»ä»»åŠ¡ä¸Šè¿›è¡Œäº†éªŒè¯ã€‚ MAG è¯•å›¾å°†è§†è§‰ä¿¡æ¯å’ŒéŸ³é¢‘ä¿¡æ¯èå…¥è¯­è¨€è¡¨å¾ã€‚æ•°æ®é›†ä¸­ï¼Œä½œè€…é¦–å…ˆä½¿ç”¨æœºå™¨ç¿»è¯‘ç”Ÿæˆè§†é¢‘å­—å¹•ï¼Œç„¶åäººå·¥ä¿®æ­£ï¼Œä½œä¸ºè¯­è¨€ä¿¡æ¯ã€‚éšåä½œè€…æ ¹æ®æ—¶é—´å…±ç°æ€§æå–å‡º &lt;å›¾åƒï¼ŒéŸ³é¢‘ï¼Œå­—å¹•&gt; çš„åºåˆ—ï¼Œå…¶ä¸­æ¯ä¸ªä¸‰å…ƒç»„æ˜¯åŒæ—¶å‡ºç°çš„ã€‚ MAG éšåæå–å›¾åƒä¸­çš„ç‰¹å¾ä¿¡æ¯(ä»»åŠ¡çš„è¡¨æƒ…ï¼Œæ‰‹éƒ¨åŠ¨ä½œç­‰)å’Œè¯­éŸ³ä¸­çš„ç‰¹å¾ä¿¡æ¯(è¯­è°ƒç­‰)ï¼Œå¹¶ç¼–ç ä¸ºå‘é‡ä¸è¯­è¨€ä¿¡æ¯èåˆã€‚ è®°åºåˆ—ä¸­ç¬¬ iii ä¸ªå…ƒç»„çš„è¯­è¨€åµŒå…¥å‘é‡ï¼Œè¯­éŸ³åµŒå…¥å‘é‡å’Œè§†è§‰åµŒå…¥å‘é‡ä¸º (Zi,Ai,Vi)(Z_i, A_i, V_i)(Ziâ€‹,Aiâ€‹,Viâ€‹), ä½œè€…é¦–å…ˆå°†è¯­è¨€å‘é‡åˆ†åˆ«å’Œå…¶ä»–æ¨¡æ€å‘é‡æ‹¼æ¥ï¼Œåˆ†åˆ«è®¡ç®—å‡ºé—¨æ§å‘é‡ givg_i^vgivâ€‹ å’Œ giag_i^agiaâ€‹: giv=R(Wgv[Zi;Vi]+bv)gia=R(Wga[Zi;Ai]+ba)\\begin{aligned} g_i^v &amp;= R(W_{gv}[Z_i; V_i] + b_v)\\\\ g_i^a &amp;= R(W_{ga}[Z_i; A_i] + b_a) \\end{aligned}givâ€‹giaâ€‹â€‹=R(Wgvâ€‹[Ziâ€‹;Viâ€‹]+bvâ€‹)=R(Wgaâ€‹[Ziâ€‹;Aiâ€‹]+baâ€‹)â€‹ å…¶ä¸­ RRR æ˜¯æ¿€æ´»å‡½æ•°. ä½œè€…è®¤ä¸ºï¼Œä¸Šè¿°é—¨æ§ç½‘ç»œå¯ä»¥è®¡ç®—å‡ºå¤šæ¨¡æ€ä¿¡æ¯ä¸è¯­è¨€ä¿¡æ¯çš„ç›¸å…³ç³»æ•°ã€‚ä½œè€…éšåä½¿ç”¨ä¸Šè¿°é—¨æ§ç³»æ•°ä¸å¤šæ¨¡æ€åµŒå…¥å‘é‡ç›¸ä¹˜è·å¾—å¤šæ¨¡æ€ä¿¡æ¯èåˆå‘é‡ï¼Œå³ï¼šè¡¨å¾ç©ºé—´ä¸­çš„ä½ç§»å‘é‡ï¼š Hi=giaâ‹…(WaAi)+givâ‹…(WvVi)+bHH_i = g_i^a\\cdot(W_aA_i) + g_i^v\\cdot(W_vV_i) + b_H Hiâ€‹=giaâ€‹â‹…(Waâ€‹Aiâ€‹)+givâ€‹â‹…(Wvâ€‹Viâ€‹)+bHâ€‹ éšåï¼ŒæŒ‰ç…§ä½ç§»å‘é‡çš„è§‚ç‚¹ï¼Œä½œè€…å°†å¤šæ¨¡æ€ä¿¡æ¯å‘é‡å’Œè¯­è¨€å‘é‡ç›¸åŠ è·å¾—å¤šæ¨¡æ€ä¿¡æ¯ä¸‹çš„è¯­è¨€è¡¨å¾ï¼š ZË‰i=Zi+Î±Hi\\bar{Z}_i = Z_i + \\alpha H_i ZË‰iâ€‹=Ziâ€‹+Î±Hiâ€‹ å…¶ä¸­ Î±=minâ¡(âˆ¥Ziâˆ¥2âˆ¥Hiâˆ¥2Î²,1)\\alpha = \\min(\\frac{\\|Z_i\\|_2}{\\|H_i\\|_2}\\beta, 1)Î±=min(âˆ¥Hiâ€‹âˆ¥2â€‹âˆ¥Ziâ€‹âˆ¥2â€‹â€‹Î²,1) ä¸Šè¿° MAG æ¨¡å‹å°†å¤šæ¨¡æ€ä¿¡æ¯å‘é‡ä¸è¯­è¨€è¡¨å¾å‘é‡åšäº†èåˆï¼Œä½œè€…éšåä»‹ç»äº† MAG ä¸ BERT çš„ç»“åˆã€‚ MAG-BERT ä½œè€…é€‰æ‹©å°† MAG æ¨¡å‹å¤¹åœ¨ BERT çš„æŸä¸¤å±‚ä¹‹é—´ï¼Œä¸å¦¨è®°ä½œç¬¬ jjj å±‚å’Œç¬¬ j+1j + 1j+1 å±‚ä¹‹é—´ï¼Œåˆ™ MAG çš„è¯­è¨€è¡¨å¾æ¥è‡ª BERT ç¬¬ jjj å±‚ transformer layer çš„è¾“å‡ºï¼Œä¸”è‡ª j+1j + 1j+1 å±‚èµ·ï¼Œè¾“å…¥å‘é‡ä¸­èå…¥äº†å¤šæ¨¡æ€ä¿¡æ¯ï¼š åœ¨æƒ…æ„Ÿåˆ†ç±»ä»»åŠ¡ä¸­ï¼Œä½œè€…ç›´æ¥å–åºåˆ—å¼€å¤´çš„ [CLS][CLS][CLS] token çš„è¡¨å¾ä½œä¸ºæ•´ä¸ªåºåˆ—çš„è¡¨å¾ã€‚ MAG-XLNet MAG-XLNet çš„ç»“æ„ä¸ MAG-BERT ç›¸åŒï¼Œä¸åŒä¹‹å¤„æ¥è‡ª XLNet æœ¬èº«ï¼šåœ¨ XLNet ä¸­ï¼Œ[CLS][CLS][CLS] token åŠ åœ¨åºåˆ—çš„å°¾éƒ¨ã€‚ experiment ä½œè€…åœ¨ CMU-MOSI æ•°æ®é›†ä¸Šè¿›è¡Œäº†å®éªŒï¼Œè¯¥æ•°æ®é›†æ˜¯å¤šæ¨¡æ€æƒ…æ„Ÿåˆ†ç±»æ•°æ®é›†ï¼Œæ•°æ®æ¥è‡ª youtube ç”µå½±è¯„è®ºè§†é¢‘ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œä½œè€…è¯•éªŒäº† MAG å¯ä»¥æ”¾ç½®çš„ä½ç½®ï¼šä»åµŒå…¥å±‚ä¹‹åç¬¬ä¸€å±‚ transformers ä¹‹å‰åˆ°æœ€åä¸€å±‚ transformer ä¹‹å‰ï¼Œç»“æœæ˜¾ç¤ºæ”¾åœ¨ç¬¬ä¸€å±‚ transformer ä¹‹åæ€§èƒ½æœ€å¥½ã€‚è¿™ä¸€ç»“æœæ˜¯ç¬¦åˆç›´è§‰çš„ï¼šåµŒå…¥å±‚çš„è¯­è¨€è¡¨å¾æ²¡æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè€Œåœ¨å¤ªé åçš„å±‚åŠ å…¥å¤šæ¨¡æ€ä¿¡æ¯åˆ™æ— æ³•å¯¹å…¶è¿›è¡Œæœ‰æ•ˆçš„ä¸Šä¸‹æ–‡èåˆã€‚","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"Multimodal","slug":"Multimodal","permalink":"https://blog.zhuwenq.cc/tags/Multimodal/"},{"name":"Visual Knowledge","slug":"Visual-Knowledge","permalink":"https://blog.zhuwenq.cc/tags/Visual-Knowledge/"},{"name":"Aoustic Knowledge","slug":"Aoustic-Knowledge","permalink":"https://blog.zhuwenq.cc/tags/Aoustic-Knowledge/"}]},{"title":"è«é‡Œæ–¯éå†","slug":"è«é‡Œæ–¯éå†","date":"2022-03-20T08:47:29.000Z","updated":"2023-06-21T06:51:28.944Z","comments":true,"path":"è«é‡Œæ–¯éå†/","link":"","permalink":"https://blog.zhuwenq.cc/%E8%8E%AB%E9%87%8C%E6%96%AF%E9%81%8D%E5%8E%86/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 5 æœˆ 3 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 5 æœˆ 3 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç† è«é‡Œæ–¯éå† (Morris Traversal) æ˜¯ä¸€ç§æ—¶é—´å¤æ‚åº¦ä¸º O(n) ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1) ï¼Œä¸”ä¸æ”¹å˜æ ‘çš„ç»“æ„çš„äºŒå‰æ ‘éå†ç®—æ³•ã€‚ è«é‡Œæ–¯éå† é€šå¸¸çš„äºŒå‰æ ‘éå†ç®—æ³•ä½¿ç”¨å †æ ˆæˆ–è€…é€’å½’å®Œæˆï¼Œå®ƒä»¬çš„ç©ºé—´å¤æ‚åº¦é€šå¸¸æ˜¯ O(n) çš„ã€‚ è¦ä½¿ç”¨ O(1) çš„ç©ºé—´å®ç°éå†ï¼Œæœ€ä¸»è¦çš„éš¾ç‚¹æ˜¯å¦‚ä½•åœ¨æŒ‡é’ˆåˆ°è¾¾å¶èŠ‚ç‚¹çš„æ—¶å€™å›åˆ°çˆ¶èŠ‚ç‚¹ï¼Œåœ¨ä¸èƒ½ä½¿ç”¨å †æ ˆçš„æƒ…å†µä¸‹ï¼Œè«é‡Œæ–¯éå†ä½¿ç”¨çº¿ç´¢äºŒå‰æ ‘ (Threaded Binary Tree) çš„æ€æƒ³ï¼Œè«é‡Œæ–¯æ–¹æ³•ä¸­ä¸éœ€è¦é¢å¤–çš„ç©ºé—´æ¥ä¿å­˜å¶å­èŠ‚ç‚¹çš„å‰é©± (predecessor) èŠ‚ç‚¹å’Œåç»§ (successor) èŠ‚ç‚¹ï¼Œåªéœ€è¦åˆ©ç”¨å¶å­èŠ‚ç‚¹çš„ç©ºé—²å·¦å³å­èŠ‚ç‚¹æŒ‰ç…§ä¸€å®šçš„é¡ºåºæŒ‡å‘å‰é©±æˆ–åç»§èŠ‚ç‚¹å°±å¯ä»¥ã€‚ é¦–å…ˆçœ‹è«é‡Œæ–¯æ–¹æ³•çš„ä¸­åºéå†ï¼Œé€šè¿‡ä¸­åºéå†å¯ä»¥æ¨å‡ºå…¶ä»–é¡ºåºçš„éå†ã€‚ é¦–å…ˆå®ç°ä¸€ä¸ª LeetCode é£æ ¼çš„äºŒå‰æ ‘èŠ‚ç‚¹åŸå‹ï¼š 123456struct TreeNode&#123; int val; TreeNode* left; TreeNode* right; TreeNode(int _val):val(_val),left(NULL),right(NULL)&#123; &#125;&#125; ä¸­åºéå† ç®—æ³•æµç¨‹ï¼š å¦‚æœå½“å‰èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™è®¿é—®å½“å‰èŠ‚ç‚¹å¹¶ä»¥å½“å‰èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ä½œä¸ºå½“å‰èŠ‚ç‚¹ï¼ˆä¸æ™®é€šéå†æ— å¼‚ï¼‰ å¦‚æœå½“å‰èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™åœ¨å½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸­å¯»æ‰¾å½“å‰èŠ‚ç‚¹åœ¨ä¸­åºéå†ä¸‹çš„å‰é©±èŠ‚ç‚¹ å¦‚æœå‰é©±èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™å°†å®ƒçš„å³å­èŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹ï¼ˆè®¾ç½®çº¿ç´¢ï¼‰ã€‚æ›´æ–°å½“å‰èŠ‚ç‚¹ä¸ºå½“å‰èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ å¦‚æœå‰é©±èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ä¸ºå½“å‰èŠ‚ç‚¹ï¼Œåˆ™å°†å…¶é‡è®¾ä¸ºç©ºï¼ˆæ–­å¼€çº¿ç´¢ï¼Œæ¢å¤æ ‘çš„å½¢çŠ¶ï¼‰ã€‚è®¿é—®å½“å‰èŠ‚ç‚¹å¹¶æ›´æ–°å½“å‰èŠ‚ç‚¹ä¸ºå½“å‰èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ã€‚ é‡å¤ä»¥ä¸Šä¸¤ç‚¹ç›´åˆ°å½“å‰èŠ‚ç‚¹ä¸ºç©ºã€‚ çº¿ç´¢è®¾ç½®å’Œéå†è¿‡ç¨‹å›¾ç¤º: ä»£ç è¿‡ç¨‹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627void visit(TreeNode *root);void inOrderTraversal(TreeNode *root)&#123; TreeNode *cur = root; TreeNode *prev = NULL; while (cur != NULL) &#123; if (cur-&gt;left == NULL) &#123; //æœ€å·¦ä¾§ visit(cur); cur = cur-&gt;right; &#125; else &#123; prev = cur-&gt;left; while (prev-&gt;right != NULL &amp;&amp; prev-&gt;right != cur) //find the predecessor prev = prev-&gt;right; if (prev-&gt;right == NULL) &#123; prev-&gt;right = cur; cur = cur-&gt;left; &#125; else if (prev-&gt;right == cur) &#123; //recover prev-&gt;right = NULL; visit(cur); cur = cur-&gt;right; &#125; &#125; &#125;&#125; ç®—æ³•çš„ç©ºé—´å¤æ‚åº¦æ˜¯ O(1) çš„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸»è¦ä½“ç°åœ¨å¯»æ‰¾å‰é©±èŠ‚ç‚¹çš„æ“ä½œä¸Šï¼š 12while (prev != NULL &amp;&amp; prev-&gt;right != NULL) //find the predecessor prev = prev-&gt;right; è¿™æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦ç›´è§‚ä¸Šæ˜¯ O(log n) çš„ï¼Œä½†æ˜¯ç”±äºè¦å¯¹æ¯ä¸ªå·¦å­èŠ‚ç‚¹éç©ºçš„èŠ‚ç‚¹éƒ½è¦åšä¸€æ¬¡ï¼Œå› æ­¤æ€»ä½“ä¸Šæ˜¯ O(n) çš„ã€‚ å‰åºéå† å‰åºéå†ä¸ä¸­åºéå†æ€»ä½“ä¸Šæ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯è®¿é—®èŠ‚ç‚¹çš„æ—¶æœºç•¥æœ‰ä¸åŒ ç®—æ³•æµç¨‹ï¼š å¦‚æœå½“å‰èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™è®¿é—®å½“å‰èŠ‚ç‚¹å¹¶ä»¥å½“å‰èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ä½œä¸ºå½“å‰èŠ‚ç‚¹ï¼ˆä¸æ™®é€šéå†æ— å¼‚ï¼‰ å¦‚æœå½“å‰èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™åœ¨å½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸­å¯»æ‰¾å½“å‰èŠ‚ç‚¹åœ¨ä¸­åºéå†ä¸‹çš„å‰é©±èŠ‚ç‚¹ å¦‚æœå‰é©±èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™å°†å®ƒçš„å³å­èŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹ï¼ˆè®¾ç½®çº¿ç´¢ï¼‰ä¹‹åè®¿é—®å½“å‰èŠ‚ç‚¹ã€‚æ›´æ–°å½“å‰èŠ‚ç‚¹ä¸ºå½“å‰èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ å¦‚æœå‰é©±èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ä¸ºå½“å‰èŠ‚ç‚¹ï¼Œåˆ™å°†å…¶é‡è®¾ä¸ºç©ºï¼ˆæ–­å¼€çº¿ç´¢ï¼Œæ¢å¤æ ‘çš„å½¢çŠ¶ï¼‰ã€‚æ›´æ–°å½“å‰èŠ‚ç‚¹ä¸ºå½“å‰èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ã€‚ é‡å¤ä»¥ä¸Šä¸¤ç‚¹ç›´åˆ°å½“å‰èŠ‚ç‚¹ä¸ºç©ºã€‚ ä»£ç è¿‡ç¨‹ï¼š 12345678910111213141516171819202122232425void preOrderTraversal(TreeNode *root)&#123; TreeNode *cur = root; TreeNode *prev = NULL; while (cur != NULL) &#123; if (cur != NULL) &#123; visit(cur); cur = cur-&gt;right; &#125; else &#123; prev = cur-&gt;left; while (prev-&gt;right != NULL &amp;&amp; prev-&gt;right != cur) prev = prev-&gt;right; if (prev-&gt;right == NULL) &#123; prev-&gt;right = cur; visit(cur); cur = cur-&gt;left; &#125; else &#123; prev-&gt;right = NULL; cur = cur-&gt;right; &#125; &#125; &#125;&#125; Reference Morris Traversalæ–¹æ³•éå†äºŒå‰æ ‘ï¼ˆéé€’å½’ï¼Œä¸ç”¨æ ˆï¼ŒO(1)ç©ºé—´ï¼‰","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"éå†","slug":"éå†","permalink":"https://blog.zhuwenq.cc/tags/%E9%81%8D%E5%8E%86/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://blog.zhuwenq.cc/tags/%E7%AE%97%E6%B3%95/"},{"name":"çº¿ç´¢æ ‘","slug":"çº¿ç´¢æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E7%BA%BF%E7%B4%A2%E6%A0%91/"}]},{"title":"æ•°æ®ç»“æ„-å›¾çš„æœ€çŸ­è·¯å¾„é—®é¢˜","slug":"æ•°æ®ç»“æ„-å›¾çš„æœ€çŸ­è·¯å¾„é—®é¢˜","date":"2022-03-20T08:22:04.000Z","updated":"2023-06-21T06:51:28.940Z","comments":true,"path":"æ•°æ®ç»“æ„-å›¾çš„æœ€çŸ­è·¯å¾„é—®é¢˜/","link":"","permalink":"https://blog.zhuwenq.cc/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%9B%BE%E7%9A%84%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 4 æœˆ 10 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 4 æœˆ 10 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç† å³ï¼šåœ¨ç½‘ç»œï¼ˆå¸¦æƒå›¾ï¼‰ä¸­ï¼Œæ±‚ä¸¤ä¸ªä¸åŒé¡¶ç‚¹ä¹‹é—´çš„æ‰€æœ‰è·¯å¾„ä¸­ï¼Œè¾¹çš„æƒå€¼å’Œæœ€å°çš„é‚£æ¡è·¯å¾„ã€‚è¿™æ¡è·¯å¾„å°±å«æœ€çŸ­è·¯å¾„ (Shortest Path) ï¼Œè¿™æ¡è·¯å¾„çš„èµ·ç‚¹å«åšæºç‚¹ (Source) ï¼Œè·¯å¾„çš„æœ€åä¸€ä¸ªé¡¶ç‚¹å«åšç»ˆç‚¹ (Destination) ã€‚ æœ€çŸ­è·¯å¾„é—®é¢˜ä¸æ˜¯ä¸€ä¸ªå­¤ç«‹çš„é—®é¢˜ï¼Œå®ƒæ˜¯ä¸€ç³»åˆ—é—®é¢˜çš„é›†åˆï¼Œå¯ä»¥åˆ†ä¸ºå•æºæœ€çŸ­è·¯å¾„é—®é¢˜å’Œå¤šæºæœ€çŸ­è·¯å¾„é—®é¢˜ã€‚ å•æºæœ€çŸ­è·¯å¾„é—®é¢˜ å³ä»æŸå›ºå®šæºç‚¹å‡ºå‘ï¼Œæ±‚å…¶åˆ°å…¶ä»–ä»»ä¸€ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚ å…¶è¿‡ç¨‹æ˜¯æŒ‰ç…§è·¯å¾„é•¿åº¦é€’å¢ï¼ˆéé€’å‡ï¼‰çš„é¡ºåºæ‰¾åˆ°åˆ°è¾¾å„ä¸ªé¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºçš„å›¾ï¼š å‡è®¾é¡¶ç‚¹ 0 æ˜¯æºç‚¹ï¼Œåˆ™è·æºç‚¹çš„è·ç¦»ä¸ºçš„é¡¶ç‚¹æ˜¯ 0 ï¼Œè·ç¦»æºç‚¹ä¸ºçš„é¡¶ç‚¹æœ‰ 1,4 ï¼Œä»–ä»¬æ˜¯æºç‚¹çš„é‚»æ¥ç‚¹ã€‚æŸ¥æ‰¾è·ç¦»ä¸º 2 çš„é¡¶ç‚¹æ—¶ï¼Œä¸éœ€è¦ä»æºç‚¹å¼€å§‹æŸ¥æ‰¾ï¼Œå¯ä»¥ä»è·ç¦»ä¸º 1 çš„é¡¶ç‚¹æŸ¥æ‰¾ä»–ä»¬çš„é‚»æ¥ç‚¹ï¼ˆåŒæ—¶ä¸èƒ½æ˜¯æºç‚¹çš„é‚»æ¥ç‚¹ï¼‰ã€‚è¿™ä¸€è¿‡ç¨‹ä¸å¹¿åº¦ä¼˜å…ˆæœç´¢ç›¸ä¼¼ï¼Œéƒ½æ˜¯ä¼˜å…ˆæŸ¥æ‰¾é¡¶ç‚¹çš„æ‰€æœ‰é‚»æ¥ç‚¹ã€‚ å¯¹è·ç¦»ä» 0 åˆ° 1 çš„é¡¶ç‚¹åˆ—è¡¨ï¼Œå¯å¾—ä¸‹è¡¨ï¼š è·æºç‚¹çš„è·ç¦» é¡¶ç‚¹ 0 0 1 1, 4 2 2, 3 å›å¿†å¹¿åº¦ä¼˜å…ˆæœç´¢çš„ç¨‹åºè¿‡ç¨‹ï¼š 123456789101112131415161718192021int Visited[MaxSize] = 0;void breadthFirstSearch(Graph *graph, Vertex *vertex)&#123; visit(vertex); //visite vertex first Visited[vertex-&gt;id] = 1; //set visited true Queue *queue = createQueue(); add(queue, vertex); //add to queue to find its neighbors while (!isEmpty(queue)) &#123; Vertex *v = delete (queue); for (v çš„æ¯ä¸ªé‚»å±…èŠ‚ç‚¹ neighbor) &#123; if (!Visited[neighbor-&gt;id]) //if not visted,visit and add to queue &#123; visit(neighbor); Visited[neighbor-&gt;id] = 1; add(queue, neighbor); &#125; &#125; &#125;&#125; æ— æƒå•æºæœ€çŸ­è·¯å¾„ç®—æ³• å¯¹äºå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª Visited æ•°ç»„æ¥è®°å½•é¡¶ç‚¹æœ‰æ²¡æœ‰è¢«è®¿é—®è¿‡ï¼Œåœ¨æœ€çŸ­è·¯å¾„é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®°å½•é¡¶ç‚¹ä¸æºç‚¹ä¹‹é—´çš„è·ç¦»ã€‚è¿™é‡Œä½¿ç”¨ä¸€ä¸ª dist æ•°ç»„ dist[v] = é¡¶ç‚¹vä¸æºç‚¹ä¹‹é—´çš„è·ç¦» æ¥è®°å½•è·ç¦»ã€‚åŒæ—¶æœ€çŸ­è·¯å¾„é—®é¢˜å®é™…ä¸Šéœ€è¦æ±‚è§£çš„ä¸ä»…æ˜¯æœ€çŸ­è·ç¦»ï¼Œè¿˜éœ€è¦æ±‚è§£å®é™…çš„è·¯å¾„ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå®¹å™¨è®°å½•ä»æºç‚¹åˆ°è¾¾é¡¶ç‚¹çš„è·¯å¾„ã€‚å¯ä»¥ä½¿ç”¨ä¸€ä¸ª path æ•°ç»„ path[w] = v //væ˜¯ä»æºç‚¹å»é¡¶ç‚¹wçš„å¿…ç»é¡¶ç‚¹æ¥è®°å½•è·¯å¾„ ï¼Œè¿™æ ·ï¼Œå½“éœ€è¦ç›´åˆ°æºç‚¹åˆ°é¡¶ç‚¹ w çš„è·¯å¾„æ—¶ï¼Œé€’å½’çš„è®¿é—®æ•°ç»„ path å°±å¯ä»¥å¾—åˆ°: 1234567vertex v;//ç›®çš„é¡¶ç‚¹wStack stack;while(dist[w]!=0)//Dist[w] == 0æ—¶ï¼Œè¯´æ˜é€’å½’åˆ°äº†æºç‚¹ï¼Œè·¯å¾„ç”Ÿæˆå®Œæ¯•&#123; push(stack,w);//è·¯å¾„é¡¶ç‚¹å‹æ ˆ w = path[w];&#125; ç»¼ä¸Šï¼Œæ— æƒå•æºæœ€çŸ­è·¯å¾„é—®é¢˜çš„ç¨‹åºè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š 1234567891011121314151617181920int dist[MaxSize] = &#123;-1&#125;;int path[MaxSize];void shortestPath(Vertex vertex)&#123; Queue *queue = new Queue(); enqueue(queue, vertex); while (!isEmpty(queue)) &#123; Vertex v = dequeue(queue); for (v çš„æ‰€æœ‰é‚»å±…é¡¶ç‚¹ n) &#123; if (dist[n] == -1) &#123; dist[n] = dist[v] + 1; path[n] = v; enqueue(queue, n); &#125; &#125; &#125;&#125; è¿™ä¸ªè¿‡ç¨‹çš„å¤§éƒ¨åˆ†ä¸å¹¿åº¦ä¼˜å…ˆæœç´¢æ— å¼‚ï¼Œåªæ˜¯åœ¨åˆ¤æ–­æ˜¯å¦å·²è®¿é—®ä»¥åŠæ ‡è®°è·¯å¾„è·ç¦»å’Œè®°å½•è·¯å¾„æ–¹é¢ç¨æœ‰ä¸åŒã€‚ ç¨‹åºæ‰§è¡Œå®Œæˆåï¼Œä»æºç‚¹åˆ°å›¾ä¸­å„ä¸ªé¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„é•¿åº¦è¢«è®°å½•åœ¨æ•°ç»„ dist[] ä¸­ï¼Œè·¯å¾„ä¿¡æ¯è¢«è®°å½•åœ¨æ•°ç»„ path[] ä¸­ã€‚ å¸¦æƒå•æºæœ€çŸ­è·¯å¾„ç®—æ³• é¦–å…ˆçœ‹å¦‚ä¸‹å›¾æ‰€ç¤ºçš„å¸¦æƒå›¾ï¼š å¯ä»¥çœ‹åˆ°è¾¹ &lt;v2,v5&gt;&lt;v_2, v_5&gt;&lt;v2â€‹,v5â€‹&gt; çš„æƒå€¼æ˜¯ âˆ’10-10âˆ’10 ï¼Œå¯¹è¿™ä¸ªå›¾è€Œè¨€ï¼Œåªè¦æ²¿ç€è·¯å¾„ v4â†’v2â†’v5v_4\\rightarrow v_2\\rightarrow v_5v4â€‹â†’v2â€‹â†’v5â€‹ èµ°ä¸€åœˆï¼Œæ€»çš„æƒå€¼å’Œå°±æ˜¯ âˆ’5-5âˆ’5 ï¼Œå¦‚æœèµ°æ— æ•°åœˆï¼Œæƒå€¼å’Œå°±æ˜¯ âˆ’âˆ-\\inftyâˆ’âˆ ã€‚è¿™ç§èµ°ä¸€åœˆæƒå€¼å’Œä¸ºè´Ÿå€¼çš„åœˆè¢«ç§°ä¸ºè´Ÿå€¼åœˆ (nagative-cost cycle) ï¼Œæ˜¾ç„¶ï¼Œåªè¦å›¾ä¸­å­˜åœ¨è´Ÿå€¼åœˆï¼Œä¸€èˆ¬çš„ç®—æ³•è‚¯å®šæ— æ³•æ­£å¸¸å·¥ä½œã€‚å› æ­¤ï¼Œä¸‹é¢çš„è®¨è®ºé»˜è®¤å›¾ä¸­ä¸å­˜åœ¨è´Ÿå€¼åœˆã€‚ æ— æƒå›¾å¯ä»¥çœ‹ä½œç‰¹æ®Šçš„å¸¦æƒå›¾ï¼Œå› æ­¤ï¼Œå¸¦æƒå›¾çš„å•æºæœ€çŸ­è·¯å¾„ç®—æ³•å®é™…ä¸Šä¸æ— æƒå›¾çš„å•æºæœ€çŸ­è·¯å¾„ç®—æ³•æœ‰ä¸€å®šçš„ç›¸ä¼¼ä¹‹å¤„ï¼Œä»–ä»¬éƒ½æ˜¯æŒ‰ç…§è·¯å¾„é•¿åº¦é€’å¢ï¼ˆéé€’å‡ï¼‰çš„é¡ºåºæ‰¾åˆ°æœ€çŸ­è·¯å¾„ã€‚ä¸‹é¢è®¨è®ºçš„å¸¦æƒå›¾çš„å•æºæœ€çŸ­è·¯å¾„ç®—æ³•å°±æ˜¯å¤§åé¼é¼çš„ **è¿ªæ°æ–¯ç‰¹æ‹‰ (Dijkstra)**ç®—æ³•ã€‚ Dijkstraç®—æ³•å¤§è‡´æœ‰ä»¥ä¸‹è¿‡ç¨‹ï¼š å®šä¹‰ä¸€ä¸ªé›†åˆ s ï¼Œ s åœ¨åˆå§‹çŠ¶æ€ä¸‹åªæœ‰æºç‚¹ source å­˜åœ¨ã€‚ç„¶åé€æ­¥å°†å·²ç»ç¡®å®šäº†æœ€çŸ­è·¯å¾„çš„èŠ‚ç‚¹æ”¶è¿›é›†åˆ s ã€‚å³ï¼šs=source+å·²ç»ç¡®å®šäº†æœ€çŸ­è·¯å¾„çš„é¡¶ç‚¹vis = source + å·²ç»ç¡®å®šäº†æœ€çŸ­è·¯å¾„çš„é¡¶ç‚¹ v_is=source+å·²ç»ç¡®å®šäº†æœ€çŸ­è·¯å¾„çš„é¡¶ç‚¹viâ€‹ å¯¹äºå›¾ä¸­ä»»ä½•ä¸€ä¸ªå°šæœªæ”¶è¿› s çš„é¡¶ç‚¹ v ï¼Œå®šä¹‰ dist[v] = æºç‚¹åˆ°é¡¶ç‚¹ v çš„æœ€çŸ­è·¯å¾„é•¿åº¦ ï¼ŒåŒæ—¶è¯¥è·¯å¾„å¿…é¡»ä»…ä»…ç»è¿‡é›†åˆ s ä¸­çš„é¡¶ç‚¹ï¼Œå³è·¯å¾„ sourceâ†’viâˆˆsâ†’vsource\\rightarrow v_i \\in s\\rightarrow vsourceâ†’viâ€‹âˆˆsâ†’v çš„é•¿åº¦ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç¨‹åºè¿è¡Œçš„åˆå§‹é˜¶æ®µï¼Œé›†åˆ s ä¸­çš„é¡¶ç‚¹è¾ƒå°‘ï¼Œæ­¤æ—¶è·¯å¾„ sourceâ†’viâˆˆsâ†’vsource\\rightarrow v_i \\in s\\rightarrow vsourceâ†’viâ€‹âˆˆsâ†’v å¤šåŠå¹¶ä¸æ˜¯æœ€çŸ­è·¯å¾„ï¼Œä½†æ˜¯éšç€é›†åˆ s çš„æ‰©å¤§ï¼Œè¯¥è·¯å¾„ä¹Ÿä¼šä¸æ–­å®Œå–„ï¼Œæœ€åå½“æ‰€æœ‰é¡¶ç‚¹éƒ½è¢«æ”¶å…¥é›†åˆ s ï¼Œæœ€åçš„è·¯å¾„å°±ä¸€å®šæ˜¯æœ€çŸ­è·¯å¾„äº†ã€‚ ç”±äºè·¯å¾„æ˜¯æŒ‰ç…§é€’å¢ï¼ˆéé€’å‡ï¼‰çš„é¡ºåºç”Ÿæˆçš„ï¼Œå› æ­¤æœ‰ä»¥ä¸‹ç»“è®ºï¼š çœŸæ­£çš„æœ€çŸ­è·¯å¾„è‚¯å®šåªç»è¿‡é›†åˆ s ä¸­çš„èŠ‚ç‚¹ æ¯æ¬¡æ”¶å½•è¿›é›†åˆ s çš„é¡¶ç‚¹æ˜¯å‰©ä½™æœªæ”¶å½•é¡¶ç‚¹ä¸­ dist å€¼æœ€å°çš„é¡¶ç‚¹ï¼ˆè´ªå¿ƒç®—æ³•ï¼‰ å¢åŠ ä¸€ä¸ªé¡¶ç‚¹ v è¿›å…¥é›†åˆ s æ—¶ï¼Œå¯èƒ½ä¼šå½±å“åˆ°å…¶ä»–é¡¶ç‚¹ w çš„ dist å€¼ï¼Œè¿™æ˜¯å› ä¸ºæºç‚¹åˆ°é¡¶ç‚¹ w çš„è·¯å¾„å¯èƒ½ä¼šç»è¿‡é¡¶ç‚¹ v ï¼Œå¹¶ä¸”é¡¶ç‚¹ v åˆ°é¡¶ç‚¹ w ä¹‹é—´å¯èƒ½å­˜åœ¨ä¸€æ¡è¾¹ã€‚å› æ­¤éœ€è¦å¯¹é¡¶ç‚¹ w çš„ dist å€¼è¿›è¡Œæ›´æ–°ï¼š dist[w]=min(dist[w],dist[v]+&lt;v,w&gt;çš„æƒå€¼)dist[w] = min(dist[w],dist[v] + &lt;v,w&gt;çš„æƒå€¼)dist[w]=min(dist[w],dist[v]+&lt;v,w&gt;çš„æƒå€¼) ã€‚ ä¸‹é¢æ˜¯ Dijkstra ç®—æ³•çš„å¤§è‡´è¿‡ç¨‹ï¼Œé¦–å…ˆä¸ºäº†è¡¨ç¤ºé›†åˆ s ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ•°ç»„ collected æ¥è®°å½•é¡¶ç‚¹æ˜¯å¦è¢«æ”¶å½•ï¼ˆç±»ä¼¼å›¾çš„æœç´¢ç®—æ³•ä¸­çš„ Visited æ•°ç»„ï¼‰ 12345678910111213141516171819202122232425int dist[MaxSize] = &#123;infty&#125;;int path[MaxSize];bool collected[MaxSize] = &#123;false&#125;;void dijkstra(Vertex vertex)&#123; while (true) &#123; å–æœªè¢«é›†åˆæ”¶å½•çš„é¡¶ç‚¹ä¸­distå€¼æœ€å°çš„é¡¶ç‚¹v //è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç›´æ¥æ‰«æå…¨éƒ¨é¡¶ç‚¹ç„¶åå–æœ€å°æˆ–è€…æŠŠé¡¶ç‚¹å­˜åœ¨ä¸€ä¸ªæœ€å°å †ä¸­ if (vä¸å­˜åœ¨ï¼Œå³é¡¶ç‚¹å®Œå…¨è¢«æ”¶å½•) break; //è·³å‡ºå¾ªç¯ collected[v] = true; //æ”¶å½•é¡¶ç‚¹ for (v çš„æ‰€æœ‰é‚»å±…èŠ‚ç‚¹ w) &#123; if (!collected[w]) &#123; if (dist[v] + weight(v, w) &lt; dist[w]) &#123; //æ³¨æ„åˆ°è¿™ä¸ªæ¡ä»¶è¦æ±‚dist[w]&gt;=dist[v]+weight(v,w)æ—¶ä¸‹é¢çš„æ›´æ–°è·¯å¾„é•¿åº¦ä»£ç æ‰ä¼šè¿è¡Œ //å› æ­¤distçš„åˆå§‹å€¼åº”è¯¥æ˜¯æ­£æ— ç©·ï¼Œå¦åˆ™å…¶åˆå§‹å€¼å¯èƒ½æ— æ³•è¢«æ›´æ–° dist[w] = dist[v] + weight(v, w); path[w] = v; &#125; &#125; &#125; &#125;&#125; è¿™æ®µä¼ªä»£ç ä¸é€‚ç”¨äºå­˜åœ¨è´Ÿè¾¹çš„æƒ…å†µ. å¤šæºæœ€çŸ­è·¯å¾„ç®—æ³• å¤šæºæœ€çŸ­è·¯å¾„é—®é¢˜æ±‚è§£çš„æ˜¯ä»»æ„ä¸¤ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œè¦å®ç°è¿™ä¸ªé—®é¢˜çš„æ±‚è§£ï¼Œå¯ä»¥ç”¨å›¾ä¸­æ¯ä¸€ä¸ªé¡¶ç‚¹ä½œä¸ºæºç‚¹å¯¹å…¶è¿è¡Œä¸€æ¬¡å•æºæœ€çŸ­è·¯å¾„ç®—æ³•ï¼Œè¿™ç§æ–¹æ³•æ¯”è¾ƒ low è€Œä¸”å¯¹äºç¨ å¯†å›¾æ•ˆç‡ä¸é«˜ã€‚æˆ–è€…è¿˜æœ‰ä¸€ç§å¤§åé¼é¼çš„ç®—æ³•ä¸“é—¨è§£å†³è¿™ä¸ªé—®é¢˜ï¼šä½›æ´›ä¼Šå¾— (Floyd) ç®—æ³• Floyd ç®—æ³•å¯¹äºç¨ å¯†å›¾çš„æ•ˆæœè¾ƒå¥½ï¼Œå› æ­¤ä¸‹é¢çš„å›¾ä½¿ç”¨é‚»æ¥çŸ©é˜µè¡¨ç¤ºã€‚ Floyd ç®—æ³•çš„è·¯å¾„æ˜¯æŒ‰ç…§é¡¶ç‚¹çš„ç¼–å·é€’å¢çš„é¡ºåºç”Ÿæˆçš„ï¼Œå®ƒçš„å¤§è‡´è¿‡ç¨‹å¦‚ä¸‹ï¼š ç”¨çŸ©é˜µ Dk[i][j]D^k[i][j]Dk[i][j] è¡¨ç¤ºé¡¶ç‚¹ iii åˆ°é¡¶ç‚¹ jjj ä¹‹é—´ä»…ç»è¿‡ç¼–å·å°äºç­‰äº kkk çš„é¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„é•¿åº¦ï¼Œå³è·¯å¾„ iâ†’(lâ‰¤k)â†’ji\\rightarrow (l \\leq k)\\rightarrow jiâ†’(lâ‰¤k)â†’j çš„é•¿åº¦ã€‚ç¨‹åºè¿è¡Œçš„åˆå§‹é˜¶æ®µï¼Œkkk å€¼è¾ƒå°ï¼Œè·¯å¾„å¹¶ä¸ä¸€å®šæ˜¯æœ€çŸ­è·¯å¾„ï¼Œå½“ kkk å¢é•¿åˆ°é¡¶ç‚¹ä¸ªæ•°å°‘ä¸€æ—¶ï¼Œæ‰€å¾—çš„æœ€çŸ­è·¯å¾„å°±æ˜¯å®é™…ä¸Šçš„æœ€çŸ­è·¯å¾„äº†ï¼Œå³æœ€çŸ­è·¯å¾„æ˜¯é€æ­¥ç”Ÿæˆçš„ çŸ©é˜µ Dk[i][j]D^k[i][j]Dk[i][j] çš„åˆå§‹å€¼æ˜¯ Dâˆ’1[i][j]D^{-1}[i][j]Dâˆ’1[i][j] ï¼Œå®ƒå¯ä»¥ç›´æ¥åˆå§‹åŒ–ä¸ºå›¾çš„é‚»æ¥çŸ©é˜µï¼Œå¯¹è§’å…ƒå…¨éƒ¨æ˜¯ 000 ï¼Œå¯¹äºæ²¡æœ‰ç›´æ¥è¾¹çš„é¡¶ç‚¹ kkk å’Œ mmm ï¼Œå…¶åˆå§‹å€¼ Dâˆ’1[k][m]D^{-1}[k][m]Dâˆ’1[k][m] åº”è¯¥è¢«åˆå§‹åŒ–ä¸ºæ— ç©·å¤§ ä»çŸ©é˜µ Dkâˆ’1[i][j]D^{k-1}[i][j]Dkâˆ’1[i][j] é€’æ¨åˆ°çŸ©é˜µ Dk[i][j]D^k[i][j]Dk[i][j] æ—¶ï¼Œå³æ–°è¯»å…¥ä¸€ä¸ªé¡¶ç‚¹ kkkï¼š kkk ä¸å½±å“ iii åˆ° jjj çš„æœ€çŸ­è·¯å¾„ï¼Œå³ kkk ä¸åœ¨è·¯å¾„ä¸Šï¼Œåˆ™ä¸éœ€è¦æ›´æ–°æœ€çŸ­è·¯å¾„é•¿åº¦ï¼šDk[i][j]=Dkâˆ’1[i][j]D^k[i][j] = D^{k-1}[i][j]Dk[i][j]=Dkâˆ’1[i][j] kkk å½±å“ iii åˆ° jjj çš„æœ€çŸ­è·¯å¾„ï¼Œå³ä» kkk èµ°çš„è·¯å¾„æ›´çŸ­ï¼Œåˆ™æ–°çš„è·¯å¾„ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šDk[i][j]=Dkâˆ’1[i][k]+Dkâˆ’1[k][j]D^k[i][j] = D^{k-1}[i][k] + D^{k-1}[k][j]Dk[i][j]=Dkâˆ’1[i][k]+Dkâˆ’1[k][j] è¦è®°å½•æœ€çŸ­è·¯å¾„ï¼ŒåŒæ ·éœ€è¦ä¸€ä¸ªçŸ©é˜µ Path[i][j]Path[i][j]Path[i][j] å‚¨å­˜ä» iii åˆ° jjj çš„è·¯å¾„ã€‚å‡å¦‚æˆ‘ä»¬ç»™çŸ©é˜µèµ‹å€¼ä¸º Path[i][j]=kPath[i][j]=kPath[i][j]=k ï¼Œè¿™è¡¨æ˜ä» iii åˆ° jjj çš„è·¯å¾„ç­‰äºä» iii åˆ° kkk çš„è·¯å¾„åŠ ä¸Šä» kkk åˆ° jjj çš„è·¯å¾„ã€‚å› æ­¤ï¼Œè·¯å¾„çš„å–å‡ºå¯ä»¥ä½¿ç”¨ä¸€ä¸ªé€’å½’è¿‡ç¨‹å®ç°ã€‚ Floyd ç®—æ³•çš„ç¨‹åºè¿‡ç¨‹å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829int Dist[MaxSize][MaxSize];int Path[MaxSize][MaxSize];void floyd(Vertex **map, int mapSize)&#123; //åˆå§‹åŒ– for (int i = 0; i &lt; mapSize; ++i) &#123; for (int j = 0; j &lt; mapSize; ++j) &#123; Dist[i][j] = map[i][j]; Path[i][j] = -1; &#125; &#125; for (int k = 0; k &lt; mapSize; ++k) &#123; for (int i = 0; i &lt; mapSize; ++i) &#123; for (int j = 0; j &lt; mapSize; ++j) &#123; if (Dist[i][k] + Dist[k][j] &lt; Dist[i][j]) &#123; //è¿™é‡Œåˆ¤æ–­kæ˜¯å¦å½±å“æœ€çŸ­è·¯å¾„ //è‹¥æ— è¿æ¥çš„ä¸¤ç‚¹æœªè¢«åˆå§‹åŒ–ä¸ºæ— ç©·å¤§ï¼Œä¼šå½±å“è¿™é‡Œçš„åˆ¤æ–­ Dist[i][j] = Dist[i][k] + Dist[k][j]; //æ›´æ–°æœ€çŸ­è·¯å¾„é•¿åº¦ Path[i][j] = k; &#125; &#125; &#125; &#125;&#125;","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"å›¾","slug":"å›¾","permalink":"https://blog.zhuwenq.cc/tags/%E5%9B%BE/"},{"name":"æœ€çŸ­è·¯å¾„","slug":"æœ€çŸ­è·¯å¾„","permalink":"https://blog.zhuwenq.cc/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/"}]},{"title":"æ•°æ®ç»“æ„-å›¾çš„éå†","slug":"æ•°æ®ç»“æ„-å›¾çš„éå†","date":"2022-03-20T08:11:56.000Z","updated":"2023-06-21T06:51:28.940Z","comments":true,"path":"æ•°æ®ç»“æ„-å›¾çš„éå†/","link":"","permalink":"https://blog.zhuwenq.cc/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%9B%BE%E7%9A%84%E9%81%8D%E5%8E%86/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 4 æœˆ 2 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 4 æœˆ 2 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç† ä¸¤ç§éå† æ·±åº¦ä¼˜å…ˆæœç´¢ (Depth First Search,DFS) æ·±åº¦ä¼˜å…ˆæœç´¢é¡¾åæ€ä¹‰å°±æ˜¯åœ¨æœç´¢è¿‡ç¨‹ä¸­ç…å‡†æŸæ¡è·¯å¾„ä¸€ç›´å‘ä¸‹è®¿é—®ï¼Œç›´åˆ°è®¿é—®åˆ°äº†è¿™æ¡è·¯å¾„çš„ç»ˆç‚¹æ‰åˆ‡æ¢åˆ°å…¶ä»–è·¯å¾„ã€‚é—®é¢˜æ˜¯ï¼Œåœ¨æŸæ¡è·¯å¾„ä¸Šä¸€è·¯å‘ä¸‹è®¿é—®æ—¶ï¼Œéœ€è¦ä¿å­˜ä½æ¥æ—¶çš„è·¯å¾„ä¿¡æ¯ï¼Œå¦åˆ™åœ¨åˆ°è¾¾ç»ˆç‚¹çš„æ—¶å€™å°†æ— æ³•è¿”å›åˆ°èµ·ç‚¹åˆ‡æ¢å…¶ä»–è·¯å¾„ã€‚ è¿™ç§ä¸€è·¯å‘ä¸‹ç›´åˆ°æŸä¸ªæ¡ä»¶ï¼ˆç»ˆç‚¹ï¼‰å†åŸè·¯è¿”å›çš„è¿‡ç¨‹å¾ˆåƒç¨‹åºè®¾è®¡ä¸­çš„é€’å½’æ€æƒ³ï¼Œå› æ­¤ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢å¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨æ ˆ (Stack) å®ç°ã€‚ å¦‚ä¸‹é¢æ‰€ç¤ºçš„å›¾ï¼š å‡è®¾ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ä»èŠ‚ç‚¹ 0 å¼€å§‹éå†ï¼Œåˆ™é¦–å…ˆå¯¹èŠ‚ç‚¹ 0 çš„æ‰€æœ‰é‚»å±…èŠ‚ç‚¹ï¼ˆä¸ 0 ç›´æ¥ç›¸è¿çš„èŠ‚ç‚¹ï¼‰ä¸­çš„ä¸€ä¸ªè®¿é—®ï¼Œå‡è®¾è®¿é—®åˆ°äº†èŠ‚ç‚¹ 2 ï¼Œåˆ™å¯¹èŠ‚ç‚¹ 2 çš„é‚»å±…èŠ‚ç‚¹è¿›è¡Œè®¿é—®ã€‚é¦–å…ˆè®¿é—®é‚»å±…èŠ‚ç‚¹ 0 ï¼Œ0 å·²ç»è¢«è®¿é—®ï¼Œå› æ­¤åˆ‡æ¢åˆ°èŠ‚ç‚¹ 1 ã€‚æ¥ç€å¯¹èŠ‚ç‚¹ 1 çš„é‚»å±…èŠ‚ç‚¹ 2 è®¿é—®ï¼Œ 2 å·²è¢«è®¿é—®ï¼Œå› æ­¤åˆ‡æ¢åˆ° 3 ã€‚æ¥ç€è®¿é—® 3 çš„é‚»å±…èŠ‚ç‚¹ 4 ã€‚è®¿é—®åˆ°èŠ‚ç‚¹ 4 ä¹‹åï¼Œå¯¹èŠ‚ç‚¹ 4 çš„æ‰€æœ‰é‚»å±…èŠ‚ç‚¹è®¿é—®ï¼Œå‘ç°å‡è¢«è®¿é—®è¿‡ã€‚ç„¶åå¼€å§‹å›æº¯ï¼ŒæŸ¥æ‰¾æ˜¯å¦æœ‰å°šæœªè®¿é—®åˆ°çš„åˆ†æ”¯ã€‚æ¯”å¦‚æ­¤ä¾‹ä¸­å›æº¯åˆ°èŠ‚ç‚¹ 3 ï¼Œå‘ç°æ‰€æœ‰é‚»å±…èŠ‚ç‚¹éƒ½è¢«è®¿é—®è¿‡ï¼Œç»§ç»­å›æº¯äº¦ç„¶ï¼Œå½“å›æº¯åˆ°èµ·å§‹èŠ‚ç‚¹ 0 æ—¶ï¼Œä¾¿çŸ¥é“æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«è®¿é—®è¿‡ï¼Œéå†å®Œæˆã€‚ å®é™…çš„ç¨‹åºè¿‡ç¨‹å¯ä»¥æè¿°ä¸ºï¼š å»ºç«‹ä¸€ä¸ªç©ºæ ˆï¼Œè®¿é—®èµ·å§‹é¡¶ç‚¹ 0 ï¼Œå¹¶æŠŠ 0 å‹æ ˆ è®¿é—®èŠ‚ç‚¹ 0 çš„é‚»å±…èŠ‚ç‚¹ 2 ï¼ŒæŠŠ 2 å‹æ ˆ è®¿é—®èŠ‚ç‚¹ 2 çš„æœªè®¿é—®èŠ‚ç‚¹ 1 ï¼ŒæŠŠ 1 å‹æ ˆ è®¿é—®èŠ‚ç‚¹ 3,4 ï¼ŒæŠŠ 3,4 å‹æ ˆ éå†èŠ‚ç‚¹ 4 çš„é‚»å±…èŠ‚ç‚¹ä¹‹åï¼Œå‰æ–¹æ— è·¯å¯èµ°ï¼Œå¼€å§‹å‡ºæ ˆ é¦–å…ˆå‡ºæ ˆèŠ‚ç‚¹ 3 ï¼Œè®¿é—®èŠ‚ç‚¹ 3 çš„æœªè®¿é—®é‚»å±…èŠ‚ç‚¹å¹¶å‹æ ˆï¼Œä¸€ç›´è®¿é—®å¹¶å‹æ ˆåˆ°å°½å¤´ã€‚ä¹‹åå¯¹æ¯ä¸ªå‡ºæ ˆçš„é¡¶ç‚¹åšåŒæ ·çš„æ“ä½œï¼Œç›´åˆ°æ ˆä¸ºç©ºï¼ˆé¡¶ç‚¹å…¨éƒ¨å¼¹å‡ºï¼‰ã€‚ 12345678910111213141516171819202122232425262728int Visited[Size] = 0;//æ·±åº¦ä¼˜å…ˆæœç´¢void depthFirstSearch(Graph *graph, Vertex *vertex)&#123; Stack *stack = createStack(); Vertex *nextNode = vertex; while (!isEmpty(stack)) &#123; visit(nextNode); //visit vertex push(stack, nextNode); //push vertex to stack Visited[nextNode-&gt;id] = 1; //shows that this vertex was visted int end = 1; //flag that shows if route comes to end for (int i = 0; i &lt; nextNode-&gt;neighborNum; ++i) //neighbor of vertex &#123; Vertex *neighbor = nextNode-&gt;neighbors[i]; if (!Visited[neighbor-&gt;id]) //if not visited &#123; nextNode = neighbor; //set nextNode neighbor not visited end = -1; //shows that end is not coming break; &#125; &#125; if (end) &#123; nextNode = pop(stack); //if end comes,pop a vertex from stack &#125; &#125;&#125; è¿™ä¸ªå®ç°é¦–å…ˆæ„é€ äº†ä¸€ä¸ªé¡¶ç‚¹ä¸ªæ•°é•¿åº¦çš„æ•°ç»„æ¥æ ‡è¯†é¡¶ç‚¹æ˜¯å¦è¢«è®¿é—®ï¼Œç„¶ååˆ©ç”¨å¾ªç¯å’Œå †æ ˆå®ç°éå†è¿‡ç¨‹ã€‚è¿™æ˜¯ä¸€ä¸ªå¹¶ä¸ä¼˜é›…çš„å®ç°ï¼Œç”šè‡³ä¸çŸ¥é“æ˜¯å¦æ­£ç¡®ã€‚ å¦‚æœç›´æ¥ç”¨é€’å½’ç¨‹åºä¼šéå¸¸æ¸…æ™°ï¼š(ä¸¤æ®µä»£ç å®é™…ä¸Šéƒ½æ˜¯ä¼ªä»£ç ï¼Œå› ä¸ºèŠ‚ç‚¹çš„é‚»å±…èŠ‚ç‚¹ä¿¡æ¯çš„å–å‡ºæ˜¯ä¸è§„èŒƒçš„ï¼Œä¸æ­£ç¡®çš„) 123456789101112int Visited[Size] = 0;void depthFirstSearch(Graph *graph, Vertex *vertex)&#123; visit(vertex); Visted[vertex-&gt;id] = 1; for(int i = 0;i &lt; vertex-&gt;neighborNum;++i) &#123; if(!Visited[vertex-&gt;neighbor[i]])&#123; depthFirstSearch(graph,vertex); &#125; &#125;&#125; å¹¿åº¦ä¼˜å…ˆæœç´¢ (Breadth First Search,BFS) å¹¿åº¦ä¼˜å…ˆæœç´¢è¿‡ç¨‹ç±»ä¼¼äºäºŒå‰æ ‘çš„å±‚åºéå†ï¼Œéƒ½æ˜¯å…ˆè®¿é—®æŸèŠ‚ç‚¹ï¼Œç„¶åæŠŠè¯¥èŠ‚ç‚¹çš„ç›¸é‚»èŠ‚ç‚¹æŒ¨ä¸ªè®¿é—®ï¼ŒåŒæ ·ç±»ä¼¼çš„æ˜¯ï¼Œå¹¿åº¦ä¼˜å…ˆéå†çš„å®ç°ä¹Ÿå¯ä»¥ä½¿ç”¨ é˜Ÿåˆ— (Queue) å®ç°ã€‚ åŒä¸€ä¸ªå›¾ï¼š ä½¿ç”¨å¹¿åº¦ä¼˜å…ˆéå†çš„è¿‡ç¨‹å¤§è‡´æ˜¯ï¼Œé¦–å…ˆä»èµ·å§‹é¡¶ç‚¹ 0 å‡ºå‘ï¼ŒæŒ¨ä¸ªè®¿é—®å®ƒçš„é‚»å±…é¡¶ç‚¹ 2,4 ã€‚ç„¶åè®¿é—®èŠ‚ç‚¹ 2 å’Œå®ƒçš„é‚»å±…èŠ‚ç‚¹ 0 (å·²è¢«è®¿é—®), 1,3 ï¼Œç„¶åè®¿é—®èŠ‚ç‚¹ 4 å’Œå®ƒçš„é‚»å±…èŠ‚ç‚¹ 0,1,3 ã€‚æœ€åå¯¹èŠ‚ç‚¹ 0,1,3 æŒ¨ä¸ªè¿›è¡Œä¸Šè¿°çš„åŠ¨ä½œã€‚ ä½¿ç”¨é˜Ÿåˆ—å®ç°çš„ç¨‹åºè¿‡ç¨‹ä¸ºï¼š é¦–å…ˆå»ºç«‹ç©ºçš„é˜Ÿåˆ—ï¼Œå°†èŠ‚ç‚¹ 0 å…¥é˜Ÿï¼Œ å¼¹å‡ºèŠ‚ç‚¹ 0 è¿›è¡Œè®¿é—®ï¼ŒåŒæ—¶æŠŠèŠ‚ç‚¹ 0 çš„æ‰€æœ‰ æœªè¢«è®¿é—®è¿‡çš„ é‚»å±…èŠ‚ç‚¹ 2,4 åŠ å…¥é˜Ÿåˆ— ä»é˜Ÿåˆ—å¼¹å‡ºä¸€ä¸ªé¡¶ç‚¹ï¼Œå¯¹å…¶è¿›è¡Œè®¿é—®å¹¶æŠŠå®ƒçš„æ‰€æœ‰ æœªè¢«è®¿é—®è¿‡çš„ é‚»å±…é¡¶ç‚¹åŠ å…¥é˜Ÿåˆ—ã€‚ç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºï¼Œè¯´æ˜éå†å®Œæˆã€‚ 123456789101112131415161718192021void breadthFirstSearch(Graph *graph, Vertex *vertex)&#123; visit(vertex); //visite vertex first Visited[vertex-&gt;id] = 1; //set visited true Queue *queue = createQueue(); add(queue, vertex); //add to queue to find its neighbors while (!isEmpty(queue)) &#123; Vertex *v = delete (queue); for (int i = 0; i &lt; v-&gt;neighborNum; ++i) //find all neighbors &#123; Vertex *neighbor = v-&gt;neighbors[i]; if (!Visited[neighbor-&gt;id]) //if not visted,visit and add to queue &#123; visit(neighbor); Visited[neighbor-&gt;id] = 1; add(queue, neighbor); &#125; &#125; &#125;&#125; è¿™ä¸ªå®ç°ä»ç„¶æ˜¯ä¼ªä»£ç ï¼Œéœ€è¦æ›´åŠ åˆç†çš„æŸ¥æ‰¾é¡¶ç‚¹é‚»å±…ä¿¡æ¯çš„æ–¹æ³•æ‰èƒ½å·¥ä½œã€‚ ä¸¤ç§éå†çš„æ—¶é—´å¤æ‚åº¦å®é™…ä¸Šæ˜¯ç›¸åŒçš„ï¼ˆå…¨éƒ¨éå†æ—¶ï¼‰ï¼Œä½†æ˜¯å¯¹äºéå†çš„ä¸­é€”é€€å‡ºçš„é—®é¢˜ï¼Œéœ€è¦è®¤çœŸæ€è€ƒé€‰æ‹©æ›´åˆé€‚çš„éå†æ–¹å¼ã€‚å¦‚å¯»è·¯é—®é¢˜ä¸­éœ€è¦æ ¹æ®åœ°å›¾çš„æ ·å¼é€‰æ‹©éå†æ–¹å¼ã€‚ å›¾çš„ä¸€äº›æœ¯è¯­ è¿é€šï¼šå¦‚æœä»é¡¶ç‚¹ v åˆ°é¡¶ç‚¹ w ä¹‹é—´å­˜åœ¨ä¸€æ¡ï¼ˆæ— å‘ï¼‰è·¯å¾„ï¼Œåˆ™ç§°é¡¶ç‚¹ v å’Œé¡¶ç‚¹ w ä¹‹é—´æ˜¯è¿é€šçš„ã€‚ å¼ºè¿é€šï¼šæœ‰å‘å›¾ä¸­é¡¶ç‚¹ v å’Œ w ä¹‹é—´çš„è·¯å¾„æ˜¯åŒå‘è·¯å¾„ï¼Œåˆ™ v å’Œ w ä¹‹é—´æ˜¯å¼ºè¿é€šçš„ã€‚ è·¯å¾„ï¼šé¡¶ç‚¹ v åˆ°é¡¶ç‚¹ w ä¹‹é—´çš„è·¯å¾„æ˜¯ä¸€ç³»åˆ—é¡¶ç‚¹çš„åºåˆ—ï¼Œå…¶ä¸­ä»»æ„ä¸€å¯¹ç›¸é‚»çš„é¡¶ç‚¹ä¹‹é—´åœ¨å›¾ä¸­éƒ½æœ‰ è¾¹ (Edge) ã€‚è·¯å¾„çš„é•¿åº¦æ˜¯è·¯å¾„ä¸­çš„è¾¹æ•°ï¼ˆå¯¹äºå¸¦æƒå›¾ï¼Œè·¯å¾„é•¿åº¦æ˜¯è¾¹çš„æƒå€¼ä¹‹å’Œï¼‰ã€‚å¦‚æœè·¯å¾„åºåˆ—ä¸­æ‰€æœ‰çš„é¡¶ç‚¹éƒ½ä¸ç›¸åŒï¼ˆè·¯å¾„æ˜¯æ— ç¯çš„ï¼‰ï¼Œåˆ™ç§°è·¯å¾„ä¸º ç®€å•è·¯å¾„ ã€‚ å›è·¯ï¼šèµ·ç‚¹ç­‰äºç»ˆç‚¹çš„è·¯å¾„ è¿é€šå›¾ï¼šå›¾çš„ ä»»æ„ä¸¤ç‚¹ å‡è¿é€š å¼ºè¿é€šå›¾ï¼šæœ‰å‘å›¾ çš„ ä»»æ„ä¸¤ç‚¹ å‡å¼ºè¿é€š è¿é€šåˆ†é‡ï¼šæ— å‘å›¾çš„æå¤§è¿é€šå­å›¾ï¼š æå¤§é¡¶ç‚¹æ•°ï¼šå­å›¾ä¸­å†åŠ ä»»æ„ä¸€ä¸ªç‚¹å°±ä¸æ˜¯è¿é€šå›¾äº† æå¤§è¾¹æ•°ï¼šå­å›¾ä¸­æ‰€æœ‰é¡¶ç‚¹ä¹‹é—´çš„è¾¹æ•° å¼ºè¿é€šåˆ†é‡ï¼šæœ‰å‘å›¾ çš„æå¤§å¼ºè¿é€šåˆ†é‡ å¯¹äºä¸è¿é€šçš„å›¾ï¼Œå¯ä»¥å¯¹å›¾çš„æ¯ä¸ªè¿é€šåˆ†é‡è°ƒç”¨ä¸Šé¢ä¸¤ä¸ªéå†å‡½æ•°å®ç°æ•´ä¸ªå›¾çš„éå†ã€‚","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"å›¾","slug":"å›¾","permalink":"https://blog.zhuwenq.cc/tags/%E5%9B%BE/"},{"name":"éå†","slug":"éå†","permalink":"https://blog.zhuwenq.cc/tags/%E9%81%8D%E5%8E%86/"}]},{"title":"æ•°æ®ç»“æ„-å›¾","slug":"æ•°æ®ç»“æ„-å›¾","date":"2022-03-20T07:50:09.000Z","updated":"2023-06-21T06:51:28.940Z","comments":true,"path":"æ•°æ®ç»“æ„-å›¾/","link":"","permalink":"https://blog.zhuwenq.cc/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%9B%BE/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 4 æœˆ 1 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 4 æœˆ 1 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç† å›¾æ˜¯ä¸€ç§è¡¨ç¤ºå¤šå¯¹å¤šå…³ç³»çš„æ•°æ®ç»“æ„ï¼Œå®ƒåŒ…å«ä¸€ç»„é¡¶ç‚¹ (Vertex) å’Œé¡¶ç‚¹ä¹‹é—´çš„è¿æ¥å…³ç³»ï¼ˆç§°ä¸ºè¾¹ (Edge) ï¼‰ã€‚ å¯¹äºèŠ‚ç‚¹ viv_iviâ€‹ å’Œ vjv_jvjâ€‹ ï¼Œä¸€èˆ¬ç”¨ &lt;vi,vj&gt;&lt;v_i, v_j&gt;&lt;viâ€‹,vjâ€‹&gt; è¡¨ç¤ºç”± viv_iviâ€‹ æŒ‡å‘ vjv_jvjâ€‹ çš„è¾¹ã€‚å›¾ä¸­çš„ç›¸åŒèŠ‚ç‚¹å¯¹ä¸€èˆ¬åªè€ƒè™‘ä¸€æ¡è¾¹ï¼Œä¸è€ƒè™‘é‡å¤çš„è¾¹å’ŒæŒ‡å‘è‡ªå·±çš„è¾¹ï¼Œæ ¹æ®è¾¹çš„å•å‘åŒå‘ï¼Œå¸¦æƒä¸å¸¦æƒï¼Œå›¾å¯ä»¥åˆ†ä¸º æ— å‘æ— æƒå›¾ï¼Œæ— å‘å¸¦æƒå›¾ï¼Œæœ‰å‘æ— æƒå›¾ï¼Œæœ‰å‘å¸¦æƒå›¾ å›¾çš„æ“ä½œé›† 1234567Graph *create(int vertexCnt); //åˆ›å»ºç©ºå›¾è¿”å›void insertVertex(Graph *graph, Vertex *vertex); //å°†èŠ‚ç‚¹æ’å…¥å›¾void insertEdge(Graph *graph, Edge *edge); //å°†è¾¹æ’å…¥å›¾void depthFirstSearch(Graph *graph, Vertex *vertex); //ä»é¡¶ç‚¹vertexå‡ºå‘æ·±åº¦ä¼˜å…ˆéå†void breadthFirstSearch(Graph *graph, Vertex *vertex); //ä»é¡¶ç‚¹vertexå‡ºå‘å®½åº¦ä¼˜å…ˆéå†void shortestPath(Graph *graph, Vertex *vertex, int dist[]); //è®¡ç®—ä»èŠ‚ç‚¹vertexåˆ°ä»»æ„èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„void minSpanningTree(Graph *graph); //è®¡ç®—å›¾çš„æœ€å°ç”Ÿæˆæ ‘ å›¾çš„å»ºç«‹å®ç°åœ¨åæ–‡ç»™å‡º å¦‚ä½•è¡¨ç¤ºä¸€ä¸ªå›¾ é‚»æ¥çŸ©é˜µ ä½¿ç”¨ä¸€ä¸ªäºŒç»´çŸ©é˜µå¯ä»¥æè¿°ä¸€ä¸ªå›¾ã€‚å¯¹äºæœ‰ n ä¸ªé¡¶ç‚¹çš„å›¾ï¼Œå¯ä»¥ç”¨ä¸€ä¸ª n*n å¤§å°çš„çŸ©é˜µ G[n][n] æ¥è¡¨ç¤ºã€‚ é¦–å…ˆç»™é¡¶ç‚¹ç¼–å· 0 - n-1 ï¼ŒçŸ©é˜µçš„å€¼ G[i][j]=1G[i][j] = 1G[i][j]=1 (è‹¥ &lt;vi,vj&gt;&lt;v_i, v_j&gt;&lt;viâ€‹,vjâ€‹&gt; å­˜åœ¨) ï¼ŒG[i][j]=0G[i][j] = 0G[i][j]=0 è‹¥ &lt;vi,vj&gt;&lt;v_i, v_j&gt;&lt;viâ€‹,vjâ€‹&gt; ä¸å­˜åœ¨ ã€‚å¯¹äºå¸¦æƒå›¾ï¼ŒçŸ©é˜µçš„å€¼ä¸€èˆ¬æ˜¯è¾¹çš„æƒé‡ã€‚ å¦‚ä¸‹é¢çš„æœ‰å‘å¸¦æƒå›¾ï¼š å…¶é‚»æ¥çŸ©é˜µä¸ºï¼š v0v_0v0â€‹ v1v_1v1â€‹ v2v_2v2â€‹ v3v_3v3â€‹ v4v_4v4â€‹ v0v_0v0â€‹ 0 2 0 0 0 v1v_1v1â€‹ 0 0 2 2 3 v2v_2v2â€‹ 0 0 0 0 0 v3v_3v3â€‹ 0 0 0 0 0 v4v_4v4â€‹ 0 0 0 0 0 å¯¹äºæ— å‘å›¾ï¼Œä»–ä»¬çš„é‚»æ¥çŸ©é˜µä¸€èˆ¬æ˜¯å¯¹ç§°çš„ï¼š é‚»æ¥çŸ©é˜µä¸ºï¼š v0v_0v0â€‹ v1v_1v1â€‹ v2v_2v2â€‹ v3v_3v3â€‹ v4v_4v4â€‹ v0v_0v0â€‹ 0 1 0 1 0 v1v_1v1â€‹ 1 0 1 1 0 v2v_2v2â€‹ 0 1 0 0 1 v3v_3v3â€‹ 1 1 0 0 0 v4v_4v4â€‹ 0 0 1 0 0 å› æ­¤ï¼Œå¯¹äºæ— å‘å›¾ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªé•¿åº¦ä¸º N(N+1)/2N(N+1) / 2N(N+1)/2 çš„åºåˆ—å‚¨å­˜ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœä¸€åŠçš„ç©ºé—´ã€‚ä¾‹å¦‚å–ä¸Šè¿°çŸ©é˜µçš„ä¸‹åŠéƒ¨åˆ†ï¼š v0v_0v0â€‹ v1v_1v1â€‹ v2v_2v2â€‹ v3v_3v3â€‹ v4v_4v4â€‹ v0v_0v0â€‹ 0 v1v_1v1â€‹ 1 0 v2v_2v2â€‹ 0 1 0 v3v_3v3â€‹ 1 1 0 0 v4v_4v4â€‹ 0 0 1 0 0 å°†ä¸Šè¿°æ•°æ®æŒ‰è¡Œä¼˜å…ˆé¡ºåºå‚¨å­˜åœ¨ä¸€ä¸ªæ•°ç»„é‡Œï¼Œæ•°ç»„çš„é•¿åº¦ä¸º N(N+1)/2N(N+1)/2N(N+1)/2 ã€‚è¦è®¿é—®èŠ‚ç‚¹ i,j(iè¡Œï¼Œjåˆ—) ä¹‹é—´çš„è¿æ¥ï¼Œå¯ä»¥è®¿é—®æ•°ç»„çš„ iâˆ—(i+1)/2+ji*(i+1)/2+jiâˆ—(i+1)/2+j ä½ç½®ã€‚ é‚»æ¥çŸ©é˜µæ˜¯ä¸€ç§è¾ƒä¸ºç›´è§‚çš„è¡¨ç¤ºæ–¹æ³•ï¼Œå®ƒçš„å¥½å¤„æœ‰ï¼š æ–¹ä¾¿æ£€æŸ¥ä»»æ„ä¸€å¯¹èŠ‚ç‚¹ä¹‹é—´æ˜¯å¦å­˜åœ¨è¾¹ æ–¹ä¾¿æŸ¥æ‰¾æ‰€æœ‰ä¸æŸä¸€ç»“ç‚¹ç›´æ¥ç›¸è¿çš„èŠ‚ç‚¹ æ–¹ä¾¿è®¡ç®—èŠ‚ç‚¹çš„åº¦ï¼ˆæŒ‡å‘èŠ‚ç‚¹çš„è¾¹ä¸ªæ•°å«å…¥åº¦ï¼Œä»èŠ‚ç‚¹æŒ‡å‘åˆ«çš„èŠ‚ç‚¹çš„è¾¹ä¸ªæ•°å«å‡ºåº¦ï¼‰ã€‚ å®ƒçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼šå¯¹è¾ƒä¸ºç¨€ç–çš„å›¾ï¼ˆç‚¹å¤šè¾¹å°‘ï¼‰è€Œè¨€ï¼Œç©ºé—´åˆ©ç”¨æ•ˆç‡ä¸é«˜ï¼Œè®¡ç®—å›¾çš„æ€»è¾¹æ•°æ˜¯æ—¶é—´æ•ˆç‡ä¸é«˜ã€‚ é‚»æ¥è¡¨ ä½¿ç”¨ä¸€ä¸ªé•¿åº¦ä¸º n (èŠ‚ç‚¹ä¸ªæ•°)çš„é“¾è¡¨æ•°ç»„ G[n] å‚¨å­˜å›¾ã€‚æ•°ç»„çš„å…ƒç´  G[i] è¡¨ç¤ºç¼–å·ä¸º i çš„èŠ‚ç‚¹ï¼Œ G[i] åæ¥å®ƒæŒ‡å‘çš„æ‰€æœ‰èŠ‚ç‚¹æŒ‡é’ˆã€‚ å¦‚ï¼š ä¸Šå›¾çš„é‚»æ¥è¡¨ä¸ºï¼š v0v_0v0â€‹ 3 1 v1v_1v1â€‹ 0 2 3 v2v_2v2â€‹ 1 4 v3v_3v3â€‹ 1 1 v4v_4v4â€‹ 2 è¿™æ ·çš„è¡¨ç¤ºæ–¹æ³•ä¸ä¼šå‚¨å­˜æ²¡æœ‰è¿æ¥çš„æ— æ•ˆä¿¡æ¯ï¼Œä½†æ˜¯å®ƒæŠŠæ¯æ¡è¾¹éƒ½å‚¨å­˜äº†ä¸¤éã€‚å¯¹äºç¨€ç–çš„å›¾è€Œè¨€ï¼Œå®ƒçš„ç©ºé—´åˆ©ç”¨ç‡è¾ƒé«˜ï¼Œä½†æ˜¯è¾ƒä¸ºç¨ å¯†çš„å›¾ä¼šæµªè´¹è¾ƒå¤šç©ºé—´ã€‚ é‚»æ¥è¡¨å¯ä»¥æ–¹ä¾¿çš„æŸ¥æ‰¾ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ç›´æ¥ç›¸è¿èŠ‚ç‚¹ï¼Œå¦‚æœå‚¨å­˜çš„å›¾æ˜¯æ— å‘å›¾ï¼Œå®ƒä¹Ÿå¯ä»¥æ–¹ä¾¿çš„è®¡ç®—å‡ºèŠ‚ç‚¹çš„åº¦ã€‚ä½†æ˜¯å¦‚æœå‚¨å­˜çš„æ˜¯æœ‰å‘å›¾ï¼Œé‚»æ¥è¡¨å°†æ— æ³•æ–¹ä¾¿çš„è®¡ç®—å‡ºèŠ‚ç‚¹çš„å…¥åº¦ï¼ŒåŒæ—¶å®ƒä¹Ÿæ— æ³•æ–¹ä¾¿åœ°åˆ¤æ–­å‡ºç»™å®šèŠ‚ç‚¹å¯¹ä¹‹é—´æ˜¯å¦å­˜åœ¨è¾¹ã€‚ å›¾çš„å»ºç«‹ é‚»æ¥çŸ©é˜µ é¦–å…ˆç»™å‡ºå›¾çš„åŸå‹ï¼š 1234567typedef struct graph&#123; int vertexCount; //é¡¶ç‚¹æ•° int edgeCount; //è¾¹æ•° WeightType graphMat[MaxSize][MaxSize]; //é‚»æ¥çŸ©é˜µï¼Œå…ƒç´ è¡¨ç¤ºè¾¹çš„æƒé‡ DataType data[MaxSize]; //èŠ‚ç‚¹æ•°æ®&#125; Graph; å›¾çš„å»ºç«‹é¦–å…ˆéœ€è¦å»ºç«‹ä¸€ä¸ªåªæœ‰èŠ‚ç‚¹æ²¡æœ‰è¾¹çš„å›¾ï¼š 123456789101112131415Graph *create(int vertexCnt)&#123; Graph *graph = (Graph *)malloc(sizeof(Graph)); graph-&gt;vertexCount = vertexCnt; //åˆå§‹åŒ–é¡¶ç‚¹æ•° graph-&gt;edgeCount = 0; //åˆå§‹åŒ–è¾¹æ•° for (int i = 0; i &lt; graph-&gt;vertexCount; ++i) &#123; graph-&gt;data[i] = 0; //æ•°æ®åˆå§‹åŒ–ï¼Œåº”è¯¥åˆå§‹åŒ–ä¸ºç”¨æˆ·ç»™å®šçš„æ•°æ® for (int j = 0; j &lt; graph-&gt;vertexCount; ++j) &#123; graph-&gt;graphMat[i][j] = 0; //è¿æ¥åˆå§‹åŒ– &#125; &#125; return graph;&#125; ç„¶åæŠŠè¾¹æ’å…¥åˆ°å›¾ä¸­ï¼Œè¾¹åº”è¯¥ä¿å­˜èµ·ç‚¹å’Œç»ˆç‚¹ä»¥åŠæƒé‡æ•°æ®ï¼š 123456789101112131415161718typedef int Vertex;//é‚»æ¥çŸ©é˜µä¸­ï¼ŒèŠ‚ç‚¹å¯ç”¨åæ ‡è¡¨ç¤ºtypedef struct edge&#123; Vertex start; //èµ·ç‚¹ Vertex end; //ç»ˆç‚¹ WeightType weight; //æƒé‡&#125; Edge;void insertEdge(Graph *graph, Edge *edge)&#123; if (graph == NULL) return NULL; if (edge-&gt;start &gt;= graph-&gt;vertexCount || edge-&gt;end &gt;= graph-&gt;vertexCount) return NULL; graph-&gt;graphMat[edge-&gt;start][edge-&gt;end] = edge-&gt;weight; //å¯¹äºæ— å‘å›¾ï¼Œè¿˜éœ€è¦ä¸‹é¢ä¸€å¥ graph-&gt;graphMat[edge-&gt;end][edge-&gt;start] = edge-&gt;weight;&#125; å¯¹äºç»™å®šçš„è¾¹çš„é›†åˆ Edge edges[someNumber] åªè¦å¯¹å…¶ä¸­æ¯ä¸ªè¾¹è°ƒç”¨æ’å…¥å‡½æ•°å°±å¯ä»¥äº† 12345Edge edges[cnt];for(int i = 0;i &lt; cnt;++i)&#123; insertEdge(graph,edges[i]);&#125; é‚»æ¥è¡¨ é‚»æ¥è¡¨è¡¨ç¤ºçš„å›¾åŸå‹æœ‰æ‰€ä¸åŒï¼Œé¦–å…ˆå»ºç«‹èŠ‚ç‚¹çš„åŸå‹ï¼Œæ ¹æ®é‚»æ¥è¡¨çš„ç»“æ„ï¼ŒèŠ‚ç‚¹åº”è¯¥æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚ 123456typedef struct lnode&#123; int vertexPosition; //é‚»æ¥ç‚¹ä¸‹æ ‡ï¼Œå³é¡¶ç‚¹ç¼–å· WeightType weight; //è¾¹æƒé‡ LVertex *next;&#125; LVertex; é‚»æ¥è¡¨åº”è¯¥æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ æ˜¯é“¾è¡¨æŒ‡é’ˆï¼š é‚»æ¥è¡¨åº”è¯¥æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ æ˜¯é“¾è¡¨æŒ‡é’ˆï¼š 1234typedef struct table&#123; //å¿½ç•¥é¡¶ç‚¹æ•°æ® LVertex *firstVertex; //ç¬¬ä¸€ä¸ªé¡¶ç‚¹&#125; LTable; æ ¹æ®ä¸Šé¢ä¸¤ä¸ªç»“æ„å®ç°å›¾çš„ç»“æ„åŸå‹ï¼š 123456typedef struct lgraph&#123; int vertexCount; //é¡¶ç‚¹æ•° int edgeCount; //è¾¹æ•° LTable graphTable[MaxSize]; //é‚»æ¥è¡¨&#125; LGraph; é‚»æ¥è¡¨å®ç°çš„å›¾å»ºç«‹ç¬¬ä¸€æ­¥ä»ç„¶æ˜¯å»ºç«‹ä¸€ä¸ªä¸€å®šæ•°é‡èŠ‚ç‚¹çš„ç©ºå›¾ï¼š 1234567891011LGraph *createGraph(int vertexCount)&#123; LGraph *graph = (LGraph *)malloc(sizeof(LGraph)); graph-&gt;edgeCount = 0; graph-&gt;vertexCount = vertexCount; for (int i = 0; i &lt; graph-&gt;vertexCount; ++i) &#123; graph-&gt;graphTable[i].firstVertex = NULL; //é‚»æ¥è¡¨é“¾è¡¨åˆå§‹åŒ–ä¸ºç©º &#125; return graph;&#125; ç„¶åå°†è¾¹æ’å…¥ï¼Œç”±äºé‚»æ¥è¡¨ä¸­åªä¿å­˜äº†å¤´èŠ‚ç‚¹ï¼Œå› æ­¤æ’å…¥æ–¹å¼é‡‡ç”¨å¤´æ’æ³•ã€‚ 12345678910111213141516171819void insertLEdge(LGraph *graph, Edge *edge)&#123; //å»ºç«‹è¦æ’å…¥çš„èŠ‚ç‚¹ LVertex *vertex = (LVertex *)malloc(sizeof(LVertex)); vertex-&gt;vertexPosition = edge-&gt;end; vertex-&gt;weight = edge-&gt;weight; //æ’å…¥é‚»æ¥è¡¨ vertex-&gt;next = graph-&gt;graphTable[edge-&gt;start].firstVertex; graph-&gt;graphTable[edge-&gt;start].firstVertex = vertex; //å¯¹äºæ— å‘å›¾ï¼Œè¿˜éœ€è¦æ’å…¥è¾¹&lt;end,start&gt; LVertex *sVertex = (Vertex *)malloc(sizeof(Vertex)); sVertex-&gt;vertexPosition = edge-&gt;start; sVertex-&gt;weight = edge-&gt;weight; sVertex-&gt;next = graph-&gt;graphTable[edge-&gt;end].firstVertex; graph-&gt;graphTable[edge-&gt;end].firstVertex = sVertex;&#125; é€šè¿‡ç»™å®šè¾¹æ•°æ®å»ºç«‹å®Œæ•´å›¾çš„è¿‡ç¨‹ä¸é‚»æ¥çŸ©é˜µæ— å¼‚ã€‚","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"å›¾","slug":"å›¾","permalink":"https://blog.zhuwenq.cc/tags/%E5%9B%BE/"}]},{"title":"æ•°æ®ç»“æ„-å“ˆå¤«æ›¼æ ‘","slug":"æ•°æ®ç»“æ„-å“ˆå¤«æ›¼æ ‘","date":"2022-03-20T07:37:30.000Z","updated":"2023-06-21T06:51:28.940Z","comments":true,"path":"æ•°æ®ç»“æ„-å“ˆå¤«æ›¼æ ‘/","link":"","permalink":"https://blog.zhuwenq.cc/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%93%88%E5%A4%AB%E6%9B%BC%E6%A0%91/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 31 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 31 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç† ç¼–ç  è€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å½¢ï¼šåœ¨ä¸€ç¯‡è‹¥å¹²å­—ç¬¦ç»„æˆçš„æ–‡ç« ä¸­ï¼Œå„ä¸ªå­—ç¬¦å‡ºç°çš„é¢‘ç‡ä¸€èˆ¬æ˜¯ä¸åŒçš„ã€‚å‡å¦‚æˆ‘ä»¬å¯ä»¥è®¾è®¡å‡ºä¸€ç§ä¸ç­‰é•¿ç¼–ç ï¼Œè®©å‡ºç°é¢‘ç‡è¾ƒé«˜çš„å­—ç¬¦ä½¿ç”¨æ›´çŸ­çš„ç¼–ç ï¼Œå‡ºç°é¢‘ç‡è¾ƒä½çš„å­—ç¬¦ä½¿ç”¨è¾ƒé•¿çš„ç¼–ç ï¼Œè¿™æ ·å¯ä»¥å®ç°å¯¹æ–‡ç« çš„æ— æŸå‹ç¼©ã€‚ å“ˆå¤«æ›¼ç¼–ç å°±æ˜¯è¿™æ ·ä¸€ç§å‹ç¼©ç¼–ç ã€‚ å“ˆå¤«æ›¼æ ‘(Huffman Tree) è€ƒè™‘ä¸‹é¢è¿™ç§åˆ¤å®šæ ‘ï¼š 1234567891011if(num&lt;60)&#123; return 1;&#125;else if(num &lt;70)&#123; return 2;&#125;else if(num&lt;80)&#123; return 3;&#125;else if(num&lt;90)&#123; return 4;&#125;else&#123; return 5;&#125; å¦‚æœå¯¹å°è§„æ¨¡çš„å­¦ç”Ÿæˆç»©è¿›è¡Œ 5 åˆ†åˆ¶å–æ•´ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šé¢è¿™æ®µæ„šè ¢çš„ç¨‹åºã€‚å¦‚æœè¦å¤„ç†çš„æ˜¯è¾ƒå¤§è§„æ¨¡çš„æ•°æ®ï¼Œé‚£ä¹ˆä¸Šé¢çš„åˆ¤æ–­è¿‡ç¨‹è¿˜æœ‰ä¼˜åŒ–çš„ç©ºé—´ã€‚ æ ¹æ®ä¸Šé¢çš„åˆ¤æ–­è¿‡ç¨‹ï¼Œå¯¹äº 60 ä»¥ä¸‹çš„æ•°æ®ï¼Œéœ€è¦åˆ¤æ–­ä¸€æ¬¡ï¼Œ 60-70 çš„æ•°æ®ï¼Œéœ€è¦åˆ¤æ–­ä¸¤æ¬¡ï¼Œ 70-80 çš„æ•°æ®ï¼Œéœ€è¦åˆ¤æ–­ä¸‰æ¬¡ã€‚å‡å¦‚è¦å¤„ç†çš„æ•°æ®é›†å¯¹ä¸åŒåˆ†æ®µçš„æ•°æ®æœ‰ä¸ªå‡ºç°é¢‘ç‡çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š | æ•°æ®æ®µ | &lt;60 | 60-70 | 70-80 | 80-90 | &gt;90 | | ------ | ---- | ----- | ----- | ----- | | é¢‘ç‡ | 0.05 | 0.15 | 0.4 | 0.3 | 0.1 | é‚£ä¹ˆä¸Šé¢çš„åˆ¤æ–­è¿‡ç¨‹å¹³å‡åˆ¤æ–­æ¬¡æ•°ä¸ºï¼š0.05âˆ—1+0.15âˆ—2+0.4âˆ—3+0.3âˆ—4+0.1âˆ—4=3.150.05 * 1 + 0.15 * 2 + 0.4 * 3 + 0.3 * 4 + 0.1 * 4 = 3.150.05âˆ—1+0.15âˆ—2+0.4âˆ—3+0.3âˆ—4+0.1âˆ—4=3.15 æ¬¡ æ ¹æ®ä¸Šé¢çš„é¢‘ç‡è¡¨å¯ä»¥æŸ¥çœ‹å‡ºï¼Œ 70-90 çš„å æ¯”è¾ƒå¤§ï¼Œè€Œä»–ä»¬éœ€è¦åˆ¤æ–­ 3,4 æ¬¡ã€‚å¦‚æœè®©å æ¯”è¾ƒå¤§çš„åªåˆ¤æ–­ä¸€æ¬¡ï¼Œè€Œè®©å æ¯”è¾ƒå°çš„ &lt;60 åˆ†æ®µåˆ¤æ–­ 4 æ¬¡ï¼Œä¼¼ä¹å¯ä»¥å‡å°‘å¹³å‡åˆ¤æ–­æ¬¡æ•°ï¼Œæé«˜æ•ˆç‡ã€‚ä¾‹å¦‚æ”¹è¿›ä¸ºå¦‚ä¸‹åˆ¤æ–­ï¼š 1234567891011121314151617if(num&lt;80)&#123; if(num&lt;70)&#123; if(num&lt;60)&#123; return 1; &#125;else&#123; return 2; &#125; &#125;else&#123; return 3; &#125;&#125;else&#123; if(num&lt;90)&#123; return 4; &#125;else&#123; return 5; &#125;&#125; åˆ™å¹³å‡åˆ¤æ–­æ¬¡æ•°ä¸ºï¼š0.05âˆ—3+0.15âˆ—3+0.4âˆ—2+0.3âˆ—2+0.1âˆ—2=2.20.05 * 3 + 0.15 * 3 + 0.4 * 2 + 0.3 * 2 + 0.1 * 2 = 2.20.05âˆ—3+0.15âˆ—3+0.4âˆ—2+0.3âˆ—2+0.1âˆ—2=2.2 æ¬¡ï¼Œä¼˜åŒ–äº†ä¸å°‘ã€‚ è¿™å°±æ˜¯å“ˆå¤«æ›¼æ ‘çš„æ€æƒ³ï¼šæ ¹æ®å…ƒç´ å‡ºç°çš„é¢‘ç‡æ„é€ æœç´¢æ ‘ã€‚ å¸¦æƒè·¯å¾„é•¿åº¦(WPL) å‡è®¾äºŒå‰æ ‘æœ‰ nnn ä¸ªå¶å­èŠ‚ç‚¹ï¼Œæ¯ä¸ªå¶å­èŠ‚ç‚¹çš„æƒå€¼ä¸ºï¼Œä»æ ¹èŠ‚ç‚¹åˆ°æ¯ä¸ªå¶å­èŠ‚ç‚¹çš„é•¿åº¦ä¸ºï¼Œåˆ™æ¯ä¸ªå¶å­èŠ‚ç‚¹çš„å¸¦æƒè·¯å¾„å’Œå°±æ˜¯ã€‚å“ˆå¤«æ›¼æ ‘å°±æ˜¯ WPL=âˆ‘WkLkWPL=\\sum W_kL_kWPL=âˆ‘Wkâ€‹Lkâ€‹ æœ€å°çš„äºŒå‰æ ‘ï¼Œåˆå«æœ€ä¼˜äºŒå‰æ ‘ã€‚ å“ˆå¤«æ›¼æ ‘çš„æ„é€  å“ˆå¤«æ›¼æ ‘çš„æ„é€ è¿‡ç¨‹å¾ˆç®€å•ï¼Œä»ä¸€ä¸ªå¸¦æƒèŠ‚ç‚¹çš„åºåˆ—ä¸­å–å‡ºæƒå€¼æœ€å°çš„ä¸¤ä¸ªèŠ‚ç‚¹ a å’Œ b ï¼Œå°† a å’Œ b åˆå¹¶ï¼Œå¹¶ä¸”æ„é€ ä¸€ä¸ªæ–°èŠ‚ç‚¹ä½œä¸º a å’Œ b çš„çˆ¶èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹çš„æƒå€¼ä¸º a,b æƒå€¼ä¹‹å’Œã€‚ç„¶åæŠŠçˆ¶èŠ‚ç‚¹æ”¾å›åˆ°åºåˆ—ä¸­ï¼Œå†å–å‡ºæƒå€¼æœ€å°çš„ä¸¤ä¸ªèŠ‚ç‚¹åˆå¹¶ã€‚ä¸€ç›´åšåˆ°åºåˆ—ä¸ºç©ºï¼Œå“ˆå¤«æ›¼æ ‘å°±å½¢æˆäº†ã€‚ å“ˆå¼—æ›¼æ•°ç»“æ„ä¸Šå°±æ˜¯æ™®é€šçš„äºŒå‰æ ‘ï¼Œå› æ­¤å®ƒçš„åŸå‹ä¸ºï¼š 123456typedef struct hafman&#123; WeightType weight; HuffmanTree *left; HuffmanTree *right;&#125; HuffmanTree; æ„é€ çš„è¿‡ç¨‹éœ€è¦å–å‡ºæƒå€¼æœ€å°çš„å…ƒç´ ï¼Œä¸å¦¨ç”¨æœ€å°å †(MinHeap)å‚¨å­˜èŠ‚ç‚¹ï¼Œæœ€å°å †çš„å®ç°ä¸[[æ•°æ®ç»“æ„-å †]]ç±»ä¼¼ã€‚å¦‚æœä½¿ç”¨æ’å¥½åºçš„åºåˆ—ä¹Ÿå¯ä»¥å®ç°ã€‚ 1234567891011121314HuffmanTree *constructHuffmanTree(MinHeap *heap)&#123; HuffmanTree *huffman; for (int i = 1; i &lt; heap-&gt;size; ++i) //size nodes need size-1 times insert &#123; huffman = (HuffmanTree *)malloc(sizeof(HuffmanTree)); huffman-&gt;left = deleteMin(heap); huffman-&gt;right = deleteMin(heap); huffman-&gt;weight = huffman-&gt;left-&gt;weight + huffman-&gt;right-&gt;weight; insert(heap, huffman); &#125; return deleteMin(heap);&#125; å“ˆå¤«æ›¼æ ‘çš„ç‰¹ç‚¹ æ ¹æ®å“ˆå¤«æ›¼æ ‘æ„é€ çš„è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹å‡ºå“ˆå¤«æ›¼æ ‘å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š æ²¡æœ‰åº¦ä¸º 1 çš„èŠ‚ç‚¹: å“ˆå¤«æ›¼æ ‘æ„é€ æ—¶æ€»æ˜¯ä¸¤ä¸¤åˆä¸€ï¼Œå› æ­¤å®ƒçš„æ‰€æœ‰èŠ‚ç‚¹è¦ä¹ˆåº¦ä¸º 2 ï¼Œè¦ä¹ˆåº¦ä¸º 0 n ä¸ªå¶èŠ‚ç‚¹çš„å“ˆå¤«æ›¼æ ‘æ€»ç»“ç‚¹æ•°ä¸º 2n-1: äºŒå‰æ ‘çš„èŠ‚ç‚¹åˆ†ä¸ºä¸‰ç±»ï¼šåº¦ä¸º 0ï¼Œ1ï¼Œ2 çš„ä¸‰ç±»èŠ‚ç‚¹ã€‚è®¾åº¦ä¸º i çš„èŠ‚ç‚¹æ•°é‡ä¸º nin_iniâ€‹ ï¼ŒåŒæ—¶æ»¡è¶³å…³ç³»ï¼šn2=n0âˆ’1n_2 = n_0 - 1n2â€‹=n0â€‹âˆ’1 ã€‚å› æ­¤åœ¨å“ˆå¤«æ›¼æ ‘ä¸­ï¼šå¶èŠ‚ç‚¹æ•°é‡nå³ä¸º n0n_0n0â€‹ ï¼Œç”±äºæ²¡æœ‰åº¦ä¸º 1 çš„ç‚¹ï¼Œæ‰€ä»¥èŠ‚ç‚¹æ€»æ•°æ˜¯ n0+n2=2nâˆ’1n_0 + n_2 = 2n - 1n0â€‹+n2â€‹=2nâˆ’1 ã€‚ å“ˆå¤«æ›¼æ ‘äº¤æ¢å·¦å³å­æ ‘ä»ç„¶æ˜¯å“ˆå¤«æ›¼æ ‘: å¯¹äºåŒä¸€ç»„å¸¦æƒèŠ‚ç‚¹åºåˆ—ï¼Œå¯èƒ½å­˜åœ¨ä¸åŒæ„çš„ä¸¤é¢—å“ˆå¤«æ›¼æ ‘ï¼Œä½†æ˜¯ä»–ä»¬çš„ WPL ç›¸åŒã€‚ å“ˆå¤«æ›¼ç¼–ç  æ˜¯ä¸€ç§å­—ç¬¦ä¸²çš„ä¸ç­‰é•¿ç¼–ç æ–¹å¼ï¼Œå¯ä»¥ä½¿å­—ç¬¦ä¸²å ç”¨çš„ç©ºé—´æœ€å°ã€‚ä½¿ç”¨ä¸ç­‰é•¿ç¼–ç æœ‰ä¸€ä¸ªé—®é¢˜ï¼šç»™å®šä¸€ä¸²ç¼–ç ï¼Œæ— æ³•å‡†ç¡®çš„æŠŠæ¯ä¸ªå­—ç¬¦åˆ†å‰²å‡ºæ¥ï¼Œä¸åŒçš„åˆ†å‰²æ–¹å¼æœ‰ä¸åŒçš„å«ä¹‰ï¼Œå³äºŒä¹‰æ€§é—®é¢˜ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œåˆæœ‰èªæ˜äººæå‡ºäº†è§£å†³çš„æ–¹æ³•ï¼šä½¿ç”¨å‰ç¼€ç  (Prefix Code) ã€‚ æ‰€è°“å‰ç¼€ç ï¼Œå³æ»¡è¶³ï¼šä»»ä½•å­—ç¬¦çš„ç¼–ç éƒ½ä¸æ˜¯å…¶ä»–å­—ç¬¦ç¼–ç çš„å‰ç¼€ã€‚ä¾‹å¦‚ç»™å‡ºä¸‹é¢çš„ä¸‰ä¸ªå­—æ¯çš„éå‰ç¼€ç¼–ç ï¼š 123a: 1b: 0c: 10 åˆ™å­—ç¬¦ a çš„ç¼–ç  1 æ˜¯å­—ç¬¦ c çš„ç¼–ç  10 çš„å‰ç¼€ï¼Œå½“ç»™å‡ºç¼–ç  10 æ—¶ï¼Œæ— æ³•åˆ†è¾¨ç©¶ç«Ÿæ˜¯ ab è¿˜æ˜¯ c ã€‚ å“ˆå¤«æ›¼ç¼–ç æ˜¯åœ¨ä¸€æ£µäºŒå‰æ ‘ä¸Šè¿›è¡Œçš„ï¼Œè§„å®š 0 ä»£è¡¨å·¦å­æ ‘ï¼Œ 1 ä»£è¡¨å³å­æ ‘ï¼ŒåŒæ—¶å­—ç¬¦åªå‚¨å­˜åœ¨å¶èŠ‚ç‚¹ä¸Šã€‚è¿™æ ·æ¯ä¸ªå­—ç¬¦çš„ç¼–ç å®é™…ä¸Šæè¿°äº†ä»æ ¹èŠ‚ç‚¹åˆ°è¯¥å­—ç¬¦æ‰€åœ¨å¶èŠ‚ç‚¹çš„è·¯å¾„ï¼ŒåŒæ—¶ä»»ä½•ä¸€ä¸ªå­—ç¬¦çš„ç¼–ç éƒ½ä¸å¯èƒ½æ˜¯å…¶ä»–å­—ç¬¦ç¼–ç çš„å‰ç¼€ã€‚ è§£å†³äº†äºŒä¹‰æ€§é—®é¢˜ï¼Œå“ˆå¤«æ›¼ç¼–ç ä¸‹ä¸€ä¸ªè¦è§£å†³çš„é—®é¢˜å°±æ˜¯æ•ˆç‡ã€‚ç»“åˆå“ˆå¤«æ›¼æ ‘çš„æ€æƒ³ï¼ŒæŠŠå­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦çš„å‡ºç°æ¬¡æ•°ä½œä¸ºè¯¥å­—ç¬¦çš„æƒå€¼å»ºç«‹å“ˆå¤«æ›¼æ ‘ï¼Œè¿™æ ·å‡ºç°æ¬¡æ•°å¤šçš„èŠ‚ç‚¹å°†ä½äºè¾ƒæµ…ä½ç½®å¤„çš„å¶èŠ‚ç‚¹ï¼Œå…¶è·¯å¾„ç¼–ç ï¼ˆ 0 ä»£è¡¨å·¦ï¼Œ 1 ä»£è¡¨å³ï¼‰é•¿åº¦ä¹Ÿè¾ƒçŸ­ã€‚è¿™æ ·å°±å®ç°äº†å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…ä¸€ç¯‡æ–‡ç« çš„å­—ç¬¦ä¸ç­‰é•¿ç¼–ç ï¼Œä¹Ÿå°±å®ç°äº†å¯¹å­—ç¬¦ä¸²çš„å‹ç¼©ã€‚","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"å“ˆå¤«æ›¼æ ‘","slug":"å“ˆå¤«æ›¼æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E5%93%88%E5%A4%AB%E6%9B%BC%E6%A0%91/"}]},{"title":"æ•°æ®ç»“æ„-å †","slug":"æ•°æ®ç»“æ„-å †","date":"2022-03-20T07:20:51.000Z","updated":"2023-06-21T06:51:28.940Z","comments":true,"path":"æ•°æ®ç»“æ„-å †/","link":"","permalink":"https://blog.zhuwenq.cc/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%A0%86/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 30 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 30 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç† å † Heap å³ ä¼˜å…ˆé˜Ÿåˆ— Priority Queue å‡ ç§å®ç°æ–¹å¼ ä¸€èˆ¬æ•°ç»„ï¼ˆæ— åºï¼‰ï¼š æ’å…¥ï¼šå¯¹äºä¸€èˆ¬æ•°ç»„ï¼Œå¯ä»¥æ€»æ˜¯æŠŠå…ƒç´ æ’å…¥åˆ°æ•°ç»„çš„å¤´éƒ¨æˆ–å°¾éƒ¨ï¼Œå› æ­¤å®ƒçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)O(1)O(1) åˆ é™¤ï¼šé¦–å…ˆè¦åœ¨æ•°ç»„ä¸­æ‰¾åˆ°æœ€å¤§(æˆ–æœ€å°)å…ƒç´ ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)O(n)O(n) çš„ã€‚ç„¶åå°†å…ƒç´ åˆ é™¤ï¼Œè¢«åˆ é™¤å…ƒç´ çš„åæ–¹å…ƒç´ éœ€è¦å‰æŒªä¸€ä½ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(n)O(n)O(n) æœ‰åºæ•°ç»„ï¼š æ’å…¥ï¼šå¯¹äºæœ‰åºæ•°ç»„ï¼Œæ’å…¥æ—¶éœ€è¦æ‰¾åˆ°åˆé€‚çš„ä½ç½®ï¼Œè¿™ä¸€æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸€èˆ¬æ˜¯ O(n)O(n)O(n) æˆ–è€… O(logâ¡n)O(\\log n)O(logn) çš„ åˆ é™¤ï¼šç”±äºæ•°ç»„æ˜¯æœ‰åºçš„ï¼Œåˆ é™¤çš„ä½ç½®æ€»æ˜¯åœ¨æ•°ç»„çš„å¤´éƒ¨æˆ–å°¾éƒ¨ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)O(1)O(1) çš„ ä¸€èˆ¬é“¾è¡¨ï¼ˆæ— åºï¼‰ï¼š æ’å…¥ï¼šæ’å…¥å¯ä»¥ç®€å•çš„æ’å…¥åœ¨é“¾è¡¨å¤´éƒ¨ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)O(1)O(1) çš„ åˆ é™¤ï¼šé¦–å…ˆæ‰¾åˆ°æœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)O(n)O(n) ï¼Œç„¶ååˆ é™¤æ‰è¯¥èŠ‚ç‚¹ï¼Œåˆ é™¤æ“ä½œå¯¹é“¾è¡¨è€Œè¨€æ˜¯ O(1)O(1)O(1) çš„ æœ‰åºé“¾è¡¨ï¼š æ’å…¥ï¼šé¦–å…ˆæ‰¾åˆ°åˆé€‚çš„ä½ç½®ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)O(n)O(n) ï¼Œç„¶åæ’å…¥ï¼Œæ“ä½œæ˜¯ O(1)O(1)O(1) çš„ åˆ é™¤ï¼šåˆ é™¤æ€»æ˜¯åœ¨ä¸¤ç«¯è¿›è¡Œï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)O(1)O(1) äºŒå‰æ ‘ï¼š äºŒå‰æœç´¢æ ‘ï¼šäºŒå‰æœç´¢æ ‘çš„æœ€å¤§å€¼åœ¨æœ€å³ä¾§ï¼Œæœ€å°å€¼åœ¨æœ€å·¦ä¾§ã€‚å¯¹äºä¼˜å…ˆé˜Ÿåˆ—è¿™ä¸ªä½¿ç”¨åœºæ™¯ï¼Œç»è¿‡è‹¥å¹²æ¬¡åˆ é™¤æ“ä½œä¹‹åäºŒå‰æœç´¢æ ‘å°†é€€åŒ–ä¸ºä¸€é¢—æ–œäºŒå‰æ ‘ï¼Œæ—¶é—´æ•ˆç‡ä¼šè¿…é€Ÿä¸‹é™ã€‚ æœ€å¤§å † æ³¨æ„åˆ°ä¼˜å…ˆé˜Ÿåˆ—åªæœ‰ä¸¤ä¸ªä¸»è¦æ“ä½œï¼š æ’å…¥ (Insert) å’Œ åˆ é™¤ (Delete) å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€é¢—äºŒå‰æ ‘å‚¨å­˜ä¼˜å…ˆé˜Ÿåˆ—çš„æ•°æ®ï¼Œåº”è¯¥ç€é‡ä¼˜åŒ–æ›´åŠ å›°éš¾çš„åˆ é™¤æ“ä½œã€‚è€ƒè™‘è¿™æ ·ä¸€ç§ç»“æ„ï¼šäºŒå‰æ ‘çš„æœ€å¤§èŠ‚ç‚¹å§‹ç»ˆåœ¨å®ƒçš„æ ¹èŠ‚ç‚¹å¤„ï¼Œå¯¹æ¯ä¸€æ£µå­æ ‘è€Œè¨€äº¦å¦‚æ­¤ï¼Œé‚£ä¹ˆåˆ é™¤æ“ä½œå°†å§‹ç»ˆåœ¨æ ¹èŠ‚ç‚¹è¿›è¡Œã€‚ä¸ºäº†é¿å…äºŒå‰æ ‘å˜æ–œï¼Œæˆ‘ä»¬ä½¿ç”¨å®Œå…¨äºŒå‰æ ‘å‚¨å­˜æ•°æ®ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ª æœ€å¤§å †(MaxHeap) æœ€å¤§å †æ˜¯ä¸€é¢— å®Œå…¨äºŒå‰æ ‘ (Complete Binary Tree) ï¼ŒåŒæ—¶å®ƒçš„æ¯ä¸ªèŠ‚ç‚¹æ¯”å®ƒçš„å·¦å³å­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹å¤§ï¼ˆæ¯”å­æ ‘å°ç§°ä¸ºæœ€å°æ ‘ï¼‰ã€‚ å¦‚ä¸‹å›¾å°±æ˜¯ä¸€ä¸ªæœ€å¤§å †ï¼š æœ€å¤§å †çš„å®ç° [[æ•°æ®ç»“æ„-äºŒå‰æ ‘å’ŒäºŒå‰æ ‘çš„å‚¨å­˜ç»“æ„]] ä¸­æåˆ°ï¼Œå¯¹äºå®Œå…¨äºŒå‰æ ‘ï¼Œå®ƒå…·æœ‰çˆ¶èŠ‚ç‚¹åºå·æ˜¯å­èŠ‚ç‚¹åºå·çš„äºŒåˆ†ä¹‹ä¸€è¿™ä¸€æ€§è´¨ï¼Œå› æ­¤å®Œå…¨äºŒå‰æ ‘å†…éƒ¨å¯ä»¥ä½¿ç”¨æ•°ç»„å®ç°ï¼ŒåŒæ—¶æ•°ç»„å®ç°çš„å®Œå…¨äºŒå‰æ ‘å…·æœ‰å¾ˆé«˜çš„æ•ˆç‡ä¹Ÿå¾ˆæ–¹ä¾¿æ“ä½œï¼Œåªæ˜¯å®¹é‡ä¸€èˆ¬æ˜¯å›ºå®šçš„ï¼Œç©ºé—´æ•ˆç‡è¾ƒä½ã€‚æ•°æ®ç»“æ„åŸå‹å¦‚ä¸‹ï¼š 123456typedef struct maxheap&#123; KeyType *data; //å †çš„æ•°æ® int size; //å½“å‰å…ƒç´ ä¸ªæ•° int capacity; //å †çš„æœ€å¤§å®¹é‡&#125; MaxHeap; ä¸»è¦æ“ä½œæœ‰ï¼š 12345MaxHeap *createHeap(const int maxSize); //åˆ›å»ºç©ºå †ï¼Œæœ€å¤§ç©ºé—´ä¸ºmaxSizeint isFull(MaxHeap *heap); //åˆ¤æ–­å †æ˜¯å¦å·²æ»¡int isEmpty(MaxHeap *heap); //åˆ¤æ–­å †æ˜¯å¦ä¸ºç©ºvoid insert(MaxHeap *heap, KeyType key); //æŠŠå…ƒç´ keyæ’å…¥å †KeyType deleteMax(MaxHeap *heap); //åˆ é™¤å¹¶è¿”å›å †ä¸­çš„æœ€å¤§å€¼ ä¸‹é¢åªè®¨è®ºæ’å…¥å’Œåˆ é™¤æ“ä½œ æ’å…¥ ä¸€èˆ¬çš„æ•°ç»„å®ç°çš„å®Œå…¨äºŒå‰æ ‘å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ’å…¥ã€‚æˆ‘ä»¬åœ¨åŸå‹ä¸­ç»´æŠ¤æœ‰è¡¨ç¤ºäºŒå‰æ ‘å½“å‰å…ƒç´ ä¸ªæ•°çš„ tagï¼Œå¹¶ä¸”å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸‹æ ‡æœ‰ç®€å•çš„å±‚åºè§„å¾‹ï¼ˆè‡ªä¸Šè€Œä¸‹ï¼Œè‡ªå·¦è€Œå³ï¼‰ã€‚å› æ­¤å¯ä»¥ç›´æ¥æŠŠå…ƒç´ æ’å…¥åˆ°æ•°ç»„çš„ size + 1 å¤„ã€‚ ç„¶è€Œä½œä¸ºä¸€ä¸ªæœ€å¤§å †ï¼Œè¿™æ ·çš„æ’å…¥å¯èƒ½ä¼šç ´åæœ€å¤§å †çš„å¦ä¸€ä¸ªåŸåˆ™ï¼šæ ¹èŠ‚ç‚¹æ€»æ˜¯å¤§äºå·¦å³å­æ ‘èŠ‚ç‚¹ã€‚å› æ­¤ï¼Œåœ¨æ’å…¥åˆ° size + 1 ä½ç½®åï¼Œè¿˜éœ€è¦åˆ¤æ–­è¯¥åŸåˆ™æ˜¯å¦è¢«ç ´åï¼Œå¦‚æœè¢«ç ´ååˆ™éœ€è¦ä¿®å¤è¿™ä¸€åŸåˆ™ã€‚ ä¾‹å¦‚ä¸Šé¢å›¾ç‰‡ä¸­çš„å †å¦‚æœæ’å…¥å…ƒç´  2 ï¼Œè¢«æ’å…¥çš„ä½ç½®ä¸‹æ ‡ä¸º 10 ï¼Œæ˜¯ä¸‹æ ‡ä¸º 5 çš„èŠ‚ç‚¹ 3 çš„å·¦å­æ ‘ä½ç½®ã€‚åŒæ—¶ 2 å°äº 3 ï¼Œè¿™ä¸ªæ’å…¥ä¸ä¼šç ´åæ ¹æœ€å¤§åŸåˆ™ã€‚ å‡å¦‚æ’å…¥çš„å…ƒç´ æ˜¯ 5 ï¼Œåˆ™ä¼šå› ä¸º 5 å¤§äº 3 è€Œéœ€è¦å¯¹æœ€å¤§å †è¿›è¡Œä¿®å¤ã€‚ä¿®å¤çš„è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ï¼Œåªè¦æŠŠèŠ‚ç‚¹ 5 ä¸èŠ‚ç‚¹ 3 äº¤æ¢ä½ç½®å°±è¡Œäº†ï¼ˆæ’å…¥çš„èŠ‚ç‚¹ä¸çˆ¶èŠ‚ç‚¹äº¤æ¢ä½ç½®ï¼‰ã€‚å‡å¦‚æ’å…¥çš„å…ƒç´ æ˜¯ 91 ï¼Œåˆ™éœ€è¦ä¸€ç›´äº¤æ¢åˆ°æ•´æ£µæ ‘çš„æ ¹èŠ‚ç‚¹å¤„ã€‚ è¿™ä¸ªå®ç°é‡‡ç”¨äº†å¦ä¸€ä¸ªæ–¹æ¡ˆï¼Œæ’å…¥æ—¶å…ˆæ ¹æ®æ ¹æœ€å¤§åŸåˆ™åˆ¤æ–­åˆé€‚çš„ä½ç½®åœ¨å“ªé‡Œï¼Œåœ¨åˆ¤æ–­çš„åŒæ—¶æŠŠä¸åˆé€‚çš„èŠ‚ç‚¹ç»Ÿç»Ÿåç§»ï¼Œä¸ºæ–°æ’å…¥çš„èŠ‚ç‚¹è…¾å‡ºä½ç½®ã€‚ 1234567891011121314void insert(MaxHeap *heap, KeyType key)&#123; if (heap == NULL) return; //if heap is NULL,do nothing else if (isFull(heap)) return; //if heap is full,do nothing int position = ++heap-&gt;size; //insert position should be 1 after size //when break out loop,heap-&gt;data[position]&gt;key &amp;&amp; position is the right position for (; heap-&gt;data[position] &lt; key; position /= 2) &#123; //in loop,heap-&gt;data[position]&gt;key,move data down heap-&gt;data[position] = heap-&gt;data[position / 2]; &#125; heap-&gt;data[position] = key; //insert key to the right pos&#125; åˆ é™¤ æœ€å¤§å †åˆ é™¤çš„ä½ç½®æ˜¯ç¡®å®šçš„ï¼šæ€»æ˜¯äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ä½ç½®ã€‚ç„¶è€Œä¸èƒ½ç›´æ¥åœ°å°±æŠŠæ ¹èŠ‚ç‚¹åˆ é™¤æ‰ï¼Œå› ä¸ºä¸€æ–¹é¢æ ¹èŠ‚ç‚¹åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡æ˜¯ 0 ï¼ŒæŠŠå®ƒåˆ é™¤äº†ä»¥ååé¢æ‰€æœ‰çš„å…ƒç´ éƒ½è¦å‰ç§»ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)O(n)O(n) ï¼ˆå¦‚æœä¸ç§»è¿Ÿæ—©ç©ºé—´ä¼šè¢«å…¨éƒ¨ä¸¢å¤±ï¼‰ï¼›å¦ä¸€æ–¹é¢æ˜¯å› ä¸ºæˆ‘ä»¬æœ‰æ›´å¥½çš„é€‰æ‹©ï¼šåˆ æ‰æ•°ç»„å°¾éƒ¨ä½ç½®çš„èŠ‚ç‚¹ï¼Œç„¶åæŠŠå°¾éƒ¨èŠ‚ç‚¹çš„å…ƒç´ æ‹¿åˆ°æ ¹èŠ‚ç‚¹æ›¿æ¢åŸæ¥çš„æ ¹èŠ‚ç‚¹ã€‚è¿™æ ·åˆ é™¤è¿‡ç¨‹å¯ä»¥ç®€è¿°ä¸ºï¼šåˆ æ‰å°¾éƒ¨èŠ‚ç‚¹ï¼Œæ›¿æ¢æ ¹èŠ‚ç‚¹ã€‚ ä¸æ’å…¥è¿‡ç¨‹ç±»ä¼¼ï¼Œæ ¹èŠ‚ç‚¹è¢«å°¾èŠ‚ç‚¹æ›¿æ¢ä¹‹åæœ€å¤§å †çš„æ ¹æœ€å¤§åŸåˆ™æ— æ³•å¾—åˆ°ä¿è¯ã€‚ å¦‚ä¸‹å›¾æœ€å¤§å †ï¼š åˆ æ‰æœ€å¤§å€¼ä¹‹åï¼Œä½¿ç”¨å°¾éƒ¨èŠ‚ç‚¹ 3 ä»£æ›¿æ ¹èŠ‚ç‚¹ï¼Œå¤§å°é¡ºåºè¢«ç ´åï¼š å¤§å°é¡ºåºæ¢å¤çš„è¿‡ç¨‹ä¸ºï¼šæ‰¾åˆ°æ ¹èŠ‚ç‚¹å·¦å³å­èŠ‚ç‚¹ä¸­è¾ƒå¤§çš„ä¸€ä¸ªï¼Œè®©ä»–ä¸æ ¹èŠ‚ç‚¹äº¤æ¢ä½ç½®ï¼Œç„¶ååœ¨è¢«äº¤æ¢çš„å­èŠ‚ç‚¹ä½ç½®å¯¹å®ƒçš„å­æ ‘é‡å¤å‰è¿°æ“ä½œã€‚ ä¾‹å¦‚ä¸Šé¢çš„æœ€å¤§å †æ¢å¤ä¹‹åå¦‚ä¸‹ï¼š ä¸‹é¢çš„å®ç°é‡‡ç”¨äº†ä¸æ’å…¥ç±»ä¼¼çš„æ–¹æ¡ˆï¼šå…ˆä¸åšæ›¿æ¢ï¼Œè€Œæ˜¯å…ˆè®©ä¸åˆé€‚çš„èŠ‚ç‚¹ç§»ä½ï¼Œè…¾å‡ºåˆé€‚çš„èŠ‚ç‚¹æŠŠè¢«åˆ æ‰çš„å°¾éƒ¨èŠ‚ç‚¹æ’å…¥ã€‚ 12345678910111213141516171819202122232425KeyType deleteMax(MaxHeap *heap)&#123; if (heap == NULL) return; else if (isEmpty(heap)) return; KeyType target = heap-&gt;data[1]; KeyType temp = heap-&gt;data[heap-&gt;size--]; int child = 0; int parent = 1; for (; parent * 2 &lt;= heap-&gt;size; parent = child) &#123; child = parent * 2; //left child index,may overflow if (child &lt;= heap-&gt;size &amp;&amp; heap-&gt;data[child] &lt; heap-&gt;data[child + 1]) &#123; //if right child is bigger,turn to right child child++; &#125; if (heap-&gt;data[child] &lt;= temp) break; //if order is corrict,break else //replace nodes heap-&gt;data[parent] = heap-&gt;data[child]; &#125; heap-&gt;data[parent] = temp; //put temp to right position return target;&#125; æˆ–è€…ä¹Ÿå¯ä»¥ç›´æ¥æŠŠå°¾éƒ¨èŠ‚ç‚¹æ”¾åœ¨æ ¹èŠ‚ç‚¹ï¼Œç„¶åä»ä¸Šåˆ°ä¸‹åˆ¤æ–­é¡ºåºæ˜¯å¦æ­£ç¡®ï¼Œä¸æ­£ç¡®å°±äº¤æ¢ä½ç½®ã€‚ 1234567891011121314151617181920KeyType deleteMax(MaxHeap *heap)&#123; if (heap == NULL) return; else if (isEmpty(heap)) return; KeyType target = heap-&gt;data[1]; heap-&gt;data[1] = heap-&gt;data[heap-&gt;size--]; int child = 0; for (int i = 1; i * 2 &lt; heap-&gt;size; i = child) &#123; child = i * 2; if (heap-&gt;data[child] &lt; heap-&gt;data[child + 1]) child++; if (heap-&gt;data[i] &lt; heap-&gt;data[child]) swap(&amp;heap-&gt;data[i], &amp;heap-&gt;data[child]); else break; &#125;&#125; ä»åºåˆ—å»ºå † 1MaxHeap* createHeap(KeyType* list, int size); æœ‰ä¸¤ç§æ€è·¯ï¼Œä¸€ç§æ˜¯å…ˆå»ºç«‹ä¸€ä¸ªç©ºå †ï¼Œç„¶åæŠŠå…ƒç´ ä¸€ä¸ªä¸€ä¸ªæ’å…¥åˆ°ç©ºå †ä¸­ï¼Œè¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogâ¡n)O(n\\log n)O(nlogn) ã€‚å¦ä¸€ç§æ˜¯å°†åºåˆ—ä¸­çš„å…ƒç´ ç›´æ¥æ”¾åœ¨ä¸€ä¸ªæ•°ç»„é‡Œï¼ŒæŒ‰ç…§å®Œå…¨äºŒå‰æ ‘çš„æ„é€ ï¼Œè¿™ä¸ªæ•°ç»„å°±æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ã€‚ç„¶åå¯¹å®Œå…¨äºŒå‰æ ‘ä¸­çš„æ¯ä¸ªçˆ¶èŠ‚ç‚¹è¿›è¡Œä¿®æ­£ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæœ€å¤§å †ï¼Œè¿™ä¸ªæ“ä½œæ˜¯çº¿æ€§çš„å¤æ‚åº¦ O(n)O(n)O(n) (ä¸åŒ…æ‹¬æ•°ç»„æ‹·è´çš„æ—¶é—´)ã€‚ 1234567891011121314151617181920//MaxHeap *createHeap(KeyType *list,int size)&#123; MaxHeap *heap = (MaxHeap*)malloc(sizeof(MaxHeap)); heap-&gt;data = (KeyType*)malloc(sizeof(KeyType) * (size + 1)); for (int i = 1;i&lt;size;++i)&#123; heap-&gt;data[i] = list[i]; &#125; int parent = heap-&gt;size / 2; for(;parent &gt; 0;parent--) &#123; int child = parent * 2; if(child + 1 &lt;= heap-&gt;size) &#123; child += heap-&gt;data[child] &lt; heap-&gt;data[child + 1]; &#125; if(heap-&gt;data[parent] &lt; heap-&gt;data[child]) swap(&amp;heap-&gt;data[parent],&amp;heap-&gt;data[child]); &#125;&#125;","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"å †","slug":"å †","permalink":"https://blog.zhuwenq.cc/tags/%E5%A0%86/"}]},{"title":"æ•°æ®ç»“æ„-å¹³è¡¡äºŒå‰æ ‘","slug":"æ•°æ®ç»“æ„-å¹³è¡¡äºŒå‰æ ‘","date":"2022-03-20T06:40:58.000Z","updated":"2023-06-21T06:51:28.944Z","comments":true,"path":"æ•°æ®ç»“æ„-å¹³è¡¡äºŒå‰æ ‘/","link":"","permalink":"https://blog.zhuwenq.cc/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 27 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 27 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç† å†™åœ¨å‰é¢ å‡å¦‚æœç´¢ä¸€é¢—äºŒå‰æœç´¢æ ‘ (Binary Search Tree) ä¸­çš„æŸä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæœç´¢çš„æœ€åæ¬¡æ•°å°†æ˜¯è¯¥äºŒå‰æœç´¢æ ‘çš„é«˜åº¦ã€‚å†å‡å¦‚è¢«æœç´¢çš„äºŒå‰æ ‘æ˜¯ä¸€é¢—æ–œäºŒå‰æ ‘ï¼Œé‚£ä¹ˆæœç´¢çš„æœ€åæƒ…å†µå°†éœ€è¦æ ‘çš„èŠ‚ç‚¹ä¸ªæ•° n æ¬¡ã€‚å¦‚æœäºŒå‰æœç´¢æ ‘çš„é«˜åº¦å°½å¯èƒ½å°ï¼Œå°†å¤§å¤§é™ä½æœç´¢çš„æ—¶é—´å¤æ‚åº¦ï¼Œç›¸æ¯”æ–œäºŒå‰æ ‘çš„æœ€åæ—¶é—´å¤æ‚åº¦ä¸º O(n) ï¼Œè¾ƒä¸ºå¹³è¡¡çš„äºŒå‰æ ‘å°†æŠŠæ—¶é—´å¤æ‚åº¦é™ä½ä¸º O(log n) ã€‚ æŒ‰ç…§é«˜åº¦å°½å¯èƒ½ä½æˆ–è€…å·¦å³å°½å¯èƒ½å¹³è¡¡æ¥æ’åˆ—èŠ‚ç‚¹çš„äºŒå‰æœç´¢æ ‘å°±æ˜¯å¹³è¡¡äºŒå‰æ ‘ (Balance Binary Tree) or (AVL Tree)( AVL æ˜¯ä»¥å‘æ˜è¿™ä¸€æ•°æ®ç»“æ„çš„ç§‘å­¦å®¶å‘½åçš„)ã€‚ å¹³è¡¡å› å­ å¹³è¡¡å› å­ (Balance Factor) è¡¨ç¤ºä¸€ä¸ªæ ‘èŠ‚ç‚¹çš„å¹³è¡¡ç¨‹åº¦ï¼Œå®ƒçš„å€¼ BF(T)BF(T)BF(T) ç”±èŠ‚ç‚¹ T çš„å·¦å³å­æ ‘é«˜åº¦å·®å†³å®šï¼š BF(T)=Hl(T)âˆ’Hr(T)BF(T) = Hl(T) - Hr(T)BF(T)=Hl(T)âˆ’Hr(T) å¹³è¡¡äºŒå‰æ ‘ å¹³è¡¡äºŒå‰æ ‘çš„ä»»ä¸€èŠ‚ç‚¹å®ƒçš„å·¦å³å­æ ‘é«˜åº¦å·®å³å¹³è¡¡å› å­çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1ï¼Œå³ âˆ£BF(T)âˆ£&lt;=1|BF(T)|&lt;=1âˆ£BF(T)âˆ£&lt;=1 å¹³è¡¡äºŒå‰æ ‘çš„é«˜åº¦ è®¾ä¸€é¢—é«˜åº¦ä¸º hhh çš„å¹³è¡¡äºŒå‰æ ‘èƒ½æ‹¥æœ‰çš„æœ€å°çš„èŠ‚ç‚¹æ•°ä¸º nhn_hnhâ€‹, åˆ™å¯¹äºè¯¥äºŒå‰æ ‘çš„ä»»ä¸€èŠ‚ç‚¹ï¼Œå…¶å·¦å³å­æ ‘çš„é«˜åº¦åˆ†åˆ«ä¸º hâˆ’1h - 1hâˆ’1 å’Œ hâˆ’2h - 2hâˆ’2, å…¶èŠ‚ç‚¹æ•°åˆ†åˆ«ä¸º nhâˆ’1n_{h-1}nhâˆ’1â€‹ å’Œ nhâˆ’2n_{h-2}nhâˆ’2â€‹, åˆ™è¯¥äºŒå‰æ ‘çš„æ€»èŠ‚ç‚¹æ•°ä¸º nh=nhâˆ’1+nnâˆ’2+1n_h = n_{h-1} + n_{n-2} + 1nhâ€‹=nhâˆ’1â€‹+nnâˆ’2â€‹+1. è¯¥é€’æ¨å…¬å¼æ¨å¹¿åˆ°è¯¥äºŒå‰æ ‘çš„ä»»ä¸€å­æ ‘éƒ½æˆç«‹ï¼Œå› æ­¤ï¼Œé«˜åº¦ä¸º hhh çš„å¹³è¡¡äºŒå‰æ ‘èŠ‚ç‚¹æ•°æ»¡è¶³ç±»æ–æ³¢é‚£å¥‘æ•°åˆ—é€’æ¨å…¬å¼ è®¾æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç¬¬ hhh é¡¹å€¼ä¸º Fh=Fhâˆ’1+Fhâˆ’2F_h = F_{h-1} + F_{h-2}Fhâ€‹=Fhâˆ’1â€‹+Fhâˆ’2â€‹, åˆ™ nh=Fhâˆ’1n_h = F_h - 1nhâ€‹=Fhâ€‹âˆ’1. åˆå› ä¸º Fhâ‰ˆ15(1+52)hF_h \\approx \\frac{1}{\\sqrt{5}}(\\frac{1 + \\sqrt{5}}{2})^hFhâ€‹â‰ˆ5â€‹1â€‹(21+5â€‹â€‹)h, æ•… nhâ‰ˆ15(1+52)hâˆ’1n_h \\approx \\frac{1}{\\sqrt{5}}(\\frac{1 + \\sqrt{5}}{2})^h - 1nhâ€‹â‰ˆ5â€‹1â€‹(21+5â€‹â€‹)hâˆ’1ï¼Œæ‰€ä»¥ï¼Œå¯¹äºèŠ‚ç‚¹æ•°ä¸º nnn çš„å¹³è¡¡äºŒå‰æ ‘ï¼Œä»–çš„é«˜åº¦æ˜¯ logâ¡2n\\log_2nlog2â€‹n æ•°é‡çº§çš„ï¼Œæœç´¢çš„æœ€åæ—¶é—´å¤æ‚åº¦æ˜¯ O(logâ¡n)O(\\log n)O(logn) å¹³è¡¡äºŒå‰æ ‘çš„è‡ªå¹³è¡¡ ç”±äºå¹³è¡¡äºŒå‰æ ‘ä¹Ÿæ˜¯ä¸€é¢—äºŒå‰æœç´¢æ ‘ï¼Œå®ƒåœ¨èŠ‚ç‚¹æ’å…¥æ—¶ä»éœ€æ»¡è¶³äºŒå‰æœç´¢æ ‘å·¦å°å³å¤§çš„è§„åˆ™ã€‚è¿™ç§æƒ…å†µä¸‹éš¾å…ä¼šç ´ååŸæœ‰çš„å¹³è¡¡ï¼ˆå¹³è¡¡å› å­ä¼šæ”¹å˜ï¼‰ã€‚å¦‚ï¼š å¯¹è¿™é¢—æ ‘è€Œè¨€ï¼Œå®ƒæ˜¯å¹³è¡¡çš„ï¼Œé™¤æœ€å€’æ•°ç¬¬äºŒå±‚èŠ‚ç‚¹å¤–å…¶ä»–èŠ‚ç‚¹çš„å¹³è¡¡å› æ•°éƒ½æ˜¯ 0 ã€‚æ­¤æ—¶å¦‚æœè¦æ’å…¥å…ƒç´  8 ï¼Œæ ¹æ®äºŒå‰æœç´¢æ ‘çš„æ’å…¥è§„åˆ™ï¼ŒèŠ‚ç‚¹å°†è¢«æ’å…¥åˆ°èŠ‚ç‚¹7çš„å³å­èŠ‚ç‚¹ä½ç½®ï¼Œä¸ä¼šç ´åæ ‘çš„å¹³è¡¡ã€‚ å¦‚æœè¢«æ’å…¥çš„å…ƒç´ æ˜¯ 79 ï¼Œåˆ™ä¼šè¢«æ’å…¥åˆ°èŠ‚ç‚¹ 78 çš„å³å­èŠ‚ç‚¹ä½ç½®ï¼Œæ­¤æ—¶èŠ‚ç‚¹ 71 çš„å¹³è¡¡å› æ•°å°†å˜ä¸º -2 ï¼ŒèŠ‚ç‚¹ 50 çš„å¹³è¡¡å› æ•°ä¹Ÿä¼šå˜ä¸º -2 ï¼Œå¹³è¡¡æ€§è¢«ç ´åã€‚ æˆ‘ä»¬ç§°å¹³è¡¡æ€§è¢«ç ´åçš„èŠ‚ç‚¹ä¸ºå‘ç°è€…ï¼Œç ´åå¹³è¡¡æ€§çš„èŠ‚ç‚¹ä¸ºç ´åè€…ã€‚æ ¹æ®ç ´åè€…ä¸å‘ç°è€…çš„ç›¸å¯¹ä½ç½®ï¼ŒæŠŠç ´åå¹³è¡¡çš„æ’å…¥åˆ†ä¸º 4 ç§æƒ…å†µï¼š RRæ’å…¥ â€”ç ´åè€…ä½äºå‘ç°è€…çš„å³å­æ ‘çš„å³è¾¹ LLæ’å…¥ â€”ç ´åè€…ä½äºå‘ç°è€…çš„å·¦å­æ ‘çš„å·¦è¾¹ RLæ’å…¥ â€”ç ´åè€…ä½äºå‘ç°è€…çš„å³å­æ ‘çš„å·¦è¾¹ LRæ’å…¥ â€”ç ´åè€…ä½äºå‘ç°è€…çš„å·¦å­æ ‘çš„å³è¾¹ å¯¹è¿™å››ç§æƒ…å†µåˆ†åˆ«è¿›è¡Œå¤„ç†ï¼ŒæŠŠè¢«ç ´åçš„å¹³è¡¡æ ‘é‡æ–°æ„é€ æˆå¹³è¡¡äºŒå‰æ ‘ï¼Œå°±æ˜¯å¹³è¡¡äºŒå‰æ ‘çš„è‡ªå¹³è¡¡ã€‚ å››ç§å¤„ç†æ–¹å¼åˆ†åˆ«ä¸ºï¼šRRæ—‹è½¬ï¼ŒLLæ—‹è½¬ï¼ŒRLæ—‹è½¬ï¼ŒLRæ—‹è½¬ï¼Œæ—‹è½¬çš„ç»“æœéœ€è¦æ»¡è¶³äºŒå‰æŸ¥æ‰¾æ ‘çš„è§„åˆ™ã€‚ RRæ—‹è½¬ å¦‚å›¾æ‰€ç¤ºçš„å¹³è¡¡äºŒå‰æ ‘ï¼Œå‡è®¾æ’å…¥å…ƒç´  80 æ­¤æ—¶å‘ç°è€…æ˜¯ 50 ï¼Œç ´åè€…æ˜¯ 80 ã€‚ æ ¹æ®äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ä¸éš¾çŸ¥é“ï¼Œå‘ç°è€… 50 çš„å³å­æ ‘æ‰€æœ‰èŠ‚ç‚¹å‡å¤§äº 50 ã€‚å› æ­¤ï¼Œå¯ä»¥ç”¨ 50 çš„å³å­èŠ‚ç‚¹æ›¿æ¢ 50 çš„ä½ç½®ï¼ŒåŒæ—¶æŠŠ 50 å³å­èŠ‚ç‚¹ 78 çš„å·¦å­æ ‘ï¼ˆä¸€å®šå°äº 78 ï¼‰æŒ‚åœ¨ 50 çš„å³å­èŠ‚ç‚¹å¤„ï¼ˆä¸€å®šå¤§äº 50 ï¼‰ï¼Œæœ€åæŠŠ 50 è¿™ä¸€èŠ‚ç‚¹è¿åŒå®ƒçš„å­æ ‘æŒ‚åœ¨èŠ‚ç‚¹ 78 çš„å·¦å­èŠ‚ç‚¹ä½ç½®ã€‚ è¿‡ç¨‹å¯ä»¥ç®€è¿°ä¸ºï¼š ä½¿ç”¨å‘ç°è€… F çš„å³å­èŠ‚ç‚¹ r ä»£æ›¿å‘ç°è€… æŠŠå‘ç°è€… F æŒ‚åˆ° r çš„å·¦å­èŠ‚ç‚¹å¤„ æŠŠ r çš„å·¦å­èŠ‚ç‚¹ï¼ˆå¯ä»¥ä¸ºç©ºï¼‰é‡æ–°æŒ‚åœ¨ F çš„å³å­èŠ‚ç‚¹å¤„ è¿”å›å æ®åŸ F èŠ‚ç‚¹ä½ç½®çš„èŠ‚ç‚¹ï¼ˆåº”è¯¥ä¸º r ï¼‰ã€‚ 123456789101112//æ³¨æ„ï¼šæ­¤å‡½æ•°ä¸åº”å•ç‹¬ä½¿ç”¨ï¼Œå®ƒåº”è¯¥é…åˆæ’å…¥æ“ä½œä½¿ç”¨// å› ä¸ºå•å•å°†finderçš„å­æ ‘æ—‹è½¬æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦æŠŠè¿”å›çš„èŠ‚ç‚¹æŒ‚è½½åˆ°åŸæ ‘ä¸ŠAVLTree *singleRightRotation(AVLTree *tree)&#123; //tree is the finder AVLTree *replacer = tree-&gt;right; //right child of finder tree-&gt;right = replacer-&gt;left; //right child&#x27;s left child to finder&#x27;s right child replacer-&gt;left = tree; //finder to right child&#x27;s left child //update heights of changed nodes replacer-&gt;height = maxOfTwo(replacer-&gt;left-&gt;height, replacer-&gt;right-&gt;height) + 1; tree-&gt;height = maxOfTwo(tree-&gt;left-&gt;height, tree-&gt;right-&gt;height) + 1; return replacer;&#125; LLæ—‹è½¬ ç±»ä¼¼çš„ï¼Œå‡è®¾ä¸Šå›¾æ‰€ç¤ºçš„å¹³è¡¡äºŒå‰æ ‘è¦æ’å…¥å…ƒç´  2 åˆ™æ–°æ’å…¥çš„å…ƒç´ ä½äºæœ€å·¦ä¾§èŠ‚ç‚¹ 1 çš„å³å­èŠ‚ç‚¹ä½ç½®ã€‚æ­¤æ—¶å‘ç°è€…æ˜¯ 6 ï¼Œç ´åè€…æ˜¯ 1 ï¼Œç ´åè€…ä½äºå‘ç°è€…çš„å·¦å­æ ‘çš„å·¦å­æ ‘çš„å³å­èŠ‚ç‚¹å¤„ï¼ˆæ³¨æ„ï¼šè™½ç„¶ä½äºå³å­èŠ‚ç‚¹ï¼Œä½†ä»ç„¶æ˜¯å‘ç°è€…çš„å·¦å­æ ‘çš„å·¦å­æ ‘ä¸Šï¼‰,å› æ­¤æ˜¯ LLæ’å…¥ã€‚ ä¸ RRæ’å…¥ ç±»ä¼¼ï¼Œå‘ç°è€…çš„å·¦å­æ ‘æ‰€æœ‰èŠ‚ç‚¹éƒ½å°äºå‘ç°è€…ï¼Œå› æ­¤å¯ä»¥: ç”¨å‘ç°è€…çš„å·¦å­èŠ‚ç‚¹ä»£æ›¿å‘ç°è€…çš„ä½ç½® æŠŠå‘ç°è€…æŒ‚åœ¨å…¶å·¦å­èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹å¤„ï¼ˆå‘ç°è€…ä¸€å®šå¤§äºå®ƒçš„å·¦å­èŠ‚ç‚¹ï¼‰ æŠŠå‘ç°è€…çš„å·¦å­èŠ‚ç‚¹çš„å³å­æ ‘æŒ‚åœ¨å‘ç°è€…çš„å·¦å­èŠ‚ç‚¹ä½ç½® 12345678910AVLTree *singleLeftRotation(AVLTree *tree)&#123; AVLTree *replacer = tree-&gt;left; tree-&gt;left = replacer-&gt;right; replacer-&gt;right = tree; //update heights of changed nodes replacer-&gt;height = maxOfTwo(replacer-&gt;left-&gt;height, replacer-&gt;right-&gt;height) + 1; tree-&gt;height = maxOfTwo(tree-&gt;left-&gt;height, tree-&gt;right-&gt;height) + 1; return replacer;&#125; RLæ—‹è½¬ å¦‚ä¸Šå¹³è¡¡äºŒå‰æ ‘ï¼Œæ’å…¥å…ƒç´  49 49 æ’å…¥åˆ°èŠ‚ç‚¹ 47 çš„å³å­èŠ‚ç‚¹å¤„ï¼Œæ­¤æ—¶å‘ç°è€…æ˜¯ 46 ï¼Œç ´åè€…æ˜¯ 49 ã€‚ç ´åè€…ä½äºå‘ç°è€…çš„å³å­æ ‘çš„å·¦å­æ ‘ä¸Šï¼Œå› æ­¤æ˜¯ RLæ’å…¥ã€‚ æ­¤æ—¶ï¼Œå‘ç°è€… F å¿…æœ‰ä¸€ä¸ªå³å­èŠ‚ç‚¹ R ï¼ŒèŠ‚ç‚¹ R å¿…æœ‰ä¸€ä¸ªå·¦å­èŠ‚ç‚¹ Lã€‚ æ‰€è°“ RLæ—‹è½¬ å°±æ˜¯å…ˆå¯¹èŠ‚ç‚¹ R åšå³æ—‹: ç„¶åå¯¹èŠ‚ç‚¹ F åšå·¦æ—‹ï¼š 12345AVLTree *rightLeftRotation(AVLTree *tree)&#123; tree-&gt;right = singleRightRotation(tree-&gt;right); return singleLeftRotation(tree);&#125; LRæ—‹è½¬ ä¸Šå›¾æ‰€ç¤ºæ ‘æ’å…¥å…ƒç´  25 å‘ç°è€…æ˜¯ 30 ï¼Œç ´åè€…æ˜¯ 25 ã€‚å…ˆå¯¹èŠ‚ç‚¹ 20 åšå·¦æ—‹: åœ¨å¯¹èŠ‚ç‚¹ 30 å³æ—‹ï¼š 12345AVLTree *leftRightRotation(AVLTree *tree)&#123; tree-&gt;left = singleLeftRotation(tree-&gt;left); return singleRightRotation(tree);&#125; æ’å…¥æ“ä½œ åœ¨ä¸Šè¿°å››ç§æ—‹è½¬çš„åŸºç¡€ä¸Šï¼Œå¯ä»¥å®ç°æ–°çš„å…·æœ‰è‡ªå¹³è¡¡ç‰¹ç‚¹çš„æ’å…¥æ“ä½œã€‚æ’å…¥ä¹‹ååˆ¤æ–­å…¶çˆ¶èŠ‚ç‚¹çš„å¹³è¡¡å› å­ï¼Œå¦‚æœå¹³è¡¡è¢«ç ´åï¼Œä½¿ç”¨å¯¹åº”çš„æ—‹è½¬æ“ä½œæ¢å¤å¹³è¡¡ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142AVLTree *insert(AVLTree *tree, KeyType key)&#123; //æ’å…¥å®Œæˆåè¯¥ç¨‹åºçš„é€’å½’è¿‡ç¨‹ä¼šä»ä¸‹è€Œä¸Šæ£€æŸ¥çˆ¶èŠ‚ç‚¹çš„å¹³è¡¡æ€§ if (tree == NULL) &#123; tree = (AVLTree *)malloc(sizeof(AVLTree)); tree-&gt;key = key; tree-&gt;left = tree-&gt;right = NULL; &#125; else if (key &lt; tree-&gt;key) &#123; //insert left sub tree tree-&gt;left = insert(tree-&gt;left, key); if (getHeight(tree-&gt;left) - getHeight(tree-&gt;right) == 2) &#123; //balance broken if (key &lt; tree-&gt;key) &#123; //single left rotation tree = singleLeftRotation(tree); &#125; else &#123; //signle left right rotation tree = leftRightRotation(tree); &#125; &#125; &#125; else if (key &gt; tree-&gt;key) &#123; tree-&gt;right = insert(tree-&gt;right, key); if (getHeight(tree-&gt;right) - getHeight(tree-&gt;left) == 2) &#123; //balance broken if (key &gt; tree-&gt;key) &#123; //single right rotation tree = singleRightRotation(tree); &#125; else &#123; //right left rotation tree = rightLeftRotation(tree); &#125; &#125; &#125; //update height tree-&gt;height = maxOfTwo(getHeight(tree-&gt;left), getHeight(tree-&gt;right)) + 1; return tree;&#125; åˆ é™¤æ“ä½œ TODO","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"å¹³è¡¡äºŒå‰æ ‘","slug":"å¹³è¡¡äºŒå‰æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91/"}]},{"title":"æ•°æ®ç»“æ„-äºŒå‰æœç´¢æ ‘","slug":"æ•°æ®ç»“æ„-äºŒå‰æœç´¢æ ‘","date":"2022-03-20T06:28:47.000Z","updated":"2023-06-21T06:51:28.940Z","comments":true,"path":"æ•°æ®ç»“æ„-äºŒå‰æœç´¢æ ‘/","link":"","permalink":"https://blog.zhuwenq.cc/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 26 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 26 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 20 æ—¥é‡æ–°æ•´ç† äºŒå‰æœç´¢æ ‘ (Binary Search Tree) åˆç§°ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ã€‚äºŒå‰æœç´¢æ ‘æœ¬è´¨ä¸Šæ˜¯ä¸€é¢—äºŒå‰æ ‘ï¼Œåœ¨éç©ºæ—¶å®ƒå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š å·¦å­æ ‘çš„æ‰€æœ‰é”®å€¼ key å°äºæ ¹èŠ‚ç‚¹é”®å€¼ å³å­æ ‘çš„æ‰€æœ‰é”®å€¼ key å¤§äºæ ¹èŠ‚ç‚¹é”®å€¼ å·¦å­æ ‘å’Œå³å­æ ‘ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ ï¼ˆæ¯ä¸ªèŠ‚ç‚¹çš„é”®å€¼æ˜¯å”¯ä¸€çš„ï¼‰ æ“ä½œé›† 12345678910//ä»äºŒå‰æœç´¢æ ‘ä¸­æ‰¾å‡ºé”®å€¼ä¸ºkeyçš„èŠ‚ç‚¹åœ°å€BinarySearchTree *find(BinarySearchTree *tree, KeyType key);//æ‰¾å‡ºäºŒå‰æœç´¢æ ‘çš„æœ€å°é”®å€¼èŠ‚ç‚¹BinarySearchTree *findMin(BinarySearchTree *tree);//æ‰¾å‡ºäºŒå‰æœç´¢æ ‘çš„æœ€å¤§é”®å€¼èŠ‚ç‚¹BinarySearchTree *findMax(BinarySearchTree *tree);//å‘äºŒå‰æœç´¢æ ‘æ’å…¥é”®å€¼ä¸ºkeyçš„èŠ‚ç‚¹BinarySearchTree *insert(BinarySearchTree *tree, KeyType key);//ä»äºŒå‰æœç´¢æ ‘åˆ é™¤é”®å€¼ä¸ºkeyçš„èŠ‚ç‚¹BinarySearchTree *delete (BinarySearchTree *tree, KeyType key); å®ç° find æŸ¥æ‰¾çš„æ“ä½œè¾ƒä¸ºç®€å• è‹¥æ ‘ä¸ºç©ºï¼Œè¿”å› NULL è‹¥æ ‘éç©ºï¼Œå°† key ä¸æ ¹èŠ‚ç‚¹çš„ key è¿›è¡Œæ¯”è¾ƒï¼š è‹¥å¤§äºæ ¹èŠ‚ç‚¹çš„ key ï¼Œè¯´æ˜å¾…æŸ¥æ‰¾èŠ‚ç‚¹åœ¨æ ¹èŠ‚ç‚¹çš„å³ä¾§ï¼Œåœ¨å³å­æ ‘ä¸­ç»§ç»­æŸ¥æ‰¾ è‹¥å°äºæ ¹èŠ‚ç‚¹çš„ key ï¼Œè¯´æ˜å¾…æŸ¥æ‰¾èŠ‚ç‚¹åœ¨æ ¹èŠ‚ç‚¹çš„å·¦ä¾§ï¼Œåœ¨å·¦å­æ ‘ä¸­ç»§ç»­æŸ¥æ‰¾ è‹¥ç­‰äºæ ¹èŠ‚ç‚¹çš„ key ï¼Œè¯´æ˜å¾…æŸ¥æ‰¾èŠ‚ç‚¹å·²æ‰¾åˆ°ï¼Œç›´æ¥è¿”å›è·ŸèŠ‚ç‚¹ 123456789101112131415161718//é€’å½’å®ç°BinarySearchTree *find(BinarySearchTree *tree, KeyType key)&#123; if (tree == NULL) return NULL; if (key &gt; tree-&gt;key) &#123; return find(tree-&gt;right, key); &#125; else if (key &lt; tree-&gt;key) &#123; return find(tree-&gt;left, key); &#125; else &#123; return tree; &#125;&#125; ä¸Šè¿°å°¾é€’å½’å®ç°æ•ˆç‡ä¸é«˜è€Œä¸”æœ‰çˆ†æ ˆçš„é£é™©ï¼Œä¸‹é¢æ˜¯å°†å°¾é€’å½’å±•å¼€ä¸ºå¾ªç¯çš„å®ç°ã€‚ 12345678910111213141516//å¾ªç¯å®ç°BinarySearchTree *find(BinarySearchTree *tree, KeyType key)&#123; if (tree == NULL) return NULL; BinarySearchTree *temp = tree; while (temp) &#123; if (key &gt; temp-&gt;key) temp = temp-&gt;right; else if (key &lt; temp-&gt;key) temp = temp-&gt;left; else return temp; &#125;&#125; findMin è§‚å¯ŸäºŒå‰æŸ¥æ‰¾æ ‘çš„ç»“æ„ç‰¹ç‚¹ï¼Œå®¹æ˜“çŸ¥é“å…¶æœ€å°çš„å…ƒç´ ä¸€å®šåœ¨æ ‘çš„æœ€å·¦ä¾§ã€‚ 1234567891011BinarySearchTree *findMin(BinarySearchTree *tree)&#123; if (tree == NULL) return NULL; BinarySearchTree *temp = tree; while (temp-&gt;left) &#123; temp = temp-&gt;left; &#125; return temp;&#125; 1234567//é€’å½’å®ç°BinarySearchTree *findMin(BinarySearchTree *tree)&#123; if(tree==NULL) return NULL; if(tree-&gt;left) return findMin(tree-&gt;left); else return tree;&#125; findMax åŒç†ï¼Œæœ€å¤§å…ƒç´ ä¸€å®šåœ¨äºŒå‰æœç´¢æ ‘çš„æœ€å³ä¾§ã€‚ insert æ’å…¥æ“ä½œè¾ƒä¸ºå¤æ‚ï¼Œå…ˆæ‰¾åˆ°è¦æ’å…¥çš„ä½ç½®ï¼Œç„¶åæ„é€ èŠ‚ç‚¹å°†èŠ‚ç‚¹æ’å…¥åˆé€‚çš„ä½ç½®ã€‚ é¦–å…ˆçœ‹ç®€å•çš„é€’å½’å®ç° 123456789101112131415BinarySearchTree *insert(BinarySearchTree *tree, KeyType key)&#123; if (tree == NULL) &#123; tree = (BinarySearchTree *)malloc(sizeof(BinarySearchTree)); tree-&gt;key = key; tree-&gt;left = tree-&gt;right = NULL; return tree; &#125; if (key &gt; tree-&gt;key) return insert(tree-&gt;right, key); else if (key &lt; tree-&gt;key) return insert(tree-&gt;left, key); //else key==tree-&gt;key; do nothing&#125; å¾ªç¯å®ç°ï¼š 12345678910111213141516171819//å¾ªç¯å®ç°BinarySearchTree *insert(BinarySearchTree *tree, KeyType key)&#123; BinarySearchTree *temp = tree; while (temp) &#123; if (key &gt; temp-&gt;key) temp = temp-&gt;right; else if (key &lt; temp-&gt;key) temp = temp-&gt;left; else break; //if equals,I dont know what&#x27;s right,lets just rewrite it. &#125; //when break out while loop,temp must be NULL temp = (BinarySearchTree *)malloc(sizeof(BinarySearchTree)); temp-&gt;key = key; temp-&gt;left = temp-&gt;right = NULL; return temp;&#125; delete åˆ é™¤æ“ä½œæ˜¯æœ€ä¸ºå¤æ‚çš„ï¼Œå› ä¸ºè¢«åˆ é™¤çš„èŠ‚ç‚¹å¤„åœ¨ä¸åŒä½ç½®æ—¶ï¼Œæ“ä½œçš„è¡Œä¸ºä¹Ÿæ˜¯ä¸åŒçš„ã€‚é¦–å…ˆæ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ è‹¥åˆ é™¤çš„èŠ‚ç‚¹æ˜¯å¶èŠ‚ç‚¹ï¼Œå¯ä»¥ç›´æ¥å°†å…¶ç½®ä¸ºNULL è‹¥åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨å®ƒçš„å­©å­èŠ‚ç‚¹ä»£æ›¿è¢«åˆ é™¤çš„èŠ‚ç‚¹ è‹¥åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™æœ‰ä¸¤ç§é€‰æ‹©ï¼š ä½¿ç”¨è¢«åˆ é™¤èŠ‚ç‚¹çš„å·¦å­æ ‘çš„æœ€å¤§å€¼èŠ‚ç‚¹ä»£æ›¿è¢«åˆ é™¤èŠ‚ç‚¹ ä½¿ç”¨è¢«åˆ é™¤èŠ‚ç‚¹çš„å³å­æ ‘çš„æœ€å°å€¼èŠ‚ç‚¹ä»£æ›¿è¢«åˆ é™¤èŠ‚ç‚¹ ç„¶åè¿˜éœ€è¦åˆ é™¤å·¦å­æ ‘/å³å­æ ‘ä¸­é‚£ä¸ªæ‹¿å»ä»£æ›¿è¢«åˆ é™¤èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œè¿‡ç¨‹è¾ƒä¸ºå¤æ‚ï¼Œåˆ é™¤å­æ ‘èŠ‚ç‚¹çš„æ“ä½œéœ€è¦é€’å½’å®Œæˆï¼ˆå…¶ä»–çš„å®ç°ä¸ä¼šğŸ˜ï¼‰ 123456789101112131415161718192021222324252627BinarySearchTree *delete (BinarySearchTree *tree, KeyType *key)&#123; BinarySearchTree *target = find(tree, key); if (target == NULL) return NULL; if (target-&gt;left &amp;&amp; target-&gt;right) &#123; //both left child and right child are valid KeyType min = findMin(target-&gt;right)-&gt;key; //or findMax(target-&gt;left) target-&gt;key = min; delete (target-&gt;right, min); &#125; else &#123; BinarySearchTree *temp = target; //copy target address,it need to be freed if (target-&gt;left != NULL) &#123; //only left child target = target-&gt;left; &#125; else if (target-&gt;right != NULL) &#123; //only right child target = target-&gt;right; &#125; //else no child,just free the node will be fine free(temp); &#125; return tree;&#125; æœ€å æ³¨æ„åˆ°æ ¹æ®äºŒå‰æœç´¢æ ‘çš„æ’å…¥è§„åˆ™ï¼Œå‡å¦‚è¦æ’å…¥çš„å…ƒç´ ä¸€ä¸ªæ¯”ä¸€ä¸ªå¤§ï¼Œåˆ™æ ‘çš„å³ä¾§å°†å½¢æˆä¸€ä¸ªé•¿é“¾ï¼Œé«˜åº¦ä¼šè¿…é€Ÿå¢åŠ ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåº”è¯¥åœ¨æ’å…¥æ—¶å¼•å…¥ä¸€ç§å°½é‡å¹³è¡¡çš„æ’å…¥è§„åˆ™ï¼Œè¿™å°±æ˜¯å¹³è¡¡äºŒå‰æ ‘ã€‚","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"äºŒå‰æœç´¢æ ‘","slug":"äºŒå‰æœç´¢æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/"}]},{"title":"Latex Citation Style","slug":"Latex-Citation-Style","date":"2022-03-18T15:03:43.000Z","updated":"2023-06-21T06:51:28.800Z","comments":true,"path":"Latex-Citation-Style/","link":"","permalink":"https://blog.zhuwenq.cc/Latex-Citation-Style/","excerpt":"LaTeX\\LaTeXLATEâ€‹X ä¸­æœ‰ä¸‰ä¸ªä¸»æµçš„ bibliography åŒ…ï¼šbibtex, natbib å’Œ biblatex, å…¶ä¸­ biblatex æ”¯æŒæœ¬åœ°åŒ–(å¤šè¯­è¨€), ä¹Ÿæ›´åŠ ç°ä»£åŒ–æ›´åŠ æ˜“ç”¨ã€‚","text":"LaTeX\\LaTeXLATEâ€‹X ä¸­æœ‰ä¸‰ä¸ªä¸»æµçš„ bibliography åŒ…ï¼šbibtex, natbib å’Œ biblatex, å…¶ä¸­ biblatex æ”¯æŒæœ¬åœ°åŒ–(å¤šè¯­è¨€), ä¹Ÿæ›´åŠ ç°ä»£åŒ–æ›´åŠ æ˜“ç”¨ã€‚ 12% å¯¼å…¥ biblatex , ä½¿ç”¨ biber åç«¯ , author-year cite style\\usepackage[backend=biber,style=authoryear]&#123;biblatex&#125; å¯¼å…¥ biblatex å¯ä»¥ä¼ å…¥çš„å‚æ•°[1]ï¼š backend=biber: æ’åº bibliography çš„åç«¯ç¨‹åºï¼Œé»˜è®¤çš„ biber æ”¯æŒä¸åŒçš„æ’åºæ–¹å¼å’Œå¤šç§æ ·å¼ï¼ŒåŒæ—¶ä¹Ÿæ›´æ˜“äºä½¿ç”¨ã€‚å¦ä¸€ä¸ªé€‰é¡¹æ˜¯ bibtex, ä»…æ”¯æŒæ’åºï¼Œæ²¡æœ‰æ ·å¼æ”¯æŒã€‚ style=alphabetic: bibliography æ ·å¼å’Œ citation æ ·å¼ sorting=ynt: å®šä¹‰æ’åºæ–¹å¼ option æ’åºé¡ºåº nty name, title, year nyt name, year, title nyvt name, year, volume, title anyt alphabetic label, name, year, title anyvt alphabetic label, name, year, volume, title none ä»¥ citation é¡ºåºæ’åˆ— bibliography æ ·å¼ style å­—æ®µæ”¯æŒçš„ bibtex æ ·å¼[2]ï¼š æ‹“å±•çš„æ ·å¼ï¼š é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥è‡ªå®šä¹‰ bibliography section çš„æ ‡é¢˜ï¼š 1\\printbibliography[title=&#123;Whole bibliography&#125;] æˆ–è€…ä»¥æŸä¸ªæ ‡å‡†è¿‡æ»¤æ‰“å° bibliographyï¼š 12345\\printbibliography[type=article,title=&#123;Articles only&#125;]\\printbibliography[type=book,title=&#123;Books only&#125;]\\printbibliography[keyword=&#123;physics&#125;,title=&#123;Physics-related only&#125;]\\printbibliography[keyword=&#123;latex&#125;,title=&#123;\\LaTeX-related only&#125;] æ·»åŠ  bibliography section åˆ°ç›®å½•ï¼š 1234% é¡¶çº§ç›®å½•\\printbibliography[heading=bibintoc,title=&#123;Whole bibliography&#125;]% æ¬¡çº§ç›®å½•\\printbibliography[heading=subbibintoc,type=article,title=&#123;Articles only&#125;] Citation æ ·å¼ æ²¡æœ‰æ˜¾ç¤ºè®¾ç½®æ—¶ï¼Œbiblatex ä¼šä½¿ç”¨æœ€ç¬¦åˆ bibliography æ ·å¼çš„ citation æ ·å¼[3] numberic: æ•°å­—æ ·å¼ numberic-comp: è‡ªåŠ¨èšåˆè¿ç»­çš„æ•°å­—ï¼š[1, 2, 3] èšåˆä¸º [1-3] numberic-verb: è‡ªåŠ¨åˆ†è§£è¿ç»­çš„æ•°å­—ï¼š[1, 2, 3] åˆ†è§£ä¸º [1];[2];[3] alphabetic: alphabetic-verb: åˆ†è§£è¿ç»­çš„ citation authoryear: authoryear-comp: åŒä¸€ä¸ªä½œè€…çš„ä¸åŒå¹´ä»½çš„å¼•ç”¨èšåˆï¼šDoe 1992, Doe 1995 èšåˆä¸º Doe 1992, 1995 authoryear-ibid: authoryear-icomp: authortitle: authortitle-comp: authortitle-ibid: authortitle-icomp: authortitle-terse: authortitle-tcomp: authortitle-ticomp: verbose: reading: æœŸåˆŠæ ·å¼ Citation style biblatex stylename description ACS chem-acs American Chemical Society (ACS) style AIP phys (*) American Institute of Physics (AIP) style Nature nature Nature style Science science Science style IEEE ieee Institute of Electrical and Electronics Engineers (IEEE) style Chicago chicago-authordate Chicago Style MLA mla MLA style APA apa American Psychological Association (APA) style Bibliography management with biblatex â†©ï¸ Biblatex bibliography styles â†©ï¸ Biblatex Citation styles â†©ï¸","categories":[{"name":"è®°å½•å¤‡å¿˜","slug":"è®°å½•å¤‡å¿˜","permalink":"https://blog.zhuwenq.cc/categories/%E8%AE%B0%E5%BD%95%E5%A4%87%E5%BF%98/"}],"tags":[{"name":"Latex","slug":"Latex","permalink":"https://blog.zhuwenq.cc/tags/Latex/"},{"name":"Citation Style","slug":"Citation-Style","permalink":"https://blog.zhuwenq.cc/tags/Citation-Style/"}]},{"title":"Knowledge-Aware Languege Model Pretraining","slug":"Knowledge-Aware-Languege-Model-Pretraining","date":"2022-03-12T08:44:33.000Z","updated":"2023-06-21T06:51:28.800Z","comments":true,"path":"Knowledge-Aware-Languege-Model-Pretraining/","link":"","permalink":"https://blog.zhuwenq.cc/Knowledge-Aware-Languege-Model-Pretraining/","excerpt":"æ–‡ç« ç ”ç©¶å‘ PLM æ³¨å…¥çŸ¥è¯†çš„æ–¹æ³•ï¼Œæå‡ºä¸€ç§ä¸éœ€æ›´æ”¹ transformer layerï¼Œä¸éœ€æ·»åŠ é¢å¤–çš„ knowledge-aware layer çš„çŸ¥è¯†æ³¨å…¥æ–¹æ³•ï¼šKALMã€‚","text":"æ–‡ç« ç ”ç©¶å‘ PLM æ³¨å…¥çŸ¥è¯†çš„æ–¹æ³•ï¼Œæå‡ºä¸€ç§ä¸éœ€æ›´æ”¹ transformer layerï¼Œä¸éœ€æ·»åŠ é¢å¤–çš„ knowledge-aware layer çš„çŸ¥è¯†æ³¨å…¥æ–¹æ³•ï¼šKALMã€‚ Introduction PLM ç”Ÿæˆçš„è¯­è¨€è¡¨å¾è¢«è®¤ä¸ºå«æœ‰ä¸°å¯Œçš„è¯æ³•è¯­æ³•çŸ¥è¯†ï¼Œä½†æ˜¯åœ¨ç¼ºä¹æ˜¾ç¤ºçŸ¥è¯†æ€§ä»»åŠ¡è®­ç»ƒæ—¶ï¼ŒPLM å¸¸å¸¸ç”Ÿæˆè¯­æ³•ä¸Šæ­£ç¡®ï¼Œä½†äº‹å®ä¸Šé”™è¯¯çš„æ–‡æœ¬ã€‚è¿™è¯´æ˜ PLM ä¸­ç¼ºä¹è¯­ä¹‰ï¼Œä»¥åŠäº‹å®çŸ¥è¯†ã€‚ ä½œè€…æå‡ºä¸€ç§ä¿ƒä½¿ PLM æ³¨æ„è¾“å…¥æ–‡æœ¬ä¸­çš„å®ä½“ä»¥åŠå…¶åœ¨æ–‡æœ¬ä¸­çš„è§’è‰²çš„é¢„è®­ç»ƒæ¨¡å¼ï¼Œåœ¨æ²¡æœ‰ä½¿æ¨¡å‹å˜å¾—æ›´å¤§çš„æƒ…å†µä¸‹å‘ PLM æ³¨å…¥çŸ¥è¯†ã€‚ ä½œè€…é¦–å…ˆå°†è¾“å…¥è¯­å¥ä¸­çš„ word span è¿æ¥åˆ°å…¶æŒ‡ä»£çš„å®ä½“ä¸Šï¼Œç„¶ååŒæ—¶ä¸º word ç”Ÿæˆ word embedding å’Œ entity embeddingã€‚åœ¨è¾“å‡ºå±‚ï¼Œé™¤å» PLM çš„è¯­è¨€å»ºæ¨¡ç›®æ ‡ä¹‹å¤–ï¼Œä½œè€…æ·»åŠ äº†ä¸€ä¸ª entity prediction task å¼•å¯¼æ¨¡å‹ä»å¹²æ‰°é¡¹ä¸­åˆ†è¾¨å‡º word æ‰€æŒ‡å‘çš„å®ä½“ã€‚è¿™ä¸¤ä¸ªè®­ç»ƒç›®æ ‡ç»¼åˆèµ·æ¥å³æ˜¾ç¤ºåœ°å¼•å¯¼æ¨¡å‹ä¸ä»…è¦é¢„æµ‹å‡ºæ­£ç¡®çš„è¯ï¼ˆè¯­æ³•ï¼Œå¥æ³•ï¼Œè¯­ä¹‰çŸ¥è¯†ï¼‰ï¼Œè¿˜è¦é¢„æµ‹å‡ºè¿™äº›è¯æ‰€æŒ‡ä»£çš„å®ä½“ï¼ˆäº‹å®çŸ¥è¯†ï¼‰ã€‚ KALM ä½œè€…åœ¨è‡ªå›å½’æ¨¡å‹çš„åŸºç¡€ä¸Šè®¾è®¡ KALMï¼Œå¯¹äºä¸€ä¸ª nnn ä¸ª tokens çš„åºåˆ— X={w1,w2,...,wn}X = \\{w_1, w_2, ..., w_n\\}X={w1â€‹,w2â€‹,...,wnâ€‹}, è‡ªå›å½’æ¨¡å‹ç”±ä»¥ä¸‹è¯­è¨€æ¦‚ç‡åˆ†è§£æè¿°ï¼š p(X)=âˆip(wiâˆ£w&lt;i)p(X) = \\prod_i p(w_i|w_{&lt;i}) p(X)=iâˆâ€‹p(wiâ€‹âˆ£w&lt;iâ€‹) åœ¨ PLM ä¸­ï¼Œé€šå¸¸ç”± transformer layer è®¡ç®—ä¸Šè¿°æ¦‚ç‡ï¼š p(wiâˆ£w&lt;i)=transformer(wiâˆ£w&lt;i)p(w_i|w_{&lt;i}) = \\text{transformer}(w_i|w_{&lt;i})p(wiâ€‹âˆ£w&lt;iâ€‹)=transformer(wiâ€‹âˆ£w&lt;iâ€‹) ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼ŒPLM é—´æ¥é€šè¿‡è¯ä¹‹é—´çš„å…±ç°æ¨¡å¼æ•æ‰è¯­ä¹‰çŸ¥è¯†ã€‚ä½œè€…åˆ™é€šè¿‡å‘æ¨¡å‹æä¾›ä¸€ä¸ªä¿¡å·æç¤ºè¾“å…¥/è¾“å‡ºä¸­å®ä½“çš„å­˜åœ¨ä»¥ä¿ƒä½¿æ¨¡å‹å¯¹çŸ¥è¯†çš„æ³¨æ„ï¼ŒæœŸæœ› PLM èƒ½å¤Ÿä»è¾“å…¥è¯­å¥ä¸­æ•æ‰äº‹å®çŸ¥è¯† Entity Tokenizer ä½œè€…é¦–å…ˆä½¿ç”¨ä¸€ä¸ª Entity Tokenizer å°†è¾“å…¥æ–‡æœ¬ä¸­æ‰€æœ‰çš„ token ä¸å…¶æ‰€æŒ‡ä»£çš„æœ€å¸¸å‡ºç°çš„å®ä½“è¿æ¥ï¼šwi:i+kâ†’eiw_{i:i+k}\\rightarrow e_iwi:i+kâ€‹â†’eiâ€‹, å…¶ä¸­ eie_ieiâ€‹ æ˜¯ word span wi:i+kw_{i:i+k}wi:i+kâ€‹ æ‰€æœ€ç»å¸¸æŒ‡ä»£çš„å®ä½“ã€‚å½“ wiw_iwiâ€‹ ä¸å±äºä»»ä½•å·²çŸ¥çš„å®ä½“æ—¶ï¼šei=nulle_i = nulleiâ€‹=null. ä¸Šè¿°è¿‡ç¨‹é€šè¿‡åœ¨ä¸€ä¸ªé¢„å®šä¹‰çš„å®ä½“è¯å…¸ä¸Šè¿›è¡Œæ–‡æœ¬åŒ¹é…è¿›è¡Œã€‚ ç»è¿‡ tokenize åï¼Œè¾“å…¥è¯­å¥è¢«åˆ†æˆè¯-å®ä½“ä¸¤ä¸ª token åºåˆ—ï¼š Xduet={{w1,w2,â€¦,wT}Word Sequence{e1,e2,â€¦,eT}Entity SequenceX_{duet} = \\begin{cases} \\{w_1, w_2, \\dots, w_T\\} &amp;\\text{Word Sequence}\\\\ \\{e_1, e_2, \\dots, e_T\\} &amp;\\text{Entity Sequence} \\end{cases}Xduetâ€‹={{w1â€‹,w2â€‹,â€¦,wTâ€‹}{e1â€‹,e2â€‹,â€¦,eTâ€‹}â€‹Word SequenceEntity Sequenceâ€‹ ä¸Šè¿°ä¸¤ä¸ªåºåˆ—é€ä½ç½®å¯¹é½ï¼Œå½“æœ‰å¤šä¸ªè¯å¯¹åº”åŒä¸€ä¸ªå®ä½“æ—¶ï¼Œå¦‚ wi:i+kw_{i:i+k}wi:i+kâ€‹ å¯¹åº”ä¸€ä¸ªå®ä½“ï¼Œåˆ™ eie_ieiâ€‹ åˆ° ei+ke_{i+k}ei+kâ€‹ æ˜¯ç›¸åŒçš„ã€‚ Knowledge-Aware Input ç»è¿‡ tokenize åï¼Œä½œè€…ä¸ºä¸¤ä¸ª token åºåˆ—åˆ†åˆ«ç”ŸæˆåµŒå…¥ï¼š ei=Embeddinge(ei)âˆˆRdewi=Embeddingw(wi)âˆˆRdw\\begin{aligned} \\mathbf{e}_i &amp;= \\text{Embedding}_e(e_i)\\in\\mathbb{R}^{d_e}\\\\ \\mathbf{w}_i &amp;= \\text{Embedding}_w(w_i)\\in\\mathbb{R}^{d_w} \\end{aligned}eiâ€‹wiâ€‹â€‹=Embeddingeâ€‹(eiâ€‹)âˆˆRdeâ€‹=Embeddingwâ€‹(wiâ€‹)âˆˆRdwâ€‹â€‹ ä¸¤ä¸ªåµŒå…¥çº¿æ€§ç›¸åŠ ä½œä¸ºæ¨¡å‹çš„è¾“å…¥åµŒå…¥ï¼šti=wi+Lineart(ei)\\mathbf{t}_i = \\mathbf{w}_i + \\text{Linear}_t(\\mathbf{e}_i)tiâ€‹=wiâ€‹+Lineartâ€‹(eiâ€‹), å…¶ä¸­ LineartâˆˆRdeÃ—dw\\text{Linear}_t\\in\\mathbb{R}^{d_e\\times d_w}Lineartâ€‹âˆˆRdeâ€‹Ã—dwâ€‹ Knowledge-Aware Output åœ¨è¾“å‡ºå±‚ä¸Šï¼Œé™¤è‡ªå›å½’æ¨¡å‹çš„ next-word prediction ä»»åŠ¡å¤–ï¼Œä½œè€…æ·»åŠ äº†ä¸€ä¸ª next-entity prediction ä»»åŠ¡ã€‚ å…·ä½“æ¥è¯´ï¼Œä½œè€…æ·»åŠ äº†ä¸€ä¸ª output head è¿›è¡Œå®ä½“è¾¨åˆ«ã€‚è®° LLL å±‚ transformer å±‚è¾“å‡ºçš„ç¬¬ iii ä¸ª token çš„è¡¨å¾ä¸º hiL\\mathbf{h}_i^LhiLâ€‹, åˆ™ç¬¬ iii ä¸ªä½ç½®çš„å®ä½“æŸå¤±è®¡ç®—ä¸ºï¼š le(eiâˆ£t&lt;i)=maxâ¡(0,s(hiL,ei)âˆ’s(hiL,eâˆ’)+Î»)s(hiL,ej)=cosâ¡(Linear(hiL),ej)hiL=transformerL(t&lt;i)\\begin{aligned} l_e(e_i|t_{&lt;i}) &amp;= \\max(0, s(\\mathbf{h}_i^L, \\mathbf{e}_i) - s(\\mathbf{h}_i^L, \\mathbf{e}_-)+\\lambda)\\\\ s(\\mathbf{h}_i^L, \\mathbf{e}_j) &amp;= \\cos(\\text{Linear}(\\mathbf{h}_i^L), \\mathbf{e}_j)\\\\ \\mathbf{h}_i^L &amp;= \\text{transformer}^L(t_{&lt;i}) \\end{aligned}leâ€‹(eiâ€‹âˆ£t&lt;iâ€‹)s(hiLâ€‹,ejâ€‹)hiLâ€‹â€‹=max(0,s(hiLâ€‹,eiâ€‹)âˆ’s(hiLâ€‹,eâˆ’â€‹)+Î»)=cos(Linear(hiLâ€‹),ejâ€‹)=transformerL(t&lt;iâ€‹)â€‹ ä¸Šå¼ä¸­ï¼Œeie_ieiâ€‹ æŒ‡ç¬¬ iii ä¸ª token æ‰€æŒ‡ä»£çš„å®ä½“ï¼Œeâˆ’e_-eâˆ’â€‹ æŒ‡ä½œè€…ä»é™¤ eie_ieiâ€‹ ä¹‹å¤–çš„å®ä½“ä¸­é‡‡æ ·å¾—åˆ°çš„è´Ÿä¾‹ï¼Œè¯¥æŸå¤±ä¿ƒä½¿æ¨¡å‹åˆ†è¾¨ tokenitoken_itokeniâ€‹ æ‰€æŒ‡ä»£çš„å®ä½“ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®éªŒä¸­ï¼Œä½œè€…ä½¿ç”¨çš„è´Ÿä¾‹é‡‡æ ·ç­–ç•¥ä¸ºï¼š1% çš„ nullnullnull , 49% çš„éšæœºé‡‡æ ·å®ä½“ï¼Œ50% çš„ä»ç›®æ ‡å®ä½“çš„ Trans-E åµŒå…¥ç©ºé—´ä¸­æœ€è¿‘çš„ 100 ä¸ªå®ä½“ä¸­é‡‡æ ·ï¼ˆè¢«è®¤ä¸ºæ˜¯éš¾ä»¥åˆ†è¾¨çš„è´Ÿä¾‹ï¼‰ã€‚ Pretraining KALM çš„æ€»ä½“æŸå¤±æ˜¯ï¼š lKALM(Xduet=âˆ‘ilw(p(wiâˆ£t&lt;i))+Î±le(eiâˆ£t&lt;i)l_\\text{KALM}(X_{duet} = \\sum_i l_w(p(w_i|t_{&lt;i})) + \\alpha l_e(e_i|t_{&lt;i}) lKALMâ€‹(Xduetâ€‹=iâˆ‘â€‹lwâ€‹(p(wiâ€‹âˆ£t&lt;iâ€‹))+Î±leâ€‹(eiâ€‹âˆ£t&lt;iâ€‹) Inference æ¨ç†æ—¶ï¼Œä»…ä½¿ç”¨ word prediction headã€‚ å®éªŒ ä½œè€…è¿›è¡Œäº†çŸ¥è¯†å—…æ¢è¯„æµ‹å’Œ zero-shot QA ä»»åŠ¡è¯„æµ‹ã€‚","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"Knowledge Injection","slug":"Knowledge-Injection","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Injection/"},{"name":"Entity Signal","slug":"Entity-Signal","permalink":"https://blog.zhuwenq.cc/tags/Entity-Signal/"}]},{"title":"Differentiable Reasoning over a Virtual Knowledge Base","slug":"Differentiable-Reasoning-over-a-Virtual-Knowledge-Base","date":"2022-03-08T08:59:37.000Z","updated":"2023-06-21T06:51:28.784Z","comments":true,"path":"Differentiable-Reasoning-over-a-Virtual-Knowledge-Base/","link":"","permalink":"https://blog.zhuwenq.cc/Differentiable-Reasoning-over-a-Virtual-Knowledge-Base/","excerpt":"æ–‡ç« ä¸»è¦æ€æƒ³æ˜¯åˆ©ç”¨åŒ…å«äº‹å®çš„è¯­æ–™åº“ä½œä¸ºè™šæ‹ŸçŸ¥è¯†åº“è¿›è¡Œè‡ªç„¶è¯­è¨€é—®ç­”ã€‚2021 å¹´ EMNLP çš„æ–‡ç«  TransferNet: An Effective and Transparent Framework for Multi-hop Question Answering over Relation Graph ä¸­æåˆ°çš„åœ¨ text form å…³ç³»çš„çŸ¥è¯†å›¾è°±ä¸Šè¿›è¡Œé—®ç­”çš„æ€æƒ³ä¸æ­¤ç±»ä¼¼ã€‚","text":"æ–‡ç« ä¸»è¦æ€æƒ³æ˜¯åˆ©ç”¨åŒ…å«äº‹å®çš„è¯­æ–™åº“ä½œä¸ºè™šæ‹ŸçŸ¥è¯†åº“è¿›è¡Œè‡ªç„¶è¯­è¨€é—®ç­”ã€‚2021 å¹´ EMNLP çš„æ–‡ç«  TransferNet: An Effective and Transparent Framework for Multi-hop Question Answering over Relation Graph ä¸­æåˆ°çš„åœ¨ text form å…³ç³»çš„çŸ¥è¯†å›¾è°±ä¸Šè¿›è¡Œé—®ç­”çš„æ€æƒ³ä¸æ­¤ç±»ä¼¼ã€‚ ä½œè€…é¦–å…ˆåœ¨è¯­æ–™åº“ä¸Šé¢„å…ˆæå–å‡ºæ‰€æœ‰çš„å®ä½“æåŠï¼Œå¹¶ä¸ºå…¶ç”Ÿæˆä¸Šä¸‹æ–‡è¡¨å¾ï¼Œå¹¶åŸºäºå¤„ç†çš„ç»“æœåˆ¶ä½œå‡ºå®ä½“-&gt;æåŠä»¥åŠæåŠ-&gt;å®ä½“çš„æ˜ å°„çŸ©é˜µã€‚éšååœ¨æ‰§è¡Œé—®ç­”ä»»åŠ¡æ—¶ï¼Œé¦–å…ˆä»é—®é¢˜ä¸­æå–å‡ºæ¶‰åŠåˆ°çš„å®ä½“ï¼Œç¼–ç æˆå‘é‡ã€‚ç„¶åé€šè¿‡ä¸å®ä½“-&gt;æåŠçŸ©é˜µç›¸ä¹˜åˆæ­¥é€‰å‡ºæåŠï¼Œéšåä½œè€…æ ¹æ®æ•´ä¸ªé—®é¢˜ä¸ºæåŠè¯„åˆ†ï¼Œç­›é€‰æ‰ä¸é—®é¢˜ä¸ç›¸å…³çš„æåŠã€‚ç­›é€‰å‡ºçš„ç»“æœå‘é‡ä¹˜ä»¥æåŠ-&gt;å®ä½“çŸ©é˜µå¾—åˆ°æ¨ç†çš„ç»“æœå®ä½“å‘é‡ã€‚å¯¹äº k-hop çš„é—®é¢˜ï¼Œåªéœ€è¿­ä»£å¼åœ°æ‰§è¡Œ k æ¬¡ä¸Šè¿°è¿‡ç¨‹å³å¯å¾—åˆ°ç»“æœã€‚ Methodology ä½œè€…æå‡ºçš„ä¸»è¦æ€æƒ³æ˜¯å°†è¯­æ–™åº“çœ‹ä½œçŸ¥è¯†åº“ï¼Œå¹¶åŸºäºæ­¤å›ç­”è‡ªç„¶è¯­è¨€é—®é¢˜ qqq. é¦–å…ˆä»é—®é¢˜ qqq ä¸­æå–å‡ºæ¶‰åŠåˆ°çš„å®ä½“é›† zzz, ç„¶åè®© zzz ä¸­çš„å®ä½“è·Ÿéšé—®é¢˜ä¸­è•´å«çš„å…³ç³»åœ¨çŸ¥è¯†åº“ä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚ä½œè€…ä½¿ç”¨ IFIDF æ¨¡æ‹Ÿè¯¥è¿‡ç¨‹ï¼Œé¦–å…ˆå°†å®ä½“é›† zzz ä¸­çš„å®ä½“æ‰©å±•åˆ°è¯­æ–™åº“ä¸­æ‰€æœ‰è·Ÿå…¶å…±åŒå‡ºç°è¿‡çš„å®ä½“æåŠ mmm, æ­¤æ—¶å¹¶é mmm ä¸­çš„æ‰€æœ‰å…±åŒå‡ºç°è¿‡çš„æåŠéƒ½æ˜¯ä¸é—®é¢˜ qqq ç›¸å…³çš„ã€‚å› æ­¤ä½œè€…ä½¿ç”¨ä¸€ä¸ªç¥ç»ç½‘ç»œæ ¹æ®é—®é¢˜ qqq ç­›é€‰è¿™äº›æåŠï¼Œç­›é€‰åçš„æåŠè¢«è®¤ä¸ºæœ‰ä¸¤ä¸ªæ€§è´¨ï¼š ä¸ zzz ä¸­çš„å®ä½“å…±åŒå‡ºç°è¿‡ ä¸ zzz å…±åŒå‡ºç°çš„è¯­å¥æè¿°äº†å’Œé—®é¢˜ qqq ç±»ä¼¼çš„å…³ç³» æ ¹æ®è¿™äº›ç­›é€‰è¿‡çš„æåŠï¼Œä½œè€…åˆå°†å…¶è½¬æ¢åˆ°ä»–ä»¬æ‰€æŒ‡ä»£çš„å®ä½“é›† zâ€²z&#x27;zâ€²ï¼Œzâ€²z&#x27;zâ€² å³å€™é€‰ç­”æ¡ˆã€‚å¦‚æœé—®é¢˜æ˜¯å¤šè·³çš„ï¼Œåˆ™è¿­ä»£å¼å¤šæ¬¡é‡å¤ä¸Šè¿°è¿‡ç¨‹å³å¯ã€‚ Formal Description è®°è¯­æ–™åº“ä¸º D={d1,d2,...,dâˆ£Dâˆ£}\\mathcal{D} = \\{d_1, d_2, ..., d_|\\mathcal{D}|\\}D={d1â€‹,d2â€‹,...,dâˆ£â€‹Dâˆ£}, å…¶ä¸­ dk=(dk1,dk2,...,dkLk)d_k = (d_k^1, d_k^2, ..., d_k^{L_k})dkâ€‹=(dk1â€‹,dk2â€‹,...,dkLkâ€‹â€‹) æ˜¯è¯­æ–™åº“ä¸­æœ‰ LkL_kLkâ€‹ ä¸ª token çš„æ–‡æ¡£ã€‚é¦–å…ˆä½œè€…ä½¿ç”¨ entity linker å°†ä¸€ä¸ªå›ºå®šçš„å®ä½“é›† E\\mathcal{E}E åœ¨è¯­æ–™åº“ä¸­çš„æåŠè¯†åˆ«å‡ºæ¥ï¼Œæ¯ä¸ªæåŠ mmm è®°ä½œ (em,km,im,jm)(e_m, k_m, i_m, j_m)(emâ€‹,kmâ€‹,imâ€‹,jmâ€‹), è¡¨ç¤ºæ–‡æ¡£ kmk_mkmâ€‹ ä¸­çš„æ–‡æœ¬ç‰‡æ®µ dkmim,...,dkmjmd_{k_m}^{i_m}, ..., d_{k_m}^{j_m}dkmâ€‹imâ€‹â€‹,...,dkmâ€‹jmâ€‹â€‹ è¡¨ç¤ºå®ä½“ emâˆˆEe_m\\in\\mathcal{E}emâ€‹âˆˆE. è®°è¯­æ–™åº“ä¸­æ‰€æœ‰çš„å®ä½“æåŠç»„æˆçš„é›†åˆä¸º M\\mathcal{M}M, åˆ™æœ‰ âˆ£Mâˆ£â‰«âˆ£Eâˆ£|\\mathcal{M}| \\gg |\\mathcal{E}|âˆ£Mâˆ£â‰«âˆ£Eâˆ£. ä½œè€…ä»æ¦‚ç‡è¯­è¨€æ¨¡å‹å‡ºå‘ï¼Œè€ƒè™‘ä¸€ä¸ªä»…ä»¥æœ€ç»ˆç­”æ¡ˆ aâˆˆEa\\in\\mathcal{E}aâˆˆE ä¸ºå‚è€ƒçš„ T-hop é—®é¢˜çš„å¼±ç›‘ç£åœºæ™¯ï¼Œè®°ä¸­é—´ hop çš„ç­”æ¡ˆä¸º z0,z1,...,zTâˆˆEz_0, z_1, ..., z_T\\in\\mathcal{E}z0â€‹,z1â€‹,...,zTâ€‹âˆˆE, å…¶ä¸­ z0z_0z0â€‹ å³é—®é¢˜ä¸­å‡ºç°çš„å®ä½“ï¼ŒzTz_TzTâ€‹ ä¸ºæœ€ç»ˆç­”æ¡ˆ aaa. åˆ™æ¯ä¸€ä¸ª hop çš„è®¡ç®—æ¨¡å‹ä¸ºï¼š Prâ¡(ztâˆ£q)=âˆ‘ztâˆ’1âˆˆEPrâ¡(ztâˆ£q,ztâˆ’1)Prâ¡(ztâˆ’1âˆ£q)\\Pr(z_t|q)=\\sum_{z_{t-1}\\in\\mathcal{E}}\\Pr(z_t|q, z_{t-1})\\Pr(z_{t-1}|q) Pr(ztâ€‹âˆ£q)=ztâˆ’1â€‹âˆˆEâˆ‘â€‹Pr(ztâ€‹âˆ£q,ztâˆ’1â€‹)Pr(ztâˆ’1â€‹âˆ£q) ç”±äºæ¨ç†è¿‡ç¨‹åŸºäºè¯­æ–™åº“ï¼Œä½œè€…ç»“åˆè¯­æ–™åº“ä¸­çš„å®ä½“æåŠ mmm æ¥è®¡ç®— Prâ¡(ztâˆ£q,ztâˆ’1)\\Pr(z_t|q, z_{t-1})Pr(ztâ€‹âˆ£q,ztâˆ’1â€‹)ï¼š Prâ¡(ztâˆ£q)=âˆ‘mâˆˆMâˆ‘ztâˆ’1âˆˆEPrâ¡(ztâˆ£m)Prâ¡(mâˆ£q,ztâˆ’1)Prâ¡(ztâˆ’1âˆ£q)\\Pr(z_t|q) = \\sum_{m\\in\\mathcal{M}}\\sum_{z_{t-1}\\in\\mathcal{E}}\\Pr(z_t|m)\\Pr(m|q,z_{t-1})\\Pr(z_{t-1}|q) Pr(ztâ€‹âˆ£q)=mâˆˆMâˆ‘â€‹ztâˆ’1â€‹âˆˆEâˆ‘â€‹Pr(ztâ€‹âˆ£m)Pr(mâˆ£q,ztâˆ’1â€‹)Pr(ztâˆ’1â€‹âˆ£q) ä¸Šå¼ä¸­ï¼ŒPrâ¡(mâˆ£q,ztâˆ’1)\\Pr(m|q, z_{t-1})Pr(mâˆ£q,ztâˆ’1â€‹) è¡¨ç¤º mmm ä¸é—®é¢˜ qqq å’Œ ä¸Šä¸€æ­¥çš„å®ä½“ ztâˆ’1z_{t-1}ztâˆ’1â€‹ ä¹‹é—´çš„ç›¸å…³æ€§ã€‚ä½œè€…åˆ©ç”¨å®ä½“ä»¥åŠå®ä½“æåŠçš„ TFIDF å‘é‡è®¡ç®—è¯¥ç›¸å…³æ€§ï¼ŒåŒæ—¶åˆ©ç”¨ä¸€ä¸ªç¥ç»ç½‘ç»œç­›é€‰ç¬¦åˆé—®é¢˜æè¿°çš„æåŠï¼š Prâ¡(mâˆ£q,ztâˆ’1)âˆ1{G(ztâˆ’1)â‹…F(m)&gt;Ïµ}âŸå…±ç°æåŠå±•å¼€Ã—st(m,ztâˆ’1,q)âŸç›¸å…³æ€§ç­›é€‰\\Pr(m|q, z_{t-1})\\propto \\underbrace{\\mathbb{1}\\{G(z_{t-1})\\cdot F(m) &gt; \\epsilon\\}}_{\\text{å…±ç°æåŠå±•å¼€}}\\times \\underbrace{s_t(m, z_{t-1}, q)}_{\\text{ç›¸å…³æ€§ç­›é€‰}} Pr(mâˆ£q,ztâˆ’1â€‹)âˆå…±ç°æåŠå±•å¼€1{G(ztâˆ’1â€‹)â‹…F(m)&gt;Ïµ}â€‹â€‹Ã—ç›¸å…³æ€§ç­›é€‰stâ€‹(m,ztâˆ’1â€‹,q)â€‹â€‹ ä¸Šå¼ä¸­ç¬¬ä¸€é¡¹è¢«è®¤ä¸ºåŸºäºå’Œä¸Šä¸€æ­¥çš„ä¸­é—´å®ä½“ ztâˆ’1z_{t-1}ztâˆ’1â€‹ å…±ç°ä¸å¦ç­›é€‰æåŠï¼Œç¬¬äºŒé¡¹æ ¹æ®é—®é¢˜ qqq å’Œä¸Šä¸€æ­¥çš„å®ä½“ ztâˆ’1z_{t-1}ztâˆ’1â€‹ è®¡ç®—ç¬¬ t ä¸ª hop éœ€è¦çš„å…³ç³»ç±»å‹ï¼Œå¹¶æ®æ­¤è¿›ä¸€æ­¥ç­›é€‰æåŠã€‚ é™¤ Prâ¡(mâˆ£q,ztâˆ’1)\\Pr(m|q, z_{t-1})Pr(mâˆ£q,ztâˆ’1â€‹) å¤–ï¼ŒPrâ¡(ztâˆ£m)\\Pr(z_t|m)Pr(ztâ€‹âˆ£m) åˆ™æ ¹æ® entity linker çš„ç»“æœåˆ¤æ–­æåŠ mmm æ˜¯å¦æŒ‡ä»£å®ä½“ ztz_tztâ€‹ã€‚æŒ‡ä»£åˆ™ä¸º 1ï¼Œ å¦åˆ™ä¸º 0ã€‚ åœ¨å®é™…å®ç°æ—¶ï¼Œä½œè€…ä½¿ç”¨çŸ©é˜µè®¡ç®—å®ç°ä¸Šè¿°æ¨¡å‹ã€‚é¦–å…ˆä½œè€…é¢„è®¡ç®—è¯­æ–™åº“ä¸­æ‰€æœ‰å®ä½“å’Œå®ä½“æåŠçš„ TFIDF å‘é‡ï¼Œå¹¶å°†å…¶ç»„ç»‡æˆä¸€ä¸ªç¨€ç–çŸ©é˜µ AEâ†M[e,m]=1(G(e)â‹…F(m)&gt;Ïµ)A_{E\\leftarrow M}[e, m] = \\mathbb{1}(G(e)\\cdot F(m) &gt; \\epsilon)AEâ†Mâ€‹[e,m]=1(G(e)â‹…F(m)&gt;Ïµ)(å³å®ä½“ eee å’ŒæåŠ mmm çš„ TFIDF å‘é‡çš„ç§¯å¤§äºé˜ˆå€¼ Ïµ\\epsilonÏµ æ—¶ï¼ŒA[e,m]=1A[e, m] = 1A[e,m]=1). æ­¤æ—¶å…±ç°æåŠå±•å¼€å¯ä»¥é€šè¿‡å®ä½“å‘é‡ ztâˆ’1z_{t-1}ztâˆ’1â€‹ å’Œ AEâ†MA_{E\\leftarrow M}AEâ†Mâ€‹ çš„ä¹˜ç§¯å¾—åˆ°ã€‚ å¯¹äºç›¸å…³æ€§ç­›é€‰ï¼Œè®° TK(st(m,ztâˆ’1,q))\\mathbb{T}_K(s_t(m, z_{t-1}, q))TKâ€‹(stâ€‹(m,ztâˆ’1â€‹,q)) ä¸º top-K ç›¸å…³çš„æåŠï¼Œä¸”ç¼–ç åˆ°å‘é‡ç©ºé—´ Râˆ£Mâˆ£\\mathbb{R}^{|\\mathcal{M}|}Râˆ£Mâˆ£. å¯¹äºæåŠåˆ°å®ä½“çš„æ˜ å°„ï¼Œä½œè€…ä½¿ç”¨å¦ä¸€ä¸ªç¨€ç–çŸ©é˜µ BMâ†EB_{M\\leftarrow E}BMâ†Eâ€‹ è¿›è¡Œï¼Œè¯¥çŸ©é˜µè¡¨ç¤ºä¸ç›¸åŒå®ä½“å…±ç°è¿‡çš„æåŠã€‚ ç»¼åˆä¸Šè¿°è¿‡ç¨‹ï¼Œztz_tztâ€‹ çš„è®¡ç®—å¯ä»¥è¡¨ç¤ºä¸ºï¼š Zt=softmax([Ztâˆ’1TAEâ†MâŠ™TK(st(m,ztâˆ’1,q))]BMâ†E)Z_t = \\text{softmax}([Z_{t-1}^TA_{E\\leftarrow M}\\odot\\mathbb{T}_K(s_t(m, z_{t-1}, q))]B_{M\\leftarrow E}) Ztâ€‹=softmax([Ztâˆ’1Tâ€‹AEâ†Mâ€‹âŠ™TKâ€‹(stâ€‹(m,ztâˆ’1â€‹,q))]BMâ†Eâ€‹) å…¶ä¸­ ZtZ_tZtâ€‹ æ˜¯ç¼–ç åçš„å®ä½“æ¦‚ç‡å‘é‡ã€‚ ä¸Šå¼çš„è®¡ç®—è¿‡ç¨‹æ˜¯å¯å¾®çš„ï¼ŒåŒæ—¶ç”±äº top-K çš„é™åˆ¶ï¼Œæ¯ä¸ª hop çš„è®¡ç®—æœ€å¤šäº§ç”Ÿ K ä¸ªå®ä½“ï¼Œé¿å…äº†å¤šè·³åœºæ™¯ä¸‹çš„å®ä½“çˆ†ç‚¸ã€‚ ä½œè€…åœ¨ä¸‹æ–‡ä»‹ç»äº†ä¸Šå¼è®¡ç®—ä¸­è€ƒè™‘çŸ©é˜µç¨€ç–æ€§çš„æ•ˆç‡ï¼ŒåŒæ—¶è¯´æ˜äº† st(m,ztâˆ’1,q)s_t(m, z_{t-1}, q)stâ€‹(m,ztâˆ’1â€‹,q) çš„è®¡ç®—æ–¹æ³•ï¼šst(m,ztâˆ’1,q)âˆexpâ¡{f(m)â‹…gt(q,ztâˆ’1)s_t(m, z_{t-1}, q)\\propto \\exp\\{f(m)\\cdot g_t(q, z_{t-1})stâ€‹(m,ztâˆ’1â€‹,q)âˆexp{f(m)â‹…gtâ€‹(q,ztâˆ’1â€‹) ä½¿ç”¨ PLM ç¼–ç  mmm çš„ä¸Šä¸‹æ–‡è¡¨å¾ï¼Œå¹¶ç”¨ mmm ä¸­é¦–å°¾è¯çš„è¡¨å¾çš„åŠ æƒå’Œè¡¨å¾ mmmï¼š f(m)=WT[Hid;Hjd]f(m) = W^T[H_i^d; H_j^d]f(m)=WT[Hidâ€‹;Hjdâ€‹] ä½¿ç”¨ PLM ç¼–ç é—®é¢˜ qqqï¼Œå– [CLS][CLS][CLS] çš„è¡¨å¾ä½œä¸º qqq çš„è¡¨å¾ HqH^qHqã€‚ åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯¹äºæ¯ä¸€ä¸ª hop t=1,...,Tt = 1, ..., Tt=1,...,T ä½¿ç”¨2å±‚ transformer å±‚æ ¹æ® HqH^qHq è¿›è¡Œæœ€å¤§å†…ç§¯æœç´¢(MIPS)ï¼Œç¬¬ä¸€å±‚ transformer layer è¢«è®¤ä¸ºäº§ç”Ÿèµ·å§‹è¯çš„ MIPS æŸ¥è¯¢å‘é‡ HstqH_{st}^qHstqâ€‹, ç¬¬äºŒå±‚è¢«è®¤ä¸ºäº§ç”Ÿç»“æŸè¯çš„ MIPS æŸ¥è¯¢å‘é‡ HenqH_{en}^qHenqâ€‹, å®šä¹‰ g~t(q)=VT[Hstq;Henq]\\tilde{g}_t(q) = V^T[H_{st}^q; H_{en}^q]g~â€‹tâ€‹(q)=VT[Hstqâ€‹;Henqâ€‹] è®°æ‰€æœ‰å®ä½“çš„è¡¨å¾çŸ©é˜µä¸º EâˆˆRâˆ£EÃ—pâˆ£E\\in\\mathbb{R}^{|\\mathcal{E}\\times p|}EâˆˆRâˆ£EÃ—pâˆ£, Ztâˆ’1Z_{t-1}Ztâˆ’1â€‹ æ‰€æ ‡ç¤ºçš„å®ä½“çš„è¡¨å¾å¹³å‡å€¼ä¸º Ztâˆ’1TEZ_{t-1}^TEZtâˆ’1Tâ€‹E, åˆ™ gt(q,ztâˆ’1)=g~t(q)+Ztâˆ’1TEg_t(q, z_{t-1}) = \\tilde{g}_t(q) + Z_{t-1}^TEgtâ€‹(q,ztâˆ’1â€‹)=g~â€‹tâ€‹(q)+Ztâˆ’1Tâ€‹E.(å®ä½“è¡¨å¾ä½¿ç”¨å®ä½“æ–‡æœ¬æ‰€æœ‰è¯çš„è¡¨å¾å¹³å‡è®¡ç®—) åœ¨ä¸Šè¿°è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œä½œè€…å‘ç°ç›´æ¥ä½¿ç”¨ PLM ä¸ºå®ä½“ç”Ÿæˆè¡¨å¾æ•ˆæœä¸ç†æƒ³ï¼Œä»éœ€è¦ä½¿ç”¨çŸ¥è¯†å›¾è°±è¿œç¨‹ç›‘ç£è®­ç»ƒ PLM æ”¹å–„å®ä½“è¡¨å¾ã€‚","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"QA","slug":"QA","permalink":"https://blog.zhuwenq.cc/tags/QA/"}]},{"title":"æ•°æ®ç»“æ„--äºŒå‰æ ‘çš„éå†","slug":"æ•°æ®ç»“æ„-äºŒå‰æ ‘çš„éå†","date":"2022-03-06T09:19:38.000Z","updated":"2023-06-21T06:51:28.940Z","comments":true,"path":"æ•°æ®ç»“æ„-äºŒå‰æ ‘çš„éå†/","link":"","permalink":"https://blog.zhuwenq.cc/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 25 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 6 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 25 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 6 æ—¥é‡æ–°æ•´ç† å†™åœ¨å‰é¢ æ ‘æ˜¯ä¸€ç§å¤æ‚çš„æ•°æ®ç»“æ„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ç§é‡è¦çš„äºŒç»´ç»“æ„ã€‚æ ‘çš„éå†è¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯ä¸€ç§æŠŠäºŒç»´ç»“æ„è½¬æ¢ä¸ºä¸€ç»´åºåˆ—å³çº¿æ€§åŒ–çš„è¿‡ç¨‹ã€‚ å››ç§éå† å‰åºéå† (PreOrderTraversal) ï¼šæ ¹èŠ‚ç‚¹â€”&gt;å·¦å­æ ‘â€”&gt;å³å­æ ‘ ä¸­åºéå† (InOrderTraversal) ï¼šå·¦å­æ ‘â€”&gt;æ ¹èŠ‚ç‚¹â€”&gt;å³å­æ ‘ ååºéå† (PostOrderTraversal) ï¼šå·¦å­æ ‘â€”&gt;å³å­æ ‘â€”&gt;æ ¹èŠ‚ç‚¹ å±‚åºéå† (LevelOrderTraversal) ï¼šä»ä¸Šåˆ°ä¸‹â€”&gt;ä»å·¦åˆ°å³ éå†å®ç° æŠ½è±¡ä¸€ä¸ªå‡½æ•° void visit(BinaryTree *tree) ç”¨æ¥è®¿é—®èŠ‚ç‚¹ï¼š 12345678typedef struct treeNode&#123; ElementType data; BinaryTree *left; BinaryTree *right;&#125; BinaryTree;void visit(BinaryTree *tree); //è®¿é—®èŠ‚ç‚¹ é€’å½’å®ç° å‰åºéå† å‰åºéå†é¦–å…ˆè®¿é—®æ ¹èŠ‚ç‚¹ï¼Œç„¶åè®¿é—®å·¦å­æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œç„¶åè®¿é—®å·¦å­æ ‘çš„å·¦å­æ ‘çš„æ ¹èŠ‚ç‚¹â€¦ç›´åˆ°å·¦å­æ ‘ä¸€è·¯å‘å·¦è®¿é—®å®Œæ¯•ï¼Œå®ƒå°†è‡ªä¸‹è€Œä¸Šè®¿é—®å³å­æ ‘ã€‚å¯¹äºå³å­æ ‘ï¼Œå®ƒä¹Ÿå°†è´¯å½»æ ¹â€”å·¦â€”å³çš„é¡ºåºä¸€è·¯è®¿é—®ï¼Œç›´åˆ°éå†å®Œæˆã€‚ é€’å½’å®ç°å¦‚ä¸‹ï¼š 123456789void preOrderTraversal(BinaryTree *tree)&#123; if (tree) &#123; //if empty tree or reaches the leaf,exit visit(tree); //pay a visit to the root preOrderTraversal(tree-&gt;left); //pre order,traversal left first preOrderTraversal(tree-&gt;right); &#125;&#125; ä¸­åºéå† ä¸­åºéå†å…ˆè®¿é—®å·¦å­æ ‘ï¼Œç„¶åè®¿é—®æ ¹èŠ‚ç‚¹ï¼Œæœ€åè®¿é—®å³å­æ ‘ã€‚å› æ­¤å¯ä»¥å°†å‰åºé€’å½’çš„è®¿é—®ç§»åˆ°å¯¹å·¦å­æ ‘é€’å½’çš„åé¢ç®€å•çš„å®ç°ã€‚ 123456789void inOrderTraversal(BinaryTree *tree)&#123; if (tree) &#123; //if empty tree or reaches the leaf,exit inOrderTraversal(tree-&gt;left); //pre order,traversal left first visit(tree); //pay a visit to the root inOrderTraversal(tree-&gt;right); &#125;&#125; ååºéå† åŒæ ·çš„ï¼Œå¯ä»¥æŠŠè®¿é—®è¯­å¥ç§»åˆ°è®¿é—®å³å­æ ‘çš„åé¢ã€‚ 123456789void postOrderTraversal(BinaryTree *tree)&#123; if (tree) &#123; postOrderTraversal(tree-&gt;left); postOrderTraversal(tree-&gt;right); visit(tree); &#125;&#125; å±‚åºéå†ä¸å…·æœ‰æ˜æ˜¾çš„é€’å½’ç‰¹å¾ï¼Œæš‚ä¸è®¨è®ºå…¶é€’å½’å®ç° éé€’å½’å®ç° ä¼—æ‰€å‘¨çŸ¥ï¼Œé€’å½’çš„ç¨‹åºè™½ç„¶é€»è¾‘æ¸…æ™°ä»£ç ç®€å•ï¼Œä½†æ˜¯å…¶è¿è¡Œèµ·æ¥æœ‰è®¸å¤šä¸ç¨³å®šå› ç´ ã€‚ç”±äºå‡½æ•°åœ¨æ„å»ºæ—¶æ˜¯ä»¥å‡½æ•°æ ˆçš„å½¢å¼å‚¨å­˜å‡½æ•°ä¿¡æ¯çš„ï¼Œå› æ­¤åœ¨å¤„ç†è¾ƒå¤§è§„æ¨¡çš„è¾“å…¥æ—¶ï¼Œé€’å½’çš„ç¨‹åºå¸¸å¸¸ä¼šå‘ç”Ÿçˆ†æ ˆçš„ä¸¥é‡å¼‚å¸¸ã€‚ åŒæ—¶ï¼Œé€’å½’å®ç°çš„éå†æœ¬è´¨ä¸Šæ˜¯æŠŠèŠ‚ç‚¹å‹å…¥å †æ ˆå¹¶åœ¨é€‚å½“çš„æ—¶æœºå¼¹å‡ºï¼Œå› æ­¤ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å †æ ˆ (Stack) å®ç°äºŒå‰æ ‘çš„éå†ã€‚ é¦–å…ˆå®ç°ä¸€ä¸ªå¤§è‡´çš„å †æ ˆï¼Œå…³äºå †æ ˆçš„è¯¦ç»†ä»‹ç»å’Œå®ç°å¯è§è¿™ç¯‡åšå®¢ 1234567891011121314151617181920212223242526272829303132333435363738typedef struct stack&#123; ElementType data; Stack *next;&#125; Stack;Stack *createEmpty()&#123; Stack *top = (Stack *)malloc(sizeof(Stack)); top-&gt;next = NULL; return top;&#125;int isEmpty(Stack *stack)&#123; return stack-&gt;next == NULL;&#125;void push(Stack *stack, ElementType item)&#123; Stack *temp = (Stack *)malloc(sizeof(Stack)); temp-&gt;data = item; temp-&gt;next = stack-&gt;next; stack-&gt;next = temp;&#125;ElementType pop(Stack *stack)&#123; if (isEmpty(stack)) &#123; return; //error!Empty stack &#125; ElementType targetValue = stack-&gt;next-&gt;data; Stack *target = stack-&gt;next; stack-&gt;next = target-&gt;next; free(target); return targetValue;&#125; å‰åºéå† æ ¹æ®å‰åºéå†çš„é¡ºåºï¼Œæˆ‘ä»¬é¦–å…ˆæŠŠäºŒå‰æ ‘ T çš„å·¦è¾¹æœ€å¤–ä¾§èŠ‚ç‚¹ä¾ç…§ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºä¾æ¬¡è®¿é—®ï¼ˆä¿è¯äº†å…ˆè®¿é—®æ ¹èŠ‚ç‚¹å’Œå…ˆå¤„ç†å·¦å­æ ‘ï¼‰å’Œå‹æ ˆï¼ˆä¿å­˜èŠ‚ç‚¹ï¼Œåé¢æ‰èƒ½å–åˆ°å³å­èŠ‚ç‚¹ï¼‰ã€‚å·¦å¤–ä¾§è®¿é—®å¹¶å‹æ ˆå®Œåï¼Œå¦‚æœå †æ ˆä¸ä¸ºç©ºï¼Œå¼¹å‡ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ­¤èŠ‚ç‚¹æ˜¯æœ€åä¸€ä¸ªå‹æ ˆçš„ä¹Ÿæ˜¯äºŒå‰æ ‘å·¦ä¸‹è§’çš„èŠ‚ç‚¹ã€‚å°†æ­¤èŠ‚ç‚¹è½¬å‘å®ƒçš„å³å­èŠ‚ç‚¹ï¼Œé‡å¤å‰é¢çš„è¿‡ç¨‹ï¼ˆä¿è¯äº†åå¤„ç†å³å­æ ‘ï¼‰ã€‚ 1234567891011121314151617181920void preOrderTraversal(BinaryTree *tree)&#123; BinaryTree *t = tree; //make a copy Stack *stack = createEmpty(); while (t || !isEmpty(stack)) &#123; //if t==null &amp;&amp; stack is empty,exit while (t) &#123; //push left nodes push(stack, t); visit(t); //visit root and left nodes first t = t-&gt;left; &#125; if (!isEmpty(stack)) &#123; t = pop(stack); t = t-&gt;right; //turn to right visit(t); //visit right node &#125; &#125;&#125; ä¸­åºéå† ä¸­åºéå†æŒ‰ç…§å·¦å­èŠ‚ç‚¹â€”æ ¹èŠ‚ç‚¹â€”å³å­èŠ‚ç‚¹çš„é¡ºåºè®¿é—®ï¼Œå…ˆæŠŠå·¦å¤–ä¾§èŠ‚ç‚¹å‹æ ˆä½†ä¸è®¿é—®ï¼Œå‹æ ˆå®Œæˆåå¼¹å‡ºèŠ‚ç‚¹è¿›è¡Œè®¿é—®ï¼ˆä¿è¯äº†å…ˆè®¿é—®çš„æ˜¯å·¦å­èŠ‚ç‚¹å…ˆå¤„ç†çš„æ˜¯å·¦å­æ ‘ï¼‰ã€‚è®¿é—®å®Œæˆåè½¬å‘å¼¹å‡ºèŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹é‡å¤è¿‡ç¨‹ã€‚ 12345678910111213141516171819void inOrderTraversal(BinaryTree *tree)&#123; BinaryTree *t = tree; Stack *stack = createEmpty(); while (t || !isEmpty(stack)) &#123; while (t) &#123; push(stack, t); t = t-&gt;left; &#125; if (!isEmpty(stack)) &#123; t = pop(stack); visit(t); t = t-&gt;right; &#125; &#125;&#125; ååºéå† ååºéå†å…ˆå¤„ç†å·¦å­æ ‘ï¼Œå†å¤„ç†å³å­æ ‘ï¼Œæœ€åå¤„ç†æ ¹èŠ‚ç‚¹ã€‚åœ¨å…ˆå¤„ç†å·¦å­æ ‘çš„ä¸­åºéå†çš„åŸºç¡€ä¸Šï¼Œå¼¹å‡ºèŠ‚ç‚¹ T åå¹¶ä¸ç«‹åˆ»è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯è¿›è¡Œä¸€æ¬¡åˆ¤æ–­ï¼šè‹¥ T æ²¡æœ‰å³å­èŠ‚ç‚¹ T-&gt;right == null ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¸ºå¶èŠ‚ç‚¹ï¼Œè¿›è¡Œè®¿é—®ï¼›è‹¥èŠ‚ç‚¹å­˜åœ¨å³å­èŠ‚ç‚¹ï¼Œåˆ™ä¸è¿›è¡Œè®¿é—®ï¼ŒæŠŠ T è½¬å‘ T çš„å³å­èŠ‚ç‚¹ï¼Œé‡å¤ä¸Šé¢çš„è¿‡ç¨‹è½¬è€Œå¤„ç†å³å­æ ‘ã€‚ è¿™ä¸ªè¿‡ç¨‹å­˜åœ¨ä¸€ä¸ªé”™è¯¯ï¼šå½“ T å­˜åœ¨å³å­èŠ‚ç‚¹æ—¶ï¼ŒæŠŠ T è½¬å‘äº† T-&gt;right ï¼Œç”±äº T æ˜¯ä»¥ pop çš„æ–¹å¼å‡ºæ ˆï¼Œåˆ™å †æ ˆä¸­å°šæœªè¿›è¡Œå¤„ç†çš„ T èŠ‚ç‚¹ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰è¢«åˆ é™¤äº†ï¼Œè¿™å°±å¯¼è‡´äº†æ ¹èŠ‚ç‚¹ç¼ºå¤±ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ T å­˜åœ¨å³èŠ‚ç‚¹æ—¶ï¼Œä¸º T çš„å€¼åšä¸€ä¸ªæ‹·è´ TCopy ï¼Œä½†ä¸ä¿ç•™ T çš„å­èŠ‚ç‚¹ä¿¡æ¯ã€‚å³ï¼š TCopy-&gt;left == TCopy-&gt;right == null ã€‚ç„¶åæŠŠ TCopy å‹æ ˆï¼Œè¿™æ ·ä¿è¯äº†æ ¹èŠ‚ç‚¹ T çš„å€¼èƒ½å¤Ÿè¢«è®¿é—®åˆ°ï¼ŒåŒæ—¶åœ¨ T çš„å³å­æ ‘å¤„ç†å®Œæˆï¼Œå †æ ˆå†æ¬¡å¼¹å‡ºæ ¹èŠ‚ç‚¹æ—¶ï¼Œå…¶å³å­èŠ‚ç‚¹ä¸ä¼šè¢«é‡å¤å¤„ç†ã€‚ 123456789101112131415161718192021222324252627282930void postOrderTraversal(BinaryTree *tree)&#123; BinaryTree *t = tree; Stack *stack = createEmpty(); BinaryTree *tCopy = (BinaryTree *)malloc(sizeof(BinaryTree)); while (t || !isEmpty(stack)) &#123; while (t) &#123; push(stack, t); t = t-&gt;left; &#125; if (!isEmpty(stack)) &#123; t = pop(stack); tCopy-&gt;data = t-&gt;data; t = t-&gt;right; //turn to right if (t) &#123; tCopy-&gt;left = tCopy-&gt;right = NULL; push(stack, tCopy); //temp will be visited after right sub tree &#125; else &#123; visit(tCopy); &#125; &#125; &#125; free(tCopy);&#125; å±‚åºéå† å±‚åºéå†æŒ‰ç…§å…ˆä¸Šåä¸‹ï¼Œå…ˆå·¦åå³çš„é¡ºåºï¼Œå› æ­¤åœ¨è®¿é—®å·¦å­èŠ‚ç‚¹æ—¶ï¼Œéœ€è¦æš‚å­˜å³å­èŠ‚ç‚¹ã€‚å¯ä»¥é‡‡ç”¨å †æ ˆ (Stack) æˆ–è€…é˜Ÿåˆ— (Queue) å‚¨å­˜ã€‚ å †æ ˆå®ç° æš‚ä¸è®¨è®ºï¼ˆä¸ä¼šï¼‰ é˜Ÿåˆ—å®ç° é˜Ÿåˆ—çš„è¯¦ç»†å®ç°è§è¿™ç¯‡åšå®¢ å…ˆå°†æ ¹èŠ‚ç‚¹å…¥é˜Ÿï¼Œç„¶åå‡ºé˜Ÿæ ¹èŠ‚ç‚¹è¿›è¡Œè®¿é—®ï¼Œè®¿é—®å®Œæˆåé¡ºåºå‹æ ˆæ ¹èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ï¼Œå³å­èŠ‚ç‚¹ã€‚ å†æ¬¡å‡ºé˜Ÿä¸€ä¸ªèŠ‚ç‚¹ï¼Œè®¿é—®å®Œæˆåé¡ºåºå…¥é˜Ÿå®ƒçš„å·¦å³å­èŠ‚ç‚¹ã€‚é‡å¤æœ¬è¿‡ç¨‹ç›´åˆ°è®¿é—®å®Œæ¯•ã€‚ 12345678910111213141516void levelOrderTraversal(BinaryTree *tree)&#123; if (tree == NULL) return; //Error!empty tree Queue *queue = createQueue(); add(queue, tree); //add root to queue while (!isEmpty(queue)) &#123; //when queue is empty,traversal done BinaryTree *t = delete (queue); visit(t); if (t-&gt;left) add(queue, t-&gt;left); if (t-&gt;right) add(queue, t-&gt;right); &#125;&#125; æœ€å äºŒå‰æ ‘ååˆ†å¤æ‚ä¸”é‡è¦ï¼ŒäºŒå‰æ ‘çš„éå†åˆæ˜¯äºŒå‰æ ‘é‡è¦çš„åŸºç¡€æ“ä½œä¹‹ä¸€ï¼Œç†è§£å¹¶æŒæ¡ä¸Šè¿°éå†æ–¹æ³•ååˆ†å¿…è¦ã€‚ ç”±ä¸¤ç§éå†å”¯ä¸€åœ°ç¡®å®šä¸€é¢—äºŒå‰æ ‘ è®¾å‰åºéå†ä¸º Pre ï¼Œä¸­åºéå†ä¸º In ï¼Œååºéå†ä¸º Post ã€‚åˆ™åœ¨å·²çŸ¥ In &amp; Pre æˆ–è€… In &amp; Post çš„æƒ…å†µä¸‹å¯ä»¥å”¯ä¸€ä½ç¡®å®šä¸€é¢—äºŒå‰æ ‘ã€‚ åˆ†æï¼š ä¸€ä¸ªå…ˆåºéå†åºåˆ—ç”±æ ¹èŠ‚ç‚¹â€”å·¦å­æ ‘èŠ‚ç‚¹â€”å³å­æ ‘èŠ‚ç‚¹ç»„æˆ ä¸€ä¸ªä¸­åºéå†åºåˆ—ç”±å·¦å­æ ‘èŠ‚ç‚¹â€”æ ¹èŠ‚ç‚¹â€”å³å­æ ‘èŠ‚ç‚¹ç»„æˆ ä¸€ä¸ªååºéå†åºåˆ—ç”±å·¦å­æ ‘èŠ‚ç‚¹â€”å³å­æ ‘èŠ‚ç‚¹â€”æ ¹èŠ‚ç‚¹ç»„æˆ ä¾‹å¦‚å·²çŸ¥ Pre &amp; In : ç”±å…ˆåºåºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¯ä»¥çŸ¥é“æ ¹èŠ‚ç‚¹ï¼Œåˆ©ç”¨æ ¹èŠ‚ç‚¹åœ¨ä¸­åºåºåˆ—ä¸­æŸ¥è¯¢å…¶ä½ç½®ï¼Œå¯ä»¥å¾—çŸ¥å·¦å­æ ‘çš„é•¿åº¦ã€‚ç„¶ååœ¨å…ˆåºåºåˆ—ä¸­çš„æ ¹èŠ‚ç‚¹åæ–¹æˆªå–è¯¥é•¿åº¦ï¼Œå³å¾—äºŒå‰æ ‘çš„å·¦å­æ ‘åºåˆ—ã€‚ å·¦å­æ ‘åºåˆ—çš„é¦–å…ƒç´ æ˜¯å·¦å­æ ‘çš„æ ¹èŠ‚ç‚¹â€¦å¦‚æ­¤è¿­ä»£åˆ°å¶èŠ‚ç‚¹ä¾¿ç¡®å®šäº†å·¦å­æ ‘çš„æ„é€ ï¼Œå³å­æ ‘åŒç†ã€‚ å¦‚æœåªå·²çŸ¥ Pre &amp; Post åˆ™æ— æ³•ç¡®å®šå·¦å­æ ‘åºåˆ—æˆ–è€…å³å­æ ‘åºåˆ—çš„é•¿åº¦ï¼Œæ— æ³•ç¡®å®šäºŒå‰æ ‘ã€‚","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"æ•°æ®ç»“æ„--äºŒå‰æ ‘å’ŒäºŒå‰æ ‘çš„å‚¨å­˜ç»“æ„","slug":"æ•°æ®ç»“æ„-äºŒå‰æ ‘å’ŒäºŒå‰æ ‘çš„å‚¨å­˜ç»“æ„","date":"2022-03-06T09:05:20.000Z","updated":"2023-06-21T06:51:28.940Z","comments":true,"path":"æ•°æ®ç»“æ„-äºŒå‰æ ‘å’ŒäºŒå‰æ ‘çš„å‚¨å­˜ç»“æ„/","link":"","permalink":"https://blog.zhuwenq.cc/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E4%BA%8C%E5%8F%89%E6%A0%91%E5%92%8C%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%82%A8%E5%AD%98%E7%BB%93%E6%9E%84/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 24 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 6 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 24 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 6 æ—¥é‡æ–°æ•´ç† å®šä¹‰ äºŒå‰æ ‘æ˜¯ä¸€ä¸ªæœ‰ç©·çš„èŠ‚ç‚¹é›†åˆï¼Œè¿™ä¸ªé›†åˆå¯ä»¥ä¸ºç©ºã€‚è‹¥é›†åˆä¸ä¸ºç©ºï¼Œåˆ™é›†åˆæ˜¯ç”±æ ¹èŠ‚ç‚¹ root å’Œè¢«ç§°ä¸ºå·¦å­æ ‘å’Œå³å­æ ‘çš„ä¸¤é¢—ä¸ç›¸äº¤çš„äºŒå‰æ ‘ç»„æˆã€‚ ç‰¹æ®ŠäºŒå‰æ ‘ æ–œäºŒå‰æ ‘ (Skewed Binary Tree) å¦‚å›¾ï¼š å®Œç¾äºŒå‰æ ‘ (Perfect Binary Tree) æˆ–æ»¡äºŒå‰æ ‘ (Full Binary Tree) å®Œå…¨äºŒå‰æ ‘ (Complete Binary Tree) æœ‰ n ä¸ªèŠ‚ç‚¹çš„äºŒå‰æ ‘ï¼Œå¯¹æ ‘ä¸­èŠ‚ç‚¹æŒ‰ä»ä¸Šåˆ°ä¸‹ï¼Œä»å·¦åˆ°å³çš„é¡ºåºè¿›è¡Œç¼–å·ã€‚ä¸æ»¡äºŒå‰æ ‘ç›¸æ¯”ï¼Œç›¸åŒä½ç½®å¤„çš„èŠ‚ç‚¹ç¼–å·ç›¸åŒã€‚ å³ï¼šå®Œå…¨äºŒå‰æ ‘ç›¸å½“äºæ»¡äºŒå‰æ ‘å°‘äº†æœ€ä¸‹å±‚å¶å­èŠ‚ç‚¹çš„å³ä¾§è‹¥å¹²èŠ‚ç‚¹ã€‚ æ€§è´¨ äºŒå‰æ ‘çš„ç¬¬ i å±‚æœ€å¤§èŠ‚ç‚¹ä¸ªæ•°ä¸º 2iâˆ’12^{i - 1}2iâˆ’1 æ·±åº¦ä¸º k çš„äºŒå‰æ ‘æœ€å¤§èŠ‚ç‚¹æ€»æ•°ä¸º 2kâˆ’12^k - 12kâˆ’1 å¯¹äºä»»ä½•éç©ºäºŒå‰æ ‘ T ï¼Œè‹¥ n0n_0n0â€‹ è¡¨ç¤ºå¶èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œ n2n_2n2â€‹ æ˜¯åº¦ä¸º2çš„éå¶èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œé‚£ä¹ˆä¸¤è€…æ»¡è¶³å…³ç³» n0=n2+1n_0 = n_2 + 1n0â€‹=n2â€‹+1 è¯æ˜ï¼šå¯¹äºæ€»ç»“ç‚¹æ•°ä¸º n çš„äºŒå‰æ ‘ï¼Œå…¶è¾¹æ€»æ•°ä¸º n-1 ã€‚æ€»çš„èŠ‚ç‚¹æ•° n ç”±åº¦ä¸º 0,1,2 çš„èŠ‚ç‚¹ç»„æˆï¼Œå³ nâˆ’1=n0+n1+n2âˆ’1n - 1 = n_0 + n_1 + n_2 - 1nâˆ’1=n0â€‹+n1â€‹+n2â€‹âˆ’1 ã€‚ åŒæ—¶ï¼Œå¯¹äºäºŒå‰æ ‘çš„èŠ‚ç‚¹ï¼Œå…¶åº¦æ•°å³ä¸ºå…¶å¯¹æ€»è¾¹æ•°çš„è´¡çŒ®å€¼ï¼Œå³ï¼šåº¦ä¸º i çš„èŠ‚ç‚¹å°†è´¡çŒ® i æ¡è¾¹ã€‚æ‰€ä»¥è¾¹æ•° n-1 æ»¡è¶³ nâˆ’1=0Ã—n0+1Ã—n1+2Ã—n2n - 1 = 0\\times n_0 + 1\\times n_1 + 2\\times n_2nâˆ’1=0Ã—n0â€‹+1Ã—n1â€‹+2Ã—n2â€‹ ã€‚ æ‰€ä»¥ nâˆ’1=n0+n1+n2âˆ’1=0Ã—n0+1Ã—n1+2Ã—n2n-1 = n_0+n_1+n_2 - 1=0\\times n_0+1\\times n_1 + 2\\times n_2nâˆ’1=n0â€‹+n1â€‹+n2â€‹âˆ’1=0Ã—n0â€‹+1Ã—n1â€‹+2Ã—n2â€‹ ï¼Œå³ï¼š n0=n2+1n_0 = n_2 + 1n0â€‹=n2â€‹+1 ã€‚ ADTæè¿° æ“ä½œé›† 123bool isEmpty(BinaryTree* tree); //åˆ¤æ–­äºŒå‰æ ‘æ˜¯å¦ä¸ºç©ºBinaryTree* createBinaryTree(); //åˆ›å»ºä¸€ä¸ªäºŒå‰æ ‘void traversal(BinaryTree* tree); //éå†äºŒå‰æ ‘ å¯¹äºäºŒå‰æ ‘è€Œè¨€ï¼Œéå†æ˜¯å…¶æœ€é‡è¦çš„æ“ä½œã€‚å¸¸è§çš„éå†æ–¹æ³•æœ‰ï¼š 1234void preOrderTraversal(BinaryTree* tree); //å…ˆåºéå†ï¼Œæ ¹--å·¦å­æ ‘--å³å­æ ‘void inOrderTraversal(BinaryTree* tree); //ä¸­åºéå†ï¼Œå·¦å­æ ‘--æ ¹--å³å­æ ‘void postOrderTraversal(BinaryTree* tree); //ååºéå†ï¼Œå·¦å­æ ‘--å³å­æ ‘--æ ¹void levelOrderTraversal(BinaryTree* tree); //å±‚æ¬¡éå†ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œä»å·¦åˆ°å³ å‚¨å­˜ç»“æ„ é¡ºåºç»“æ„ å¯¹äºå®Œå…¨äºŒå‰æ ‘ï¼Œå¯¹å…¶æŒ‰ä»ä¸Šåˆ°ä¸‹ï¼Œä»å·¦åˆ°å³çš„é¡ºåºè¿›è¡Œç¼–å·ï¼š å¦‚å›¾ä¸éš¾çœ‹å‡ºï¼Œçˆ¶èŠ‚ç‚¹çš„ç¼–å·ä¸º i æ—¶ï¼Œå…¶å·¦å­èŠ‚ç‚¹çš„ç¼–å·ä¸º 2i ï¼Œå…¶å³å­èŠ‚ç‚¹çš„ç¼–å·ä¸º 2i+1 ï¼Œçˆ¶èŠ‚ç‚¹çš„ç¼–å·æ˜¯å­èŠ‚ç‚¹ç¼–å·é™¤ä»¥ 2 çš„å‘ä¸‹å–æ•´ã€‚ å¯¹äºè¿™æ ·çš„äºŒå‰æ ‘ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªé•¿åº¦åˆé€‚çš„æ•°ç»„æ¥å‚¨å­˜æ•°çš„æ•°æ®ï¼Œç”±äºå…¶èŠ‚ç‚¹ç¼–å·çš„è§„å¾‹æ€§ï¼Œæ ‘çš„éå†ç­‰æ“ä½œä¸ä¼šå›°éš¾ã€‚ èŠ‚ç‚¹ A B O C S M Q W K ç¼–å· 1 2 3 4 5 6 7 8 9 å¯¹äºä¸€èˆ¬äºŒå‰æ ‘ï¼Œä¹Ÿå¯ä»¥ç”¨è¿™æ ·çš„æ–¹å¼å‚¨å­˜ã€‚ä¸è¿‡é¦–å…ˆéœ€è¦æŠŠéå®Œå…¨äºŒå‰æ ‘ç”¨ç©ºèŠ‚ç‚¹å˜ä¸ºå®Œå…¨äºŒå‰æ ‘ï¼š ç”¨æ•°ç»„å‚¨å­˜ä¸ºï¼š èŠ‚ç‚¹ A B O null null M null null null null null null C ç¼–å· 1 2 3 4 5 6 7 8 9 10 11 12 13 å¯è§ï¼Œæ•°ç»„ç»“æ„çš„äºŒå‰æ ‘ä¼šé€ æˆä¸€å®šçš„ç©ºé—´æµªè´¹ã€‚ é“¾å¼ç»“æ„ å°†èŠ‚ç‚¹è®¾è®¡æˆå¦‚å›¾æ ·å¼ï¼Œå†…éƒ¨å‚¨å­˜èŠ‚ç‚¹æ•°æ®å’ŒæŒ‡å‘å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚ 12345typedef struct binaryTree&#123; ElementType data; BinaryTree* left; BinaryTree* right;&#125;BinaryTree;","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"æ•°æ®ç»“æ„--æ ‘å’Œæ ‘çš„è¡¨ç¤º","slug":"æ•°æ®ç»“æ„-æ ‘å’Œæ ‘çš„è¡¨ç¤º","date":"2022-03-06T08:53:29.000Z","updated":"2023-06-21T06:51:28.944Z","comments":true,"path":"æ•°æ®ç»“æ„-æ ‘å’Œæ ‘çš„è¡¨ç¤º/","link":"","permalink":"https://blog.zhuwenq.cc/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91%E5%92%8C%E6%A0%91%E7%9A%84%E8%A1%A8%E7%A4%BA/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 23 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 6 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 23 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 6 æ—¥é‡æ–°æ•´ç† å†™åœ¨å‰é¢ å®¢è§‚ä¸–ç•Œä¸­è®¸å¤šäº‹ç‰©å­˜åœ¨å±‚æ¬¡å…³ç³»ï¼Œå¦‚äººç±»çš„æ—è°±ï¼Œç¤¾ä¼šç»„ç»‡çš„ç»“æ„ç­‰ã€‚è¿™äº›åˆ†å±‚æ¬¡çš„ç»“æ„åœ¨ç®¡ç†æ–¹é¢å…·æœ‰ä¸€å®šçš„æ•ˆç‡ä¼˜åŠ¿ï¼Œæ ‘å°±æ˜¯ç±»ä¼¼çš„ä¸€ç§å…·æœ‰å±‚æ¬¡ç»“æ„å…³ç³»çš„æ•°æ®ç»“æ„ã€‚ äºŒåˆ†æŸ¥æ‰¾ äºŒåˆ†æŸ¥æ‰¾ binarySearch ä½œä¸ºä¸€ç§æ—¶é—´å¤æ‚åº¦ä¸ºçš„ä¼˜ç§€æŸ¥æ‰¾ç®—æ³•ï¼Œå…¶åœ¨æ•°æ®ç®¡ç†çš„æŸ¥è¯¢æ–¹é¢å…·æœ‰é‡è¦åœ°ä½ã€‚äºŒåˆ†æŸ¥æ‰¾æ¥å—è¢«æŸ¥æ‰¾å…ƒç´ æ‰€å±çš„åºåˆ— list ï¼ˆæœ‰åºçš„ï¼Œå‡è®¾ä¸ºå‡åºï¼‰å’Œè¢«æŸ¥æ‰¾å…ƒç´ çš„å€¼ target ä¸¤ä¸ªå‚æ•°ï¼Œå®ƒçš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š å®šä¹‰ä¸¤ä¸ªå˜é‡ left å’Œ right æŒ‡å‘åºåˆ—çš„å·¦ç«¯å’Œå³ç«¯ï¼Œå˜é‡ mid æŒ‡å‘ä¸¤ç«¯çš„ä¸­é—´ä½ç½®ï¼ŒæŸ¥æ‰¾å°†åœ¨è¿™ä¸¤ç«¯ä¹‹é—´è¿›è¡Œã€‚ åˆå§‹åŒ– left = 1 ï¼Œ right = list.length ï¼Œ mid = (left + right) / 2 ã€‚ æ¯”è¾ƒ mid å¤„çš„å…ƒç´ ä¸å¾…æŸ¥æ‰¾å…ƒç´  target ä¹‹é—´çš„å…³ç³»ï¼š è‹¥ list[mid] = target ï¼Œè¯´æ˜åœ¨ mid å¤„æ‰¾åˆ°äº†å…ƒç´  target ï¼Œè¿”å› mid ã€‚ è‹¥ list[mid] &lt; target ï¼Œè¯´æ˜ target åœ¨ mid çš„å³ä¾§ï¼Œè¿™æ—¶åº”æŠŠ left å³ç§»ä¸º mid + 1 ï¼Œç„¶åæ›´æ–° mid ä¸º (left + right) / 2 ï¼Œé‡å¤è¿‡ç¨‹ 3ã€‚ è‹¥ list[mid] &gt; target ï¼Œè¯´æ˜ target åœ¨ mid çš„å·¦ä¾§ï¼Œè¿™æ—¶åº”æŠŠ right å·¦ç§»åˆ° mid - 1 ï¼Œç„¶åæ›´æ–° mid ä¸º (left + right) / 2 ï¼Œé‡å¤è¿‡ç¨‹ 3ã€‚ æœ€åè‹¥å§‹ç»ˆæœªä»è¿‡ç¨‹3.1è·³å‡ºï¼Œåˆ™ä¼šå¯¼è‡´å·¦å³äº¤å‰å³ left &gt; right ï¼Œæ­¤æ—¶è¯´æ˜å…ƒç´ æœªæŸ¥æ‰¾åˆ°ï¼Œåº”é€€å‡ºç¨‹åºã€‚ ç®—æ³•Cè¯­è¨€ä»£ç ï¼ˆä¼ªï¼‰å¦‚ä¸‹ï¼š 1234567891011121314151617int binarySearch(ElementType *list, int listLength, ElementType target)&#123; int left = 0; int right = listLength - 1; int mid = 0; while (left &lt;= right) &#123; mid = (left + right) / 2; if (list[mid] == target) return mid; else if (list[mid] &gt; target) right = mid - 1; else left = mid + 1; &#125; return -1; //means not frond!&#125; äºŒåˆ†æŸ¥æ‰¾ç®—æ³•ä¹‹æ‰€ä»¥èƒ½è·å¾—è¾ƒé«˜çš„æ—¶é—´æ•ˆç‡ï¼ŒåŸå› ä¹‹ä¸€å°±æ˜¯å®ƒçš„æœç´¢è¿‡ç¨‹å®é™…ä¸Šæ˜¯ä¸€é¢—æœç´¢æ ‘ã€‚ä¾‹å¦‚åºåˆ— [1,2,3,4,5,6,7,8,9,10,11] ï¼ŒæŒ‰ç…§äºŒåˆ†æ³•å»ºç«‹æ ‘çŠ¶ç»“æ„å¦‚ä¸‹ï¼š åˆ™å¯¹äºä»»ä½•ä¸€ä¸ªå…ƒç´ çš„æœç´¢æ¬¡æ•°éƒ½å°†ä¸è¶…è¿‡æ ‘çš„æ·±åº¦ 4 ã€‚è€Œå¯¹äºä¸€é¢—æœ‰ n ä¸ªèŠ‚ç‚¹çš„æ ‘ï¼ˆé•¿åº¦ä¸º n çš„åºåˆ—ï¼‰ï¼Œå…¶æœç´¢æ ‘çš„æ·±åº¦ä¸º logâ¡2n+1\\log_2 n + 1log2â€‹n+1 ï¼Œå› æ­¤äºŒåˆ†æœç´¢çš„æœ€åæ—¶é—´å¤æ‚åº¦æ˜¯ O(logâ¡2n)O(\\log_2 n)O(log2â€‹n) å®šä¹‰ æ ‘æ˜¯ç”± n ä¸ªå…ƒç´ æ„æˆçš„æœ‰ç©·é›†åˆã€‚å½“ n = 0 æ—¶ï¼Œç§°ä¸ºç©ºæ ‘ã€‚å¯¹äºä»»ä½•ä¸€é¢—éç©ºæ ‘ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š ä¸€é¢—æ ‘æœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ root å…¶ä½™èŠ‚ç‚¹å¯åˆ†ä¸ºmä¸ªäº’ä¸ç›¸äº¤çš„æœ‰é™é›†ï¼Œå…¶ä¸­æ¯ä¸ªé›†åˆæœ¬èº«åˆå¯ä»¥è§†ä¸ºä¸€é¢—æ ‘ï¼Œç§°ä¸ºåŸæ ‘çš„å­æ ‘ SubTree ã€‚ æœ¯è¯­è§£é‡Š æ ‘çš„ä¸€äº›åŸºæœ¬æœ¯è¯­ï¼š èŠ‚ç‚¹çš„åº¦ Degree ï¼šèŠ‚ç‚¹çš„å­æ ‘ä¸ªæ•° æ ‘çš„åº¦ï¼šæ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ä¸­æœ€å¤§çš„åº¦æ•° å¶èŠ‚ç‚¹ Leaf ï¼šåº¦ä¸º 0 çš„èŠ‚ç‚¹ çˆ¶èŠ‚ç‚¹ Parent ï¼šæœ‰å­æ ‘çš„èŠ‚ç‚¹æ˜¯å…¶å­æ ‘æ ¹èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ å­èŠ‚ç‚¹ Child ï¼šè‹¥ A æ˜¯ B çš„çˆ¶èŠ‚ç‚¹ï¼Œåˆ™ B æ˜¯ A çš„å­èŠ‚ç‚¹ å…„å¼ŸèŠ‚ç‚¹ Sibling ï¼šå…·æœ‰åŒä¸€çˆ¶èŠ‚ç‚¹çš„å„èŠ‚ç‚¹å½¼æ­¤ä¹‹é—´æ˜¯å…„å¼ŸèŠ‚ç‚¹ è·¯å¾„å’Œè·¯å¾„é•¿åº¦ï¼šä»èŠ‚ç‚¹åˆ°çš„è·¯å¾„æ˜¯ä¸€ä¸ªèŠ‚ç‚¹åºåˆ—ï¼Œå…¶ä¸­æ˜¯çš„çˆ¶èŠ‚ç‚¹ã€‚è·¯å¾„æ‰€åŒ…å«çš„è¾¹çš„æ¡æ•°æ˜¯è·¯å¾„é•¿åº¦ ç¥–å…ˆèŠ‚ç‚¹ Ancestor ï¼šæ²¿ç€ä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸€èŠ‚ç‚¹çš„è·¯å¾„æ‰€åŒ…å«çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯èŠ‚ç‚¹çš„ç¥–å…ˆèŠ‚ç‚¹ å­å­™èŠ‚ç‚¹ Descendant ï¼šæŸä¸€èŠ‚ç‚¹çš„å­æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯è¿™ä¸ªèŠ‚ç‚¹çš„å­å­™èŠ‚ç‚¹ èŠ‚ç‚¹çš„å±‚æ¬¡ Level ï¼šè§„å®šæ ¹èŠ‚ç‚¹åœ¨ 1 å±‚ï¼Œå…¶ä»–èŠ‚ç‚¹çš„å±‚æ¬¡ä¸ºå…¶çˆ¶èŠ‚ç‚¹å±‚æ¬¡ +1 æ ‘çš„æ·±åº¦ Depth ï¼šæ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„æœ€å¤§å±‚æ¬¡ç§°ä¸ºæ ‘çš„æ·±åº¦ æ ‘çš„è¡¨ç¤º å¯¹äºä¸‹å›¾æ‰€ç¤ºçš„æ ‘ï¼š å¯ä»¥ç”¨é“¾è¡¨è¡¨ç¤ºèŠ‚ç‚¹ï¼š é—®é¢˜ï¼šèŠ‚ç‚¹è§„æ ¼ä¸ç»Ÿä¸€ï¼Œæœ‰çš„èŠ‚ç‚¹åº¦ä¸º 1 ï¼Œæœ‰çš„èŠ‚ç‚¹åº¦ä¸º 3 ã€‚ä¸ºäº†ç»Ÿä¸€è€Œé‡‡ç”¨æ ‘çš„åº¦ä½œä¸ºèŠ‚ç‚¹ä¸­éœ€è¦ä¿å­˜çš„å­èŠ‚ç‚¹ä¸ªæ•°è¿‡äºæµªè´¹ç©ºé—´ï¼Œå¯é‡‡ç”¨å„¿å­-å…„å¼Ÿè¡¨ç¤ºæ³• å¦‚å›¾æ‰€ç¤ºé‡‡ç”¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ä¿å­˜ä¸€ä¸ªå­èŠ‚ç‚¹å’Œç›¸é‚»çš„å…„å¼ŸèŠ‚ç‚¹çš„ç»“æ„ï¼š èŠ‚ç‚¹ç»“æ„å¦‚ä¸‹å›¾ï¼š è¿™æ ·çš„ç»“æ„ä¿è¯äº†èŠ‚ç‚¹çš„ç»Ÿä¸€ä¹Ÿä¿è¯äº†ç©ºé—´çš„åˆ©ç”¨æ•ˆç‡ï¼Œç”±äºæ¯ä¸ªèŠ‚ç‚¹ç»“æ„ä¸Šè¿æ¥å…¶ä»–ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿç§°ä¸ºäºŒå‰æ ‘ã€‚","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"æ ‘","slug":"æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E6%A0%91/"}]},{"title":"æ•°æ®ç»“æ„--é˜Ÿåˆ—","slug":"æ•°æ®ç»“æ„-é˜Ÿåˆ—","date":"2022-03-06T08:44:14.000Z","updated":"2023-06-21T06:51:28.944Z","comments":true,"path":"æ•°æ®ç»“æ„-é˜Ÿåˆ—/","link":"","permalink":"https://blog.zhuwenq.cc/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E9%98%9F%E5%88%97/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 21 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 6 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 21 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 6 æ—¥é‡æ–°æ•´ç† å†™åœ¨å‰é¢ é˜Ÿåˆ— (Queue) ä¹Ÿæ˜¯çº¿æ€§è¡¨ä¸­çš„ä¸€ç§é‡è¦æ•°æ®ç»“æ„ï¼Œé˜Ÿåˆ—ä¸­çš„å…ƒç´ åªèƒ½åœ¨é˜Ÿåˆ—çš„å¤´éƒ¨ (front) å‡ºé˜Ÿ (delete) ï¼Œåªèƒ½åœ¨é˜Ÿåˆ—çš„å°¾éƒ¨ (rear) å…¥é˜Ÿ (add) ã€‚å› æ­¤å®ƒæ˜¯ä¸€ç§å…ˆå…¥å…ˆå‡º (First In First Out) çš„æ•°æ®ç»“æ„ã€‚ å®šä¹‰ æ“ä½œé›† ä¸€ä¸ªé˜Ÿåˆ—åº”æœ‰ä»¥ä¸‹æ“ä½œï¼š 12345Queue *createQueue(); //ç”Ÿæˆé˜Ÿåˆ—int isFull(Queue *queue); //æŸ¥è¯¢é˜Ÿåˆ—æ˜¯å¦ä¸ºæ»¡é˜Ÿåˆ—void add(Queue *queue, ElementType item); //å…¥é˜Ÿint isEmpty(Queue *queue); //æŸ¥è¯¢é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºElementType delete (Queue *queue); //å‡ºé˜Ÿ å®ç° é“¾å¼ç»“æ„ é“¾å¼ç»“æ„çš„é˜Ÿåˆ—ç”±ä¸¤ä¸ªèŠ‚ç‚¹åŸŸç»„æˆï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ front å’Œ rear èŠ‚ç‚¹ï¼ŒæŒ‡å‘é“¾è¡¨å¤´å’Œé“¾è¡¨å°¾ã€‚ 0. åŸå‹ 1234567891011typedef struct queueNode&#123; ElementType data; QueueNode *next;&#125; QueueNode;typedef struct queue_list_based&#123; QueueNode *front; //æŒ‡å‘å¤´èŠ‚ç‚¹ QueueNode *rear; //æŒ‡å‘å°¾èŠ‚ç‚¹&#125; Queue; 1. ç”Ÿæˆç©ºé˜Ÿåˆ— ç”Ÿæˆä¸€ä¸ª Queue ç»“æ„ä½“ï¼Œå¹¶æŠŠå®ƒçš„ front å’Œ rear èŠ‚ç‚¹èµ‹å€¼ä¸º NULL ã€‚ 1234567Queue *createQueue()&#123; Queue *queue = (Queue *)malloc(sizeof(Queue)); queue-&gt;front = NULL; queue-&gt;rear = NULL; return queue;&#125; 2. æŸ¥è¯¢æ˜¯å¦ä¸ºæ»¡é˜Ÿåˆ— é“¾å¼å®ç°çš„é˜Ÿåˆ—ä¸å­˜åœ¨æ»¡é˜Ÿåˆ— 3. æŸ¥è¯¢æ˜¯å¦ä¸ºç©ºé˜Ÿåˆ— å½“ä¸”ä»…å½“é“¾å¼å®ç°çš„é˜Ÿåˆ—ä¸ºç©ºé˜Ÿåˆ—æ—¶ï¼Œå®ƒçš„å¤´èŠ‚ç‚¹ front ä¸º NULL ã€‚ 1234int isEmpty(Queue *queue)&#123; return queue-&gt;front == NULL;&#125; 4. å…¥é˜Ÿ å…¥é˜Ÿæ—¶ï¼Œè‹¥é˜Ÿåˆ—ä¸ä¸ºç©ºæŠŠå°¾èŠ‚ç‚¹çš„ next èŠ‚ç‚¹èµ‹å€¼ä¸ºè¦å…¥é˜Ÿçš„èŠ‚ç‚¹ï¼Œç„¶åæŠŠå°¾èŠ‚ç‚¹ç§»åŠ¨åˆ°æ–°æ’å…¥çš„èŠ‚ç‚¹ï¼Œå¦åˆ™ï¼ŒæŠŠå¤´èŠ‚ç‚¹èµ‹å€¼ä¸ºæ–°æ’å…¥çš„èŠ‚ç‚¹ã€‚ 12345678910111213141516void add(Queue *queue, ElementType item)&#123; QueueNode *node = (QueueNode *)malloc(sizeof(QueueNode)); node-&gt;data = item; node-&gt;next = NULL; if (isEmpty(queue)) &#123; queue-&gt;front = node; queue-&gt;rear = node; &#125; else &#123; queue-&gt;rear-&gt;next = node; queue-&gt;rear = node; &#125;&#125; 5. å‡ºé˜Ÿ å‡ºé˜Ÿæ—¶ï¼Œè‹¥é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œå…ˆæŠŠå¤´èŠ‚ç‚¹ä¿å­˜ä¸‹æ¥ï¼Œç„¶åæŠŠå¤´èŠ‚ç‚¹åç§»ï¼Œæœ€ååˆ é™¤å¹¶è¿”å›åŸå¤´èŠ‚ç‚¹ã€‚ 1234567891011121314151617181920ElementType delete (Queue *queue)&#123; if (isEmpty(queue)) &#123; return NULL; //Error!queue is Empty &#125; QueueNode *frontNode = queue-&gt;front; if (queue-&gt;front == queue-&gt;rear) &#123; //if queue has just one element,make it empty. queue-&gt;front = NULL; queue-&gt;rear = NULL; &#125; else &#123; queue-&gt;front = queue-&gt;front-&gt;next; &#125; ElementType frontNodeValue = frontNode-&gt;data; free(frontNode); return frontNodeValue;&#125; é¡ºåºç»“æ„ 0. åŸå‹ é¡ºåºç»“æ„çš„é˜Ÿåˆ—ä½¿ç”¨ä¸€ä¸ªæ•°ç»„å­˜æ”¾æ•°æ®ï¼Œå®ƒçš„å†…éƒ¨ç»´æŠ¤ä¸¤ä¸ªæ•´å½¢å˜é‡ front å’Œ rear åˆ†åˆ«æŒ‡ç¤ºé˜Ÿåˆ—å¤´éƒ¨å’Œå°¾éƒ¨èŠ‚ç‚¹çš„ä½ç½®ã€‚ ç”±äºé˜Ÿåˆ—çš„å…¥é˜Ÿå’Œå‡ºé˜Ÿçš„æ“ä½œå°†æ”¹å˜é˜Ÿåˆ—å…ƒç´ åœ¨å†…éƒ¨æ•°ç»„ä¸­çš„èµ·å§‹å’Œç»ˆæ­¢ä½ç½®ï¼Œå› æ­¤é¡ºåºç»“æ„çš„é˜Ÿåˆ—å¸¸å¸¸æ˜¯ä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—ï¼Œå³å†…éƒ¨æ•°ç»„å¾ªç¯ä½¿ç”¨ï¼Œæ•°ç»„ä¸‹æ ‡å¯¹æ•°ç»„é•¿åº¦å–æ¨¡ï¼Œè¿™æ ·å¯ä»¥æé«˜ç©ºé—´çš„åˆ©ç”¨æ•ˆç‡ã€‚ å®¹æ˜“çŸ¥é“ï¼Œå½“é˜Ÿåˆ—çš„ front å’Œ rear å€¼ç›¸åŒæ—¶ï¼Œé˜Ÿåˆ—æ˜¯ç©ºçš„ï¼ŒåŒæ—¶ï¼Œå½“é˜Ÿåˆ—å¤„äºæ»¡çš„çŠ¶æ€æ—¶ï¼Œ front å’Œ rear ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œè¿™ç§æƒ…å†µå°†ä½¿æˆ‘ä»¬æ— æ³•åˆ†è¾¨é˜Ÿåˆ—çš„æ»¡ç©ºçŠ¶æ€ã€‚ è¿™ç§æƒ…å†µçš„å‡ºç°æ˜¯å¿…ç„¶çš„ï¼Œæ¯”å¦‚å¯¹äºä¸€ä¸ªé•¿åº¦ä¸º 10 çš„é˜Ÿåˆ—ï¼Œå®ƒçš„å†…éƒ¨å¯ä»¥æœ‰ 0,1,2,3...10 ä¸ªå…ƒç´ ï¼Œå³ 11 ä¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤´å°¾å·®å€¼å³ front - rear çš„å€¼è¡¨å¾è¿™ 11 ä¸­çŠ¶æ€ã€‚ç„¶è€Œ front - rear åªæœ‰ 10 ç§å¯èƒ½çš„ç»“æœï¼Œæ— æ³•è¡¨å¾ 11 ç§çŠ¶æ€ã€‚ è¿™ç§çŸ›ç›¾çš„è§£å†³æ–¹æ¡ˆååˆ†ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é˜Ÿåˆ—çš„å†…éƒ¨å¢åŠ ä¸€ä¸ª counter è®¡æ•°å™¨æ¥è®°å½•é˜Ÿåˆ—å†…éƒ¨çš„å…ƒç´ ä¸ªæ•°ã€‚æˆ–è€…æˆ‘ä»¬å¯ä»¥è®©å¤´èŠ‚ç‚¹ front æŒ‡å‘é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„å‰ä¸€ä½ç½®ï¼Œè¿™æ ·ï¼Œé˜Ÿåˆ—å†…éƒ¨å®é™…åªèƒ½å‚¨å­˜æ•°ç»„é•¿åº¦å‡ä¸€ä¸ªå…ƒç´ ï¼Œå¤´å°¾èŠ‚ç‚¹ä¾¿ä¸ä¼šå› ä¸ºé˜Ÿåˆ—æ»¡è€Œç›¸é‡äº†ã€‚ 123456typedef struct queue_array_based&#123; ElementType *data; int front; int rear;&#125;Queue; 1. ç”Ÿæˆé˜Ÿåˆ— ç”Ÿæˆæœ€å¤§é•¿åº¦ä¸º maxSize - 1 çš„é˜Ÿåˆ—ï¼Œå¹¶æŠŠ front,rear èµ‹å€¼ä¸º 0 ï¼Œæ ‡å¿—ä¸ºç©ºé˜Ÿåˆ—ã€‚ 12345678Queue *createQueue(const int maxSize)&#123; Queue *queue = (Queue *)malloc(sizeof(Queue)); queue-&gt;data = (ElementType *)malloc(maxSize * sizeof(ElementType)); queue-&gt;front = 0; queue-&gt;rear = 0; return queue;&#125; 2. æŸ¥è¯¢é˜Ÿåˆ—æ˜¯å¦ä¸ºæ»¡é˜Ÿåˆ— å½“ä¸”ä»…å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œ rear å’Œ front å¿…å®šæ˜¯ç›¸é‚»ä½ç½®ï¼Œä¸” rear åœ¨ front åé¢ï¼Œå› æ­¤ï¼Œé€šè¿‡åˆ¤æ–­ front + 1 ä¸æ•°ç»„é•¿åº¦çš„ä½™ä¸ rear æ¯”è¾ƒï¼Œå¯ä»¥è·çŸ¥é˜Ÿåˆ—æ˜¯å¦å·²æ»¡ã€‚ 1234int isFull(Queue *queue, const int maxSize)&#123; return ((queue-&gt;front + 1) % maxSize) == (queue-&gt;rear);&#125; 3. æŸ¥è¯¢é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º å½“ä¸”ä»…å½“é˜Ÿåˆ—ç©ºæ—¶ï¼Œ front å’Œ rear çš„å€¼ç›¸ç­‰ã€‚ 1234int isEmpty(Queue *queue)&#123; return queue-&gt;front == queue-&gt;rear;&#125; 4. å…¥é˜Ÿ å…¥é˜Ÿæ—¶ï¼Œè‹¥é˜Ÿåˆ—æœªæ»¡ï¼Œ rear çš„å€¼å˜ä¸º rear + 1 å¯¹æ•°ç»„é•¿åº¦çš„å–ä½™ï¼Œç„¶åæŠŠå…¥å¯¹çš„å…ƒç´ æ”¾åœ¨ rear çš„ä½ç½®ã€‚ 123456789void add(Queue *queue, ElementType item, const int maxSize)&#123; if (isFull(queue, maxSize)) &#123; return; //Error!queue is Full. &#125; queue-&gt;rear = (queue-&gt;rear + 1) % maxSize; queue-&gt;data[queue-&gt;rear] = item;&#125; 5. å‡ºé˜Ÿ å‡ºé˜Ÿæ—¶ï¼Œè‹¥é˜Ÿåˆ—éç©ºï¼Œå°† front ç§»åˆ° front + 1 å¯¹æ•°ç»„é•¿åº¦å–ä½™çš„ä½ç½®ï¼Œç„¶åè¿”å› front ä½ç½®çš„å…ƒç´ ã€‚ 123456789ElementType delete (Queue *queue, const int maxSize)&#123; if (isEmpty(queue)) &#123; return NULL; //Error!queue is Empty. &#125; queue-&gt;front = (queue-&gt;front + 1) % maxSize; return queue-&gt;data[queue-&gt;front];&#125;","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"é˜Ÿåˆ—","slug":"é˜Ÿåˆ—","permalink":"https://blog.zhuwenq.cc/tags/%E9%98%9F%E5%88%97/"}]},{"title":"A Simple but Effective Pluggable Entity Lookup Table for Pre-trained Language Models","slug":"A-Simple-but-Effective-Pluggable-Entity-Lookup-Table-for-Pre-trained-Language-Models","date":"2022-03-06T08:35:45.000Z","updated":"2023-06-21T06:51:28.720Z","comments":true,"path":"A-Simple-but-Effective-Pluggable-Entity-Lookup-Table-for-Pre-trained-Language-Models/","link":"","permalink":"https://blog.zhuwenq.cc/A-Simple-but-Effective-Pluggable-Entity-Lookup-Table-for-Pre-trained-Language-Models/","excerpt":"ä½œè€…æå‡ºä¸€ç§å‘ PLM æ³¨å…¥å®ä½“çŸ¥è¯†çš„ç®€å•æ–¹æ³•ï¼šé¦–å…ˆåˆ©ç”¨ PLM ä¸ºå®ä½“æåŠç”Ÿæˆçš„è¡¨å¾é¢„æ„å»ºå®ä½“åµŒå…¥æŸ¥æ‰¾è¡¨ï¼Œå¹¶åœ¨æ¨¡å‹æ¨ç†æ—¶ä¿®æ”¹åµŒå…¥å±‚ï¼Œå°†å®ä½“æåŠçš„åµŒå…¥ç›´æ¥æ›¿æ¢ä¸ºæŸ¥æ‰¾è¡¨ä¸­çš„åµŒå…¥ï¼Œå®ç°æ— ç‰¹æ®Šé¢„è®­ç»ƒçš„æ¡ä»¶ä¸‹å‘ PLM æ³¨å…¥å®ä½“çŸ¥è¯†ã€‚","text":"ä½œè€…æå‡ºä¸€ç§å‘ PLM æ³¨å…¥å®ä½“çŸ¥è¯†çš„ç®€å•æ–¹æ³•ï¼šé¦–å…ˆåˆ©ç”¨ PLM ä¸ºå®ä½“æåŠç”Ÿæˆçš„è¡¨å¾é¢„æ„å»ºå®ä½“åµŒå…¥æŸ¥æ‰¾è¡¨ï¼Œå¹¶åœ¨æ¨¡å‹æ¨ç†æ—¶ä¿®æ”¹åµŒå…¥å±‚ï¼Œå°†å®ä½“æåŠçš„åµŒå…¥ç›´æ¥æ›¿æ¢ä¸ºæŸ¥æ‰¾è¡¨ä¸­çš„åµŒå…¥ï¼Œå®ç°æ— ç‰¹æ®Šé¢„è®­ç»ƒçš„æ¡ä»¶ä¸‹å‘ PLM æ³¨å…¥å®ä½“çŸ¥è¯†ã€‚ Methodology æ„å»ºå®ä½“åµŒå…¥ ä½œè€…è§‚å¯Ÿåˆ°åœ¨ PLM å¦‚ BERT ä¸­ï¼Œè¯çš„åµŒå…¥å’Œè¾“å‡ºè¡¨å¾å®é™…å¤„äºç›¸åŒçš„å‘é‡ç©ºé—´ï¼Œå› æ­¤ä½œè€…è€ƒè™‘æœ‰å¯èƒ½åˆ©ç”¨è¾“å‡ºè¡¨å¾æ„å»ºåµŒå…¥ã€‚ å¯¹äºå®ä½“ eee, å…¶åµŒå…¥è®°ä½œ E(e)\\mathbf{E}(e)E(e). åœ¨å®è·µä¸­ï¼Œä½œè€…æŒ‰å¦‚ä¸‹è¿‡ç¨‹è®¡ç®— E(e)\\mathbf{E}(e)E(e): æ”¶é›†åŒ…å« eee çš„å¥å­é›† SeS_eSeâ€‹ å¯¹ SeS_eSeâ€‹ ä¸­æ¯ä¸ªå¥å­ï¼Œæ›¿æ¢ eee ä¸º [MASK][MASK][MASK] è®° xix_ixiâ€‹ ä¸ºæ¯ä¸ªå¥å­ä¸­æ›¿æ¢çš„ [MASK][MASK][MASK], E(e)=Câ‹…âˆ‘xiâˆˆSerxi\\mathbf{E}(e) = C\\cdot\\sum_{x_i\\in S_e}\\mathbf{r}_{x_i}E(e)=Câ‹…âˆ‘xiâ€‹âˆˆSeâ€‹â€‹rxiâ€‹â€‹ å…¶ä¸­ CCC æ˜¯ç¼©æ”¾ç³»æ•°ï¼Œrxir_{x_i}rxiâ€‹â€‹ æ˜¯ PLM ä¸º xix_ixiâ€‹ ç”Ÿæˆçš„è¡¨å¾ã€‚ (ä½œè€…ç»™å‡ºäº†ä¸ºä½•å¦‚æ­¤è®¾è®¡çš„æ•°å­¦ä¸Šçš„ç†ç”±) åŒæ—¶ï¼Œä½œè€…å°† E(e)\\mathbf{E}(e)E(e) çš„èŒƒæ•°é™å®šä¸ºå¸¸æ•° LLLã€‚ å°†å®ä½“åµŒå…¥æ³¨å…¥ PLM é¦–å…ˆä¿®æ”¹è¾“å…¥è¯­å¥ï¼Œåœ¨è¾“å…¥è¯­å¥ä¸­å®ä½“æåŠçš„åé¢åŠ ä¸Š â€œ(e)â€, å³ä¸€å¯¹æ‹¬å·å’Œå®ä½“ eeeï¼Œæ­¤æ—¶ï¼Œå®ä½“ eee ä½œä¸ºè¯å…¸ä¸­å­˜åœ¨çš„ token å‡ºç°ã€‚ ä¾‹å¦‚å¯¹äºè¾“å…¥è¯­å¥ï¼šSteve Job works for [MASK]\\text{Steve Job works for [MASK]}Steve Job works for [MASK], ä¿®æ”¹åä¸º \\text{Steve Job(Steven_Job) works for [MASK]}. éšååœ¨åµŒå…¥å±‚ï¼Œè¢«æ’å…¥çš„å®ä½“ \\text{Steve_Job} çš„åµŒå…¥å°†ä½¿ç”¨æŸ¥æ‰¾è¡¨ä¸­é¢„ç”Ÿæˆçš„åµŒå…¥ï¼Œå…¶ä»– token ä½¿ç”¨åŸæ¥çš„åµŒå…¥ã€‚éšåå°†è¯¥åµŒå…¥ç›´æ¥é€å…¥ encoderã€‚","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"Entity Represention","slug":"Entity-Represention","permalink":"https://blog.zhuwenq.cc/tags/Entity-Represention/"},{"name":"Entity Lookup Table","slug":"Entity-Lookup-Table","permalink":"https://blog.zhuwenq.cc/tags/Entity-Lookup-Table/"}]},{"title":"æ•°æ®ç»“æ„--æ ˆ","slug":"æ•°æ®ç»“æ„-æ ˆ","date":"2022-03-05T08:53:20.000Z","updated":"2023-06-21T06:51:28.944Z","comments":true,"path":"æ•°æ®ç»“æ„-æ ˆ/","link":"","permalink":"https://blog.zhuwenq.cc/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%88/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 19 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 5 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 19 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 5 æ—¥é‡æ–°æ•´ç† åç¼€è¡¨è¾¾å¼ æ•°å­¦ä¸­å¸¸è§çš„è¿ç®—è¡¨è¾¾å¼å¦‚ a+bÃ—c+d/ea + b \\times c + d / ea+bÃ—c+d/e ç§°ä¸ºä¸­ç¼€è¡¨è¾¾å¼ï¼Œå®ƒçš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯è¿ç®—ç¬¦å·å¦‚ +++ï¼Œâˆ’-âˆ’ï¼ŒÃ—\\timesÃ—ï¼Œ/// éƒ½æ˜¯ä½äºè¿ç®—ç¬¦çš„æ•°æ®ä¸­é—´çš„ã€‚æŠŠè¿ç®—ç¬¦æ‹¿åˆ°æ•°æ®çš„åé¢ï¼Œå¦‚ abcÃ—+de/+abc\\times + de / +abcÃ—+de/+ å°±ç§°ä½åç¼€è¡¨è¾¾å¼ã€‚åœ¨ä½¿ç”¨è®¡ç®—æœºè®¡ç®—æ™®é€šçš„ä¸­ç¼€è¡¨è¾¾å¼æ±‚å€¼æ—¶ï¼Œä¸€èˆ¬å°±éœ€è¦å…ˆæŠŠä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢ä¸ºåç¼€è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºåç¼€è¡¨è¾¾å¼åŒ…å«äº†è¡¨è¾¾å¼ä¸­å„è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ä¿¡æ¯ï¼Œè®¡ç®—æœºè§£ææ‰§è¡Œèµ·æ¥é€»è¾‘æ¸…æ™°ï¼Œå®¹æ˜“å®ç°ã€‚ è€Œåœ¨ä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢ä¸ºåç¼€è¡¨è¾¾å¼ä»¥åŠè®¡ç®—æœºè§£ææ‰§è¡Œåç¼€è¡¨è¾¾å¼æ—¶ï¼Œå°±éœ€è¦æ ˆ (Stack) è¿™ä¸€æ•°æ®ç»“æ„ã€‚ æ ˆ å †æ ˆæ˜¯ä¸€ç§åªèƒ½åœ¨ä¸€ç«¯ï¼ˆæ ˆé¡¶ï¼‰è¿›è¡Œæ’å…¥(push)ï¼Œå’Œåˆ é™¤popæ“ä½œçš„çº¿æ€§è¡¨ï¼Œå› æ­¤ä»–ä¹Ÿæ˜¯ä¸€ä¸­åå…¥å…ˆå‡º(Last In First Out)çš„æ•°æ®ç»“æ„ã€‚ æ“ä½œé›† å †æ ˆåº”å…·æœ‰ä»¥ä¸‹åŸºæœ¬æ“ä½œï¼š 12345Stack *createEmpty(); // ç”Ÿæˆç©ºæ ˆint isFull(Stack *stack); // æŸ¥è¯¢æ˜¯å¦æ»¡æ ˆint isEmpty(Stack *stack); // æŸ¥è¯¢æ˜¯å¦ç©ºæ ˆvoid push(Stack *stack, ElementType item); // åœ¨æ ˆé¡¶æ’å…¥å…ƒç´ ElementType pop(Stack *stack); // åˆ é™¤å¹¶è¿”å›æ ˆé¡¶å…ƒç´  å®ç° é“¾å¼ç»“æ„ é¦–å…ˆå®ç°æ•°æ®ç»“æ„åŸå‹ï¼š ä½¿ç”¨é“¾è¡¨å‚¨å­˜æ•°æ®æ—¶ï¼Œé“¾è¡¨çš„å¤´èŠ‚ç‚¹æŒ‡å‘æ ˆé¡¶ï¼Œä¸ºäº†ä¾¿äºæ“ä½œï¼Œå¤´èŠ‚ç‚¹çš„nextèŠ‚ç‚¹æŒ‡å‘çš„æ˜¯å †æ ˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå³å¤´èŠ‚ç‚¹åªä½œä¸ºæŒ‡ç¤ºä½œç”¨ã€‚ 12345#define ElementType inttypedef struct stack &#123; ElementType data; Stack* next;&#125;Stack; ç”Ÿæˆç©ºè¡¨ åˆ›å»ºä¸€ä¸ªç©ºçš„é“¾è¡¨èŠ‚ç‚¹å¹¶è¿”å›ï¼š 12345Stack* createEmpty() &#123; Stack* top = (Stack*)malloc(sizeof(Stack)); top-&gt;next = NULL; return top;&#125; æŸ¥è¯¢æ˜¯å¦æ»¡æ ˆ é“¾å¼ç»“æ„ä¸å­˜åœ¨æ»¡æ ˆ æŸ¥è¯¢æ˜¯å¦ä¸ºç©ºæ ˆ ç”±äºé“¾å¼ç»“æ„çš„å †æ ˆå§‹ç»ˆæŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œå› æ­¤åªè¦å¤´èŠ‚ç‚¹çš„nextèŠ‚ç‚¹ä¸ä¸ºNULLï¼Œæ ˆå°±ä¸æ˜¯ç©ºçš„ï¼š 123int isEmpty(Stack* stack) &#123; return stack-&gt;next == NULL;&#125; åœ¨æ ˆé¡¶æ’å…¥å…ƒç´  åˆ›å»ºä¸€ä¸ªç©ºèŠ‚ç‚¹tempï¼Œå¹¶æŠŠç©ºèŠ‚ç‚¹çš„nextæŒ‡é’ˆæŒ‡å‘å¤´èŠ‚ç‚¹topçš„ä¸‹ä¸€èŠ‚ç‚¹ï¼Œç„¶åæŠŠå¤´èŠ‚ç‚¹çš„nextæŒ‡é’ˆæŒ‡å‘tempã€‚ï¼ˆtempçš„å€¼åˆå§‹åŒ–ä¸ºè¦æ’å…¥çš„å€¼itemï¼‰ 123456void push(Stack *stack, ElementType item) &#123; Stack *temp = (Stack *)malloc(sizeof(Stack)); temp-&gt;data = item; temp-&gt;next = stack-&gt;next; stack-&gt;next = temp;&#125; åˆ é™¤å¹¶è¿”å›æ ˆé¡¶å…ƒç´  å¦‚æœæ ˆéç©ºï¼Œé¦–å…ˆæŠŠæ ˆé¡¶å…ƒç´ (topèŠ‚ç‚¹çš„nextæŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹çš„å€¼targetValue)å‚¨å­˜ä¸‹æ¥ï¼Œç„¶ååˆ é™¤æ ˆé¡¶èŠ‚ç‚¹ï¼Œè¿”å›targetValueã€‚ 1234567891011ElementType pop(Stack *stack) &#123; if (isEmpty(stack)) &#123; return; //error!Empty stack &#125; ElementType targetValue = stack-&gt;next-&gt;data; Stack *target = stack-&gt;next; stack-&gt;next = target-&gt;next; free(target); return targetValue;&#125; é¡ºåºç»“æ„ï¼ˆæ•°ç»„ï¼‰ é¦–å…ˆå®ç°æ•°æ®ç»“æ„åŸå‹ åœ¨é¡ºåºç»“æ„ä¸­ï¼Œç”±äºæ•°æ®åœ¨æ•°ç»„ä¸­å‚¨å­˜ï¼Œéœ€è¦ä½¿ç”¨æ•°ç»„ä¸‹æ ‡è®¿é—®å…ƒç´ ã€‚å› æ­¤éœ€è¦ä¸€ä¸ªä¸‹æ ‡å§‹ç»ˆæŒ‡å‘æ ˆé¡¶ã€‚åŒæ—¶å †æ ˆåœ¨åˆ›å»ºæ—¶ä¹Ÿéœ€è¦æŒ‡å®šæœ€å¤§çš„ç©ºé—´å¤§å°MaxSize. 12345typedef struct stack&#123; ElementType *data; int top;&#125;Stack; ç”Ÿæˆç©ºè¡¨ ç”±äºéœ€è¦æŒ‡å®šå †æ ˆæœ€å¤§é•¿åº¦ï¼Œå› æ­¤éœ€è¦æœ‰ä¸€ä¸ªå‚æ•°ä¼ å…¥ã€‚åŒæ—¶ï¼Œå †æ ˆçš„å†…å­˜ç©ºé—´å°†åœ¨å †æ ˆåˆ›å»ºæ—¶åˆ†é…å®Œæˆã€‚ å †æ ˆä¸­æŒ‡ç¤ºæ ˆé¡¶ä½ç½®çš„å˜é‡å°†è¢«åˆå§‹åŒ–ä¸º-1ï¼Œå®ƒä»£è¡¨è¿™æ˜¯ä¸€ä¸ªç©ºæ ˆã€‚ 1234567Stack *createEmpty(const int maxSize)&#123; ElementType *data = (ElementType *)malloc(maxSize * sizeof(ElementType)); Stack *stack = (Stack *)malloc(sizeof(Stack)); stack-&gt;data = data; stack-&gt;top = -1;//means an Empty Stack&#125; æŸ¥è¯¢æ˜¯å¦æ»¡æ ˆ ç”±äºæ•°ç»„å®ç°çš„å †æ ˆä¸­ä¸å«å †æ ˆé•¿åº¦çš„ä¿¡æ¯ï¼Œå› æ­¤è¢«æŸ¥è¯¢å †æ ˆçš„å¤§å°éœ€è¦æ˜¾å¼ä¼ å‚ã€‚é€šè¿‡æ¯”äº¤ä¼ å…¥çš„å¤§å°æ•°æ®å’Œæ ˆé¡¶ä½ç½®topï¼Œå¯ä»¥è½»æ˜“å¾—åˆ°å †æ ˆæ˜¯å¦æ»¡æ ˆã€‚ 1234int isFull(Stack *stack, int maxSize)&#123; return stack-&gt;top &gt;= maxSize;&#125; æŸ¥è¯¢æ˜¯å¦ä¸ºç©ºæ ˆ å½“ä¸ºç©ºæ ˆæ—¶ï¼Œtopå€¼ä¸º-1 int isEmpty(Stack *stack) { return stack-&gt;top == -1; } åœ¨æ ˆé¡¶æ’å…¥å…ƒç´  åœ¨æ ˆæœªæ»¡çš„æƒ…å†µä¸‹ï¼Œpushæ“ä½œå¯ä»¥ç®€å•åœ°æŠŠtopæŒ‡ç¤ºå™¨+1å¹¶æŠŠæ ˆé¡¶èµ‹å€¼ä¸ºè¦æ’å…¥çš„å…ƒç´ å®Œæˆï¼š 12345678void push(Stack *stack, ElementType item, const int maxSize)&#123; if (isFull(stack, maxSize)) &#123; return; //Error!stack overflow &#125; stack-&gt;data[stack-&gt;top++] = item;&#125; åˆ é™¤å¹¶è¿”å›æ ˆé¡¶å…ƒç´  æ ˆä¸ä¸ºç©ºæ—¶ï¼Œåˆ é™¤æ“ä½œå¯ä»¥ç®€å•åœ°æŠŠtopæŒ‡ç¤ºå™¨-1å®Œæˆï¼Œæ­¤æ—¶è™½ç„¶åŸæ ˆé¡¶å…ƒç´ ä»åœ¨dataæ•°ç»„ä¸­ï¼Œä½†æ˜¯ç”±äºæ ˆé¡¶æŒ‡ç¤ºå™¨å·²ç»ä¸‹ç§»ï¼ŒåŸæ ˆé¡¶åœ°å€å¤„äºå¯æ“¦å†™çš„çŠ¶æ€ï¼Œç›¸å½“äºåˆ é™¤ã€‚å¹¶ä¸”ç”±äºæ ˆçš„å†…å­˜ç©ºé—´åœ¨æ ˆè¢«æ„å»ºæ—¶å·²ç»ç”³è¯·å®Œæ¯•ï¼Œåœ¨æ ˆä¸Šè¿›è¡Œçš„æ“ä½œå°†ä¸ä¼šå½±å“æ ˆæ‰€å ç”¨çš„å†…å­˜å¤§å°ã€‚ 12345678ElementType pop(Stack *stack)&#123; if (isEmpty(stack)) &#123; return NULL; //Error!stack is Empty &#125; return stack-&gt;data[stack-&gt;top--];&#125; æœ€å æ ˆçš„ä¸¤ç§Cè¯­è¨€ï¼ˆä¼ªï¼‰å®ç°å¤§è‡´å¦‚ä¸Šï¼Œä¸‹é¢çœ‹çœ‹åç¼€è¡¨è¾¾å¼å¦‚ä½•å·¥ä½œçš„ã€‚ è½¬æ¢ä¸­ç¼€è¡¨è¾¾å¼ä¸ºåç¼€è¡¨è¾¾å¼ é¦–å…ˆå»ºé‡Œå †æ ˆç”¨äºå‚¨å­˜è¿ç®—ç¬¦ï¼Œç„¶åé¡ºåºè¯»å–è¡¨è¾¾å¼æ¯ä¸ªå¯¹è±¡ï¼ˆæ•°å€¼ï¼Œç¬¦å·ç­‰ï¼‰ï¼Œå¯¹äºæ¯ä¸ªå¯¹è±¡ï¼ŒæŒ‰å¦‚ä¸‹æ³•åˆ™å¤„ç†ï¼š è‹¥å¯¹è±¡æ˜¯è¿ç®—æ•°å€¼ï¼Œç›´æ¥è¾“å‡º è‹¥å¯¹è±¡æ˜¯å·¦æ‹¬å·'('ï¼Œå‹å…¥(push)å †æ ˆ è‹¥å¯¹è±¡æ˜¯å³æ‹¬å·')'ï¼Œå°†æ ˆå†…çš„è¿ç®—ç¬¦æŒ¨ä¸ªå¼¹å‡ºï¼Œç›´åˆ°é‡åˆ°å·¦æ‹¬å·'(' è‹¥å¯¹è±¡æ˜¯è¿ç®—ç¬¦ï¼Œå°†å…¶ä¸æ ˆé¡¶è¿ç®—ç¬¦æ¯”è¾ƒï¼š è‹¥ä¼˜å…ˆçº§å¤§äºæ ˆé¡¶è¿ç®—ç¬¦ï¼Œåˆ™æŠŠè¯¥è¿ç®—ç¬¦å‹æ ˆ è‹¥ä¼˜å…ˆçº§å°äºæ ˆé¡¶è¿ç®—ç¬¦ï¼Œåˆ™æŠŠæ ˆé¡¶è¿ç®—ç¬¦å¼¹å‡ºï¼Œç»§ç»­ä¸æ–°çš„æ ˆé¡¶è¿ç®—ç¬¦æ¯”è¾ƒï¼Œç›´åˆ°å…¶ä¼˜å…ˆçº§å¤§äºæ ˆé¡¶è¿ç®—ç¬¦ä¸ºæ­¢ã€‚ è‹¥è¡¨è¾¾å¼ä¸­çš„å¯¹è±¡è¯»å–å®Œæ¯•ï¼ŒæŒ¨ä¸ªå¼¹å‡ºæ ˆå†…æ‰€æœ‰è¿ç®—ç¬¦ã€‚ è¿™æ ·å°±æŠŠä¸€ä¸ªä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢ä¸ºäº†åç¼€è¡¨è¾¾å¼ï¼Œçœ‹è¿™ä¸ªä¾‹å­ï¼š è®¡ç®—åç¼€è¡¨è¾¾å¼ é¦–å…ˆå»ºç«‹å †æ ˆç”¨äºå‚¨å­˜è®¡ç®—ç»“æœï¼Œç„¶åé¡ºåºè¯»å–åç¼€è¡¨è¾¾å¼æ¯ä¸ªå¯¹è±¡ï¼Œå¹¶æŒ‰å¦‚ä¸‹æ³•åˆ™å¤„ç†ï¼š å¦‚æœå¯¹è±¡æ˜¯è¿ç®—æ•°ï¼Œå‹æ ˆ å¦‚æœå¯¹è±¡æ˜¯æ“ä½œç¬¦ï¼Œå¼¹å‡ºæ ˆå†…çš„ä¸¤ä¸ªå…ƒç´ æŒ‰è¯¥æ“ä½œç¬¦è®¡ç®—ï¼Œå¹¶æŠŠç»“æœå‹æ ˆ å¤„ç†å®Œæ‰€æœ‰å¯¹è±¡åï¼Œæ ˆé¡¶çš„å¯¹è±¡å°±æ˜¯è¿ç®—ç»“æœ","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"æ ˆ","slug":"æ ˆ","permalink":"https://blog.zhuwenq.cc/tags/%E6%A0%88/"}]},{"title":"æ•°æ®ç»“æ„--çº¿æ€§è¡¨","slug":"æ•°æ®ç»“æ„-çº¿æ€§è¡¨","date":"2022-03-05T08:39:45.000Z","updated":"2023-06-21T06:51:28.944Z","comments":true,"path":"æ•°æ®ç»“æ„-çº¿æ€§è¡¨/","link":"","permalink":"https://blog.zhuwenq.cc/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%BA%BF%E6%80%A7%E8%A1%A8/","excerpt":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 19 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 5 æ—¥é‡æ–°æ•´ç†","text":"æœ¬æ–‡å†™äº 2020 å¹´ 3 æœˆ 19 æ—¥ï¼Œ2022 å¹´ 3 æœˆ 5 æ—¥é‡æ–°æ•´ç† å®šä¹‰ çº¿æ€§è¡¨æ˜¯ç”±åŒç±»å‹çš„æ•°æ®å…ƒç´ æ„æˆçš„æœ‰åºåºåˆ—æ•°æ®ç»“æ„ï¼Œè¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°ç§°ä¸ºçº¿æ€§è¡¨çš„é•¿åº¦ï¼Œæ— å…ƒç´ çš„çº¿æ€§è¡¨ç§°ä¸ºç©ºè¡¨ï¼Œè¡¨èµ·å§‹ä½ç½®ç§°ä¸ºè¡¨å¤´ï¼Œç»“æŸä½ç½®ç§°ä½è¡¨å°¾ã€‚ çº¿æ€§è¡¨çš„ADTæè¿°å¦‚ä¸‹ï¼š ç±»å‹å: çº¿æ€§è¡¨ æ•°æ®å¯¹è±¡é›†: ç”± n(n&gt;=0)n(n &gt;= 0)n(n&gt;=0) ä¸ªå…ƒç´ æ„æˆçš„æœ‰åºåºåˆ— (a1,a2,...,an)(a_1, a_2, ..., a_n)(a1â€‹,a2â€‹,...,anâ€‹) æ“ä½œé›†: 123456List makeEmptyList(); // åˆ›å»ºç©ºè¡¨ElementType findKth(const int K,List list); // æ‰¾åˆ°ç¬¬Kä¸ªå…ƒç´ int find(const ElementType ele,List list); // æ‰¾åˆ°å…ƒç´ eleç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®void insert(ElementType ele,const int position,List list); // æŠŠå…ƒç´ eleæ’å…¥positionä½ç½®çš„å‰é¢void delete(const int position,List list); // åˆ é™¤ä½ç½®positionå¤„çš„å…ƒç´ int length(); // è¿”å›çº¿æ€§è¡¨çš„é•¿åº¦ å®ç° çº¿æ€§è¡¨å†…éƒ¨å¯ä»¥ä½¿ç”¨é¡ºåºå‚¨å­˜çš„æ•°ç»„å®ç°ï¼Œæˆ–è€…ä½¿ç”¨é“¾è¡¨å®ç°ã€‚ é“¾è¡¨å®ç° åŸå‹ 12345678#define ElementType intList *makeEmptyList(); // åˆ›å»ºç©ºè¡¨List *findKth(const int K, List *list); // æ‰¾åˆ°ç¬¬Kä¸ªå…ƒç´ int find(const ElementType ele, List *list); // æ‰¾åˆ°å…ƒç´ eleç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®List *insert(ElementType ele, const int position, List *list); // æŠŠå…ƒç´ eleæ’å…¥positionä½ç½®çš„å‰é¢List *delete (const int position, List *list); // åˆ é™¤ä½ç½®positionå¤„çš„å…ƒç´ int length(List *list); åˆ›å»ºç©ºè¡¨ 12345List *makeEmptyList()&#123; List *list = (List *)malloc(sizeof(List)); return list;&#125; æŸ¥æ‰¾ç¬¬Kä¸ªå…ƒç´  1234567891011List *findKth(const int K, List *list)&#123; List *listCopy = list; //make a copy int i = 0; while (listCopy &amp;&amp; i &lt; K) &#123; i++; listCopy = listCopy-&gt;next; &#125; return listCopy;&#125; æŒ‰å€¼æŸ¥æ‰¾ 123456789int find(const ElementType ele, List *list)&#123; List *listCopy = list; while (listCopy &amp;&amp; listCopy-&gt;data != ele) &#123; listCopy = listCopy-&gt;next; &#125; return listCopy;&#125; æ’å…¥ 1234567891011121314151617181920List *insert(ElementType ele, const int position, List *list)&#123; if (position == 1) &#123; List *n = makeEmptyList(); n-&gt;data = ele; n-&gt;next = list; return n; &#125; List *target = findKth(position - 1, list); if (target == NULL) &#123; return NULL; //error &#125; List *n = makeEmptyList(); n-&gt;data = ele; n-&gt;next = target-&gt;next; target-&gt;next = n; return list;&#125; åˆ é™¤èŠ‚ç‚¹ 123456789101112131415161718192021222324252627282930List *delete (const int position, List *list)&#123; if (position == 1) &#123; if (list == NULL) return NULL; else &#123; List *copy = list; list = list-&gt;next; free(copy); return list; &#125; &#125; List *target = findKth(position - 1, list); List *lastNode = target; if (target == NULL) &#123; return; &#125; else if (target-&gt;next == NULL) &#123; return; &#125; target = target-&gt;next; lastNode-&gt;next = target-&gt;next; free(target); return list;&#125; è·å–é•¿åº¦ 1234567891011int length(List *list)&#123; int i = 0; List *listCopy = list; while (listCopy) &#123; listCopy = listCopy-&gt;next; i++; &#125; return i;&#125;","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"K-Adapter: Infusing Knowledge into Pre-Training Models with Adapters","slug":"K-Adapter-Infusing-Knowledge-into-Pre-Trained-Models-with-Adapters","date":"2022-02-28T16:00:00.000Z","updated":"2023-06-21T06:51:28.796Z","comments":true,"path":"K-Adapter-Infusing-Knowledge-into-Pre-Trained-Models-with-Adapters/","link":"","permalink":"https://blog.zhuwenq.cc/K-Adapter-Infusing-Knowledge-into-Pre-Trained-Models-with-Adapters/","excerpt":"æ–‡ç« ä¸»è¦ç ”ç©¶å‘é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ä¸­æ³¨å…¥çŸ¥è¯†çš„æ–¹æ³•ï¼Œç°å­˜çš„å·¥ä½œä¸»è¦æ˜¯é€šè¿‡æ›´æ–°é¢„è®­ç»ƒæ¨¡å‹å‚æ•°çš„æ–¹å¼å‘æ¨¡å‹æ³¨å…¥çŸ¥è¯†ï¼ˆå³ fine-tune çš„æ–¹å¼ï¼‰ã€‚ä½†æ˜¯è¿™ç§å‚æ•°æ›´æ–°è¿‡ç¨‹ä¼šå°†æ•´ä¸ªæ¨¡å‹çš„å‚æ•°å‘æ–°æ³¨å…¥çš„çŸ¥è¯†ä¸Šåç§»ï¼Œå¯¼è‡´ä¹‹å‰æ³¨å…¥çš„çŸ¥è¯†è¢«å‰Šå¼±æˆ–å†²åˆ·ã€‚ä½œè€…æå‡ºçš„ K-Adapter ç»“æ„ï¼Œé€šè¿‡å°†ä¸åŒçš„çŸ¥è¯†åˆ†åˆ«æ³¨å…¥åˆ°ä¸åŒçš„ Adapter ä¸­å®ç°çŸ¥è¯†çš„æŒç»­æ³¨å…¥ï¼ŒåŒæ—¶ Adapter çš„å‚æ•°é‡è¿œå°äºé¢„è®­ç»ƒæ¨¡å‹ï¼Œåœ¨çŸ¥è¯†æ³¨å…¥çš„è¿‡ç¨‹ä¸­æ›´åŠ ç»æµã€‚","text":"æ–‡ç« ä¸»è¦ç ”ç©¶å‘é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ä¸­æ³¨å…¥çŸ¥è¯†çš„æ–¹æ³•ï¼Œç°å­˜çš„å·¥ä½œä¸»è¦æ˜¯é€šè¿‡æ›´æ–°é¢„è®­ç»ƒæ¨¡å‹å‚æ•°çš„æ–¹å¼å‘æ¨¡å‹æ³¨å…¥çŸ¥è¯†ï¼ˆå³ fine-tune çš„æ–¹å¼ï¼‰ã€‚ä½†æ˜¯è¿™ç§å‚æ•°æ›´æ–°è¿‡ç¨‹ä¼šå°†æ•´ä¸ªæ¨¡å‹çš„å‚æ•°å‘æ–°æ³¨å…¥çš„çŸ¥è¯†ä¸Šåç§»ï¼Œå¯¼è‡´ä¹‹å‰æ³¨å…¥çš„çŸ¥è¯†è¢«å‰Šå¼±æˆ–å†²åˆ·ã€‚ä½œè€…æå‡ºçš„ K-Adapter ç»“æ„ï¼Œé€šè¿‡å°†ä¸åŒçš„çŸ¥è¯†åˆ†åˆ«æ³¨å…¥åˆ°ä¸åŒçš„ Adapter ä¸­å®ç°çŸ¥è¯†çš„æŒç»­æ³¨å…¥ï¼ŒåŒæ—¶ Adapter çš„å‚æ•°é‡è¿œå°äºé¢„è®­ç»ƒæ¨¡å‹ï¼Œåœ¨çŸ¥è¯†æ³¨å…¥çš„è¿‡ç¨‹ä¸­æ›´åŠ ç»æµã€‚ K-Adapter K-Adapter ç”±ä¸€ä¸ª Transformer Encoder æ¨¡å‹å’Œä¸€ä¸ª Adapter æ¨¡å‹ç»„æˆï¼ŒAdapter å±‚çš„è¾“å…¥æ¥è‡ª Transformer Encoder æ¨¡å‹ä¸­é—´éšè—å±‚çš„è¾“å‡ºå‘é‡å’Œä¸Šä¸€å±‚ Adapter çš„è¾“å‡ºå‘é‡çš„æ‹¼æ¥ã€‚æ¨¡å‹çš„æœ€ç»ˆè¾“å‡ºç”± Adapter çš„è¾“å‡ºå‘é‡å’Œ Transformer Encoder æ¨¡å‹çš„è¾“å‡ºå‘é‡æ‹¼æ¥ã€‚æœ¬æ–‡ä¸­ä½œè€…é€‰ç”¨ RoBERTa ä½œä¸º Transformer Encoderã€‚ Adapter ä¸ Houlsby et al.[1] åœ¨æ¯ä¸€å±‚ Transformer å±‚ä¸Šæ·»åŠ  adapter å±‚çš„åšæ³•ä¸åŒï¼Œä½œè€…æå‡ºçš„ K-Adapter ä»¥å¤–æŒ‚çš„å½¢å¼å·¥ä½œã€‚K-Adapter æ¨¡å‹ä¸­çš„ Adapter æ¨¡å‹æœ‰ K ä¸ª Adapter å±‚ï¼Œæ¯ä¸ª Adapter å±‚ä¸­æœ‰ N ä¸ª transformer å±‚å’Œä¸¤ä¸ªæŠ•å½±å±‚ï¼ŒåŒæ—¶æ¯å±‚ Adapter å±‚ä¸­æœ‰ä¸€ä¸ªæ®‹å·®è¿æ¥ã€‚Adapter å±‚çš„ç»“æ„å¦‚ä¸‹å›¾ã€‚ K-Adapter ä¸­çš„ K ä¸ª Adapter å±‚è¢«æ’åœ¨ RoBERTaï¼ˆä»£æŒ‡ pre-trained modelï¼‰ çš„ K ä¸ªä¸åŒçš„ Transformer å±‚ä¸Šã€‚æ¯ä¸ª Adapter å±‚çš„è¾“å…¥ç”± transformer å±‚çš„è¾“å‡ºå‘é‡å’Œä¸Šä¸€ä¸ª adapter å±‚çš„è¾“å‡ºå‘é‡çš„æ‹¼æ¥è€Œæˆï¼Œæ•´ä¸ª K-Adapter æ¨¡å‹çš„è¾“å‡ºå‘é‡åˆ™ç”± RoBERTa å’Œ Adapter çš„æœ€ç»ˆéšè—å±‚å‘é‡æ‹¼æ¥è€Œæˆã€‚ åœ¨é¢„è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä½œè€…é€šè¿‡ä¸åŒçš„é¢„è®­ç»ƒä»»åŠ¡åˆ†åˆ«è®­ç»ƒä¸åŒçš„ Adapter æ¨¡å‹ï¼Œä»¥å®ç°ä¸åŒçŸ¥è¯†çš„æ³¨å…¥ã€‚åœ¨ä¸‹æ¸¸ä»»åŠ¡çš„å¾®è°ƒæ—¶ï¼Œä½¿ç”¨çš„æ‰€æœ‰ Adapter çš„è¾“å‡ºå‘é‡æ‹¼æ¥æ„æˆä¸‹æ¸¸ä»»åŠ¡çš„è¾“å…¥ã€‚ é¢„è®­ç»ƒè®¾ç½® å®éªŒä¸­ï¼Œä½œè€…ä½¿ç”¨çš„ transformer encoder æ¨¡å‹æ˜¯ RoBERTaLARGE(L=24,H=1024,A=16,335M params\\text{RoBERTa}_{LARGE}(L=24, H=1024, A=16, 335M \\text{ params}RoBERTaLARGEâ€‹(L=24,H=1024,A=16,335M params, è®°ä½¿ç”¨çš„ Adapter æ¨¡å‹æ¯å±‚ä¸­çš„ transformer å±‚æ•°ä¸º NNN, transformer å±‚çš„éšè—å±‚ç»´åº¦ä¸º HAH_AHAâ€‹, AAA_AAAâ€‹ ä¸ª self-attention heads, ä¸‹æŠ•å½±å’Œä¸ŠæŠ•å½±å±‚çš„ç»´åº¦åˆ†åˆ«ä¸º Hâˆ’d,HuH-d, H_uHâˆ’d,Huâ€‹. å®éªŒä¸­é‡‡ç”¨çš„å…·ä½“å‚æ•°ä¸ºï¼šN=2,HA=768,AA=12,Hu=1024,Hd=768N=2, H_A=768, A_A=12, H_u=1024, H_d=768N=2,HAâ€‹=768,AAâ€‹=12,Huâ€‹=1024,Hdâ€‹=768ï¼Œadapter å±‚æ’å…¥åœ¨ RoBERTa çš„ç¬¬ {0,11,23}\\{0, 11, 23\\}{0,11,23} å±‚ã€‚Adapter æ¨¡å‹çš„å‚æ•°é‡æ€»å…±ä¸º 42Mã€‚åœ¨é¢„è®­ç»ƒæ—¶ï¼ŒRoBERTa çš„å‚æ•°ä¿æŒä¸å˜ï¼Œä»…æ›´æ–° Adapter çš„å‚æ•°ã€‚ä½œè€…åœ¨å®éªŒä¸­è®¾è®¡äº† Factual Adapter å’Œ Linguistic Adapter åˆ†åˆ«æ³¨å…¥äº‹å®çŸ¥è¯†å’Œè¯­æ³•çŸ¥è¯†ã€‚ Factual Adapter ä½œè€…ä½¿ç”¨ä» T-REx[2] æ•°æ®é›†ä¸­æå–çš„å­é›† T-REx-rc ä½œä¸ºæ•°æ®é›†ï¼Œå…±åŒ…å« 430 ç§å…³ç³»å’Œ 5.5M ä¸ªå¥å­ã€‚ä½œè€…é‡‡ç”¨ relation classification ä»»åŠ¡è®­ç»ƒè¯¥ Adapterï¼Œå…·ä½“åœ°è¯´ï¼ŒAdapter å’Œ RoBERTa çš„è¾“å‡ºå‘é‡æ‹¼æ¥åä½œä¸ºå…³ç³»åˆ†ç±»å±‚çš„è¾“å…¥ï¼Œå¹¶ä¸”åœ¨è¾“å…¥å®ä½“çš„è¡¨å¾ä¸Šä½¿ç”¨äº†æ± åŒ–å±‚ã€‚ Linguistic Adapter è¯­è¨€çŸ¥è¯†åŒ…æ‹¬è¯­æ³•ï¼Œè¯­ä¹‰çŸ¥è¯†ç­‰ï¼Œä½œè€…é€šè¿‡è‡ªç„¶è¯­è¨€æ–‡æœ¬ä¸­è¯ä¹‹é—´çš„ä¾å­˜å…³ç³»æå–è¯­è¨€çŸ¥è¯†ã€‚ä½œè€…åœ¨ BooK Corpus[3] æ•°æ®é›†çš„ä¸€éƒ¨åˆ†ä¸Šä½¿ç”¨ç°æˆçš„ä¾å­˜è§£æå™¨æ„å»ºäº†ä¸€ä¸ªåŒ…å« 1M ä¸ªæ ·æœ¬çš„ä¾å­˜å…³ç³»é¢„æµ‹æ•°æ®é›†ã€‚å¹¶åœ¨è¯¥æ•°æ®é›†ä¸Šè¿›è¡Œä¾å­˜å…³ç³»é¢„æµ‹ä»»åŠ¡ï¼Œå…·ä½“åœ°è¯´å³é¢„æµ‹è¾“å…¥å¥å­ä¸­æ¯ä¸ªè¯çš„ head indexã€‚ä½œè€…å°† RoBERTa å’Œ Adapter çš„è¾“å‡ºå‘é‡æ‹¼æ¥åç»è¿‡ä¸€ä¸ªçº¿æ€§åˆ†ç±»å±‚è¿›è¡Œæ¯ä¸ªè¯çš„åˆ†ç±»ã€‚ å®éªŒ ä½œè€…åœ¨ entity typingï¼Œquestion answering å’Œ relation classification ç­‰ä»»åŠ¡ä¸Šå¯¹ K-Adapter è¿›è¡Œäº†è¯„ä¼°ã€‚ Parameter-Efficient Transfer Learning for NLP. Neil Houlsby, Andrei Giurgiu, Stanislaw Jastrzebski, Bruna Morrone, Quentin De Laroussilhe, Andrea Gesmundo, Mona Attariyan and Sylvain Gelly. [ICML 2019] â†©ï¸ T-REx: A Large Scale Alignment of Natual Language with Knowledge Base Triples. Hady ElSahar, Pavlos Vougiouklis, Arslen Remaci, Christophe and Elena Simperl. [LERC 2018] â†©ï¸ Aligning Books and Movies: Towards Story-Like Visual Explanations by Watching Movies and Reading Books. Yukun Zhu, Ryan Kiros, Rich Zemel, Ruslan Salakhutdinov, Raquel Urtasun, Antonio Torralba and Sanja Fidler. [ICCV 2015] â†©ï¸","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"Adapter","slug":"Adapter","permalink":"https://blog.zhuwenq.cc/tags/Adapter/"},{"name":"Knowledge","slug":"Knowledge","permalink":"https://blog.zhuwenq.cc/tags/Knowledge/"}],"author":["Ruize Wang","Duyu Tang","Nan Duan","Zhongyu Wei","Xuanjing Huang","Jianshu Ji","Guihong Cao","Daxin Jiang","Ming Zhou"]},{"title":"LUKE: Deep Contextualized Entity Representations with Entity-aware Self-attention","slug":"LUKE-Deep-Contextualized-Entity-Representations-with-Entity-aware-Self-attention","date":"2022-02-25T16:00:00.000Z","updated":"2023-06-21T06:51:28.800Z","comments":true,"path":"LUKE-Deep-Contextualized-Entity-Representations-with-Entity-aware-Self-attention/","link":"","permalink":"https://blog.zhuwenq.cc/LUKE-Deep-Contextualized-Entity-Representations-with-Entity-aware-Self-attention/","excerpt":"ä½œè€…æå‡ºä¸€ç§å®ä½“è¡¨å¾æ–¹æ³•ï¼Œé€šè¿‡åœ¨é¢„è®­ç»ƒ Transformer Encoder æ¨¡å‹æ—¶å°†å®ä½“çœ‹ä½œç‹¬ç«‹çš„ token æ¥ä¸ºå®ä½“ç”Ÿæˆè¡¨å¾ã€‚ä½œè€…æå‡ºç±»ä¼¼äº MLM çš„é¢„è®­ç»ƒç›®æ ‡ï¼Œé¦–å…ˆå°†è¯­æ–™ä¸­çš„å®ä½“æ–‡æœ¬æå–å¹¶æ”¾åœ¨è¯­å¥æœ«ç«¯ï¼Œç„¶åä»¥ä¸€å®šçš„æ¯”ä¾‹å°†å®ä½“æ›¿æ¢ä¸º [MASK]\\text{[MASK]}[MASK] ï¼Œå¹¶è®­ç»ƒæ¨¡å‹é¢„æµ‹è¢«é®ç½©çš„å®ä½“ã€‚ä¸ºäº†æå‡æ•ˆæœï¼Œä½œè€…ä¸ºæ”¾åœ¨è¯­å¥æœ«ç«¯çš„å®ä½“è®¾è®¡äº†ç‰¹æ®Šçš„å®ä½“ positional embeddingï¼ŒåŒæ—¶åœ¨ Encoder æ¨¡å‹çš„åŸºç¡€ä¸Šæ·»åŠ  entity-aware self-attention mechanism æ¥å¢å¼ºæ¨¡å‹å¯¹ token type(entity or word) çš„æ„ŸçŸ¥ã€‚ä½œè€…åœ¨å¤šä¸ªæ•°æ®é›†å¤šä¸ªå®ä½“ç›¸å…³çš„ä»»åŠ¡ä¸Šè¿›è¡Œäº†å®éªŒã€‚","text":"ä½œè€…æå‡ºä¸€ç§å®ä½“è¡¨å¾æ–¹æ³•ï¼Œé€šè¿‡åœ¨é¢„è®­ç»ƒ Transformer Encoder æ¨¡å‹æ—¶å°†å®ä½“çœ‹ä½œç‹¬ç«‹çš„ token æ¥ä¸ºå®ä½“ç”Ÿæˆè¡¨å¾ã€‚ä½œè€…æå‡ºç±»ä¼¼äº MLM çš„é¢„è®­ç»ƒç›®æ ‡ï¼Œé¦–å…ˆå°†è¯­æ–™ä¸­çš„å®ä½“æ–‡æœ¬æå–å¹¶æ”¾åœ¨è¯­å¥æœ«ç«¯ï¼Œç„¶åä»¥ä¸€å®šçš„æ¯”ä¾‹å°†å®ä½“æ›¿æ¢ä¸º [MASK]\\text{[MASK]}[MASK] ï¼Œå¹¶è®­ç»ƒæ¨¡å‹é¢„æµ‹è¢«é®ç½©çš„å®ä½“ã€‚ä¸ºäº†æå‡æ•ˆæœï¼Œä½œè€…ä¸ºæ”¾åœ¨è¯­å¥æœ«ç«¯çš„å®ä½“è®¾è®¡äº†ç‰¹æ®Šçš„å®ä½“ positional embeddingï¼ŒåŒæ—¶åœ¨ Encoder æ¨¡å‹çš„åŸºç¡€ä¸Šæ·»åŠ  entity-aware self-attention mechanism æ¥å¢å¼ºæ¨¡å‹å¯¹ token type(entity or word) çš„æ„ŸçŸ¥ã€‚ä½œè€…åœ¨å¤šä¸ªæ•°æ®é›†å¤šä¸ªå®ä½“ç›¸å…³çš„ä»»åŠ¡ä¸Šè¿›è¡Œäº†å®éªŒã€‚ Introduction BERT, RoBERTa ç­‰ Transformer Encoder æ¨¡å‹é€šè¿‡ä¸Šä¸‹æ–‡è¯è¡¨å¾(Contextualized Word Representation, CWR)çš„æ–¹å¼æä¾›äº†é€šç”¨è¯­è¨€è¡¨å¾, ç”±äº CWR æ˜¯å¯¹ word ç”Ÿæˆè¡¨å¾ï¼Œæ— æ³•å¯¹ span-level çš„å®ä½“ç”Ÿæˆè¡¨å¾ï¼Œé€šå¸¸éœ€è¦åœ¨ä¸‹æ¸¸ä»»åŠ¡çš„å°æ•°æ®é›†ä¸Šè®­ç»ƒå¦‚ä½•æ ¹æ® word representation ç”Ÿæˆ entity representationï¼ŒCWR åœ¨å®ä½“ç›¸å…³çš„ä»»åŠ¡ä¸Šè¿˜éœ€è¿›ä¸€æ­¥æ¢ç´¢ã€‚ æœ¬æ–‡æå‡ºçš„ LUKE å³åˆ©ç”¨ Transformer Encoder æ¨¡å‹ä¸ºå®ä½“ç”Ÿæˆä¸Šä¸‹æ–‡è¡¨å¾ï¼Œè§£å†³å®ä½“ç›¸å…³çš„é—®é¢˜ã€‚ LUKE ç»™å®šä¸€ä¸ªåŒ…å« mmm ä¸ªå­— w1,w2,...,wmw_1, w_2, ..., w_mw1â€‹,w2â€‹,...,wmâ€‹ å’Œ nnn ä¸ªå®ä½“ e1,e2,...,ene_1, e_2, ..., e_ne1â€‹,e2â€‹,...,enâ€‹ çš„åºåˆ—ï¼ŒLUKE ä¸ºæ¯ä¸ªå­—è®¡ç®—ä¸€ä¸ª DDD ç»´çš„è¯è¡¨å¾ hw1,hw2,...,hwm\\mathbf{h}_{w_1}, \\mathbf{h}_{w_2}, ..., \\mathbf{h}_{w_m}hw1â€‹â€‹,hw2â€‹â€‹,...,hwmâ€‹â€‹, å…¶ä¸­ hwiâˆˆRD\\mathbf{h}_{w_i} \\in \\mathbb{R}^Dhwiâ€‹â€‹âˆˆRD, ä¸ºæ¯ä¸ªå®ä½“è®¡ç®— DDD ç»´å®ä½“è¡¨å¾ he1,he2,...,hen\\mathbf{h}_{e_1}, \\mathbf{h}_{e_2}, ..., \\mathbf{h}_{e_n}he1â€‹â€‹,he2â€‹â€‹,...,henâ€‹â€‹, å…¶ä¸­ heiâˆˆRD\\mathbf{h}_{e_i} \\in \\mathbb{R}^Dheiâ€‹â€‹âˆˆRD Input Represention å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¾“å…¥æ–‡æœ¬çš„ embedding ç”±ä»¥ä¸‹ä¸‰ä¸ª embedding è®¡ç®—ï¼š Token Embeddingï¼šä»£è¡¨å¯¹åº”çš„è¯ï¼Œè¯å…¸ä¸­æ‰€æœ‰è¯çš„è¡¨å¾å¯è®°ä¸º AâˆˆRVwÃ—D\\mathbf{A}\\in\\mathbb{R}^{V_w\\times D}AâˆˆRVwâ€‹Ã—D, å…¶ä¸­ VwV_wVwâ€‹ æ˜¯è¯å…¸å¤§å°ã€‚ç”±äºå®ä½“æ•°ç›®å¤ªå¤šï¼Œå‡ºäºè®¡ç®—æ•ˆç‡è€ƒè™‘ï¼Œå®ä½“çš„ token embedding è¢«åˆ†è§£ä¸ºä¸¤ä¸ªå°çš„çŸ©é˜µ BâˆˆRVeÃ—H\\mathbf{B}\\in\\mathbb{R}^{V_e\\times H}BâˆˆRVeâ€‹Ã—H å’Œ UâˆˆRHÃ—D\\mathbf{U}\\in\\mathbb{R}^{H\\times D}UâˆˆRHÃ—D, å…¶ä¸­ VeV_eVeâ€‹ æ˜¯è¯å…¸ä¸­çš„å®ä½“æ•°é‡ã€‚ Position Embedding: ä»£è¡¨ token åœ¨è¾“å…¥åºåˆ—ä¸­çš„ä½ç½®ã€‚åœ¨åºåˆ—ä¸­å‡ºç°åœ¨ç¬¬ iii ä½ç½®çš„æ™®é€šè¯å’Œå®ä½“è¯çš„ position embedding åˆ†åˆ«è®°ä½œ CiâˆˆRD\\mathbf{C}_i\\in\\mathbb{R}^DCiâ€‹âˆˆRD å’Œ DiâˆˆRD\\mathbf{D}_i\\in\\mathbb{R}^DDiâ€‹âˆˆRD. å¯¹äºå®ä½“ï¼Œå¦‚æœå…¶åŒ…å«å¤šä¸ªè¯ï¼Œåˆ™è¯¥å®ä½“çš„ position embedding ç”±æ‰€æœ‰è¯çš„ embedding å¹³å‡å€¼è®¡ç®—ï¼šei={wj,...,wk},Di=Î£l=jkDlkâˆ’j+1e_i = \\{w_j, ..., w_k\\}, \\mathbf{D}_i = \\frac{\\Sigma_{l = j}^k \\mathbf{D}_l}{k - j + 1}eiâ€‹={wjâ€‹,...,wkâ€‹},Diâ€‹=kâˆ’j+1Î£l=jkâ€‹Dlâ€‹â€‹. Entity type embedding: ä»£è¡¨è¾“å…¥åºåˆ—ä¸­çš„ token æ˜¯å¦æ˜¯ä¸€ä¸ªå®ä½“ï¼Œentity type embedding æ˜¯ä¸€ä¸ªå‘é‡ eâˆˆRD\\mathbf{e}\\in\\mathbb{R}^DeâˆˆRD Entity-aware Self-attention åœ¨ Transformer Encoder çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œç¬¬ iii ä¸ª token çš„è¾“å…¥åµŒå…¥è®°ä½œ xi\\mathbf{x}_ixiâ€‹, è¾“å‡ºè¡¨å¾è®°ä½œ yi\\mathbf{y}_iyiâ€‹, åˆ™å…¶åœ¨è‡ªæ³¨æ„å±‚çš„è®¡ç®—è¿‡ç¨‹ä¸ºï¼š yi=âˆ‘j=1kÎ±ijVxjÎ±ij=softmax(eij)eij=KxjTQxiL\\begin{aligned} \\mathbf{y}_i &amp;= \\sum_{j = 1}^k\\alpha_{ij}\\mathbf{V}\\mathbf{x}_j\\\\ \\alpha_{ij} &amp;= \\text{softmax}(e_{ij})\\\\ e_{ij} &amp;= \\frac{\\mathbf{Kx}_j^T\\mathbf{Qx}_i}{\\sqrt{L}} \\end{aligned}yiâ€‹Î±ijâ€‹eijâ€‹â€‹=j=1âˆ‘kâ€‹Î±ijâ€‹Vxjâ€‹=softmax(eijâ€‹)=Lâ€‹KxjTâ€‹Qxiâ€‹â€‹â€‹ å…¶ä¸­ QâˆˆRLÃ—D,KâˆˆRLÃ—D,VâˆˆRLÃ—D\\mathbf{Q}\\in\\mathbb{R}^{L\\times D}, \\mathbf{K}\\in\\mathbb{R}^{L\\times D}, \\mathbf{V}\\in\\mathbb{R}^{L\\times D}QâˆˆRLÃ—D,KâˆˆRLÃ—D,VâˆˆRLÃ—D æ˜¯è‡ªæ³¨æ„åŠ›æœºåˆ¶ä¸­çš„ query, key å’Œ value çŸ©é˜µã€‚ LUKE çš„è¾“å…¥ token åˆ†ä¸ºæ™®é€šè¯å’Œå®ä½“ä¸¤ç±»ï¼Œåœ¨è‡ªæ³¨æ„åŠ›æœºåˆ¶è®¡ç®—æ³¨æ„åŠ›åˆ†æ•° eije_{ij}eijâ€‹ æ—¶ï¼Œä½œè€…è®¤ä¸ºç»“åˆç¬¬ i,ji, ji,j ä¸ª token çš„ç±»å‹æ˜¯æœ‰ç›Šçš„ã€‚ä½œè€…ç”±æ­¤æå‡º entity-aware query mechanismï¼Œå¯¹äº i,ji, ji,j ä¸ª token çš„ç±»å‹çš„ä¸åŒç»„åˆï¼Œä½¿ç”¨ä¸åŒçš„ query matrix è¿›è¡Œè®¡ç®—ï¼š eij={KxjTQxi,if both xi,xj are wordsKxjTQw2exi,if xi is word and xj is entityKxjTQe2wxi,if xi is entity and xj is wordKxjTQe2exi,if both xi,xj are entitiese_{ij} = \\begin{cases} \\mathbf{Kx}_j^T\\mathbf{Qx}_i, &amp;\\text{if both }\\mathbf{x}_i, \\mathbf{x}_j \\text{ are words}\\\\ \\mathbf{Kx}_j^T\\mathbf{Q}_{w2e}\\mathbf{x}_i, &amp;\\text{if }\\mathbf{x}_i \\text{ is word and }\\mathbf{x}_j \\text{ is entity}\\\\ \\mathbf{Kx}_j^T\\mathbf{Q}_{e2w}\\mathbf{x}_i, &amp;\\text{if }\\mathbf{x}_i \\text{ is entity and }\\mathbf{x}_j \\text{ is word}\\\\ \\mathbf{Kx}_j^T\\mathbf{Q}_{e2e}\\mathbf{x}_i, &amp;\\text{if both }\\mathbf{x}_i, \\mathbf{x}_j \\text{ are entities} \\end{cases}eijâ€‹=â©âªâªâªâªâ¨âªâªâªâªâ§â€‹KxjTâ€‹Qxiâ€‹,KxjTâ€‹Qw2eâ€‹xiâ€‹,KxjTâ€‹Qe2wâ€‹xiâ€‹,KxjTâ€‹Qe2eâ€‹xiâ€‹,â€‹if both xiâ€‹,xjâ€‹ are wordsif xiâ€‹ is word and xjâ€‹ is entityif xiâ€‹ is entity and xjâ€‹ is wordif both xiâ€‹,xjâ€‹ are entitiesâ€‹ å³åœ¨è®¡ç®—ç¬¬ iii ä¸ª token å¯¹ç¬¬ jjj ä¸ª token çš„æ³¨æ„åŠ›åˆ†æ•°æ—¶ï¼Œè€ƒè™‘å®ƒä»¬åˆ†åˆ«çš„ç±»å‹å¹¶ä½œä¸åŒçš„è®¡ç®—ã€‚ Pretraining ä½œè€…åœ¨é¢„è®­ç»ƒä¸­ä½¿ç”¨ Wikipedia æ•°æ®ä½œä¸ºè¯­æ–™ï¼Œå°† Wikipedia æ–‡æ¡£ä¸­æ‰€æœ‰å¸¦æœ‰è¶…é“¾æ¥çš„æ–‡æœ¬ç‰‡æ®µçœ‹ä½œå®ä½“ï¼Œç”±æ­¤å¯¹æ•°æ®è¿›è¡Œå®ä½“æ ‡æ³¨ã€‚è®­ç»ƒæ—¶ï¼Œä½œè€…é¦–å…ˆå°†æ–‡æœ¬ä¸­çš„å®ä½“æ ‡æ³¨å¤åˆ¶åˆ°æ–‡æœ¬æœ«å°¾ï¼Œç„¶åä»¥ä¸€å®šæ¦‚ç‡é®ç½©è¿™äº›å®ä½“ã€‚åœ¨è®­ç»ƒæ¨¡å‹é¢„æµ‹è¢«é®ä½çš„å®ä½“æ—¶ï¼Œä½œè€…æ˜¯é€šè¿‡å°†å®ä½“è¡¨å¾æ˜ å°„åˆ°å®ä½“è¯å…¸å¤§å°çš„ç»´åº¦ï¼Œç„¶ååœ¨æ•´ä¸ªå®ä½“è¯å…¸ä¸Šè¿›è¡Œ softmax è·å¾—æ¦‚ç‡åˆ†å¸ƒï¼š y^=softmax(BTm+bo)m=layer_norm(gelu(Whhe+bh))\\begin{aligned} \\hat{\\mathbf{y}} &amp;= \\text{softmax}(\\mathbf{BTm} + \\mathbf{b}_o)\\\\ \\mathbf{m} &amp;= \\text{layer\\_norm}(\\text{gelu}(\\mathbf{W}_h\\mathbf{h}_e + \\mathbf{b}_h)) \\end{aligned}y^â€‹mâ€‹=softmax(BTm+boâ€‹)=layer_norm(gelu(Whâ€‹heâ€‹+bhâ€‹))â€‹ å…¶ä¸­ he\\mathbf{h}_eheâ€‹ æ˜¯è¢«é®ä½çš„å®ä½“çš„è¡¨å¾ï¼ŒTâˆˆRHÃ—D,WhâˆˆRDÃ—D\\mathbf{T}\\in\\mathbb{R}^{H\\times D}, \\mathbf{W}_h\\in\\mathbb{R}^{D\\times D}TâˆˆRHÃ—D,Whâ€‹âˆˆRDÃ—D æ˜¯æŠ•å½±çŸ©é˜µï¼ŒboâˆˆRVe,bhâˆˆRD\\mathbf{b}_o\\in\\mathbb{R}^{V_e}, \\mathbf{b}_h\\in\\mathbb{R}^Dboâ€‹âˆˆRVeâ€‹,bhâ€‹âˆˆRD æ˜¯åç½®å‘é‡ã€‚ é¢„è®­ç»ƒçš„æŸå¤±å‡½æ•°æ˜¯ MLM ä»»åŠ¡çš„æŸå¤±å’Œé¢„æµ‹é®ç½©å®ä½“çš„äº¤å‰ç†µæŸå¤±ä¹‹å’Œï¼ˆä¸¤è€…å½¢å¼ä¸€è‡´ï¼Œè®¡ç®—è¿‡ç¨‹ä¹Ÿä¸€è‡´ï¼‰ã€‚ Experiment ä½œè€…åˆ©ç”¨æ–°æå‡ºçš„è¡¨å¾åœ¨ entity typing(Open Entity Dataset[1]), relation classification(TACRED dataset[2]), NER(CoNLL-2003 dataset[3]), cloze-style QA(ReCoRD dataset[4]) å’Œ extractive QA(SQuAD 1.1 dataset[5]) ä»»åŠ¡ä¸Šåšäº†å®éªŒï¼Œä½¿ç”¨çš„æ¨¡å‹ç»“æ„ç±»ä¼¼ï¼šåœ¨è¡¨å¾åæ·»åŠ ç®€å•çš„çº¿æ€§åˆ†ç±»å±‚ã€‚å®éªŒçš„æ¨¡å‹ç»“æ„å’Œç»†èŠ‚å€¼å¾—å‚è€ƒã€‚ Ultra-Fine Entity Typing. Eunsol Choi, Omer Levy, Yejin Choi and Luke Zettlemoyer. [ACL 2018] â†©ï¸ Positionaware Attention and Supervised Data Improve Slot Filling. Yuhao Zhang, Victor Zhong, Danqi Chen, Gabor Angeli, and Christopher D Manning. [EMNLP 2017] â†©ï¸ Introduction to the CoNLL-2003 Shared Task: Language-Independent Named Entity Recognition. Erik F. Tjong Kim Sang and Fien De Meulder. [NAACL 2003] â†©ï¸ ReCoRD: Bridging the Gap between Human and Machine Commonsense Reading Comprehension. Sheng Zhang, Xiaodong Liu, Jingjing Liu, Jianfeng Gao, Kevin Duh, and Benjamin Van Durme. [arXiv: 1810.12885v1] â†©ï¸ SQuAD: 100,000+ Questions for Machine Comprehension of Text. Pranav Rajpurkar, Jian Zhang, Konstantin Lopyrev, and Percy Liang. [EMNLP 2016] â†©ï¸","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"Knowledge Represention","slug":"Knowledge-Represention","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Represention/"}],"author":["Ikuya Yamada","Akari Asai","Hiroyuki Shindo","Hideaki Takeda","Yuji Matsumoto"]},{"title":"Case-Based Reasoning for Natural Language Queries over Knowledge Bases","slug":"Case-Based-Reasoning-for-Natural-Language-Queries-over-Knowledge-Bases","date":"2022-02-23T16:00:00.000Z","updated":"2023-06-21T06:51:28.784Z","comments":true,"path":"Case-Based-Reasoning-for-Natural-Language-Queries-over-Knowledge-Bases/","link":"","permalink":"https://blog.zhuwenq.cc/Case-Based-Reasoning-for-Natural-Language-Queries-over-Knowledge-Bases/","excerpt":"ä½œè€…æå‡ºä¸€ç§ åŸºäºæ¡ˆä¾‹çš„æ¨ç†(Case-Based Reasoning, CBR) è§£å†³ KBQA é—®é¢˜çš„æ¨¡å‹ CBR-KBQAã€‚æ–‡ç« å…³æ³¨äºè¯­ä¹‰è§£ææ–¹å¼ï¼Œæ ¹æ®è‡ªç„¶è¯­è¨€é—®é¢˜æ–‡æœ¬ç”Ÿæˆå¯æ‰§è¡Œçš„é€»è¾‘è¡¨è¾¾å¼ (SparQL)ï¼Œå¹¶åœ¨çŸ¥è¯†å›¾è°±ä¸Šæ‰§è¡Œè¯¥é€»è¾‘è¡¨è¾¾å¼è·å¾—ç­”æ¡ˆã€‚ CBR-KBQA ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š Retrieval Module Reuse Module Revise Module é¦–å…ˆé€šè¿‡ Retrieval Module é€‰æ‹©ç›¸ä¼¼æ¡ˆä¾‹ï¼Œè¯¥æ¨¡å—ç»´æŠ¤ä¸€ä¸ªæ¡ˆä¾‹åº“ï¼Œå¹¶æ ¹æ®é—®é¢˜ä¸­çš„å…³ç³»çš„ç›¸ä¼¼åº¦é€‰æ‹©ç›¸å…³æ¡ˆä¾‹ã€‚ éšååœ¨é€»è¾‘è¡¨è¾¾å¼çš„ç”Ÿæˆä¸Šï¼Œä½œè€…é‡‡ç”¨ç±»ä¼¼äº Prompt çš„æ€æƒ³ã€‚é¦–å…ˆé‡‡ç”¨ä¸€ä¸ª seq2seq æ¨¡å‹ï¼Œå°†è‡ªç„¶è¯­è¨€é—®é¢˜å’Œæ¡ˆä¾‹åº“ä¸­ä¸è¯¥é—®é¢˜ç›¸ä¼¼çš„æ¡ˆä¾‹(è‡ªç„¶è¯­è¨€é—®é¢˜+å¯æ‰§è¡Œé€»è¾‘è¡¨è¾¾å¼)æ‹¼æ¥ä½œä¸ºæ¨¡å‹çš„è¾“å…¥ï¼Œè®­ç»ƒæ¨¡å‹ç»“åˆæ¡ˆä¾‹ç”Ÿæˆæ–°é—®é¢˜çš„é€»è¾‘è¡¨è¾¾å¼ï¼Œå®ç°å¯¹æ¡ˆä¾‹çš„å¤ç”¨ã€‚ ç”±äº Reuse Module æ ¹æ®æ¡ˆä¾‹ç”Ÿæˆæ–°çš„é€»è¾‘è¡¨è¾¾å¼ï¼Œç”Ÿæˆç»“æœä¸­çš„å…³ç³»å–è‡ªè¿‡å¾€æ¡ˆä¾‹ï¼ŒåŒæ—¶çŸ¥è¯†å›¾è°±é€šå¸¸æ˜¯ä¸å®Œæ•´çš„ï¼Œè¿™å°±å¯¼è‡´ç”Ÿæˆç»“æœä¸­çš„å…³ç³»åœ¨çŸ¥è¯†å›¾è°±ä¸­ä¸å­˜åœ¨ï¼Œå¯¼è‡´é€»è¾‘è¡¨è¾¾å¼æ— æ³•æ‰§è¡Œã€‚å› æ­¤ä½œè€…æå‡ºä¸€ä¸ª Revise Moduleï¼Œå¯¹ç”Ÿæˆç»“æœä¸­çš„å…³ç³»è¿›è¡Œä¿®æ­£ã€‚è¯¥æ¨¡å—é€šè¿‡å°†ç”Ÿæˆç»“æœä¸­çš„å…³ç³»å¯¹é½åˆ°çŸ¥è¯†å›¾è°±ä¸­å­˜åœ¨çš„æœ€ç›¸ä¼¼çš„å…³ç³»å®ç°å¯¹ç»“æœçš„ä¿®æ­£ã€‚ ç”±äº CBR-KBQA æ ¹æ®æ¡ˆä¾‹åº“ä¸­çš„è¿‡å¾€æ¡ˆä¾‹ä¸ºæ–°é—®é¢˜ç”Ÿæˆé€»è¾‘è¡¨è¾¾å¼ï¼ŒCBR-KBQA å¯ä»¥é€šè¿‡å‘æ¡ˆä¾‹åº“æ·»åŠ æ–°æ¡ˆä¾‹çš„æ–¹å¼æ³›åŒ–åˆ°è®­ç»ƒè¿‡ç¨‹ä¸­ä»æœªè§è¿‡çš„å…³ç³»ä¸Šã€‚","text":"ä½œè€…æå‡ºä¸€ç§ åŸºäºæ¡ˆä¾‹çš„æ¨ç†(Case-Based Reasoning, CBR) è§£å†³ KBQA é—®é¢˜çš„æ¨¡å‹ CBR-KBQAã€‚æ–‡ç« å…³æ³¨äºè¯­ä¹‰è§£ææ–¹å¼ï¼Œæ ¹æ®è‡ªç„¶è¯­è¨€é—®é¢˜æ–‡æœ¬ç”Ÿæˆå¯æ‰§è¡Œçš„é€»è¾‘è¡¨è¾¾å¼ (SparQL)ï¼Œå¹¶åœ¨çŸ¥è¯†å›¾è°±ä¸Šæ‰§è¡Œè¯¥é€»è¾‘è¡¨è¾¾å¼è·å¾—ç­”æ¡ˆã€‚ CBR-KBQA ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š Retrieval Module Reuse Module Revise Module é¦–å…ˆé€šè¿‡ Retrieval Module é€‰æ‹©ç›¸ä¼¼æ¡ˆä¾‹ï¼Œè¯¥æ¨¡å—ç»´æŠ¤ä¸€ä¸ªæ¡ˆä¾‹åº“ï¼Œå¹¶æ ¹æ®é—®é¢˜ä¸­çš„å…³ç³»çš„ç›¸ä¼¼åº¦é€‰æ‹©ç›¸å…³æ¡ˆä¾‹ã€‚ éšååœ¨é€»è¾‘è¡¨è¾¾å¼çš„ç”Ÿæˆä¸Šï¼Œä½œè€…é‡‡ç”¨ç±»ä¼¼äº Prompt çš„æ€æƒ³ã€‚é¦–å…ˆé‡‡ç”¨ä¸€ä¸ª seq2seq æ¨¡å‹ï¼Œå°†è‡ªç„¶è¯­è¨€é—®é¢˜å’Œæ¡ˆä¾‹åº“ä¸­ä¸è¯¥é—®é¢˜ç›¸ä¼¼çš„æ¡ˆä¾‹(è‡ªç„¶è¯­è¨€é—®é¢˜+å¯æ‰§è¡Œé€»è¾‘è¡¨è¾¾å¼)æ‹¼æ¥ä½œä¸ºæ¨¡å‹çš„è¾“å…¥ï¼Œè®­ç»ƒæ¨¡å‹ç»“åˆæ¡ˆä¾‹ç”Ÿæˆæ–°é—®é¢˜çš„é€»è¾‘è¡¨è¾¾å¼ï¼Œå®ç°å¯¹æ¡ˆä¾‹çš„å¤ç”¨ã€‚ ç”±äº Reuse Module æ ¹æ®æ¡ˆä¾‹ç”Ÿæˆæ–°çš„é€»è¾‘è¡¨è¾¾å¼ï¼Œç”Ÿæˆç»“æœä¸­çš„å…³ç³»å–è‡ªè¿‡å¾€æ¡ˆä¾‹ï¼ŒåŒæ—¶çŸ¥è¯†å›¾è°±é€šå¸¸æ˜¯ä¸å®Œæ•´çš„ï¼Œè¿™å°±å¯¼è‡´ç”Ÿæˆç»“æœä¸­çš„å…³ç³»åœ¨çŸ¥è¯†å›¾è°±ä¸­ä¸å­˜åœ¨ï¼Œå¯¼è‡´é€»è¾‘è¡¨è¾¾å¼æ— æ³•æ‰§è¡Œã€‚å› æ­¤ä½œè€…æå‡ºä¸€ä¸ª Revise Moduleï¼Œå¯¹ç”Ÿæˆç»“æœä¸­çš„å…³ç³»è¿›è¡Œä¿®æ­£ã€‚è¯¥æ¨¡å—é€šè¿‡å°†ç”Ÿæˆç»“æœä¸­çš„å…³ç³»å¯¹é½åˆ°çŸ¥è¯†å›¾è°±ä¸­å­˜åœ¨çš„æœ€ç›¸ä¼¼çš„å…³ç³»å®ç°å¯¹ç»“æœçš„ä¿®æ­£ã€‚ ç”±äº CBR-KBQA æ ¹æ®æ¡ˆä¾‹åº“ä¸­çš„è¿‡å¾€æ¡ˆä¾‹ä¸ºæ–°é—®é¢˜ç”Ÿæˆé€»è¾‘è¡¨è¾¾å¼ï¼ŒCBR-KBQA å¯ä»¥é€šè¿‡å‘æ¡ˆä¾‹åº“æ·»åŠ æ–°æ¡ˆä¾‹çš„æ–¹å¼æ³›åŒ–åˆ°è®­ç»ƒè¿‡ç¨‹ä¸­ä»æœªè§è¿‡çš„å…³ç³»ä¸Šã€‚ CBR-KBQA æ¡ˆä¾‹ï¼šæ¡ˆä¾‹å®šä¹‰ä¸ºä¸€æ¡è‡ªç„¶è¯­è¨€é—®é¢˜æ–‡æœ¬ä¸å®ƒç›¸åº”çš„å¯æ‰§è¡Œé€»è¾‘è¡¨è¾¾å¼æ–‡æœ¬ç»„æˆçš„æ–‡æœ¬å¯¹ï¼Œä½œè€…ä¸»è¦å…³æ³¨äº SPARQL è¿™ç§é€»è¾‘è¡¨è¾¾å¼å½¢å¼ã€‚ è®°è‡ªç„¶è¯­è¨€é—®é¢˜æ–‡æœ¬ä¸º qqq, KB ä¸º K\\mathcal{K}Kï¼Œåˆ™ KBQA æ¨¡å‹éœ€è¦æ ¹æ® qqq åœ¨ K\\mathcal{K}K ä¸­æŸ¥è¯¢å‡ºä¸€ä¸ªç­”æ¡ˆåˆ—è¡¨ A\\mathcal{A}A. ä½œè€…å‡è®¾æœ‰ä¸€ä¸ªå¯ä»¥è®¿é—®çš„æ¡ˆä¾‹åº“ D={(q1,l1),(q2,l2),...,(qN,lN)}\\mathcal{D} = \\{(q_1, l_1), (q_2, l_2), ..., (q_N, l_N)\\}D={(q1â€‹,l1â€‹),(q2â€‹,l2â€‹),...,(qNâ€‹,lNâ€‹)}, å…¶ä¸­ qi,liq_i, l_iqiâ€‹,liâ€‹ åˆ†åˆ«è¡¨ç¤ºè‡ªç„¶è¯­è¨€é—®é¢˜å’Œå®ƒå¯¹åº”çš„é€»è¾‘è¡¨è¾¾å¼ã€‚CBR-KBQA é¦–å…ˆåˆ©ç”¨ retrieve module ä» D\\mathcal{D}D ä¸­æŠ½å– KKK ä¸ªä¸é—®é¢˜ qqq ç›¸ä¼¼çš„æ¡ˆä¾‹ï¼Œè®°ä½œ Dq\\mathcal{D}_qDqâ€‹ã€‚ ç„¶åé€šè¿‡ reuse module å¤ç”¨ Dq\\mathcal{D}_qDqâ€‹ ä¸­æ¡ˆä¾‹çš„ç»„ä»¶ç”Ÿæˆä¸­é—´é€»è¾‘è¡¨è¾¾å¼ linterl_\\text{inter}linterâ€‹ã€‚æœ€åé€šè¿‡ revise module å°† linterl_\\text{inter}linterâ€‹ ä¸­çš„å…³ç³»ä¸çŸ¥è¯†å›¾è°±ä¸­åŒä¸€ä¸ªå®ä½“çš„æœ€ç›¸ä¼¼çš„å…³ç³»å¯¹é½ï¼Œå¯¹é½åçš„é€»è¾‘è¡¨è¾¾å¼è®°ä½œ lll. æœ€åï¼ŒCBR-KBQA åœ¨ K\\mathcal{K}K ä¸Šæ‰§è¡Œ lll, å¾—åˆ°ç­”æ¡ˆåˆ—è¡¨ A\\mathcal{A}A. Retrieve è¯¥æ¨¡å—é€šè¿‡ä¸ºè‡ªç„¶è¯­è¨€é—®é¢˜ç”Ÿæˆè¡¨å¾çš„æ–¹å¼è®¡ç®—å…¶ä¸æ¡ˆä¾‹åº“ä¸­æ¡ˆä¾‹çš„ç›¸ä¼¼åº¦ã€‚åœ¨è®¡ç®—æ—¶ï¼Œä½œè€…åŒæ—¶å¸Œæœ›å¾—åˆ°çš„ç›¸ä¼¼æ¡ˆä¾‹å…·æœ‰åœ¨å…³ç³»ä¸Šçš„é«˜åº¦ç›¸ä¼¼æ€§ï¼Œè€Œéå®ä½“ä¸Šçš„ç›¸ä¼¼æ€§ã€‚å› æ­¤åœ¨è®­ç»ƒæ—¶ï¼Œä½œè€…ä»¥ä¸€å®šçš„æ¯”ä¾‹ pmaskp_\\text{mask}pmaskâ€‹ å°†é—®é¢˜ä¸­å‡ºç°çš„å®ä½“æ›¿æ¢ä¸º [BLANK]\\text{[BLANK]}[BLANK]. ä¸¤ä¸ªé—®é¢˜ä¹‹é—´çš„ç›¸ä¼¼åº¦ç”±å®ƒä»¬è¡¨å¾å‘é‡ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦åº¦é‡ã€‚ åœ¨è®­ç»ƒæ—¶ï¼Œä½œè€…åˆ©ç”¨è®­ç»ƒæ•°æ®ä¸­å¯è®¿é—®çš„é€»è¾‘è¡¨è¾¾å¼ä½œä¸ºè¿œç¨‹ç›‘ç£ï¼šä¸€å¯¹é—®é¢˜ä¹‹é—´çš„æŸå¤±å‡½æ•° ï¼ˆè´Ÿå¯¹æ•°ä¼¼ç„¶ï¼‰ ç”±å®ƒä»¬çš„é€»è¾‘è¡¨è¾¾å¼ä¸­å‡ºç°çš„å…³ç³»é‡å¤åº¦åŠ æƒï¼š L=âˆ’âˆ‘i,jÏ‰i,jlogâ¡expâ¡(âˆ¼(qi,qj))Î£jexpâ¡(âˆ¼(qi,qj))L = -\\sum_{i, j}\\omega_{i, j}\\log\\frac{\\exp(\\sim(\\mathbf{q}_i, \\mathbf{q}_j))}{\\Sigma_j\\exp(\\sim(\\mathbf{q}_i, \\mathbf{q}_j))} L=âˆ’i,jâˆ‘â€‹Ï‰i,jâ€‹logÎ£jâ€‹exp(âˆ¼(qiâ€‹,qjâ€‹))exp(âˆ¼(qiâ€‹,qjâ€‹))â€‹ å…¶ä¸­ï¼ŒqiâˆˆRd\\mathbf{q}_i\\in \\mathbb{R}^dqiâ€‹âˆˆRd è¡¨ç¤º qiq_iqiâ€‹ çš„è¡¨å¾å‘é‡ï¼Œâˆ¼(qi,qj)=qiTqj\\sim(\\mathbf{q}_i, \\mathbf{q}_j) = \\mathbf{q}_i^T\\mathbf{q}_jâˆ¼(qiâ€‹,qjâ€‹)=qiTâ€‹qjâ€‹, Ï‰i,j\\omega_{i, j}Ï‰i,jâ€‹ ç”± qi,qjq_i, q_jqiâ€‹,qjâ€‹ å¯¹åº”çš„é€»è¾‘å½¢å¼ä¸­å…³ç³»çš„ F1 è®¡ç®—ã€‚ ä½œè€…é¢„è®¡ç®—æ¡ˆä¾‹åº“ä¸­æ‰€æœ‰é—®é¢˜çš„è¡¨å¾ï¼Œç„¶ååœ¨æ¨ç†æ—¶è¿”å› qqq çš„ top-k ç›¸ä¼¼çš„æ¡ˆä¾‹ã€‚ Reuse è¯¥æ¨¡å—å°† retriever è¿”å›çš„ k ä¸ªæ¡ˆä¾‹ä½œä¸ºè¾“å…¥é€å…¥ä¸€ä¸ªé¢„è®­ç»ƒçš„ encoder-decoder transformer æ¨¡å‹ï¼Œè®­ç»ƒæ¨¡å‹ä¸ºæ–°é—®é¢˜ç”Ÿæˆé€»è¾‘è¡¨è¾¾å¼ã€‚ä½œè€…é€‰ç”¨å…·æœ‰ç¨€ç–æ³¨æ„åŠ›çš„ BigBird ä½œä¸ºè¯¥æ¨¡å—çš„ transformer æ¨¡å‹ï¼Œä¸»è¦å› ä¸ºå®Œå…¨æ³¨æ„åŠ›çš„ transformer æ¨¡å‹çš„ç©ºé—´å¤æ‚åº¦æ˜¯è¾“å…¥åºåˆ—é•¿åº¦çš„äºŒæ¬¡æ–¹ï¼Œä¾‹å¦‚ BARTï¼ŒT5 ç­‰åªæ”¯æŒæœ€é•¿ 512 çš„è¾“å…¥åºåˆ—ã€‚ ä½œè€…æŒ‰å¦‚ä¸‹æ ¼å¼å¯¹é—®é¢˜ qqq å’Œæ¡ˆä¾‹ Dq={(q1â€²,l1â€²),(q2â€²,l2â€²),...,(qkâ€²,lkâ€²)}\\mathcal{D}_q = \\{(q_1&#x27;, l_1&#x27;), (q_2&#x27;, l_2&#x27;), ..., (q_k&#x27;, l_k&#x27;)\\}Dqâ€‹={(q1â€²â€‹,l1â€²â€‹),(q2â€²â€‹,l2â€²â€‹),...,(qkâ€²â€‹,lkâ€²â€‹)} è¿›è¡Œæ‹¼æ¥ï¼š InputEncoder(q,Dq)=q[SEP]q1â€²[SEP]l1â€²...qkâ€²[SEP]lkâ€²\\text{Input}_\\text{Encoder}(q, \\mathcal{D}_q) = q\\text{[SEP]}q_1&#x27;\\text{[SEP]}l_1&#x27;...q_k&#x27;\\text{[SEP]}l_k&#x27; InputEncoderâ€‹(q,Dqâ€‹)=q[SEP]q1â€²â€‹[SEP]l1â€²â€‹...qkâ€²â€‹[SEP]lkâ€²â€‹ ä½œè€…é‡‡ç”¨ BART-BASE åˆå§‹åŒ–æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨æ ‡å‡†çš„ seq2seq äº¤å‰ç†µæŸå¤±è®­ç»ƒã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½œè€…åœ¨æ¨¡å‹è¾“å‡ºå±‚çš„ softmax å±‚ä¸Šæ·»åŠ äº†ä¸€ä¸ªæ­£åˆ™åŒ–é¡¹ï¼šæœ‰æ¡ˆä¾‹ Dq\\mathcal{D}_qDqâ€‹ æ—¶å’Œä»…æœ‰ qqq æ—¶å¾—åˆ°æ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„ KL æ•£åº¦ã€‚è®° seq2seq æ¨¡å‹ä¸ºå‡½æ•° fff, æœ‰ Dq\\mathcal{D}_qDqâ€‹ æ—¶è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒä¸º Ïƒ=softmax(f(q,Dq))\\sigma = \\text{softmax}(f(q, \\mathcal{D}_q))Ïƒ=softmax(f(q,Dqâ€‹)), ä»…æœ‰ qqq æ—¶è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒä¸º Ïƒâ€²=softmax(f(q))\\sigma&#x27; = \\text{softmax}(f(q))Ïƒâ€²=softmax(f(q)), åˆ™æ·»åŠ äº† KLD æ­£åˆ™åŒ–é¡¹çš„æŸå¤±å‡½æ•°ä¸ºï¼š L=LCE(f(q,Dq),lq)+Î»TKLD(Ïƒ,Ïƒâ€²)L = L_{CE}(f(q, \\mathcal{D}_q), l_q) + \\lambda_T\\text{KLD}(\\sigma, \\sigma&#x27;) L=LCEâ€‹(f(q,Dqâ€‹),lqâ€‹)+Î»Tâ€‹KLD(Ïƒ,Ïƒâ€²) å…¶ä¸­ Î»T\\lambda_TÎ»Tâ€‹ æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼Œè¯¥æ­£åˆ™åŒ–é¡¹çš„ç›®çš„æ˜¯ä½¿å¾—æ¨¡å‹åœ¨æœ‰æ— æ¡ˆä¾‹å‚ä¸çš„æƒ…å†µä¸‹è¾“å‡ºçš„ç»“æœç›¸å·®ä¸è¦å¤ªå¤§ã€‚ Revise åœ¨ Reuse æ¨¡å—ä¸­ï¼Œæ¨¡å‹å¤ç”¨æ¡ˆä¾‹ä¸­çš„å…³ç³»ç”Ÿæˆæ–°çš„é€»è¾‘è¡¨è¾¾å¼ï¼Œä½†æ˜¯æ¡ˆä¾‹ä¸­çš„å…³ç³»å¾ˆå¯èƒ½ä¸æ–°é—®é¢˜çš„å®ä½“ä¸åŒ¹é…ï¼Œå³çŸ¥è¯†å›¾è°±ä¸­çš„è¯¥å®ä½“ä¸å­˜åœ¨ç”Ÿæˆçš„å…³ç³»ã€‚ å› æ­¤ä½œè€…æå‡ºä¸€ä¸ªå¯¹é½ç­–ç•¥ï¼Œå¯¹äºé—®é¢˜ä¸­çš„å®ä½“ï¼Œé¦–å…ˆå°†å…¶æ‰€æœ‰çš„å…³ç³»å–å‡ºï¼Œç„¶åè®¡ç®—å®ƒä»¬ä¸ç”Ÿæˆå…³ç³»ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œå–æœ€ä¸ºç›¸ä¼¼çš„å…³ç³»æ›¿æ¢ç”Ÿæˆçš„å…³ç³»ã€‚ å…³ç³»ä¹‹é—´çš„ç›¸ä¼¼åº¦é€šè¿‡å…³ç³»è¡¨å¾ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—ã€‚ä½œè€…å°è¯•äº†ä¸¤ç§å…³ç³»è¡¨å¾è®¡ç®—æ–¹æ³•ï¼šTransE å’Œ RoBERTa çš„å¥å­åµŒå…¥ã€‚ç”±äºå…³ç³»é€šå¸¸æ˜¯ä¸€ä¸ªçŸ­è¯­ï¼ŒRoBERTa æ— æ³•å‘æŒ¥å…¶ä¸Šä¸‹æ–‡è¡¨å¾çš„ä¼˜åŠ¿ï¼ŒTransE çš„é¢„è®­ç»ƒè¡¨å¾åœ¨æµ‹è¯•æ—¶æ›´ä¼˜ã€‚","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"Knowledge Graph","slug":"Knowledge-Graph","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Graph/"},{"name":"QA","slug":"QA","permalink":"https://blog.zhuwenq.cc/tags/QA/"}],"author":["Rajarshi Das","Manzil Zaheer","Dung Thai","Ameya Godbole","Ethan Perez","Jay-Yoon Lee","Lizhen Tan","Lazaros Polymenakos","Andrew McCallum"]},{"title":"TransferNet: An Effective and Transparent Framework for Multi-hop Question Answering over Relation Graph","slug":"TransferNet-An-Effective-and-Transparent-Framework-for-Multi-hop-Question-Answering-over-Relation-Graph","date":"2022-02-21T16:00:00.000Z","updated":"2023-06-21T06:51:28.924Z","comments":true,"path":"TransferNet-An-Effective-and-Transparent-Framework-for-Multi-hop-Question-Answering-over-Relation-Graph/","link":"","permalink":"https://blog.zhuwenq.cc/TransferNet-An-Effective-and-Transparent-Framework-for-Multi-hop-Question-Answering-over-Relation-Graph/","excerpt":"æœ¬æ–‡é’ˆå¯¹å¤šè·³ KGQA é—®é¢˜ï¼Œæå‡ºä¸€ç§é€æ˜çš„æ¡†æ¶æå‡å¤šè·³ KGQA çš„æ•ˆç‡å’Œå¯è§£é‡Šæ€§ã€‚ç°å­˜çš„æ¨¡å‹é€šå¸¸æ˜¯é€šè¿‡é¢„æµ‹å¤šè·³è¿‡ç¨‹ä¸­çš„å…³ç³»åºåˆ—æˆ–è€…é€šè¿‡å›¾ç¥ç»ç½‘ç»œæå–çŸ¥è¯†å›¾è°±çš„éšå¼ç‰¹å¾æ¥è§£å†³å¤šè·³ KGQA é—®é¢˜ï¼Œå‰è€…ç”±äºæ¨ç†è·¯å¾„çš„æœç´¢ç©ºé—´å¤ªå¤§è€Œéš¾ä»¥ä¼˜åŒ–ï¼Œåè€…åˆ™ç¼ºä¹å¯è§£é‡Šæ€§ã€‚æœ¬æ–‡ä½œè€…æå‡ºçš„ TransferNet åˆ™é€šè¿‡é€æ­¥è®¡ç®—ï¼Œè·å–æ¨ç†è¿‡ç¨‹ä¸­æ¯ä¸ªèŠ‚ç‚¹æ¿€æ´»çš„å®ä½“å’Œå…³ç³»è§£å†³ KGQA é—®é¢˜ï¼Œç”±äºæ¨ç†è¿‡ç¨‹ä¸­çš„ä¸­é—´ç»“æœå¯ä»¥è½»æ˜“è¢«äººç±»ç†è§£ï¼Œå…·æœ‰è¾ƒå¥½çš„å¯è§£é‡Šæ€§ã€‚","text":"æœ¬æ–‡é’ˆå¯¹å¤šè·³ KGQA é—®é¢˜ï¼Œæå‡ºä¸€ç§é€æ˜çš„æ¡†æ¶æå‡å¤šè·³ KGQA çš„æ•ˆç‡å’Œå¯è§£é‡Šæ€§ã€‚ç°å­˜çš„æ¨¡å‹é€šå¸¸æ˜¯é€šè¿‡é¢„æµ‹å¤šè·³è¿‡ç¨‹ä¸­çš„å…³ç³»åºåˆ—æˆ–è€…é€šè¿‡å›¾ç¥ç»ç½‘ç»œæå–çŸ¥è¯†å›¾è°±çš„éšå¼ç‰¹å¾æ¥è§£å†³å¤šè·³ KGQA é—®é¢˜ï¼Œå‰è€…ç”±äºæ¨ç†è·¯å¾„çš„æœç´¢ç©ºé—´å¤ªå¤§è€Œéš¾ä»¥ä¼˜åŒ–ï¼Œåè€…åˆ™ç¼ºä¹å¯è§£é‡Šæ€§ã€‚æœ¬æ–‡ä½œè€…æå‡ºçš„ TransferNet åˆ™é€šè¿‡é€æ­¥è®¡ç®—ï¼Œè·å–æ¨ç†è¿‡ç¨‹ä¸­æ¯ä¸ªèŠ‚ç‚¹æ¿€æ´»çš„å®ä½“å’Œå…³ç³»è§£å†³ KGQA é—®é¢˜ï¼Œç”±äºæ¨ç†è¿‡ç¨‹ä¸­çš„ä¸­é—´ç»“æœå¯ä»¥è½»æ˜“è¢«äººç±»ç†è§£ï¼Œå…·æœ‰è¾ƒå¥½çš„å¯è§£é‡Šæ€§ã€‚ Introduction æ–‡ç« å…³æ³¨äº å…³ç³»å›¾è°±(Relation Graph) ä¸Šçš„å¤šè·³ QA é—®é¢˜ï¼Œå…³ç³»å›¾è°±ä¸­åŒ…å«å®ä½“å’Œä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå…¶å…³ç³»æœ‰ä¸¤ç§å½¢å¼ï¼š æ ‡ç­¾å½¢å¼ï¼šå³çŸ¥è¯†å›¾è°±çš„å½¢å¼ï¼Œå…³ç³»æ˜¯äººå·¥æ„å»ºçš„å—é™çš„è°“è¯­ æ–‡æœ¬å½¢å¼ï¼šå…³ç³»æ˜¯ä»è‡ªç”±æ–‡æœ¬è¯­æ–™ä¸­æå–çš„è‡ªç”±æ–‡æœ¬ã€‚è¿™ç§å…³ç³»å¯ä»¥ä»ä¸»å®¢å®ä½“åŒæ—¶å‡ºç°çš„å¥å­ä¸­æŠ½å– æ ‡ç­¾å½¢å¼çš„å…³ç³»å›¾è°±ç”±äºéœ€è¦äººå·¥æ„å»ºå’Œç»´æŠ¤ï¼Œé€šå¸¸æˆæœ¬è¾ƒé«˜ä¸”ä¸å®Œæ•´ï¼Œæ–‡æœ¬å½¢å¼åˆ™æ›´åŠ ç»æµä¸”å®é™…ã€‚ä½œè€…æå‡ºçš„ TransferNet å¯ä»¥åœ¨ä¸€ä¸ªç»Ÿä¸€çš„æ¡†æ¶å†…è§£å†³è¿™ä¸¤ç§å½¢å¼çš„å…³ç³»å›¾è°±ä¸Šçš„å¤šè·³ QA é—®é¢˜ã€‚ ç°å­˜çš„è§£å†³å¤šè·³ QA é—®é¢˜çš„æ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§æ€è·¯ï¼š åœ¨å¼±ç›‘ç£çš„è®¾ç½®ä¸‹å­¦ä¹ æ¨ç†çš„å…³ç³»è·¯å¾„ï¼Œå³æ ¹æ®æœ€ç»ˆç­”æ¡ˆå­¦ä¹ æ•´ä¸ªæ¨ç†ä¸­é—´è¿‡ç¨‹ã€‚è¿™ç§æ–¹æ³•ç”±äºæœç´¢ç©ºé—´å¤ªå¤§é€šå¸¸éš¾ä»¥ä¼˜åŒ–ï¼Œå¯¹äºæ–‡æœ¬å½¢å¼çš„å…³ç³»å›¾è°±ï¼Œæœç´¢ç©ºé—´åˆ™æ›´å¤§ã€‚ç‰¹åˆ«åœ°ï¼Œå¯¹äºæ ‡ç­¾å½¢å¼å…³ç³»å›¾è°±ä¸Šçš„å¤šè·³ QA é—®é¢˜(å³ KGQA é—®é¢˜)ï¼Œä¸»è¦çš„è§£å†³æ–¹æ¡ˆå¯ä»¥å½’ä¸ºä¸¤ç±»ï¼š ä¿¡æ¯æå–å¼ï¼šé€šè¿‡å­¦ä¹  KG å’Œé—®é¢˜æ–‡æœ¬çš„è¡¨å¾æ¥è®¡ç®—ç­”æ¡ˆ è¯­ä¹‰è§£æå¼ï¼šé€šè¿‡å°†é—®é¢˜è¯­å¥è§£ææˆå¯æ‰§è¡Œçš„é€»è¾‘è¡¨è¾¾å¼ï¼ˆå¦‚ SQL è¯­å¥ï¼‰æ¥æŸ¥è¯¢ç­”æ¡ˆ é€šè¿‡å›¾ç¥ç»ç½‘ç»œæ•æ‰å›¾ä¸­çš„éšå¼ç‰¹å¾ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥è§£å†³ä¸¤ç§å½¢å¼çš„å…³ç³»å›¾è°±ï¼Œä½†æ˜¯ç”±äºæ•´ä¸ªæ¨ç†è¿‡ç¨‹æ˜¯é»‘ç›’çŠ¶æ€ï¼Œå…¶å¯è§£é‡Šæ€§è¾ƒå·®ã€‚ TransferNet åˆ™æ˜¯é€šè¿‡é€æ­¥æ¨ç†ï¼Œé€šè¿‡æ³¨æ„åŠ›æœºåˆ¶è®©æ¨¡å‹åœ¨æ¯ä¸€æ­¥å…³æ³¨äºé—®é¢˜æ–‡æœ¬ä¸­æŸäº›è¯ï¼Œæ¥è®¡ç®—è¯¥æ­¥ä¸­åº”è¯¥æ¿€æ´»çš„å…³ç³»å’Œå®ä½“æœ€ç»ˆè·å¾—ç­”æ¡ˆã€‚ Methodology Relation Graph è®° Relation Graph ä¸º G\\mathcal{G}G, å®ƒçš„å®ä½“å’Œè¾¹çš„é›†åˆè®°ä¸º E\\mathcal{E}E å’Œ R\\mathcal{R}R. å‡è®¾ G\\mathcal{G}G ä¸­å®ä½“æ•°é‡æ˜¯ nnn, åˆ™ R\\mathcal{R}R æ˜¯ä¸€ä¸ª nÃ—nn\\times nnÃ—n çš„çŸ©é˜µï¼Œå…¶å…ƒç´  ri,jr_{i, j}ri,jâ€‹ è¡¨ç¤ºå¤´å®ä½“ eie_ieiâ€‹ å’Œå°¾å®ä½“ eje_jejâ€‹ ä¹‹é—´çš„å…³ç³»ï¼Œri,jr_{i, j}ri,jâ€‹ å¯ä»¥æ˜¯ä¸€ç³»åˆ—çš„æ ‡ç­¾æˆ–æ–‡æœ¬ã€‚ä¸€ä¸ªå¤šè·³é—®é¢˜ qqq é€šå¸¸éœ€è¦ä»ä¸»é¢˜å®ä½“ exe_xexâ€‹ å‡ºå‘ï¼Œç»è¿‡ä¸€ç³»åˆ—çš„å…³ç³»åˆ°è¾¾ç­”æ¡ˆ Y={ey1,...,eyâˆ£Yâˆ£}Y = \\{e_{y^1}, ..., e_{y^{|Y|}}\\}Y={ey1â€‹,...,eyâˆ£Yâˆ£â€‹}. TransferNet TransferNet ä»ä¸»é¢˜å®ä½“ exe_xexâ€‹ å‡ºå‘ï¼Œç»è¿‡ TTT æ­¥é€æ­¥æ¨ç†è·å¾—ç­”æ¡ˆã€‚æ¯ä¸€æ­¥ä¸­ï¼ŒTransferNet å…³æ³¨äºé—®é¢˜æ–‡æœ¬çš„ä¸åŒéƒ¨åˆ†æ¥å†³å®šæœ€åˆé€‚çš„å…³ç³»è·¯å¾„ã€‚TransferNet ç»´æŠ¤ä¸€ä¸ªè¯„åˆ†å‘é‡æ¥è¡¨ç¤ºæ¯ä¸ªå®ä½“çš„æ¿€æ´»æ¦‚ç‡ï¼Œåˆå§‹æƒ…å†µä¸‹ï¼Œä¸»é¢˜å®ä½“çš„è¯„åˆ†åˆå§‹åŒ–ä¸º 1ï¼Œå…¶ä½™å®ä½“è¯„åˆ†åˆå§‹åŒ–ä¸º 0. æ¯ä¸€æ­¥ä¸­ï¼ŒTransferNet é€šè¿‡å…³æ³¨é—®é¢˜ä¸åŒçš„éƒ¨åˆ†ä¸ºæ¯ä¸ªå…³ç³»è®¡ç®—ä¸€ä¸ªæ¿€æ´»æ¦‚ç‡ï¼Œç„¶åæ®æ­¤è½¬ç§»å®ä½“è¯„åˆ†å‘é‡ï¼Œè®¡ç®—è¦æ¿€æ´»çš„å®ä½“ã€‚ å½¢å¼åŒ–åœ°ï¼Œå¯ä»¥å°†ç¬¬ ttt æ­¥çš„å®ä½“è¯„åˆ†å‘é‡è®°ä¸º at=[0,1]n\\mathbf{a}^t = [0, 1]^nat=[0,1]n, å‘é‡ç»´åº¦ä¸º nnnï¼Œæ¯ä¸ªå€¼éƒ½æ˜¯ä»‹äº [0,1][0, 1][0,1] ä¹‹é—´çš„å®æ•°ï¼Œä»£è¡¨æ¯ä¸ªå®ä½“çš„æ¿€æ´»æ¦‚ç‡ã€‚åœ¨ç¬¬ ttt æ­¥ï¼Œæ¨¡å‹é€šè¿‡å…³æ³¨äºé—®é¢˜æ–‡æœ¬çš„ç‰¹æ®Šéƒ¨åˆ†è·å¾—ä¸€ä¸ªæŸ¥è¯¢å‘é‡ qtâˆˆRd\\mathbf{q}^t\\in\\mathcal{R}^dqtâˆˆRdï¼š q,(h1,...,hâˆ£qâˆ£)=Encoder(q;Î¸e)qkt=ft(q;Î¸ft)bt=Softmax(qktâ‹…[h1;...;hâˆ£qâˆ£]T)qt=âˆ‘i=1âˆ£qâˆ£bithi\\begin{aligned} \\mathbf{q}, (\\mathbf{h}_1, ..., \\mathbf{h}_{|q|}) &amp;= \\text{Encoder}(q; \\theta_e)\\\\ \\mathbf{qk}^t &amp;= f^t(\\mathbf{q}; \\theta_{f^t})\\\\ \\mathbf{b}^t &amp;= \\text{Softmax}(\\mathbf{qk^t}\\cdot[\\mathbf{h}_1; ...; \\mathbf{h}_{|q|}]^T)\\\\ \\mathbf{q}^t &amp;= \\sum_{i = 1}^{|q|}b_i^t\\mathbf{h}_i \\end{aligned}q,(h1â€‹,...,hâˆ£qâˆ£â€‹)qktbtqtâ€‹=Encoder(q;Î¸eâ€‹)=ft(q;Î¸ftâ€‹)=Softmax(qktâ‹…[h1â€‹;...;hâˆ£qâˆ£â€‹]T)=i=1âˆ‘âˆ£qâˆ£â€‹bitâ€‹hiâ€‹â€‹ å…¶ä¸­ï¼Œq\\mathbf{q}q æ˜¯æ–‡æœ¬åµŒå…¥ï¼Œ(h1,...,hâˆ£qâˆ£)(\\mathbf{h}_1, ..., \\mathbf{h}_{|q|})(h1â€‹,...,hâˆ£qâˆ£â€‹) æ˜¯é—®é¢˜æ–‡æœ¬ä¸­æ¯ä¸ª token çš„åµŒå…¥ã€‚ftf^tft æ˜¯ä¸€ä¸ªæŠ•å½±å‡½æ•°ï¼Œå°†é—®é¢˜è¡¨å¾ q\\mathbf{q}q æŠ•å½±ä¸ºæŸ¥è¯¢å‘é‡ qkt\\mathbf{qk}^tqkt, qkt\\mathbf{qk}^tqkt å³ç¬¬ ttt æ­¥çš„æ³¨æ„åŠ›å‘é‡ï¼Œé€šè¿‡å…¶ä¸æ¯ä¸ª token çš„åµŒå…¥ hi\\mathbf{h}_ihiâ€‹ ç›¸ä¹˜å†ç»è¿‡ Softmax è·å–é—®é¢˜æ–‡æœ¬ä¸­æ¯ä¸ª token çš„æ³¨æ„åŠ›åˆ†æ•°å‘é‡ bt\\mathbf{b}^tbt, qt\\mathbf{q}^tqt åˆ™æ˜¯ hi\\mathbf{h}_ihiâ€‹ ç»è¿‡æ³¨æ„åŠ›åˆ†æ•°åŠ æƒçš„åŠ æƒå’Œã€‚ å¾—åˆ°é—®é¢˜æ–‡æœ¬çš„æ³¨æ„åŠ›æŸ¥è¯¢å‘é‡ qt\\mathbf{q}^tqt åï¼ŒTransferNet åŸºäºæ­¤è®¡ç®—å…³ç³»æ¿€æ´»åˆ†æ•° Wtâˆˆ[0,1]nÃ—n=g(qt;Î¸g)\\mathbf{W}^t\\in[0, 1]^{n\\times n} = g(\\mathbf{q}^t; \\theta_g)Wtâˆˆ[0,1]nÃ—n=g(qt;Î¸gâ€‹). å…¶ä¸­çš„ Î¸g\\theta_gÎ¸gâ€‹ æ˜¯å‡½æ•° ggg çš„å¯å­¦ä¹ å‚æ•°ï¼Œå¯¹äºæ ‡ç­¾å½¢å¼å’Œæ–‡æœ¬å½¢å¼çš„å…³ç³»å›¾è°±ï¼Œå°†æœ‰ä¸åŒçš„ ggg çš„å®ç°ã€‚ éšåï¼ŒTransferNet æ¨¡æ‹Ÿæ¨ç†è¿‡ç¨‹ï¼Œè®¡ç®—ä¸‹ä¸€æ­¥çš„æ¿€æ´»å®ä½“ï¼šat=atâˆ’1Wt\\mathbf{a}^t = \\mathbf{a}^{t-1}\\mathbf{W}^tat=atâˆ’1Wt, å³ï¼šajt=âˆ‘i=1naitâˆ’1Ã—Wi,jta_j^t = \\sum_{i=1}^{n}a_i^{t-1}\\times W_{i, j}^tajtâ€‹=âˆ‘i=1nâ€‹aitâˆ’1â€‹Ã—Wi,jtâ€‹. å…¶ç‰©ç†æ„ä¹‰ä¸ºï¼šå®ä½“ eie_ieiâ€‹ å‰ä¸€æ­¥çš„æ¿€æ´»åˆ†æ•°ä¹˜ä»¥è¾¹ ri,jr_{i, j}ri,jâ€‹ çš„å…³ç³»æ¿€æ´»åˆ†æ•°å¾—åˆ°å®ä½“ eje_jejâ€‹ çš„å½“å‰æ¿€æ´»åˆ†æ•°ã€‚ ç»è¿‡ TTT æ­¥ä¸Šè¿°è¿‡ç¨‹åï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸€æ­¥çš„å®ä½“æ¿€æ´»å‘é‡ a1,a2,...,aT\\mathbf{a}^1, \\mathbf{a}^2, ..., \\mathbf{a}^Ta1,a2,...,aT, ç”±äºæ¨¡å‹æ— æ³•å¾—çŸ¥è¾“å…¥çš„é—®é¢˜å®é™…çš„è·³æ•°ï¼Œä½œè€…é€šè¿‡è®¡ç®—æ‰€æœ‰ TTT æ­¥çš„å®ä½“æ¿€æ´»å‘é‡çš„åŠ æƒå’Œä½œä¸ºæœ€ç»ˆçš„ç­”æ¡ˆè¾“å‡ºï¼š c=Softmax(MLP(q))aâˆ—=âˆ‘t=1Tctat\\begin{aligned} \\mathbf{c} &amp;= \\text{Softmax}(\\text{MLP}(\\mathbf{q}))\\\\ \\mathbf{a}^* &amp;= \\sum_{t=1}^Tc_t\\mathbf{a}^t \\end{aligned}caâˆ—â€‹=Softmax(MLP(q))=t=1âˆ‘Tâ€‹ctâ€‹atâ€‹ å…¶ä¸­ câˆˆ[0,1]T\\mathbf{c}\\in[0, 1]^Tcâˆˆ[0,1]T è¡¨ç¤ºè¾“å…¥é—®é¢˜çš„è·³æ•°çš„æ¦‚ç‡åˆ†å¸ƒï¼Œå³ ctc_tctâ€‹ ä»£è¡¨è¯¥é—®é¢˜æ˜¯ ttt è·³é—®é¢˜çš„æ¦‚ç‡ã€‚ä½œè€…åœ¨æ­¤æ˜¯å¯„å¸Œæœ›äºå¤šå±‚æ„ŸçŸ¥æœºå¯ä»¥æ ¹æ®é—®é¢˜çš„åµŒå…¥ q\\mathbf{q}q è®¡ç®—å‡ºè¯¥é—®é¢˜çš„è·³æ•°ï¼Œå¹¶è¡¨ç°ä¸ºæ¦‚ç‡åˆ†å¸ƒçš„å½¢å¼ã€‚å› æ­¤å¯ä»¥é€šè¿‡è¯¥æ¦‚ç‡åˆ†å¸ƒä¸æ¯ä¸€æ­¥çš„å®ä½“æ¿€æ´»å‘é‡ç›¸ä¹˜è€Œè‡ªåŠ¨åœ°å¤„ç†ä» 1 è·³åˆ° TTT è·³çš„é—®é¢˜ã€‚æœ€ç»ˆç»“æœ aâˆ—\\mathbf{a}^*aâˆ— ä¸­å¾—åˆ†æœ€é«˜çš„å®ä½“å³ä¸ºæœ€ç»ˆç­”æ¡ˆã€‚ é€šè¿‡ä¸Šè¿°è¿‡ç¨‹å¯çŸ¥ï¼ŒTransferNet è®¡ç®—è¿‡ç¨‹ä¸­æ¯ä¸€æ­¥çš„æ¿€æ´»å®ä½“å’Œæ¿€æ´»å…³ç³»éƒ½å¯ä»¥è¢«å•ç‹¬å–å‡ºè§‚å¯Ÿï¼Œç”±æ­¤å¯ä»¥è½»æ˜“è§‚å¯Ÿåˆ°æ¨¡å‹çš„æ¨ç†è¿‡ç¨‹ï¼Œå› æ­¤ TransferNet æ˜¯å…·æœ‰é«˜åº¦å¯è§£é‡Šæ€§çš„ã€‚ Training ç»™å®šé—®é¢˜çš„ç­”æ¡ˆé›† Y={ey1,...,eyâˆ£Yâˆ£}Y=\\{e_{y^1}, ..., e_{y^{|Y|}}\\}Y={ey1â€‹,...,eyâˆ£Yâˆ£â€‹}, ä½œè€…æ„å»ºç›®æ ‡è¯„åˆ†å‘é‡ yâˆˆ{0,1}n\\mathbf{y}\\in\\{0, 1\\}^nyâˆˆ{0,1}n: yi={1,if eiâˆˆY0,elsey_i = \\begin{cases} 1, \\text{if }e_i\\in Y\\\\ 0, \\text{else} \\end{cases}yiâ€‹={1,if eiâ€‹âˆˆY0,elseâ€‹ ä½œè€…å– aâˆ—\\mathbf{a}^*aâˆ— ä¸ y\\mathbf{y}y ä¹‹é—´çš„ L2L2L2 èŒƒæ•°ä½œä¸ºè®­ç»ƒç›®æ ‡å‡½æ•°ï¼šL=âˆ¥aâˆ—âˆ’yâˆ¥\\mathcal{L} = \\Vert\\mathbf{a}^*-\\mathbf{y}\\VertL=âˆ¥aâˆ—âˆ’yâˆ¥. ç”±äº TransferNet æ•´ä¸ªè®¡ç®—è¿‡ç¨‹æ˜¯å¯å¾®çš„ï¼Œé€šè¿‡è¯¥ç®€å•çš„è®­ç»ƒç›®æ ‡å¯ä»¥å­¦ä¹ æ‰€æœ‰ä¸­é—´ç»“æœã€‚ é¢å¤–æ¨¡å— ä¸ºäº†å¸®åŠ©è®­ç»ƒï¼Œä½œè€…æå‡ºä¸¤ä¸ªé¢å¤–æ¨¡å—ï¼š Score Truncation: æ ¹æ®å®ä½“æ¿€æ´»åˆ†æ•°è®¡ç®—è¿‡ç¨‹ï¼Œajta_j^tajtâ€‹ ç»è¿‡ä¸€ä¸ªè½¬ç§»æ­¥ä¹‹åå…¶å€¼å¯èƒ½ä¼šè¶…è¿‡ 1. å¤ªå¤§çš„æ¿€æ´»åˆ†æ•°å¯èƒ½ä¼šåœ¨è·³æ•°è¿‡å¤šçš„æƒ…å†µä¸‹å¯¼è‡´æ¢¯åº¦çˆ†ç‚¸ï¼Œå› æ­¤ä½œè€…åœ¨æ¯ä¸ªè½¬ç§»æ­¥ä¹‹åè¿›è¡Œåˆ†æ•°è£å‰ªï¼Œä¿è¯æ¿€æ´»åˆ†æ•°è½åœ¨ [0,1][0, 1][0,1] ä¹‹é—´ï¼ŒåŒæ—¶è¦ä¿è¯è®¡ç®—è¿‡ç¨‹çš„å¯å¾®æ€§ï¼š Trunc(a)=az(a)z(a)={a.detach(),if a&gt;11,else\\begin{aligned} \\text{Trunc}(a) &amp;= \\frac{a}{z(a)}\\\\ z(a) &amp;= \\begin{cases} a.\\text{detach()}, &amp;\\text{if } a &gt; 1\\\\ 1, &amp;\\text{else} \\end{cases} \\end{aligned}Trunc(a)z(a)â€‹=z(a)aâ€‹={a.detach(),1,â€‹if a&gt;1elseâ€‹â€‹ Language Mask: TransferNet åœ¨è®¡ç®—æ—¶æ²¡æœ‰è€ƒè™‘å¯èƒ½ä¼šæä¾›æç¤ºçš„è¯­è¨€åå‘ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ–‡æœ¬å½¢å¼çš„å…³ç³»å›¾ï¼š ï¼ˆHarry Potter, &lt;sub&gt; was published in &lt;obj&gt;, United Kingdomï¼‰ å’Œ ï¼ˆHarry Potter, &lt;sub&gt; was published in &lt;obj&gt;, 1997ï¼‰ ä¹‹é—´çš„å…³ç³»æ–‡æœ¬å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯ä¸€ä¸ªè¡¨ç¤ºå‡ºç‰ˆåœ°å¦ä¸€ä¸ªè¡¨ç¤ºå‡ºç‰ˆæ—¶é—´ï¼Œæ­¤æ—¶å¯¹äºé—®é¢˜ Where was Harry Potter published , TransferNet æœªè€ƒè™‘ Where å¯¹ç­”æ¡ˆçš„æç¤ºã€‚ é’ˆå¯¹æ­¤é—®é¢˜ï¼Œä½œè€…å¼•å…¥ä¸€ä¸ªè¯­è¨€é®ç½©æ¥ç»“åˆé—®é¢˜æç¤ºï¼šm=Sigmoid(MLP(q))\\mathbf{m} = \\text{Sigmoid}(\\text{MLP}(\\mathbf{q}))m=Sigmoid(MLP(q)), å…¶ä¸­ mâˆˆ[0,1]n\\mathbf{m}\\in [0, 1]^nmâˆˆ[0,1]n, mim_imiâ€‹ è¡¨ç¤ºå®ä½“ eie_ieiâ€‹ çš„é®ç½©è¯„åˆ†ã€‚æ­¤å¤„ä½œè€…å¯„å¸Œæœ›äºå¤šå±‚æ„ŸçŸ¥æœºèƒ½å¤Ÿæ ¹æ®é—®é¢˜åµŒå…¥æå–å…¶ä¸­çš„æç¤ºï¼Œä»è€Œä»è¯¥æç¤ºçš„è§’åº¦ä¸ºå€™é€‰å®ä½“è¯„åˆ†ã€‚ æ ¹æ®è¯­è¨€é®ç½©ä¿®æ­£çš„ç»“æœä¸ºï¼šaâˆ—^=mâŠ™aâˆ—\\hat{\\mathbf{a}^*} = \\mathbf{m}\\odot \\mathbf{a}^*aâˆ—^=mâŠ™aâˆ—. æ³¨æ„åˆ°ç›¸åŒå…³ç³»æ–‡æœ¬ä¸åŒå«ä¹‰çš„ç°è±¡ä»…å‡ºç°åœ¨æ–‡æœ¬å½¢å¼çš„å…³ç³»å›¾è°±ä¸­ï¼Œæ ‡ç­¾å½¢å¼å›¾è°±ä¸éœ€è¦è¯¥ä¿®æ­£ã€‚ å…³ç³»æ¿€æ´»åˆ†æ•°è®¡ç®— å¯¹äºå…³ç³»åˆ†æ•° Wt=g(qt;Î¸g)\\mathbf{W}^t = g(\\mathbf{q}^t; \\theta_g)Wt=g(qt;Î¸gâ€‹), å‡½æ•° ggg å¯¹äºæ ‡ç­¾å½¢å¼å’Œæ–‡æœ¬å½¢å¼çš„å…³ç³»å›¾è°±æœ‰ä¸åŒçš„å®ç°ã€‚ æ ‡ç­¾å½¢å¼ï¼šå…³ç³»å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªå›ºå®šçš„è°“è¯­é›† P\\mathcal{P}P. ä½œè€…é¦–å…ˆæ ¹æ® qt\\mathbf{q}^tqt è®¡ç®—è¿™äº›è°“è¯­çš„æ¦‚ç‡ï¼Œç„¶åæ ¹æ®é¦–å°¾å®ä½“å°†å¯¹åº”çš„å…³ç³» ri,jr_{i, j}ri,jâ€‹ çš„æ¦‚ç‡æ”¾å…¥ Wi,jW_{i, j}Wi,jâ€‹: pt=Softmax(MLP(qt))\\mathbf{p}^t = \\text{Softmax}(\\text{MLP}(\\mathbf{q}^t))pt=Softmax(MLP(qt)), å¦‚æœåŒæ—¶å¯ä»¥æ¿€æ´»å¤šä¸ªå…³ç³»ï¼ŒSoftmax\\text{Softmax}Softmax å‡½æ•°å¯ä»¥æ›¿æ¢ä¸º Sigmoid\\text{Sigmoid}Sigmoid å‡½æ•°ã€‚ å‡è®¾ä¸€å¯¹å®ä½“ä¹‹é—´çš„å…³ç³»æ•°ç›®æœ€å¤šä¸º bbb, åˆ™è®° ri,j={ri,j,1,...,ri,j,b}r_{i, j} = \\{r_{i, j, 1}, ..., r_{i, j, b}\\}ri,jâ€‹={ri,j,1â€‹,...,ri,j,bâ€‹}, Wi,jW_{i, j}Wi,jâ€‹ å¯ä»¥ç”±æ‰€æœ‰å…³ç³» ri,jr_{i, j}ri,jâ€‹ çš„æ¦‚ç‡ä¹‹å’Œè®¡ç®—ï¼šWi,jt=âˆ‘k=1bpri,j,ktW_{i, j}^t = \\sum_{k=1}^bp_{r_{i, j, k}}^tWi,jtâ€‹=âˆ‘k=1bâ€‹pri,j,kâ€‹tâ€‹ æ–‡æœ¬å½¢å¼ï¼šå…³ç³»æ˜¯æ¥è‡ªæ–‡æœ¬è¯­æ–™ä¸­å®ä½“å¯¹åŒæ—¶å‡ºç°çš„æ–‡æœ¬ï¼Œè®° ri,j={ri,j,1,...,ri,j,b}r_{i, j} = \\{r_{i, j, 1}, ..., r_{i, j, b}\\}ri,jâ€‹={ri,j,1â€‹,...,ri,j,bâ€‹}, å…¶ä¸­ ri,j,kr_{i, j, k}ri,j,kâ€‹ ä»£è¡¨ç¬¬ kkk ä¸ªå…³ç³»æ–‡æœ¬ã€‚ä½œè€…ä½¿ç”¨å…³ç³»ç¼–ç å™¨è·å–å…³ç³»æ–‡æœ¬çš„åµŒå…¥ï¼Œç„¶åè®¡ç®—å…¶åˆ†æ•°ï¼š ri,j,k=Encoder(ri,j,k;Î¸r)pri,j,kt=Sigmoid(MLP(ri,j,kâŠ™qt))Wi,jt=âˆ‘k=1bpri,j,kt\\begin{aligned} \\mathbf{r}_{i, j, k} &amp;= \\text{Encoder}(r_{i, j, k}; \\theta_r)\\\\ p_{r_{i, j, k}}^t &amp;= \\text{Sigmoid}(\\text{MLP}(\\mathbf{r}_{i, j, k}\\odot \\mathbf{q}^t))\\\\ W_{i, j}^t &amp;= \\sum_{k=1}^bp_{r_{i, j, k}}^t \\end{aligned}ri,j,kâ€‹pri,j,kâ€‹tâ€‹Wi,jtâ€‹â€‹=Encoder(ri,j,kâ€‹;Î¸râ€‹)=Sigmoid(MLP(ri,j,kâ€‹âŠ™qt))=k=1âˆ‘bâ€‹pri,j,kâ€‹tâ€‹â€‹ æ­¤å¤„ä½œè€…å°†å…³ç³»æ–‡æœ¬çš„åµŒå…¥ä¸é—®é¢˜æ–‡æœ¬æ³¨æ„åŠ›æŸ¥è¯¢å‘é‡ç›¸ä¹˜ï¼Œç„¶åå¯„å¸Œæœ›äºå¤šå±‚æ„ŸçŸ¥æœºèƒ½å¤Ÿæ ¹æ®ç›¸ä¹˜çš„ç»“æœè®¡ç®—è¯¥å…³ç³»æ–‡æœ¬çš„æ¦‚ç‡åˆ†æ•°ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ–‡æœ¬å½¢å¼çš„å…³ç³»å›¾è°±ä¸­å…³ç³»æ–‡æœ¬çš„æ•°é‡ååˆ†åºå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨è®¡ç®—å…¶æ¦‚ç‡åˆ†æ•°ã€‚å› æ­¤ä½œè€…é€‰æ‹©åœ¨å‰ä¸€æ­¥ä¸­å¾—åˆ†å¤§äºä¸€ä¸ªé¢„å®šä¹‰çš„é˜ˆå€¼ Ï„\\tauÏ„ çš„å®ä½“ï¼Œç„¶åä»…è€ƒè™‘ä»è¿™äº›å®ä½“å¼€å§‹çš„å…³ç³»æ–‡æœ¬ã€‚å¦‚æœæ•°é‡ä»è¿‡äºåºå¤§ï¼Œä½œè€…æ ¹æ®å®ƒä»¬çš„å¤´å®ä½“æ¿€æ´»åˆ†æ•°å¯¹å…³ç³»æ–‡æœ¬è¿›è¡Œæ’åºï¼Œç„¶åä»…å–å‰ Ï‰\\omegaÏ‰ ä¸ªå…³ç³»æ–‡æœ¬ã€‚","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"Knowledge Graph","slug":"Knowledge-Graph","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Graph/"},{"name":"QA","slug":"QA","permalink":"https://blog.zhuwenq.cc/tags/QA/"}],"author":["Jiaxin Shi","Shulin Cao","Lei Hou","Juanzi Li","Hanwang Zhang"]},{"title":"Large-Scale Relation Learning for Question Answering over Knowledge Bases with Pre-trained Language Models","slug":"Large-Scale-Relation-Learning-for-Question-Answering-over-Knowledge-Bases-with-Pre-trained-Language-Models","date":"2022-01-14T16:00:00.000Z","updated":"2023-06-21T06:51:28.800Z","comments":true,"path":"Large-Scale-Relation-Learning-for-Question-Answering-over-Knowledge-Bases-with-Pre-trained-Language-Models/","link":"","permalink":"https://blog.zhuwenq.cc/Large-Scale-Relation-Learning-for-Question-Answering-over-Knowledge-Bases-with-Pre-trained-Language-Models/","excerpt":"KBQA(Question Answering over Knowlegde Bases) æ—¨åœ¨æ ¹æ®ç»“æ„åŒ–çš„çŸ¥è¯†å›¾è°±å›ç­”è‡ªç„¶è¯­è¨€é—®é¢˜ï¼Œè¯¥ä»»åŠ¡åœ¨ç°ä»£çš„é—®ç­”ç³»ç»Ÿå’Œä¿¡æ¯æ£€ç´¢ç³»ç»Ÿä¸­å¹¿æ³›åº”ç”¨ã€‚ ç”±äºè‡ªç„¶è¯­è¨€é—®é¢˜ä¸çŸ¥è¯†å›¾è°±ä¸­çš„æ¨ç†é“¾çš„ä¸ç›¸å®¹æ€§ï¼Œæœ€è¿‘çš„ KBQA æ–¹æ³•æ›´å…³æ³¨äºå›¾è°±ä¸­çš„é€»è¾‘å…³ç³»ï¼Œå¿½ç•¥äº†å›¾è°±çš„èŠ‚ç‚¹å’Œè¾¹ä¸Šçš„æ–‡æœ¬è¯­ä¹‰ä¿¡æ¯ã€‚åŒæ—¶é¢„è®­ç»ƒæ¨¡å‹è™½ç„¶ä»å¤§è§„æ¨¡çš„è¯­æ–™ä¸­å­¦ä¹ åˆ°äº†å¤§é‡å¼€æ”¾ä¸–ç•ŒçŸ¥è¯†ï¼Œä½†æ˜¯è¿™ç§çŸ¥è¯†æ˜¯éç»“æ„åŒ–çš„ï¼Œä¸ç»“æ„åŒ–çš„çŸ¥è¯†å›¾è°±ä¹‹é—´å­˜åœ¨éš”é˜‚ã€‚ä¸ºè¿æ¥é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ä¸çŸ¥è¯†å›¾è°±ï¼Œä½œè€…æå‡ºäº†ä¸‰ç§å…³ç³»å­¦ä¹ ä»»åŠ¡æ¥è¿›è¡Œå…³ç³»å¢å¼ºè®­ç»ƒã€‚ç»è¿‡è¿™ç§è®­ç»ƒï¼Œæ¨¡å‹èƒ½å¤Ÿå°†è‡ªç„¶è¯­è¨€è¡¨è¿°ä¸çŸ¥è¯†å›¾è°±ä¸­çš„å…³ç³»å¯¹é½ï¼ŒåŒæ—¶èƒ½å¤Ÿè·¨è¿‡ç¼ºå¤±çš„ç›´æ¥å…³ç³»è¿›è¡Œæ¨ç†ã€‚","text":"KBQA(Question Answering over Knowlegde Bases) æ—¨åœ¨æ ¹æ®ç»“æ„åŒ–çš„çŸ¥è¯†å›¾è°±å›ç­”è‡ªç„¶è¯­è¨€é—®é¢˜ï¼Œè¯¥ä»»åŠ¡åœ¨ç°ä»£çš„é—®ç­”ç³»ç»Ÿå’Œä¿¡æ¯æ£€ç´¢ç³»ç»Ÿä¸­å¹¿æ³›åº”ç”¨ã€‚ ç”±äºè‡ªç„¶è¯­è¨€é—®é¢˜ä¸çŸ¥è¯†å›¾è°±ä¸­çš„æ¨ç†é“¾çš„ä¸ç›¸å®¹æ€§ï¼Œæœ€è¿‘çš„ KBQA æ–¹æ³•æ›´å…³æ³¨äºå›¾è°±ä¸­çš„é€»è¾‘å…³ç³»ï¼Œå¿½ç•¥äº†å›¾è°±çš„èŠ‚ç‚¹å’Œè¾¹ä¸Šçš„æ–‡æœ¬è¯­ä¹‰ä¿¡æ¯ã€‚åŒæ—¶é¢„è®­ç»ƒæ¨¡å‹è™½ç„¶ä»å¤§è§„æ¨¡çš„è¯­æ–™ä¸­å­¦ä¹ åˆ°äº†å¤§é‡å¼€æ”¾ä¸–ç•ŒçŸ¥è¯†ï¼Œä½†æ˜¯è¿™ç§çŸ¥è¯†æ˜¯éç»“æ„åŒ–çš„ï¼Œä¸ç»“æ„åŒ–çš„çŸ¥è¯†å›¾è°±ä¹‹é—´å­˜åœ¨éš”é˜‚ã€‚ä¸ºè¿æ¥é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ä¸çŸ¥è¯†å›¾è°±ï¼Œä½œè€…æå‡ºäº†ä¸‰ç§å…³ç³»å­¦ä¹ ä»»åŠ¡æ¥è¿›è¡Œå…³ç³»å¢å¼ºè®­ç»ƒã€‚ç»è¿‡è¿™ç§è®­ç»ƒï¼Œæ¨¡å‹èƒ½å¤Ÿå°†è‡ªç„¶è¯­è¨€è¡¨è¿°ä¸çŸ¥è¯†å›¾è°±ä¸­çš„å…³ç³»å¯¹é½ï¼ŒåŒæ—¶èƒ½å¤Ÿè·¨è¿‡ç¼ºå¤±çš„ç›´æ¥å…³ç³»è¿›è¡Œæ¨ç†ã€‚ Introduction ä¼ ç»Ÿçš„ä¿¡æ¯æ£€ç´¢ç³»ç»Ÿé€šå¸¸æ˜¯ä¸€ä¸ª pipeline çš„å½¢å¼ï¼š named entity recongnization entity linking subgraph retrieval entity scoring KBQA ä»»åŠ¡å¯¹è¿™ç§ pipeline ä»ç„¶å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œç‰¹åˆ«æ˜¯é¢å¯¹å¤šè·³åœºæ™¯æ—¶ï¼š ç”±äºäººç±»è¯­è¨€çš„å¤æ‚æ€§ï¼Œé€šå¸¸éš¾ä»¥å°†è‡ªç„¶è¯­è¨€é—®é¢˜ä¸çŸ¥è¯†å›¾è°±ä¸­çš„å…³ç³»å¯¹é½ï¼Œæ¨¡å‹é€šå¸¸æ˜¯æ ¹æ®ä¸€äº› shortcut ç‰¹å¾è€Œä¸æ˜¯æ­£ç¡®çš„æ¨ç†è¿›è¡Œé¢„æµ‹ å®è·µä¸­ï¼ŒçŸ¥è¯†å›¾è°±å¾€å¾€æ˜¯ä¸å®Œæ•´çš„ï¼ŒåŒæ—¶ç¼ºä¹æ˜¾å¼æ¨ç†è®­ç»ƒçš„æ¨¡å‹éš¾ä»¥åœ¨ç¼ºå¤±çš„å…³ç³»ä¸Šæ¨ç† GraftNet, PullNet ç­‰é€šè¿‡å¼•å…¥å¤§é‡é¢å¤–çš„æ–‡æœ¬å¹¶ä½¿ç”¨ç‰¹æ®Šçš„æ¶æ„æ¥èåˆæ–‡æ¡£ä¸­çš„ä¿¡æ¯è§£å†³ä¸Šè¿°é—®é¢˜ EmbedKGQA é€šè¿‡å¼•å…¥é¢„è®­ç»ƒ KB embedding å¹¶è®­ç»ƒé—®é¢˜è¡¨å¾ä»¥é€‚åº”å…³ç³»è¡¨å¾æ¥è§£å†³çŸ¥è¯†å›¾è°±ä¸å®Œæ•´é—®é¢˜ æœ¬æ–‡ä¸­ï¼Œä¸ºäº†è·å¾—ä¸€ä¸ªæ›´å¥½çš„ä»è‡ªç„¶è¯­è¨€é—®é¢˜åˆ°çŸ¥è¯†å›¾è°±ä¸­æ¨ç†è·¯å¾„çš„æ˜ å°„ï¼Œä½œè€…é‡ç»„äº†åŸºäºæ£€ç´¢çš„ KBQA ä»»åŠ¡ï¼Œå°†å…¶å˜æˆé—®é¢˜æ–‡æœ¬åŒ¹é…çš„å½¢å¼ã€‚ ä½œè€…æå‡ºäº†ä¸‰ä¸ªå…³ç³»å­¦ä¹ çš„è¾…åŠ©ä»»åŠ¡ï¼š Relation Extraction, RE: ä»å¥å­ä¸­æ¨æ–­å…³ç³» Relation Matching, RM: åˆ¤æ–­ä¸¤ä¸ªå¥å­æ˜¯å¦è¡¨è¾¾åŒä¸€ä¸ªå…³ç³» Relation Reasoning, RR: è®­ç»ƒæ¨¡å‹åœ¨ç¼ºå¤±çš„å…³ç³»ä¸Šæ¨ç† Approach åŸºäºæ£€ç´¢çš„ KBQA ç»™å®šä¸€ä¸ªè¾“å…¥é—®é¢˜ qqq, é¦–å…ˆæ ‡è®° qqq ä¸­çš„å‘½åå®ä½“ï¼Œç„¶åå°†å…¶ä¸çŸ¥è¯†å›¾è°±ä¸­çš„èŠ‚ç‚¹è¿æ¥ï¼Œéšåä½¿ç”¨ä¸€äº›å¯å‘å¼ç®—æ³•(å¦‚ pagerank)ä»çŸ¥è¯†å›¾è°±ä¸­æ£€ç´¢å‡ºä¸€ä¸ªç‰¹å®šäº qqq çš„å­å›¾ G={&lt;e,r,eâ€²&gt;âˆ£e,eâ€²âˆˆE,râˆˆR}\\mathcal{G} = \\{&lt;e, r, e&#x27;&gt; | e, e&#x27; \\in \\mathcal{E}, r\\in\\mathcal{R}\\}G={&lt;e,r,eâ€²&gt;âˆ£e,eâ€²âˆˆE,râˆˆR}, å…¶ä¸­ E\\mathcal{E}E æ˜¯é—®é¢˜ qqq çš„å€™é€‰ç­”æ¡ˆå®ä½“çš„é›†åˆï¼ŒR\\mathcal{R}R æ˜¯å…³ç³»çš„é›†åˆã€‚è¯¥ä»»åŠ¡å³ä¸ºæ¯ä¸ªå€™é€‰ç­”æ¡ˆå®ä½“ eiâˆˆEe_i\\in \\mathcal{E}eiâ€‹âˆˆE è®¡ç®—ä¸€ä¸ªåˆ†æ•° sis_isiâ€‹ æ ‡ç¤ºè¯¥å®ä½“æ˜¯å¦æ˜¯ç­”æ¡ˆå®ä½“ã€‚ BERT for KBQA å¯¹äºæ¯ä¸€ä¸ªé—®é¢˜ qqq, ä½œè€…é¦–å…ˆåˆ©ç”¨ entity linking ç»“æœæ‰¾å‡º qqq åœ¨çŸ¥è¯†å›¾è°±ä¸­çš„ ä¸»é¢˜å®ä½“ etopice_\\text{topic}etopicâ€‹ï¼Œéšåï¼Œä½œè€…é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°†é—®é¢˜è½¬åŒ–ä¸ºæ–‡æœ¬åŒ¹é…é—®é¢˜ï¼š æ‰¾å‡º G\\mathcal{G}G ä¸­æ‰€æœ‰è¿æ¥äº† etopice_\\text{topic}etopicâ€‹ å’Œå€™é€‰ç­”æ¡ˆå®ä½“ eie_ieiâ€‹ çš„è·¯å¾„ï¼ŒæŸ¥æ‰¾æ—¶è®¾ç½®ä¸€ä¸ªè·¯å¾„æ•°çš„æœ€å¤§å€¼ä»¥ä¿è¯å¯è®¡ç®—æ€§ é€šè¿‡å°†è·¯å¾„ä¸­çš„èŠ‚ç‚¹æ›¿æ¢æˆå®ä½“åç§°ï¼Œè¾¹æ›¿æ¢ä¸ºå…³ç³»åç§°ï¼Œå°†è·¯å¾„ é‡ç»„ä¸ºæ–‡æœ¬å½¢å¼ é€šè¿‡å°†é—®é¢˜æ–‡æœ¬å’Œé‡ç»„åçš„è·¯å¾„æ–‡æœ¬ p1,p2,...,pnp_1, p_2, ..., p_np1â€‹,p2â€‹,...,pnâ€‹ æ‹¼æ¥ï¼Œè·å–BERTçš„è¾“å…¥æ ·æœ¬ï¼šxi=[CLS]q[SEP]p1[SEP]...pn[SEP].x_i = \\text{[CLS]}q\\text{[SEP]}p_1\\text{[SEP]}...p_n\\text{[SEP]}.xiâ€‹=[CLS]q[SEP]p1â€‹[SEP]...pnâ€‹[SEP]. å°† xix_ixiâ€‹ é€å…¥ BERTï¼Œå–æœ€ç»ˆè¾“å‡ºä¸­ [CLS]\\text{[CLS]}[CLS] çš„è¡¨å¾åšäºŒåˆ†ç±»ï¼Œä»£è¡¨äº†è¯¥å€™é€‰å®ä½“ eie_ieiâ€‹ æ˜¯å¦æ˜¯é—®é¢˜ qqq çš„ç­”æ¡ˆ è¯¥è¿‡ç¨‹ä¸­ï¼Œç›¸å½“äºå°†çŸ¥è¯†å›¾è°±ä¸­æ‰€æœ‰ etopice_\\text{topic}etopicâ€‹ å’Œ eie_ieiâ€‹ ä¹‹é—´çš„è·¯å¾„ä½œä¸ºé—®é¢˜ qqq çš„æ”¯æ’‘äº‹å®ï¼Œå¹¶ä½¿ç”¨ BERT æ¨æ–­ â€œeie_ieiâ€‹ æ˜¯é—®é¢˜ qqq çš„ç­”æ¡ˆâ€ è¿™ä¸€å‡è®¾åœ¨æ”¯æ’‘äº‹å®æ¡ä»¶ä¸‹æ˜¯å¦æˆç«‹ã€‚ äºŒåˆ†ç±»æŸå¤±å‡½æ•°è®¡ç®—è¿‡ç¨‹ï¼š si=Ïƒ(Ï‰TBERTCLS(xi))Li=âˆ’(yâ‹…logâ¡si+(1âˆ’y)â‹…logâ¡(1âˆ’si))\\begin{aligned} s_i &amp;= \\sigma(\\mathbf{\\omega}^T \\text{BERT}_\\text{CLS}(x_i))\\\\ \\mathcal{L}_i &amp;= -(y\\cdot\\log s_i + (1-y)\\cdot\\log(1-s_i)) \\end{aligned}siâ€‹Liâ€‹â€‹=Ïƒ(Ï‰TBERTCLSâ€‹(xiâ€‹))=âˆ’(yâ‹…logsiâ€‹+(1âˆ’y)â‹…log(1âˆ’siâ€‹))â€‹ å…¶ä¸­ Ïƒ\\sigmaÏƒ ä»£è¡¨ sigmoid å‡½æ•°ï¼Œyyy æ˜¯ ground truthï¼Œä»£è¡¨ eie_ieiâ€‹ å®é™…ä¸Šæ˜¯å¦æ˜¯é—®é¢˜ qqq çš„ç­”æ¡ˆã€‚ å‰¯ä»»åŠ¡ Relation Extraction (RE) 1-hop: ç›´æ¥ä½¿ç”¨ relation extraction æ•°æ®é›†ï¼Œè®­ç»ƒæ¨¡å‹ä»ç»™å®šçš„è¯­å¥ä¸­æŠ½å–å¤´å°¾å®ä½“ä¹‹é—´çš„å…³ç³»ã€‚åœ¨å®è·µæ–¹é¢ï¼Œä½œè€…æ„å»ºBERTçš„è¾“å…¥æ ¼å¼ï¼š[CLS]s[SEP]h,r,t[SEP]\\text{[CLS]}s\\text{[SEP]}h, r, t\\text{[SEP]}[CLS]s[SEP]h,r,t[SEP], å…¶ä¸­ s,h,r,ts, h, r, ts,h,r,t åˆ†åˆ«è¡¨ç¤ºå¥å­ï¼Œå¤´å®ä½“ï¼Œå…³ç³»å’Œå°¾å®ä½“ 2-hop: é€‰å–2ä¸ª1-hopçš„æ ·æœ¬ç»„åˆæˆ2-hopæ ·æœ¬ï¼š[CLS]s1,s2[SEP]h1,r1,t1(h2),r2,t2[SEP]\\text{[CLS]}s_1, s_2\\text{[SEP]}h_1, r_1, t_1(h_2), r_2, t_2\\text{[SEP]}[CLS]s1â€‹,s2â€‹[SEP]h1â€‹,r1â€‹,t1â€‹(h2â€‹),r2â€‹,t2â€‹[SEP], å…¶ä¸­ç¬¬ä¸€ä¸ª1-hopæ ·æœ¬çš„å°¾å®ä½“å³æ˜¯ç¬¬äºŒä¸ª1-hopæ ·æœ¬çš„å¤´å®ä½“ Relation Matching (RM) ä½œè€…å‡è®¾ï¼šè¡¨è¾¾ç›¸åŒå…³ç³»çš„ä¸¤ä¸ªå¥å­åº”è¯¥æœ‰ç›¸ä¼¼çš„è¡¨å¾ã€‚å› æ­¤åˆ©ç”¨BERTé¢„æµ‹ä¸¤ä¸ªå¥å­æ˜¯å¦è¡¨è¾¾ç›¸åŒçš„å…³ç³»ï¼Œè¾“å…¥æ ·æœ¬æ ¼å¼ï¼š[CLS]s1[SEP]s2[SEP]\\text{[CLS]}s_1\\text{[SEP]}s_2\\text{[SEP]}[CLS]s1â€‹[SEP]s2â€‹[SEP] Relation Reasoning (RR) BERTRL æå‡ºä¸€ç§è‡ªè®­ç»ƒæ¨¡å¼ï¼Œç”¨äº KB è¡¥å…¨ä»»åŠ¡ã€‚ä»–ä»¬éšæœºä» KB ä¸­é€‰å–ä¸€ä¸ªä¸‰å…ƒç»„ (h,r,t)(h, r, t)(h,r,t) å¹¶å‡è®¾å…¶æ˜¯ç¼ºå¤±çš„ï¼Œç„¶åé€‰æ‹©ä» hhh åˆ° ttt çš„å…¶ä»–å¤šè·³è¿æ¥ï¼Œç„¶åä½¿ç”¨ BERT æ ¹æ®è¿™äº›å¤šè·³è¿æ¥é¢„æµ‹ (h,r,t)(h, r, t)(h,r,t) æ˜¯å¦å­˜åœ¨ã€‚ è¾“å…¥æ ·æœ¬æ ¼å¼ï¼š[CLS]h,r,t[SEP]p1[SEP]...pn[SEP]\\text{[CLS]}h, r, t\\text{[SEP]}p_1\\text{[SEP]}...p_n\\text{[SEP]}[CLS]h,r,t[SEP]p1â€‹[SEP]...pnâ€‹[SEP] æ³¨æ„åˆ°ä»¥ä¸Šä¸‰ç§è¾…åŠ©ä»»åŠ¡éƒ½è¢«ç»„ç»‡æˆäº†äºŒåˆ†ç±»ä»»åŠ¡ï¼Œä¸”åªåœ¨è¾“å…¥æ•°æ®çš„ç»„ç»‡å½¢å¼ä¸Šåšäº†æ”¹å˜ï¼Œå› æ­¤å¯ä»¥åº”ç”¨åœ¨ KBQA ä»»åŠ¡ä¹‹å‰çš„é¢„è®­ç»ƒè¿‡ç¨‹æˆ–è€…åœ¨å¾®è°ƒè¿‡ç¨‹ä¸­ä¸ KBQA ä»»åŠ¡è”åˆè®­ç»ƒã€‚ Experiments Dataset KBQA Dataset: åˆ©ç”¨ WebQSP æ•°æ®é›†ï¼Œä½¿ç”¨Sun et al.çš„è„šæœ¬è¿›è¡Œå¤„ç†ï¼Œè¯¥è„šæœ¬ä¸»è¦å¯¹ WebQSP åš entity linking å’Œ subgraph retrievalï¼ŒåŒæ—¶ entity linking çš„ç»“æœç›´æ¥ä½¿ç”¨ Yih et al. çš„ã€‚ å¯¹äºæ¯ä¸ªé—®é¢˜ï¼Œéƒ½æœ‰ä¸€äº›ç”¨äºå­å›¾æ£€ç´¢çš„ç§å­å®ä½“ã€‚å­å›¾æ£€ç´¢è¿‡ç¨‹ä½¿ç”¨ Personalized PageRank ç®—æ³•ã€‚ Relation Extraction Dataset: å¯¹äºå…³ç³»å­¦ä¹ ä»»åŠ¡ï¼Œä½œè€…ä½¿ç”¨ WebRED å’Œ FewRel ä½œä¸ºé¢å¤–èµ„æº Baselines KV-Mem GraftNet PullNet EmbedKGQA NSM BERT Metrics Hits@1: å¦‚æœæ¨¡å‹ç»™å‡ºçš„å¾—åˆ†æœ€é«˜çš„ç»“æœå°±æ˜¯ç­”æ¡ˆï¼Œåˆ™ Hits@1 æ˜¯1ï¼Œå¦åˆ™æ˜¯0 F1: ç»™å®šä¸€ä¸ªé˜ˆå€¼ï¼Œå¹¶è®¤ä¸ºæ¨¡å‹è¾“å‡ºç»“æœä¸­å¾—åˆ†é«˜äºé˜ˆå€¼çš„éƒ½æ˜¯ç­”æ¡ˆï¼Œç„¶åè®¡ç®—æ¨¡å‹è¾“å‡ºçš„ç­”æ¡ˆå’ŒGTç­”æ¡ˆä¹‹é—´çš„ F1 F1 æŒ‡æ ‡å¯¹é˜ˆå€¼çš„é€‰æ‹©å¾ˆæ•æ„Ÿï¼Œå®éªŒä¸­é€‰å– Hits@1 ä½œä¸ºä¸»æŒ‡æ ‡","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"Knowledge Graph","slug":"Knowledge-Graph","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Graph/"},{"name":"QA","slug":"QA","permalink":"https://blog.zhuwenq.cc/tags/QA/"}],"author":["Yuanmeng Yan","Rumei Li","Sirui Wang","Hongzhi Zhang","Daoguang Zan","Fuzheng Zhang","Wei Wu","Weiran Xu"]},{"title":"Improving Multi-hop Question Answering over Knowledge Graphs using Knowledge Base Embeddings","slug":"Improving-Multi-hop-Question-Answering-over-Knowledge-Graphs-using-Knowledge-Base-Embeddings","date":"2022-01-07T16:00:00.000Z","updated":"2023-06-21T06:51:28.792Z","comments":true,"path":"Improving-Multi-hop-Question-Answering-over-Knowledge-Graphs-using-Knowledge-Base-Embeddings/","link":"","permalink":"https://blog.zhuwenq.cc/Improving-Multi-hop-Question-Answering-over-Knowledge-Graphs-using-Knowledge-Base-Embeddings/","excerpt":"Multi-hop KGQA è¦æ±‚è·¨è¶Š Knowledge Graph, KG çš„å¤šä¸ªè¾¹è¿›è¡Œæ¨ç†ï¼Œè€Œä¸” KG å¾€å¾€æ˜¯ä¸å®Œæ•´çš„ï¼Œä½¿ KGQA æ›´å…·æŒ‘æˆ˜æ€§ã€‚æœ€è¿‘çš„ç ”ç©¶æœ‰äº›ä½¿ç”¨é¢å¤–çš„ç›¸å…³é¢†åŸŸçš„è¯­æ–™è§£å†³ KG çš„ç¨€ç–æ€§é—®é¢˜ï¼Œä½†æ˜¯é¢å¤–çš„è¯­æ–™æ˜¯å¦å¯è·å–ï¼Œä»¥åŠç›¸å…³æ€§å¦‚ä½•åˆ¤åˆ«éƒ½æ˜¯é—®é¢˜ã€‚KG embedding ä½œä¸ºå¦ä¸€ä¸ªç ”ç©¶æ–¹å‘ï¼Œè¢«ç”¨äºç¼ºå¤±è¿æ¥é¢„æµ‹ä»¥åŠ KG è¡¥å…¨ï¼Œä½†æ˜¯æ²¡æœ‰è¢«ç›´æ¥ç”¨äº Multi-hop KGQA é—®é¢˜ã€‚æœ¬æ–‡ä½œè€…æå‡º EmbedKGQAï¼Œä½¿ç”¨ KG embedding ä»¥åŠ Question embedding è§£å†³ KGQA é—®é¢˜ã€‚","text":"Multi-hop KGQA è¦æ±‚è·¨è¶Š Knowledge Graph, KG çš„å¤šä¸ªè¾¹è¿›è¡Œæ¨ç†ï¼Œè€Œä¸” KG å¾€å¾€æ˜¯ä¸å®Œæ•´çš„ï¼Œä½¿ KGQA æ›´å…·æŒ‘æˆ˜æ€§ã€‚æœ€è¿‘çš„ç ”ç©¶æœ‰äº›ä½¿ç”¨é¢å¤–çš„ç›¸å…³é¢†åŸŸçš„è¯­æ–™è§£å†³ KG çš„ç¨€ç–æ€§é—®é¢˜ï¼Œä½†æ˜¯é¢å¤–çš„è¯­æ–™æ˜¯å¦å¯è·å–ï¼Œä»¥åŠç›¸å…³æ€§å¦‚ä½•åˆ¤åˆ«éƒ½æ˜¯é—®é¢˜ã€‚KG embedding ä½œä¸ºå¦ä¸€ä¸ªç ”ç©¶æ–¹å‘ï¼Œè¢«ç”¨äºç¼ºå¤±è¿æ¥é¢„æµ‹ä»¥åŠ KG è¡¥å…¨ï¼Œä½†æ˜¯æ²¡æœ‰è¢«ç›´æ¥ç”¨äº Multi-hop KGQA é—®é¢˜ã€‚æœ¬æ–‡ä½œè€…æå‡º EmbedKGQAï¼Œä½¿ç”¨ KG embedding ä»¥åŠ Question embedding è§£å†³ KGQA é—®é¢˜ã€‚ Introduction å¯¹äº multi-hop KGQA é—®é¢˜ï¼Œä¸»è¦æŒ‘æˆ˜åœ¨äºï¼š ç³»ç»Ÿéœ€è¦åœ¨ KG çš„å¤šæ¡è¾¹ä¸Šè¿›è¡Œæ¨ç† KG å¾€å¾€æ˜¯ä¸å®Œæ•´çš„ ä¸ºè§£å†³ KG çš„ç¨€ç–æ€§ï¼ŒSun et al.[1][2] åˆ©ç”¨é¢å¤–çš„ç›¸å…³é¢†åŸŸæ–‡æœ¬è¯­æ–™æ¥åº”å¯¹ã€‚å…¶ä¸­ Sun et al. æå‡ºçš„ PullNet[1:1] ä» KG ä¸­æ„å»ºä¸€ä¸ªä¸é—®é¢˜ç›¸å…³çš„å­å›¾ï¼Œç„¶ååˆ©ç”¨é¢å¤–çš„æ–‡æ¡£å¯¹å…¶è¿›è¡Œå¢å¼ºï¼Œéšååœ¨å¢å¼ºåçš„å­å›¾ä¸Šä½¿ç”¨å›¾å·ç§¯ç¥ç»ç½‘ç»œè®¡ç®—æœ€ç»ˆç­”æ¡ˆã€‚è¿™ç§æ–¹æ³•ä¸ä»…å­˜åœ¨ç›¸å…³çš„é¢å¤–çš„æ–‡æœ¬è¯­æ–™çš„è·å–é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦ä¸€ä¸ªé¢„å®šä¹‰çš„é‚»åŸŸèŒƒå›´ç”¨äºå­å›¾çš„å¬å›ã€‚ å¦ä¸€ä¸ªæ–¹å‘ä¸Šï¼ŒBordes et al.[3], Trouillon et al.[4], Yang et al.[5] å’Œ Nickel et al.[6] ä½¿ç”¨ KG embedding çš„æ–¹æ³•ä¸º KG ä¸­çš„å®ä½“å’Œå…³ç³»å­¦ä¹ é«˜ç»´åµŒå…¥ï¼Œç„¶åå°†å…¶ç”¨äºè¿æ¥é¢„æµ‹ä»¥åŠå›¾è°±è¡¥å…¨ã€‚ Related Work KGQA: TransE[3:1] ç­‰ç”¨äºå•è·³åœºæ™¯ Yih et al.[7] å’Œ Bao et al., 2016[8] ç­‰æå‡ºä» KG ä¸­æŠ½å–ä¸€ä¸ªç‰¹å®šäºé—®é¢˜çš„å­å›¾æ¥å›ç­”é—®é¢˜ Bordes et al., 2014a[9] æå‡ºçš„æ–¹æ³•å°†æŠ½å–å‡ºçš„å…³äºå¤´å®ä½“çš„å­å›¾ç¼–ç åˆ°é«˜ç»´ç©ºé—´ç”¨äºQAä»»åŠ¡ Bordes et al., 2015[10] æå‡ºä½¿ç”¨ Memory Network ä¸ºçŸ¥è¯†å›¾è°±ä¸­å‡ºç°çš„äº‹å®è®­ç»ƒè¡¨å¾ç”¨äºQA Bordes et al., 2014b[11] è®­ç»ƒä¸€ä¸ªé—®é¢˜ä¸ä¸‰å…ƒç»„çš„ç›¸ä¼¼åº¦å‡½æ•°ï¼Œç„¶ååœ¨æµ‹è¯•æ—¶ä¸ºé—®é¢˜å’Œå€™é€‰ä¸‰å…ƒç»„è®¡ç®—ç›¸ä¼¼åº¦åˆ†æ•° Yang et al., 2014b å’Œ Yang et al., 2015 åˆ©ç”¨åµŒå…¥çš„æ–¹æ³•å°†è‡ªç„¶è¯­è¨€é—®é¢˜è½¬æ¢ä¸ºé€»è¾‘å½¢å¼ KG embedding: Bordes et al. æå‡ºçš„ TransE[3:2]ï¼Œå°†çŸ¥è¯†å›¾è°±åµŒå…¥åˆ°é«˜ç»´å®ç©ºé—´ï¼Œå°†å…³ç³»çœ‹ä½œæ˜¯å¤´å®ä½“å’Œå°¾å®ä½“ä¹‹é—´çš„ translation Sun et al. æå‡ºçš„ RotatE[12]ï¼Œå°†çŸ¥è¯†å›¾è°±ä¸­çš„å®ä½“åµŒå…¥åˆ°å¤ç©ºé—´ï¼Œå¹¶å°†å…³ç³»çœ‹ä½œæ˜¯å¤ç©ºé—´ä¹‹é—´çš„ rotate Background KG ç»™å®šå®ä½“é›†åˆ E\\mathcal{E}E å’Œå…³ç³»é›†åˆ R\\mathcal{R}R, çŸ¥è¯†å›¾è°± G\\mathcal{G}G å®šä¹‰ä¸ºä¸‰å…ƒç»„çš„é›†åˆ KâŠ†EÃ—RÃ—E\\mathcal{K}\\subseteq\\mathcal{E}\\times\\mathcal{R}\\times\\mathcal{E}KâŠ†EÃ—RÃ—E. å…¶ä¸­æ¯ä¸ªä¸‰å…ƒç»„è®°ä½œ (h,r,t)(h, r, t)(h,r,t), h,th, th,t åˆ†åˆ«ä»£è¡¨å¤´å®ä½“å’Œå°¾å®ä½“ï¼Œrrr ä»£è¡¨å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚ Link Prediction ç»™å®šä¸€ä¸ªä¸å®Œæ•´çš„ KG, Link Predition çš„ä»»åŠ¡æ˜¯é¢„æµ‹ç¼ºå¤±çš„è¿æ¥ã€‚KG Embedding æ¨¡å‹é€šè¿‡ä¸€ä¸ªè¯„åˆ†å‡½æ•° Ï•\\phiÏ• ä¸ºä¸‰å…ƒç»„è¯„åˆ† s=Ï•(h,r,t)s=\\phi(h, r, t)s=Ï•(h,r,t) æŒ‡ç¤ºè¯¥è¿æ¥æ˜¯å¦å­˜åœ¨ã€‚ KG Embedding å¯¹äº eâˆˆEe\\in\\mathcal{E}eâˆˆE å’Œ râˆˆRr\\in\\mathcal{R}râˆˆR, KG Embedding ä¸ºå…¶ç”Ÿæˆä¸€ä¸ªåµŒå…¥å‘é‡ eeâˆˆRde,erâˆˆRdre_e\\in \\mathbb{R}^{d_e}, e_r\\in\\mathbb{R}^{d_r}eeâ€‹âˆˆRdeâ€‹,erâ€‹âˆˆRdrâ€‹. åµŒå…¥é€šå¸¸é€šè¿‡å¯¹æ¯”å­¦ä¹ çš„æ–¹æ³•è®­ç»ƒï¼Œå³é‡‡ç”¨ä¸€ä¸ª (eh,er,et)(e_h, e_r, e_t)(ehâ€‹,erâ€‹,etâ€‹) çš„è¯„åˆ†å‡½æ•° Ï•\\phiÏ•, è®­ç»ƒæ¨¡å‹ä¸ºä¸‰å…ƒç»„ (h,r,t)(h, r, t)(h,r,t) ç”ŸæˆåµŒå…¥ã€‚ä½¿å¾—å¯¹äº (h,r,t)âˆˆK(h, r, t) \\in \\mathcal{K}(h,r,t)âˆˆK, Ï•(eh,er,et)&gt;0\\phi(e_h, e_r, e_t) &gt; 0Ï•(ehâ€‹,erâ€‹,etâ€‹)&gt;0; å¯¹äº (hâ€²,râ€²,tâ€²)âˆ‰K(h&#x27;, r&#x27;, t&#x27;) \\notin \\mathcal{K}(hâ€²,râ€²,tâ€²)âˆˆ/K, Ï•(ehâ€²,erâ€²,etâ€²)&lt;0\\phi(e_{h&#x27;}, e_{r&#x27;}, e_{t&#x27;}) &lt; 0Ï•(ehâ€²â€‹,erâ€²â€‹,etâ€²â€‹)&lt;0. ComplEx Embedding ComplEx[4:1] æ˜¯ä¸€ç§é€šè¿‡å¼ é‡åˆ†è§£æ¥åµŒå…¥å®ä½“å’Œå…³ç³»åˆ°å¤ç©ºé—´çš„æ–¹æ³•ã€‚å¯¹äº h,tâˆˆEh, t\\in\\mathcal{E}h,tâˆˆE å’Œ râˆˆRr\\in \\mathcal{R}râˆˆR, ComplEx ç”ŸæˆåµŒå…¥ eh,hr,htâˆˆCde_h, h_r, h_t \\in \\mathbb{C}^dehâ€‹,hrâ€‹,htâ€‹âˆˆCd, å¹¶ä¸”å®šä¹‰è¯„åˆ†å‡½æ•°ä¸ºï¼š Ï•(h,r,t)=Re(âŸ¨eh,er,etâŸ©)=Re(âˆ‘k=1deh(k)er(k)et(k))\\begin{aligned} \\phi(h, r, t) &amp;= \\text{Re}(\\langle e_h, e_r, e_t\\rangle)\\\\ &amp;=\\text{Re}(\\sum_{k=1}^{d}e_h^{(k)}e_r^{(k)}e_t^{(k)}) \\end{aligned}Ï•(h,r,t)â€‹=Re(âŸ¨ehâ€‹,erâ€‹,etâ€‹âŸ©)=Re(k=1âˆ‘dâ€‹eh(k)â€‹er(k)â€‹et(k)â€‹)â€‹ ä½¿å¾—å¯¹äºä¸‰å…ƒç»„æ­£ä¾‹è¯„åˆ†å¤§äº0ï¼Œè´Ÿä¾‹è¯„åˆ†å°äº0. EmbedKGQA KGQA: ç»™å®šä¸€ä¸ªè‡ªç„¶è¯­è¨€é—®é¢˜ qqq å’Œä¸€ä¸ªé—®é¢˜ä¸­å‡ºç°çš„ä¸»é¢˜å®ä½“ ehe_hehâ€‹, KGQA çš„ä»»åŠ¡æ˜¯ä» KG ä¸­æŠ½å–å‡ºé—®é¢˜ qqq æŒ‡å‘çš„é‚£ä¸ªå®ä½“ ete_tetâ€‹ ä½œè€…æå‡ºçš„ EmbedKGQA æ¨¡å‹åŒ…å«ä¸‰ä¸ªæ¨¡å—ï¼š KG Embedding æ¨¡å—ï¼Œä¸º KG ä¸­æ‰€æœ‰å®ä½“åˆ›å»º embedding Question Embedding æ¨¡å—ï¼Œä¸ºè‡ªç„¶è¯­è¨€é—®é¢˜åˆ›å»º embedding Answer Selection æ¨¡å—ï¼Œç¼©å°å¤‡é€‰ç­”æ¡ˆçš„èŒƒå›´å¹¶é€‰æ‹©æœ€ç»ˆç­”æ¡ˆ KG Embedding æ¨¡å— KG Embedding ç›´æ¥ä½¿ç”¨ ComplEx Embedding æ–¹æ³•ï¼Œæ ¹æ®è®­ç»ƒé›†ä¸­å®ä½“å¯¹ KG çš„è¦†ç›–ç¨‹åº¦ï¼Œè®­ç»ƒå‡ºçš„ embedding å¯ä»¥é€‰æ‹©ä¿æŒä¸å˜æˆ–è€…åœ¨åç»­æ­¥éª¤ä¸­å¾®è°ƒã€‚ Question Embedding æ¨¡å— è¯¥æ¨¡å—å°†è‡ªç„¶è¯­è¨€é—®é¢˜ qqq åµŒå…¥åˆ°å¤å‘é‡ç©ºé—´ Cd\\mathbb{C}^dCd. è¿™ä¸ªè¿‡ç¨‹é¦–å…ˆä½¿ç”¨ä¸€ä¸ªé¢„è®­ç»ƒçš„ RoBERTa å°† qqq ç¼–ç ä¸º 768 ç»´çš„å‘é‡ï¼Œç„¶åä½¿å…¶é€šè¿‡å››å±‚å¸¦æœ‰ ReLU æ¿€æ´»å‡½æ•°çš„çº¿æ€§å…¨è¿æ¥å±‚ï¼Œæœ€ç»ˆæŠ•å½±åˆ° Cd\\mathbb{C}^dCd. Question Embedding çš„è®­ç»ƒè¿‡ç¨‹åŒæ ·é‡‡ç”¨ ComplEx Embeddingï¼Œå¯¹äºè‡ªç„¶è¯­è¨€é—®é¢˜ qqqï¼Œä¸»é¢˜å®ä½“ hâˆˆEh\\in\\mathcal{E}hâˆˆE å’Œç­”æ¡ˆé›†åˆ AâŠ†E\\mathcal{A}\\subseteq\\mathcal{E}AâŠ†E, QE çš„è®­ç»ƒå³ä½¿å¾—ï¼š Ï•(eh,eq,ea)&gt;0 âˆ€aâˆˆAÏ•(eh,eq,eaâ€¾)&lt;0 âˆ€aâ€¾âˆ‰A\\begin{aligned} \\phi(e_h, e_q, e_a) &gt; 0 &amp;\\ \\ \\forall a \\in \\mathcal{A}\\\\ \\phi(e_h, e_q, e_{\\overline{a}}) &lt; 0 &amp;\\ \\ \\forall \\overline{a} \\notin \\mathcal{A} \\end{aligned}Ï•(ehâ€‹,eqâ€‹,eaâ€‹)&gt;0Ï•(ehâ€‹,eqâ€‹,eaâ€‹)&lt;0â€‹ âˆ€aâˆˆA âˆ€aâˆˆ/Aâ€‹ Answer Selection æ¨¡å— åœ¨æ¨ç†æ—¶ï¼Œæ¨¡å‹ä¸º (h,q)(h, q)(h,q) å¯¹ä¸æ‰€æœ‰çš„å€™é€‰ç­”æ¡ˆ aâ€²âˆˆEa&#x27;\\in \\mathcal{E}aâ€²âˆˆE ç»„æˆçš„ä¸‰å…ƒç»„è¯„åˆ†ã€‚å¯¹äºç›¸å¯¹è¾ƒå°çš„ KGï¼Œç›´æ¥é€‰å‡ºè¯„åˆ†æœ€é«˜çš„å®ä½“ä½œä¸ºç­”æ¡ˆï¼š eans=arg maxâ¡aâ€²âˆˆEÏ•(eh,eq,eaâ€²)e_{ans} = \\argmax_{a&#x27;\\in\\mathcal{E}}\\phi(e_h, e_q, e_{a&#x27;}) eansâ€‹=aâ€²âˆˆEargmaxâ€‹Ï•(ehâ€‹,eqâ€‹,eaâ€²â€‹) ä½†æ˜¯å½“ KG å¾ˆå¤§æ—¶ï¼Œé€‚å½“ä¿®å‰ªå€™é€‰ç­”æ¡ˆé›†åˆå°†ä¼šæ˜¾è‘—æå‡æ€§èƒ½ã€‚ Relation Matching ä¸ PullNet[1:2] ç±»ä¼¼ï¼Œä½œè€…é€šè¿‡ä¸€ä¸ªè¯„åˆ†å‡½æ•° S(r,q)S(r, q)S(r,q) æ¥æ ¹æ®è‡ªç„¶è¯­è¨€é—®é¢˜ qqq æ’åºå…³ç³» râˆˆRr\\in \\mathcal{R}râˆˆR. è®° hrh_rhrâ€‹ ä¸ºå…³ç³» rrr çš„åµŒå…¥ï¼Œqâ€²=(&lt;s&gt;,w1,...,wâˆ£qâˆ£,&lt;/s&gt;)q&#x27;=(&lt;s&gt;, w_1, ..., w_{|q|}, &lt;/s&gt;)qâ€²=(&lt;s&gt;,w1â€‹,...,wâˆ£qâˆ£â€‹,&lt;/s&gt;) ä¸ºé—®é¢˜ qqq è¾“å…¥ RoBERTa çš„åºåˆ—ï¼Œåˆ™è¯„åˆ†å‡½æ•°å®šä¹‰ä¸º RoBERTa çš„æœ€ç»ˆéšè—å±‚è¾“å‡ºå’Œ hrh_rhrâ€‹ çš„ç‚¹ç§¯å†ç»è¿‡ sigmoid å‡½æ•°ï¼š hq=RoBERTa(qâ€²)S(r,q)=sigmoid(hqThr)\\begin{aligned} h_q = \\text{RoBERTa}(q&#x27;)\\\\ S(r, q) = \\text{sigmoid}(h_q^Th_r) \\end{aligned}hqâ€‹=RoBERTa(qâ€²)S(r,q)=sigmoid(hqTâ€‹hrâ€‹)â€‹ åœ¨æ‰€æœ‰å…³ç³»ä¸­ï¼Œé€‰æ‹©ä½¿å¾—ä¸Šè¿°è¯„åˆ†å‡½æ•°å¤§äº0.5çš„éƒ¨åˆ†è®°ä½œ Ra\\mathcal{R}_aRaâ€‹, å¯¹äºæ¯ä¸ªå€™é€‰ç­”æ¡ˆå®ä½“ aâ€²âˆˆEa&#x27;\\in \\mathcal{E}aâ€²âˆˆEï¼Œæ‰¾åˆ°ä» hhh åˆ° aâ€²a&#x27;aâ€² çš„æœ€çŸ­è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„ç”±å…³ç³»æ„æˆï¼Œå°†è·¯å¾„ä¸Šçš„å…³ç³»è®°ä½œ Raâ€²\\mathcal{R}_{a&#x27;}Raâ€²â€‹, åˆ™å€™é€‰å®ä½“ aâ€²a&#x27;aâ€² çš„ relation score å®šä¹‰ä¸º Ra\\mathcal{R}_aRaâ€‹ ä¸ Raâ€²\\mathcal{R}_{a&#x27;}Raâ€²â€‹ çš„äº¤é›†å¤§å°ï¼šRelScoreaâ€²=âˆ£Raâˆ©Raâ€²âˆ£\\text{RelScore}_{a&#x27;} = |\\mathcal{R}_a\\cap\\mathcal{R}_{a&#x27;}|RelScoreaâ€²â€‹=âˆ£Raâ€‹âˆ©Raâ€²â€‹âˆ£ æœ€ç»ˆä½¿ç”¨ relation score å’Œ ComplEx score çš„çº¿æ€§ç»„åˆå¯»æ‰¾ç­”æ¡ˆï¼š eans=arg maxâ¡aâ€²âˆˆNhÏ•(eh,eq,eaâ€²)+Î³âˆ—RelScoreaâ€²e_{ans} = \\argmax_{a&#x27;\\in\\mathcal{N}_h}\\phi(e_h, e_q, e_{a&#x27;}) + \\gamma*\\text{RelScore}_{a&#x27;} eansâ€‹=aâ€²âˆˆNhâ€‹argmaxâ€‹Ï•(ehâ€‹,eqâ€‹,eaâ€²â€‹)+Î³âˆ—RelScoreaâ€²â€‹ Pullnet: Open domain question answering with iterative retrieval on Knowledge bases and text. Haitian Sun, Tania Bedrax-Weiss, William W Cohen. arXiv: 1904.09537 â†©ï¸ â†©ï¸ â†©ï¸ Open domain question answering using early fusion of knowledge bases and text. Haitian Sun, Bhuwan Dhingra, Manzil Zaheer, Kathryn Mazaitis, Ruslan Salakhutdinov, William W Cohen. arXiv: 1809.00782 â†©ï¸ Translating embeddings for modeling multi-relational data. Antoine Bordes, Nicolas Usunier, Alberto Garcia-Duran, Jason Weston, Oksana Yakhnenko. NIPS 2013 â†©ï¸ â†©ï¸ â†©ï¸ Complex embeddings for simple link prediction. Theo Trouillon, Johannes Welbl, Sebastian Riedel, Eric Gaussier, Guillaume Bouchard. ICML 2016 â†©ï¸ â†©ï¸ Embedding entities and relations for learning and inference in knowledge bases. Bishan Yang, Wen-tau Yih, Xiaodong He, Jianfeng Gao, Li Deng. arXiv: 1412.6575 â†©ï¸ A three-way model for collective learning on multi-relational data. Maximilian Nickel, Volker Tresp, Hans-Peter Kriegel. ICML 2011 â†©ï¸ Semantic parsing via staged query graph generation: Question answering with knowledge base. Scott Wen-tau Yih, Ming-Wei Chang, Xiaodong He, Jianfeng Gao. ACL 2015 â†©ï¸ Constraint-based question answering with knowledge graph. Junwei Bao, Nan Duan, Zhao Yan, Ming Zhou, Tiejun Zhao. COLING 2016 â†©ï¸ Question answering with subgraph embeddings. Antoine Bordes, Sumit Chopra, Jason Weston. arXiv: 1406.3676 â†©ï¸ Large-scale simple question answering with memory networks. Antoine Bordes, Nicolas Usunier, Sumit Chopra, Jason Weston. arXiv: 1506.02075 â†©ï¸ Open question answering with weakly supervised embedding models. Antoine Bordes, Jason Weston, Nicolas Usunier. arXiv: 1404.4326 â†©ï¸ Rotate: Knowledge graph embedding by relational rotation in complex space. Zhiqing Sun, Zhi-Hong Deng, Jian-Yun Nie, Jian Tang. arXiv: 1902.10197 â†©ï¸","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"Knowledge Graph","slug":"Knowledge-Graph","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Graph/"},{"name":"QA","slug":"QA","permalink":"https://blog.zhuwenq.cc/tags/QA/"},{"name":"Embedding","slug":"Embedding","permalink":"https://blog.zhuwenq.cc/tags/Embedding/"}],"author":["Apoorv Saxena","Aditay Tripathi","Partha Talukdar"]},{"title":"Layer Normalization","slug":"LayerNormalization","date":"2021-12-02T16:00:00.000Z","updated":"2023-06-21T06:51:28.828Z","comments":true,"path":"LayerNormalization/","link":"","permalink":"https://blog.zhuwenq.cc/LayerNormalization/","excerpt":"Layer Normalization æ˜¯é’ˆå¯¹ Batch Normalization æå‡ºçš„ï¼Œä¸¤è€…éƒ½æ˜¯æ·±åº¦ç¥ç»ç½‘ç»œä¸­ä¸ºè§£å†³è®­ç»ƒå›°éš¾è€Œæå‡ºçš„å½’ä¸€åŒ–æ‰‹æ®µã€‚","text":"Layer Normalization æ˜¯é’ˆå¯¹ Batch Normalization æå‡ºçš„ï¼Œä¸¤è€…éƒ½æ˜¯æ·±åº¦ç¥ç»ç½‘ç»œä¸­ä¸ºè§£å†³è®­ç»ƒå›°éš¾è€Œæå‡ºçš„å½’ä¸€åŒ–æ‰‹æ®µã€‚ Background å‰é¦ˆç¥ç»ç½‘ç»œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå°†è¾“å…¥ x\\mathbf{x}x æ˜ å°„åˆ°è¾“å‡ºå‘é‡ yyy çš„éçº¿æ€§æ˜ å°„ã€‚å³ä¸‹å¼æ‰€ç¤ºçš„è¿‡ç¨‹ï¼š ail=wilThl,hil+1=f(ail+bil)a_i^{l}={w_i^{l}}^Th^l, h_i^{l+1} = f(a_i^l + b_i^l) ailâ€‹=wilâ€‹Thl,hil+1â€‹=f(ailâ€‹+bilâ€‹) å…¶ä¸­ aila_i^lailâ€‹ æŒ‡ç¬¬ lll å±‚ç¬¬ iii ä¸ªéšè—å•å…ƒçš„è¡¨å¾è¾“å‡ºï¼Œwilw_i^lwilâ€‹ æŒ‡ç¬¬ lll å±‚ä¸­ç¬¬ iii ä¸ªéšè—å•å…ƒçš„æƒé‡ï¼Œhlh^lhl æŒ‡è¾“å…¥åˆ°ç¬¬ lll å±‚çš„è¾“å…¥è¡¨å¾ï¼Œf(â‹…)f(\\cdot)f(â‹…) æ˜¯éçº¿æ€§å‡½æ•°ï¼Œbilb_i^lbilâ€‹ æ˜¯åç½®å‚æ•°ã€‚ è¿™æ ·çš„æ·±åº¦å­¦ä¹ è®¡ç®—è¿‡ç¨‹å¯¼è‡´ä¸€ä¸ªå±‚å‚æ•°çš„æ¢¯åº¦ä¸ä¸Šä¸€å±‚çš„è¾“å‡ºé«˜åº¦ç›¸å…³ï¼Œè¿™è¢«ç§°ä¸ºâ€œåå˜é‡åå·®â€ã€‚Batch Normalization çš„æå‡ºå°±æ˜¯ä¸ºäº†å‡å¼±è¿™ç§åå·®ã€‚ Batch Normalization BN å°†è®­ç»ƒæ ·æœ¬åœ¨æ¯ä¸ªéšè—å•å…ƒä¸Šçš„è¾“å…¥å½’ä¸€åŒ–ï¼Œå…·ä½“åœ°è¯´ï¼Œå¯¹äºç¬¬ lll å±‚ä¸Šç¬¬ iii ä¸ªè¾“å…¥ï¼ŒBN æ ¹æ®è®­ç»ƒæ•°æ®çš„åˆ†å¸ƒç¼©æ”¾éšè—å•å…ƒçš„è¾“å…¥ã€‚ aâ€¾il=gilÏƒil(ailâˆ’Î¼il),Î¼il=Exâˆ¼P(x)[ail],Ïƒil=Exâˆ¼P(x)[(ailâˆ’Î¼il)2]\\overline{a}_i^l = \\frac{g_i^l}{\\sigma_i^l}(a_i^l - \\mu_i^l), \\mu_i^l=\\mathbb{E}_{\\mathbf{x}\\sim P(\\mathbf{x})}[a_i^l], \\sigma_i^l = \\sqrt{\\mathbb{E}_{\\mathbf{x}\\sim P(\\mathbf{x})}[(a_i^l - \\mu_i^l)^2]} ailâ€‹=Ïƒilâ€‹gilâ€‹â€‹(ailâ€‹âˆ’Î¼ilâ€‹),Î¼ilâ€‹=Exâˆ¼P(x)â€‹[ailâ€‹],Ïƒilâ€‹=Exâˆ¼P(x)â€‹[(ailâ€‹âˆ’Î¼ilâ€‹)2]â€‹ å…¶ä¸­ aâ€¾il\\overline{a}_i^lailâ€‹ æ˜¯ç¬¬ lll å±‚ç¬¬ iii ä¸ªéšè—å•å…ƒçš„å½’ä¸€åŒ–åçš„è¾“å…¥ï¼Œgig_igiâ€‹ æ˜¯å¢ç›Šå‚æ•°ã€‚ ä¸Šè¿°å…¬å¼ä¸­è®¡ç®—ç»Ÿè®¡å‚æ•° Î¼\\muÎ¼ å’Œ Ïƒ\\sigmaÏƒ æ˜¯åœ¨æ•´ä¸ªè®­ç»ƒé›† P(x)P(\\mathbf{x})P(x) ä¸Šè¿›è¡Œï¼Œä½†æ˜¯è¿™åœ¨å®è·µä¸­ä¸å¯èƒ½å®Œæˆã€‚å› ä¸ºè¿™éœ€è¦åœ¨æŸä¸ª Batch çš„è®¡ç®—ä¸­å¼•å…¥ä¸å±äºè¯¥ Batch çš„åˆ†å¸ƒä¿¡æ¯ï¼Œå› æ­¤ç»Ÿè®¡å‚æ•°ç”±å½“å‰çš„ mini-batch ä¸­çš„æ ·æœ¬ä¸­ä¼°è®¡ã€‚è¿™å®¢è§‚ä¸Šé™åˆ¶äº† mini-batch çš„å¤§å°ä¸èƒ½å¤ªå°ï¼Œå¹¶ä¸”å¾ˆéš¾å°†å…¶åº”ç”¨åœ¨ RNN ä¸­ Layer Normalization ä½œè€…è€ƒè™‘åˆ°ï¼Œå¦‚æœå›ºå®šæ·±åº¦ç¥ç»ç½‘ç»œæ¯ä¸€å±‚çš„è¾“å…¥æ•°æ®çš„å‡å€¼å’Œæ–¹å·®ï¼Œå¯ä»¥å‡å¼±ä¸Šè¿°çš„åå˜é‡åç§»é—®é¢˜ã€‚LN ä¸­ç»Ÿè®¡å‚æ•°çš„è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š Î¼l=1Hâˆ‘i=1Hail,Ïƒl=1Hâˆ‘i=1H(ailâˆ’Î¼l)2\\mu^l = \\frac{1}{H}\\sum_{i=1}^{H}a_i^l, \\sigma^l = \\sqrt{\\frac{1}{H}\\sum_{i=1}^H(a_i^l - \\mu^l)^2} Î¼l=H1â€‹i=1âˆ‘Hâ€‹ailâ€‹,Ïƒl=H1â€‹i=1âˆ‘Hâ€‹(ailâ€‹âˆ’Î¼l)2â€‹ å…¶ä¸­ HHH ä»£è¡¨ç¬¬ lll å±‚(å½“å‰å±‚)ä¸­éšè—å•å…ƒçš„æ•°é‡ã€‚ ä¸ BN ä¸åŒçš„æ˜¯ï¼ŒLN ä¸­åŒä¸€å±‚çš„æ‰€æœ‰éšè—å•å…ƒå…±äº«ç›¸åŒçš„ç»Ÿè®¡å‚æ•° Î¼\\muÎ¼ å’Œ Ïƒ\\sigmaÏƒ ï¼Œä¸åŒçš„è®­ç»ƒæ ·æœ¬è®¡ç®—å‡ºä¸åŒçš„ Î¼\\muÎ¼ å’Œ Ïƒ\\sigmaÏƒï¼Œè€Œ BN ä¸­åˆ™æ˜¯åŒä¸€ Batch ä¸­æ‰€æœ‰çš„è®­ç»ƒæ ·æœ¬åœ¨ç›¸åŒçš„éšè—å•å…ƒä¸Šå…±äº«ç›¸åŒçš„ç»Ÿè®¡å‚æ•°ï¼Œä¸åŒçš„éšè—å•å…ƒè®¡ç®—å‡ºä¸åŒçš„ç»Ÿè®¡å‚æ•°ã€‚è¿™ä¸€åŒºåˆ«ä½¿å¾— LN å–æ¶ˆäº†å¯¹ mini-batch å°ºå¯¸çš„é™åˆ¶ï¼Œç”šè‡³å¯ä»¥è¿›è¡Œ batch-size ä¸º 1 çš„çº¯åœ¨çº¿è®­ç»ƒè¿‡ç¨‹ã€‚ LN åœ¨ RNN ä¸­åº”ç”¨","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"ML","slug":"ML","permalink":"https://blog.zhuwenq.cc/tags/ML/"}],"author":["Jimmy Lei Ba","Jamie Ryan Kiros","Geoffrey E. Hinton"]},{"title":"ERICA: Improving Entity and Relation Understanding for Pre-trained Language Models via Contrastive Learning","slug":"ERICA-Improving-Entity-and-Relation-Understanding-for-Pre-trained-Language-Models-via-Contrastive-Learning","date":"2021-11-26T16:00:00.000Z","updated":"2023-06-21T06:51:28.788Z","comments":true,"path":"ERICA-Improving-Entity-and-Relation-Understanding-for-Pre-trained-Language-Models-via-Contrastive-Learning/","link":"","permalink":"https://blog.zhuwenq.cc/ERICA-Improving-Entity-and-Relation-Understanding-for-Pre-trained-Language-Models-via-Contrastive-Learning/","excerpt":"Motivation é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹æ‹¥æœ‰å¾ˆå¼ºçš„è¡¨å¾èƒ½åŠ›ï¼Œå¯ä»¥åˆ©ç”¨é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ç”Ÿæˆçš„è¯­è¨€è¡¨å¾é«˜æ•ˆæ•æ‰æ–‡æœ¬çš„è¯­æ³•å’Œè¯­ä¹‰ç‰¹å¾ã€‚ä½œè€…è®¤ä¸ºç›®å‰å¹³å‡¡çš„é¢„è®­ç»ƒç›®æ ‡ä¸èƒ½æ˜ç¡®å»ºæ¨¡relational factsï¼Œè€Œrelational factså¯¹äºç†è§£æ•´ä¸ªæ–‡æœ¬ååˆ†é‡è¦ã€‚ç°æœ‰çš„å…³äºå»ºæ¨¡å®ä½“åŠå®ä½“ä¹‹é—´å…³ç³»çš„ç ”ç©¶ä¸»è¦å…³æ³¨äºå¥å†…å®ä½“ä¹‹é—´çš„å­¤ç«‹å…³ç³»ï¼Œå¿½ç•¥äº†åœ¨æ•´ä¸ªæ–‡æ¡£å±‚é¢ä¸Šå®ä½“ä¹‹é—´çš„å…³ç³»ã€‚","text":"Motivation é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹æ‹¥æœ‰å¾ˆå¼ºçš„è¡¨å¾èƒ½åŠ›ï¼Œå¯ä»¥åˆ©ç”¨é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ç”Ÿæˆçš„è¯­è¨€è¡¨å¾é«˜æ•ˆæ•æ‰æ–‡æœ¬çš„è¯­æ³•å’Œè¯­ä¹‰ç‰¹å¾ã€‚ä½œè€…è®¤ä¸ºç›®å‰å¹³å‡¡çš„é¢„è®­ç»ƒç›®æ ‡ä¸èƒ½æ˜ç¡®å»ºæ¨¡relational factsï¼Œè€Œrelational factså¯¹äºç†è§£æ•´ä¸ªæ–‡æœ¬ååˆ†é‡è¦ã€‚ç°æœ‰çš„å…³äºå»ºæ¨¡å®ä½“åŠå®ä½“ä¹‹é—´å…³ç³»çš„ç ”ç©¶ä¸»è¦å…³æ³¨äºå¥å†…å®ä½“ä¹‹é—´çš„å­¤ç«‹å…³ç³»ï¼Œå¿½ç•¥äº†åœ¨æ•´ä¸ªæ–‡æ¡£å±‚é¢ä¸Šå®ä½“ä¹‹é—´çš„å…³ç³»ã€‚ Contribution æå‡ºäº†ä¸¤ä¸ªé¢„è®­ç»ƒç›®æ ‡ï¼Œç”¨ä»¥æ›´å¥½åœ°æ•è·in-text factsï¼š Entity Discrimination task(å®ä½“åŒºåˆ†ä»»åŠ¡)ï¼Œç”¨ç»™å®šçš„å¤´å®ä½“å’Œå…³ç³»åŒºåˆ†å‡ºå°¾å®ä½“ Relation Discrimination task(å…³ç³»åŒºåˆ†ä»»åŠ¡)ï¼ŒåŒºåˆ†ä¸¤ä¸ªç»™å®šçš„å…³ç³»æ˜¯å¦è¯­ä¹‰ä¸Šç›¸ä¼¼ Methodology æ•°æ®æ„å»ºå’Œå½¢å¼åŒ–æè¿° ERICA åœ¨å¤§è§„æ¨¡æ— æ ‡ç­¾çš„è¯­æ–™ä¸Šè®­ç»ƒï¼Œå¹¶ç”±å¤–éƒ¨çŸ¥è¯†å›¾è°± K\\mathcal{K}K è¿›è¡Œè¿œç¨‹ç›‘ç£ã€‚ é¦–å…ˆå°†æ•°æ®ä»¥æ–‡æ¡£ä¸ºå•ä½åˆ†æ‰¹ï¼Œ D={di}i=1âˆ£Dâˆ£\\mathcal{D} = \\{d_i\\}_{i=1}^{|\\mathcal{D}|}D={diâ€‹}i=1âˆ£Dâˆ£â€‹ æ˜¯ä¸€ä¸ªåŒ…å«è‹¥å¹²æ–‡æ¡£çš„ä¸€ä¸ª batchã€‚ Ei={eij}j=1âˆ£Eiâˆ£\\mathcal{E}_i = \\{e_{ij}\\}_{j=1}^{|\\mathcal{E}_i|}Eiâ€‹={eijâ€‹}j=1âˆ£Eiâ€‹âˆ£â€‹ æ˜¯æ–‡æ¡£ did_idiâ€‹ ä¸­å‡ºç°çš„æ‰€æœ‰å®ä½“çš„é›†åˆï¼Œå…¶ä¸­ eije_{ij}eijâ€‹ æ˜¯æ–‡æ¡£ did_idiâ€‹ ä¸­çš„ç¬¬ jjj ä¸ªå®ä½“ã€‚ å¯¹äºæ–‡æ¡£ did_idiâ€‹, ä½œè€…æšä¸¾å‡ºå…¶ä¸­çš„æ‰€æœ‰å®ä½“å¯¹ (eij,eik)(e_{ij}, e_{ik})(eijâ€‹,eikâ€‹), å¹¶å°†å®ƒä»¬ä»¥ K\\mathcal{K}K ä¸­çš„å…³ç³» rjkir_{jk}^irjkiâ€‹ è¿æ¥èµ·æ¥ï¼Œè¿™æ ·å°±å¾—åˆ°äº†ä¸€ä¸ªå…ƒç»„é›† Ti={tjki=(di,eij,rjki,eik)âˆ£jâ‰ k}\\mathcal{T}_i = \\{t_{jk}^i=(d_i, e_{ij}, r_{jk}^i, e_{ik})|j\\neq k\\}Tiâ€‹={tjkiâ€‹=(diâ€‹,eijâ€‹,rjkiâ€‹,eikâ€‹)âˆ£jî€ =k}. å¯¹äº K\\mathcal{K}K ä¸­ä¸å­˜åœ¨å…³ç³»çš„å®ä½“å¯¹(out-of-KG é—®é¢˜), å°†å…¶å…³ç³»è®¾ç½®ä¸º no_relation. å¯¹äºæ•´ä¸ªæ‰¹æ¬¡ï¼Œå°†å…¶ä¸­æ¯ä¸ªæ–‡æ¡£çš„å…ƒç»„é›†æ‹¼æ¥å¾—åˆ°æ•´ä¸ªæ‰¹æ¬¡çš„å…ƒç»„é›† T=TiâˆªT2âˆª...âˆªTâˆ£Dâˆ£\\mathcal{T} = \\mathcal{T}_i\\cup\\mathcal{T}_2\\cup...\\cup\\mathcal{T}_{|\\mathcal{D}|}T=Tiâ€‹âˆªT2â€‹âˆª...âˆªTâˆ£Dâˆ£â€‹. è¿›ä¸€æ­¥ï¼Œä½œè€…é€šè¿‡å»é™¤ T\\mathcal{T}T ä¸­æ‰€æœ‰å…³ç³»ä¸º no_relation çš„å…ƒç´ æ„å»ºäº†é˜³æ€§å…ƒç»„é›† T+\\mathcal{T}^+T+. T+\\mathcal{T}^+T+ ä¸­åŒ…å«å¥å†…å®ä½“å¯¹å’Œå¥é—´å®ä½“å¯¹ã€‚ å®ä½“å’Œå…³ç³»çš„è¡¨å¾æ–¹æ³• å¯¹äºæ¯ä¸ªæ–‡æ¡£ did_idiâ€‹ ï¼Œä½œè€…é¦–å…ˆä½¿ç”¨ PLM å¯¹é½è¿›è¡Œç¼–ç ï¼Œè®¡ç®—å‡ºæ¯ä¸ª token çš„è¡¨å¾ {h1,h2,...,hâˆ£diâˆ£}\\{\\mathbf{h}_1, \\mathbf{h}_2, ..., \\mathbf{h}_{|d_i|}\\}{h1â€‹,h2â€‹,...,hâˆ£diâ€‹âˆ£â€‹}, ç„¶åå¯¹äºæ–‡æ¡£ä¸­çš„æ¯ä¸ªå®ä½“ eije_{ij}eijâ€‹, ä½œè€…é€šè¿‡å¯¹è¿™ä¸ªå®ä½“æ‰€åŒ…å«çš„æ‰€æœ‰ token çš„è¡¨å¾è¿›è¡Œå‡å€¼æ± åŒ–(mean pooling) è·å¾—è¿™ä¸ªå®ä½“æœ¬æ¬¡å‡ºç°çš„å±€éƒ¨è¡¨å¾ã€‚ç”±äºä¸€ä¸ªå®ä½“åœ¨æ–‡æ¡£ä¸­å¯èƒ½å¤šæ¬¡å‡ºç°ï¼Œå…¶ç¬¬ kkk æ¬¡å‡ºç°çš„å±€éƒ¨è¡¨å¾è®°ä¸ºï¼š meijk=MeanPool(hnstartk,...,hnendk)\\mathbf{m}_{e_{ij}}^k = \\text{MeanPool}(\\mathbf{h}_{n_{start}^k}, ..., \\mathbf{h}_{n_{end}^k}) meijâ€‹kâ€‹=MeanPool(hnstartkâ€‹â€‹,...,hnendkâ€‹â€‹) å…¶ä¸­ï¼Œnstartkn_{start}^knstartkâ€‹ å’Œ nendkn_{end}^knendkâ€‹ åˆ†åˆ«æ˜¯å®ä½“ eije_{ij}eijâ€‹ æ‰€åŒ…å«çš„ token åœ¨æ–‡æ¡£ did_idiâ€‹ ä¸­ç¬¬ kkk æ¬¡å‡ºç°çš„èµ·å§‹ä½ç½®å’Œç»ˆæ­¢ä½ç½®ã€‚ åŒæ—¶ä½œè€…å°†æ–‡æ¡£ä¸­ eije_{ij}eijâ€‹ çš„æ‰€æœ‰å±€éƒ¨è¡¨å¾å–å‡å€¼ä½œä¸ºå…¶åœ¨æ–‡æ¡£ä¸­çš„å…¨å±€ç‰¹å¾ eij\\mathbf{e}_{ij}eijâ€‹ï¼Œä½œè€…è®¤ä¸ºeij\\mathbf{e}_{ij}eijâ€‹ä¸­åŒ…å«è¯¥å®ä½“åœ¨è¯¥æ–‡æ¡£ä¸­çš„å…¨éƒ¨ä¿¡æ¯ å¯¹äºæ–‡æ¡£ä¸­ä¸¤ä¸ªå®ä½“ eij1,eij2e_{ij_1}, e_{ij_2}eij1â€‹â€‹,eij2â€‹â€‹ ä¹‹é—´çš„å…³ç³»ï¼Œä½œè€…å°†å…¶å…¨å±€è¡¨å¾æ‹¼æ¥èµ·æ¥ä½œä¸ºå…¶å…³ç³»çš„è¡¨å¾ rj1j2i=[eij1;eij2]\\mathbf{r}_{j_1j_2}^i = [\\mathbf{e}_{ij_1}; \\mathbf{e}_{ij_2}]rj1â€‹j2â€‹iâ€‹=[eij1â€‹â€‹;eij2â€‹â€‹] ä¸¤ä¸ªé¢„è®­ç»ƒç›®æ ‡ Entity Discrimination, ED å®ä½“è¾¨åˆ«ä»»åŠ¡æ˜¯æ ¹æ®ç»™å®šçš„æ–‡æ¡£å’Œå¤´å®ä½“ä»¥åŠå…³ç³»æ¨æ–­å‡ºå°¾å®ä½“ã€‚ä½œè€…è®¤ä¸ºï¼Œè¿™ä¸ªä»»åŠ¡å¯ä»¥ä¿ƒä½¿PLMé€šè¿‡å®ä½“ä¹‹é—´çš„å…³ç³»ç†è§£å®ä½“ã€‚ å®è·µä¸­ï¼Œå…ˆä» T+\\mathcal{T}^+T+ ä¸­é‡‡æ ·ä¸€ä¸ªå…ƒç»„ tjki=(di,eij,rjki,eik)t_{jk}^{i} = (d_i, e_{ij}, r_{jk}^{i}, e_{ik})tjkiâ€‹=(diâ€‹,eijâ€‹,rjkiâ€‹,eikâ€‹). ç„¶åä½¿ç”¨ PLM åŒºåˆ†GTå°¾å®ä½“å’Œæ–‡æ¡£ did_idiâ€‹ ä¸­çš„å…¶ä»–å®ä½“ã€‚å®é™…çš„æ•°æ®æ„é€ æˆå¦‚ä¸‹çš„æ ¼å¼ï¼š diâˆ—=&quot;relation_name entity_mention[SEP]di&quot;d_i^*=\\text{&quot;relation\\_name entity\\_mention[SEP]}d_i\\text{&quot;} diâˆ—â€‹=&quot;relation_name entity_mention[SEP]diâ€‹&quot; å³å°†å…³ç³» rjkir_{jk}^irjkiâ€‹ çš„åç§°ï¼Œå¤´å®ä½“ eije_{ij}eijâ€‹ çš„ mention(æ–‡å­—) æ”¾åœ¨æ–‡æ¡£ did_idiâ€‹ çš„å‰é¢ï¼Œå¹¶ç”¨ [SEP]\\text{[SEP]}[SEP] éš”å¼€ã€‚ è¯¥ä»»åŠ¡çš„ç›®æ ‡å°±æ˜¯æœ€å¤§åŒ–å¦‚ä¸‹åéªŒæ¦‚ç‡ï¼š P(eikâˆ£eij,rjki)=softmax(f(eik))\\mathcal{P}(e_{ik}|e_{ij}, r_{jk}^i) = \\text{softmax}(f(\\mathbf{e}_{ik})) P(eikâ€‹âˆ£eijâ€‹,rjkiâ€‹)=softmax(f(eikâ€‹)) å…¶ä¸­ f(â‹…)f(\\cdot)f(â‹…) æ˜¯ä¸€ä¸ªå®ä½“åˆ†ç±»å™¨ã€‚ ä½œè€…å®éªŒå‘ç°ç›´æ¥ä¼˜åŒ–ä¸Šè¿°åéªŒæ¦‚ç‡å¹¶ä¸èƒ½å¾ˆå¥½åœ°è€ƒè™‘å®ä½“ä¹‹é—´çš„å…³ç³»ï¼Œå› æ­¤å€Ÿé‰´å¯¹æ¯”å­¦ä¹ çš„æ€æƒ³ï¼Œè®­ç»ƒè¡¨å¾ä½¿å®ä½“æ­£æ ·æœ¬(eij,eik)(e_{ij}, e_{ik})(eijâ€‹,eikâ€‹)ä¹‹é—´çš„ä½™å¼¦è·ç¦»æ¯”è´Ÿæ ·æœ¬æ›´è¿‘ã€‚EDä»»åŠ¡çš„æŸå¤±å‡½æ•°è®¾è®¡ä¸ºï¼š LED=âˆ’âˆ‘tjkiâˆˆT+logâ¡expâ¡(cosâ¡(eij,eik)/Ï„)âˆ‘l=1,lâ‰ jâˆ£Eiâˆ£expâ¡(cosâ¡(eij,eil)/Ï„)\\mathcal{L}_\\text{ED}=-\\sum_{t_{jk}^i\\in \\mathcal{T}^+}\\log\\frac{\\exp(\\cos(\\mathbf{e}_{ij}, \\mathbf{e}_{ik})/\\tau)}{\\sum_{l=1, l\\neq j}^{|\\mathcal{E}_i|}\\exp(\\cos(\\mathbf{e}_{ij}, \\mathbf{e}_{il})/\\tau)} LEDâ€‹=âˆ’tjkiâ€‹âˆˆT+âˆ‘â€‹logâˆ‘l=1,lî€ =jâˆ£Eiâ€‹âˆ£â€‹exp(cos(eijâ€‹,eilâ€‹)/Ï„)exp(cos(eijâ€‹,eikâ€‹)/Ï„)â€‹ å…¶ä¸­çš„ Ï„\\tauÏ„ æ˜¯ä¸€ä¸ªè¶…å‚æ•°ã€‚ Relation Discrimination, RD å…³ç³»è¾¨åˆ«ä»»åŠ¡å³è¾¨åˆ«ä¸¤ä¸ªå…³ç³»æ˜¯å¦è¯­ä¹‰ä¸Šç›¸ä¼¼ï¼Œä¸ç°å­˜çš„å…³ç³»å¢å¼ºçš„PLMç›¸æ¯”ï¼Œæœ¬æ–‡æå‡ºçš„æ–¹æ³•ä¸»è¦æ˜¯ä½¿ç”¨äº†æ–‡æ¡£çº§åˆ«çš„å…³ç³»è€Œä¸æ˜¯å¥å†…å…³ç³»çš„è¿œç¨‹ç›‘ç£ã€‚ä½œè€…è®¤ä¸ºè¿™æ ·å¯ä»¥ä½¿PLMå­¦ä¼šç°å®ä¸–ç•Œä¸­çš„å¤æ‚æ¨ç†é“¾ã€‚ä½œè€…ä¸ºå®ä½“å¯¹ä¹‹é—´çš„å…³ç³»æ–‡æœ¬è®­ç»ƒè¡¨å¾ï¼Œå¹¶ä¼˜åŒ–ä½¿å…±äº«ç›¸åŒå…³ç³»çš„ä¸åŒå®ä½“å¯¹ä¹‹é—´çš„å…³ç³»è¡¨å¾åœ¨è¯­ä¹‰ç©ºé—´ä¸­ç›¸è¿‘ã€‚ å®è·µä¸Šï¼Œä½œè€…ä» Ts+\\mathcal{T}_s^+Ts+â€‹ æˆ– Tc+\\mathcal{T}_c^+Tc+â€‹ ä¸­ä¸ºæ¯ç§å…³ç³»çº¿æ€§é‡‡æ ·(æ¯ç§å…³ç³»å¯¹åº”çš„é‡‡æ ·ç‡ä¸è¯¥å…³ç³»çš„æ•°é‡åœ¨æŒ¡å¢™batchä¸­çš„å æ¯”æˆæ­£æ¯”)å…ƒç»„å¯¹ tA=(dA,eA1,rA,eAe),tB=(dB,eB1,rB,eB2)t_A=(d_A, e_{A_1}, r_A, e_{A_e}), t_B=(d_B, e_{B_1}, r_B, e_{B_2})tAâ€‹=(dAâ€‹,eA1â€‹â€‹,rAâ€‹,eAeâ€‹â€‹),tBâ€‹=(dBâ€‹,eB1â€‹â€‹,rBâ€‹,eB2â€‹â€‹) å…¶ä¸­ rA=rBr_A=r_BrAâ€‹=rBâ€‹. ç„¶åä½¿ç”¨å®ä½“å’Œå…³ç³»çš„è¡¨å¾æ–¹æ³•ä¸­æåˆ°çš„æ–¹æ³•å¯¹ rAr_ArAâ€‹ å’Œ rBr_BrBâ€‹ è¿›è¡Œç¼–ç ï¼Œè·å¾— rtA\\mathbf{r}_{t_A}rtAâ€‹â€‹ å’Œ rtB\\mathbf{r}_{t_B}rtBâ€‹â€‹ . ç„¶åï¼Œä¸EDç±»ä¼¼ï¼Œä½œè€…ä¹Ÿä½¿ç”¨äº†å¯¹æ¯”å­¦ä¹ çš„æ€æƒ³æ„å»ºRDçš„æŸå¤±å‡½æ•°ï¼š LRDT1,T2=âˆ’âˆ‘tAâˆˆT1,tBâˆˆT2logâ¡expâ¡(cosâ¡(rtA,rrB)/Ï„)ZZ=âˆ‘tCâˆˆT/{tA}Nexpâ¡(cosâ¡(rtA,rrB)/Ï„)LRD=LRDTs+,Ts++LRDTs+,Tc++LRDTc+,Ts++LRDTc+,Tc+\\begin{aligned} \\mathcal{L}_\\text{RD}^{\\mathcal{T}_1, \\mathcal{T}_2} &amp;= -\\sum_{t_A\\in \\mathcal{T}_1, t_B\\in \\mathcal{T}_2}\\log\\frac{\\exp(\\cos(\\mathbf{r}_{t_A}, \\mathbf{r}_{r_B})/\\tau)}{\\mathcal{Z}} \\\\ \\mathcal{Z} &amp;= \\sum_{t_C\\in \\mathcal{T}/\\{t_A\\}}^N\\exp(\\cos(\\mathbf{r}_{t_A}, \\mathbf{r}_{r_B})/\\tau) \\\\ \\mathcal{L}_\\text{RD} &amp;= \\mathcal{L}_\\text{RD}^{\\mathcal{T}_s^+, \\mathcal{T}_s^+} + \\mathcal{L}_\\text{RD}^{\\mathcal{T}_s^+, \\mathcal{T}_c^+} + \\mathcal{L}_\\text{RD}^{\\mathcal{T}_c^+, \\mathcal{T}_s^+} + \\mathcal{L}_\\text{RD}^{\\mathcal{T}_c^+, \\mathcal{T}_c^+} \\end{aligned}LRDT1â€‹,T2â€‹â€‹ZLRDâ€‹â€‹=âˆ’tAâ€‹âˆˆT1â€‹,tBâ€‹âˆˆT2â€‹âˆ‘â€‹logZexp(cos(rtAâ€‹â€‹,rrBâ€‹â€‹)/Ï„)â€‹=tCâ€‹âˆˆT/{tAâ€‹}âˆ‘Nâ€‹exp(cos(rtAâ€‹â€‹,rrBâ€‹â€‹)/Ï„)=LRDTs+â€‹,Ts+â€‹â€‹+LRDTs+â€‹,Tc+â€‹â€‹+LRDTc+â€‹,Ts+â€‹â€‹+LRDTc+â€‹,Tc+â€‹â€‹â€‹ å…¶ä¸­ NNN æ˜¯è¶…å‚æ•°ã€‚å®éªŒä¸­ç¡®ä¿ tBt_BtBâ€‹ ä» Z\\mathcal{Z}Z ä¸­é‡‡æ ·å¹¶ä¸”ä» T\\mathcal{T}T ä¸­æ„å»º Nâˆ’1N-1Nâˆ’1 ä¸ªè´Ÿæ ·æœ¬ã€‚ æ€»ä½“è®­ç»ƒç›®æ ‡ ä¸ºé¿å…ç¾éš¾æ€§é—å¿˜ï¼ŒERICA è¿˜é‡‡ç”¨äº†MLMç›®æ ‡ä»»åŠ¡ï¼Œå› æ­¤æ€»çš„è®­ç»ƒç›®æ ‡æ˜¯ï¼š L=LED+LRD+LMLM\\mathcal{L} = \\mathcal{L}_\\text{ED} + \\mathcal{L}_\\text{RD} + \\mathcal{L}_\\text{MLM} L=LEDâ€‹+LRDâ€‹+LMLMâ€‹ å®éªŒ è¿œç¨‹ç›‘ç£æ•°æ®é›†æ„å»º é¢„è®­ç»ƒå‚æ•°ç»†èŠ‚ RE ä»»åŠ¡ä¸Šä¸ CNNï¼ŒBILSTMï¼ŒBERTï¼ŒRoBERTaï¼ŒHINBERTï¼ŒCorefBERTï¼ŒSpanBERTï¼ŒERINEï¼ŒMTBï¼ŒCPæ¯”è¾ƒã€‚åˆ†åˆ«åœ¨ Document-level å’Œ Sentence-level ä¸Šæ¯”è¾ƒ Multi-Chioce QA ä»»åŠ¡ä¸Šä¸ FastQA, BiDAF, BERT, RoBERTa, CorefBERT, SpanBERT, MTB å’Œ CP æ¯”è¾ƒã€‚Extractive QA ä¸Šä¸ BERTï¼ŒRoBERTaï¼ŒMTBï¼ŒCP æ¯”è¾ƒ æ¶ˆèå®éªŒï¼Œæ¢ç´¢äº† LED\\mathcal{L}_\\text{ED}LEDâ€‹ å’Œ LRD\\mathcal{L}_\\text{RD}LRDâ€‹ çš„ä½œç”¨ï¼Œåˆ†æäº†é¢„è®­ç»ƒæ•°æ®çš„ domainï¼Œsize å’Œ å®ä½“ç¼–ç çš„æ–¹æ³•å¯¹æ€§èƒ½çš„å½±å“","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"PLM","slug":"PLM","permalink":"https://blog.zhuwenq.cc/tags/PLM/"},{"name":"NLP","slug":"NLP","permalink":"https://blog.zhuwenq.cc/tags/NLP/"},{"name":"Knowledge Graph","slug":"Knowledge-Graph","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Graph/"},{"name":"Knowledge Embedding","slug":"Knowledge-Embedding","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Embedding/"}]},{"title":"Rigid Formats Controlled Text Generation","slug":"Rigid-Formats-Controlled-Text-Generation","date":"2021-10-19T16:00:00.000Z","updated":"2023-06-21T06:51:28.884Z","comments":true,"path":"Rigid-Formats-Controlled-Text-Generation/","link":"","permalink":"https://blog.zhuwenq.cc/Rigid-Formats-Controlled-Text-Generation/","excerpt":"Motivation ä¸€èˆ¬çš„æ–‡æœ¬ç”Ÿæˆä»»åŠ¡æ²¡æœ‰ä¸¥æ ¼çš„æ ¼å¼é™åˆ¶ï¼Œåƒå®‹è¯ï¼Œåå››è¡Œè¯—ï¼Œæ­Œè¯ç­‰æ–‡æœ¬ç”±ä¸¥æ ¼çš„æ ¼å¼æˆ–éŸµå¾‹æ§åˆ¶ï¼Œè€Œå…³äºå—æ§æ ¼å¼çš„æ–‡æœ¬ç”Ÿæˆè¿˜æœªè¢«å……åˆ†ç ”ç©¶è¿‡ã€‚","text":"Motivation ä¸€èˆ¬çš„æ–‡æœ¬ç”Ÿæˆä»»åŠ¡æ²¡æœ‰ä¸¥æ ¼çš„æ ¼å¼é™åˆ¶ï¼Œåƒå®‹è¯ï¼Œåå››è¡Œè¯—ï¼Œæ­Œè¯ç­‰æ–‡æœ¬ç”±ä¸¥æ ¼çš„æ ¼å¼æˆ–éŸµå¾‹æ§åˆ¶ï¼Œè€Œå…³äºå—æ§æ ¼å¼çš„æ–‡æœ¬ç”Ÿæˆè¿˜æœªè¢«å……åˆ†ç ”ç©¶è¿‡ã€‚ åˆšæ€§æ ¼å¼æ§åˆ¶çš„æ–‡æœ¬ç”Ÿæˆ ç”Ÿæˆçš„æ–‡æœ¬å¿…é¡»ï¼š å®Œå…¨éµå®ˆé¢„å®šä¹‰çš„åˆšæ€§æ ¼å¼ æ–‡æœ¬çš„å®‰æ’å¿…é¡»æ»¡è¶³éŸµå¾‹æ ¼å¼ å¿…é¡»ä¿è¯å¥å­çš„å®Œæ•´æ€§ ç°æœ‰çš„å¦‚è¯—æ­Œå†™ä½œä»»åŠ¡çš„å·¥ä½œåªæ˜¯å°†æ–‡æœ¬çš„æ ¼å¼å’ŒéŸµå¾‹ä½œä¸ºä¸€ç§æ•°æ®çš„éšå¼ç‰¹å¾åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å­¦ä¹ ã€‚è¿™ç§æ¨¡å‹ä¸å…·æœ‰æ³›åŒ–æ€§ï¼Œåœ¨äº”è¨€ç»å¥æ•°æ®ä¸Šè®­ç»ƒçš„æ¨¡å‹ä¸èƒ½ç”¨äºä¸ƒè¨€ç»å¥çš„ç”Ÿæˆã€‚ ä»»åŠ¡å®šä¹‰ è¾“å…¥ä¸€ä¸ªåˆšæ€§æ ¼å¼ CâˆˆCC\\in \\mathcal{C}CâˆˆC: C={c0c1c2c3,c0c1c2c3c4c5.}C = \\{c_0c_1c_2c_3, c_0c_1c_2c_3c_4c_5.\\} C={c0â€‹c1â€‹c2â€‹c3â€‹,c0â€‹c1â€‹c2â€‹c3â€‹c4â€‹c5â€‹.} å…¶ä¸­ C\\mathcal{C}C æ˜¯æ‰€æœ‰å¯èƒ½çš„æ ¼å¼çš„é›†åˆã€‚C\\mathcal{C}C æ˜¯ä¸€ä¸ªå¯ä»¥æ‰©å±•è‡ªå®šä¹‰æ ¼å¼çš„é›†åˆï¼Œå› æ­¤ âˆ£Câˆ£â†’âˆ|\\mathcal{C}|\\rightarrow \\inftyâˆ£Câˆ£â†’âˆ. å…¶ä¸­çš„ cic_iciâ€‹ è¡¨ç¤ºä¸€ä¸ªå ä½ç¬¦ï¼Œä»£è¡¨éœ€è¦ç”Ÿæˆä¸€ä¸ªå®é™…çš„å­—çš„ä½ç½®ã€‚CCC ä¸­å®šä¹‰äº†å­—çš„ä¸ªæ•°å’Œæ ‡ç‚¹ç¬¦å·çš„ä½ç½®ã€‚ è¾“å‡ºçš„æ˜¯ä¸€ä¸ªç¬¦åˆæ ¼å¼ CCC çš„è‡ªç„¶è¯­è¨€è¯­å¥ YâˆˆYY\\in \\mathcal{Y}YâˆˆY, ä¾‹ï¼š Y=love is not love,bends with the remover to remove.\\begin{array}{rl} Y = &amp;\\text{love is not love,}\\\\ &amp;\\text{bends with the remover to remove.} \\end{array}Y=â€‹love is not love,bends with the remover to remove.â€‹ å› ä¸º C\\mathcal{C}C æ˜¯ä¸€ä¸ªå¯ä»¥æ‰©å±•çš„æ ¼å¼é›†ï¼Œå¯ä»¥åŸºäºç”Ÿæˆçš„ç»“æœ YYY é‡å»ºä¸€ä¸ªæ–°çš„æ ¼å¼ Câ€²C&#x27;Câ€², é‡å»ºçš„æ–¹å¼ä¸º mask æ‰éƒ¨åˆ†çš„å†…å®¹ï¼š Câ€²={c0c1c2 love,c0c1c2c3c4 remove.}C&#x27; = \\{c_0c_1c_2 \\text{ love}, c_0c_1c_2c_3c_4 \\text{ remove}.\\} Câ€²={c0â€‹c1â€‹c2â€‹ love,c0â€‹c1â€‹c2â€‹c3â€‹c4â€‹ remove.} å³ä¸¤ä¸ªå­å¥çš„æœ€åä¸€ä¸ªè¯å¿…é¡»æ˜¯ love\\text{love}love å’Œ remove\\text{remove}removeã€‚ ç„¶åæ ¹æ®æ–°ç”Ÿæˆçš„æ ¼å¼ Câ€²C&#x27;Câ€² é‡æ–°ç”Ÿæˆæ–‡æœ¬ï¼Œæ­¤è¿‡ç¨‹ç§°ä¸ºæŠ›å…‰(polishing) è¯¥ä»»åŠ¡çš„ç›®æ ‡å³æ‰¾åˆ°ä¸€ä¸ªæ˜ å°„å‡½æ•° GGG æ¥æ ¹æ®æ ¼å¼ç”Ÿæˆæ–‡æœ¬ï¼š Y=G(C)Y = G(C) Y=G(C) Methodology åŸºæœ¬æ¡†æ¶æ˜¯ä¸€ä¸ªåŸºäº Transformer çš„è‡ªå›å½’è¯­è¨€æ¨¡å‹ï¼Œè¾“å…¥å¯ä»¥æ˜¯æ•´ä¸ªçš„å®‹è¯æˆ–åå››è¡Œè¯—çš„ token åºåˆ—ã€‚ä½œè€…è®¾è®¡äº†å‡ ç§ embedding æ¥å¢å¼ºåœ¨æ ¼å¼ï¼ŒéŸµå¾‹å’Œå¥å­å®Œæ•´æ€§ä¸Šçš„å‡†ç¡®ç‡ã€‚åŒæ—¶æ”¹è¿›äº†æ³¨æ„åŠ›æœºåˆ¶æ¥ä¿ƒä½¿æ¨¡å‹æ•æ‰æ ¼å¼ä¿¡æ¯ç‰¹å¾ã€‚ ä»¥ä¸€æ®µèå£«æ¯”äºšåå››è¡Œè¯—ä¸­çš„å¥å­ä¸ºä¾‹ç»†è¯´: åŸå§‹è¯­å¥ï¼šlove is not love, bends with the remover to remove.\\text{love is not love, bends with the remover to remove.}love is not love, bends with the remover to remove. è¾“å…¥è¯­å¥ï¼š&lt;bos&gt; love is not love, &lt;/s&gt;bends with the remover to remove.&lt;/s&gt;\\text{&lt;bos&gt; love is not love, &lt;/s&gt;bends with the remover to remove.&lt;/s&gt;}&lt;bos&gt; love is not love, &lt;/s&gt;bends with the remover to remove.&lt;/s&gt; è¾“å‡ºæ˜¯è¾“å…¥çš„å·¦ç§»ç‰ˆæœ¬ï¼š$$\\begin{array}{c} \\text{love is not love,}\\ \\text{bends with the remover to remove.} \\end{array}$$ å…¶ä¸­çš„ &lt;/s&gt;&lt;/s&gt;&lt;/s&gt; æ˜¯å¥å­åˆ†éš”ç¬¦ã€‚ æ–°çš„åµŒå…¥ Format and Rhyme Symbols: C={c0,c0,c0,c2,c1,&lt;/s&gt;c0,c0,c0,c0,c0,c2,c1,&lt;/s&gt;,&lt;eos&gt;}\\begin{aligned} C = \\{&amp;c_0, c_0, c_0, c_2, c_1, &lt;/s&gt;\\\\ &amp;c_0, c_0, c_0, c_0, c_0, c_2, c_1, &lt;/s&gt;, &lt;eos&gt;\\} \\end{aligned}C={â€‹c0â€‹,c0â€‹,c0â€‹,c2â€‹,c1â€‹,&lt;/s&gt;c0â€‹,c0â€‹,c0â€‹,c0â€‹,c0â€‹,c2â€‹,c1â€‹,&lt;/s&gt;,&lt;eos&gt;}â€‹ å…¶ä¸­çš„ c0c_0c0â€‹ è¡¨ç¤ºæ™®é€šçš„ tokenï¼Œ c1c_1c1â€‹ è¡¨ç¤ºæ ‡ç‚¹ç¬¦å·ï¼Œ c2c_2c2â€‹ è¡¨ç¤ºéŸµè„šä½ç½®ã€‚ Intra-Position Symbols: P={p4,p3,p2,p1,p0,&lt;/s&gt;p6,p5,p4,p3,p2,p1,p0,&lt;/s&gt;,&lt;eos&gt;}\\begin{aligned} P = \\{&amp;p_4, p_3, p_2, p_1, p_0, &lt;/s&gt;\\\\ &amp;p_6, p_5, p_4, p_3, p_2, p_1, p_0, &lt;/s&gt;, &lt;eos&gt;\\} \\end{aligned}P={â€‹p4â€‹,p3â€‹,p2â€‹,p1â€‹,p0â€‹,&lt;/s&gt;p6â€‹,p5â€‹,p4â€‹,p3â€‹,p2â€‹,p1â€‹,p0â€‹,&lt;/s&gt;,&lt;eos&gt;}â€‹ å…¶ä¸­ pip_ipiâ€‹ è¡¨ç¤º token åœ¨åˆ†å¥ä¸­çš„å±€éƒ¨ä½ç½®ã€‚ä½œè€…ç‰¹æ„é‡‡ç”¨é€’å‡çš„é¡ºåºè¿›è¡Œç¼–ç ï¼Œä»¥ä¾¿ä¿ƒä½¿è¯¥ embedding æ›´å¥½åœ°æ•è·åˆ†å¥ç»“æŸçš„ä¿¡æ¯ç‰¹å¾(p0p_0p0â€‹ æ€»æ˜¯è¡¨ç¤ºæ ‡ç‚¹ç¬¦å·çš„ä½ç½®ï¼Œp1p_1p1â€‹ æ€»æ˜¯è¡¨ç¤ºå¥å­çš„æœ€åä¸€ä¸ªè¯) Segment Symbols: S={s0,s0,s0,s0,s0,&lt;/s&gt;s1,s1,s1,s1,s1,s1,s1,&lt;/s&gt;,&lt;eos&gt;}\\begin{aligned} S = \\{&amp;s_0, s_0, s_0, s_0, s_0, &lt;/s&gt;\\\\ &amp;s_1, s_1, s_1, s_1, s_1, s_1, s_1, &lt;/s&gt;, &lt;eos&gt;\\} \\end{aligned}S={â€‹s0â€‹,s0â€‹,s0â€‹,s0â€‹,s0â€‹,&lt;/s&gt;s1â€‹,s1â€‹,s1â€‹,s1â€‹,s1â€‹,s1â€‹,s1â€‹,&lt;/s&gt;,&lt;eos&gt;}â€‹ å…¶ä¸­çš„ sis_isiâ€‹ è¡¨ç¤ºè¯¥ä½ç½®çš„ token å±äºå“ªä¸ªåˆ†å¥ã€‚è¯¥ embedding æ—¨åœ¨å¢å¼ºä¸åŒä½ç½®ä¸åŒå­å¥ä¹‹é—´çš„äº¤äº’ã€‚ åœ¨è®­ç»ƒæ—¶ï¼Œä¸Šè¿°çš„ embedding å’Œ token çš„è¯åµŒå…¥ä»¥åŠå…¨å±€ä½ç½®åµŒå…¥ç›¸åŠ ä½œä¸ºåºåˆ—çš„è¾“å…¥åµŒå…¥ã€‚ Ht0=Ewt+Ect+Ept+Est+Egt\\mathbf{H}_t^0 = \\mathbf{E}_{w_t} + \\mathbf{E}_{c_t} + \\mathbf{E}_{p_t} + \\mathbf{E}_{s_t} + \\mathbf{E}_{g_t} Ht0â€‹=Ewtâ€‹â€‹+Ectâ€‹â€‹+Eptâ€‹â€‹+Estâ€‹â€‹+Egtâ€‹â€‹ å…¶ä¸­çš„ Ht0\\mathbf{H}_t^0Ht0â€‹ è¡¨ç¤ºç¬¬ ttt ä¸ª token çš„ç¬¬ 000 å±‚è¡¨å¾ï¼ŒEâˆ—\\mathbf{E}_*Eâˆ—â€‹ è¡¨ç¤ºå„ç§çš„ embeddingï¼Œwtw_twtâ€‹ è¡¨ç¤º token ttt çš„è¯åµŒå…¥ï¼Œc,p,sc, p, sc,p,s è¡¨ç¤ºä¸Šè¿°çš„ä¸‰ç§è‡ªå®šä¹‰ embeddingï¼Œggg è¡¨ç¤º token çš„å…¨å±€ä½ç½®ï¼Œä¸ Transformer çš„ç›¸åŒã€‚ ä¿®æ”¹æ³¨æ„åŠ›æœºåˆ¶(çš„å†…å®¹) æ¨¡å‹åœ¨è‡ªå›å½’ç”Ÿæˆä½ç½® ttt çš„ token æ—¶ï¼Œè¿˜éœ€è¦ä¸€äº›é åçš„ä½ç½®çš„ä¿¡æ¯æ¥æŒæ¡å…¨å±€çš„åŠ¨æ€å¥å­ä¿¡æ¯ã€‚å¦‚æ¨¡å‹å¯èƒ½æƒ³çŸ¥é“å½“å‰çš„ token æ˜¯å¦åº”è¯¥æ˜¯æ ‡ç‚¹ç¬¦å·æˆ–è€…æ˜¯å¦æ˜¯æœ€åä¸€ä¸ª tokenã€‚ä¸ºäº†åœ¨é¢„æµ‹çš„è¿‡ç¨‹ç§å¼•å…¥è¿™äº›ä¿¡æ¯ï¼Œä½œè€…å¼•å…¥äº†å¦ä¸€ä¸ªæ³¨æ„åŠ›å‚æ•° F0\\mathbf{F}^0F0: Ft0=Ect+Ept+Est\\mathbf{F}_t^0 = \\mathbf{E}_{c_t} + \\mathbf{E}_{p_t} + \\mathbf{E}_{s_t} Ft0â€‹=Ectâ€‹â€‹+Eptâ€‹â€‹+Estâ€‹â€‹ ä½œè€…å°†æ³¨æ„åŠ›è®¡ç®—è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š Masking Multi-Head Self-Attention: K0,V0=H0WK,H0WVQ0=H0WQCt1=LN(SLF-ATT(Qt0,Kâ‰¤t0,Vâ‰¤t0)+Ht0)Ct1=LN(FFN(Ct1)+Ct1)\\begin{aligned} \\mathbf{K}^0, \\mathbf{V}^0 &amp;= \\mathbf{H}^0\\mathbf{W}^K, \\mathbf{H}^0\\mathbf{W}^V\\\\ \\mathbf{Q}^0 &amp;= \\mathbf{H}^0\\mathbf{W}^Q\\\\ \\mathbf{C}_t^1 &amp;= \\normalsize\\text{L}\\footnotesize\\text{N}(\\normalsize\\text{S}\\footnotesize\\text{LF-}\\normalsize\\text{A}\\footnotesize\\text{TT}(\\mathbf{Q}_t^0, \\mathbf{K}_{\\leq t}^0, \\mathbf{V}_{\\leq t}^0) + \\mathbf{H}_t^0)\\\\ \\mathbf{C}_t^1 &amp;= \\normalsize\\text{L}\\footnotesize\\text{N}(\\normalsize\\text{F}\\footnotesize\\text{FN}(\\mathbf{C}_t^1) + \\mathbf{C}_t^1) \\end{aligned}K0,V0Q0Ct1â€‹Ct1â€‹â€‹=H0WK,H0WV=H0WQ=LN(SLF-ATT(Qt0â€‹,Kâ‰¤t0â€‹,Vâ‰¤t0â€‹)+Ht0â€‹)=LN(FFN(Ct1â€‹)+Ct1â€‹)â€‹ è¯¥è¿‡ç¨‹æ˜¯æ ‡å‡†çš„ Masking Multi-Head Self-Attention è¿‡ç¨‹ï¼Œåœ¨è¿›è¡Œè‡ªæ³¨æ„åŠ›è¿ç®—æ—¶åª attend to â‰¤t\\leq tâ‰¤t çš„æ–‡æœ¬è¡¨å¾(K,V\\mathbf{K, V}K,V), å³å°† &gt;t&gt; t&gt;t çš„ä½ç½® mask æˆ âˆ’âˆ-\\inftyâˆ’âˆ Global Multi-Head Attention: K1,V1=F0WK,F0WVQ1=C1WQHt1=LN(GLOBAL-ATT(Qt1,K1,V1)+Ct1)Ht1=LN(FFN(Ht1)+Ht1)\\begin{aligned} \\mathbf{K}^1, \\mathbf{V}^1 &amp;= \\mathbf{F}^0\\mathbf{W}^K, \\mathbf{F}^0\\mathbf{W}^V\\\\ \\mathbf{Q}^1 &amp;= \\mathbf{C}^1\\mathbf{W}^Q\\\\ \\mathbf{H}_t^1 &amp;= \\normalsize\\text{L}\\footnotesize\\text{N}(\\normalsize\\text{G}\\footnotesize\\text{LOBAL-}\\normalsize\\text{A}\\footnotesize\\text{TT}(\\mathbf{Q}_t^1, \\mathbf{K}^1, \\mathbf{V}^1) + \\mathbf{C}_t^1)\\\\ \\mathbf{H}_t^1 &amp;= \\normalsize\\text{L}\\footnotesize\\text{N}(\\normalsize\\text{F}\\footnotesize\\text{FN}(\\mathbf{H}_t^1) + \\mathbf{H}_t^1) \\end{aligned}K1,V1Q1Ht1â€‹Ht1â€‹â€‹=F0WK,F0WV=C1WQ=LN(GLOBAL-ATT(Qt1â€‹,K1,V1)+Ct1â€‹)=LN(FFN(Ht1â€‹)+Ht1â€‹)â€‹ åœ¨è¯¥è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰ä¸Šä¸‹æ–‡çš„ F0\\mathbf{F}^0F0 éƒ½å‚ä¸è®¡ç®—ï¼Œ F0\\mathbf{F}^0F0 ä¸­åªæœ‰è¾“å…¥çš„æ ¼å¼ï¼ŒéŸµå¾‹å’Œåˆ†æ®µä»¥åŠç›¸å¯¹ä½ç½®ä¿¡æ¯ï¼Œå¹¶ä¸åŒ…å«è¯æœ¬èº«çš„ä¿¡æ¯ã€‚ ä¸Šè¿°ä¸¤ä¸ªæ³¨æ„åŠ›è®¡ç®—å—é‡å¤ LLL å±‚å°±è·å¾—äº†æœ€ç»ˆè¡¨å¾ HL\\mathbf{H}^LHL. LLL å±‚çš„è®¡ç®—ä¸­ï¼ŒHlH^lHl æ¯å±‚éƒ½ä¼šæ›´æ–°ï¼Œè€Œ F0\\mathbf{F}^0F0 æ˜¯å…¨å±€å›ºå®šçš„ã€‚ è®­ç»ƒç›®æ ‡æ˜¯æœ€å°åŒ–æ•´ä¸ªåºåˆ—çš„è´Ÿå¯¹æ•°ä¼¼ç„¶ï¼š Lnll=âˆ’âˆ‘t=1nlogâ¡P(ytâˆ£y&lt;t)\\mathcal{L}^{\\text{nll}} = -\\sum_{t = 1}^n\\log P(\\mathbf{y}_t|\\mathbf{y}_{&lt;t}) Lnll=âˆ’t=1âˆ‘nâ€‹logP(ytâ€‹âˆ£y&lt;tâ€‹) ä¸€äº›ä¸åˆšæ€§æ–‡æœ¬æ ¼å¼(å®‹è¯ï¼Œåå››è¡Œè¯—)ç›¸å…³çš„è¯„ä»·æŒ‡æ ‡ç­‰ç»†èŠ‚","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"NLP","slug":"NLP","permalink":"https://blog.zhuwenq.cc/tags/NLP/"},{"name":"Text Generation","slug":"Text-Generation","permalink":"https://blog.zhuwenq.cc/tags/Text-Generation/"}]},{"title":"Translating Embeddings for Modeling Multi-relational Data","slug":"Translating-Embeddings-for-Modeling-Multi-relational-Data","date":"2021-10-13T16:00:00.000Z","updated":"2023-06-21T06:51:28.932Z","comments":true,"path":"Translating-Embeddings-for-Modeling-Multi-relational-Data/","link":"","permalink":"https://blog.zhuwenq.cc/Translating-Embeddings-for-Modeling-Multi-relational-Data/","excerpt":"Motivation æœ¬æ–‡ä¸»è¦é’ˆå¯¹åœ¨ä½ç»´å‘é‡ç©ºé—´ä¸­åµŒå…¥å¤šå…³ç³»æ•°æ®(Multi-relational data)çš„å®ä½“å’Œå…³ç³»ä¿¡æ¯çš„é—®é¢˜ã€‚ Multi-relational Data, æŒ‡èŠ‚ç‚¹å½¢å¦‚ (head,label,tail)(head, label, tail)(head,label,tail) çš„æœ‰å‘å›¾ï¼ŒèŠ‚ç‚¹ä¸­çš„ä¸‰å…ƒç»„åˆ†åˆ«ä»£è¡¨å¤´å®ä½“(head entity), å°¾å®ä½“(tail entity)å’Œå¤´å°¾å®ä½“ä¹‹é—´çš„å…³ç³»(label)ã€‚æœ¬æ–‡çš„å·¥ä½œä¸»è¦å°±å…³æ³¨äºå¦‚ä½•å»ºæ¨¡ Multi-relation data çš„é—®é¢˜ã€‚ Modeling multi-relational data å¤šå…³ç³»æ•°æ®å»ºæ¨¡è¿‡ç¨‹å¯ä»¥å½’ç»“ä¸ºå®ä½“ä¹‹é—´çš„å±€éƒ¨æˆ–å…¨å±€å…³ç³»æ¨¡å¼çš„æŠ½å–è¿‡ç¨‹ï¼Œå¹¶æ ¹æ®è§‚å¯Ÿåˆ°çš„å…³ç³»æ¨¡å¼æ³›åŒ–åˆ°æ‰€æœ‰å®ä½“ä¹‹é—´è¿›è¡Œé¢„æµ‹ã€‚å•ä¸€å…³ç³»çš„å±€éƒ¨æ€§å¯èƒ½æ˜¯çº¯ç²¹ç»“æ„æ€§çš„ï¼Œä½†ä¹Ÿä¸å®ä½“ç±»å‹ç›¸å…³ã€‚ä¸€èˆ¬çš„å…³ç³»æ•°æ®åˆ™æ›´åŠ å¤æ‚ï¼ŒåŒæ—¶æ¶‰åŠå…³ç³»å’Œå®ä½“çš„ç±»å‹ã€‚å› æ­¤å…³ç³»æ•°æ®æ˜¯å¼‚æ„çš„ï¼Œéœ€è¦æ›´åŠ æ³›åŒ–æ€§çš„æ–¹æ³•å»ºæ¨¡ã€‚ ç°å­˜çš„æ–¹æ³•å¤§å¤šåŸºäºéšå¼å±æ€§å­¦ä¹ çš„æ¡†æ¶ï¼Œå³é€šè¿‡å­¦ä¹ å®ä½“å’Œå…³ç³»æ•°æ®çš„éšè—è¡¨å¾è¿›è¡Œå»ºæ¨¡ã€‚è¿™äº›å·¥ä½œé›†ä¸­äºå¢åŠ æ¨¡å‹çš„è¡¨ç°åŠ›å’Œé€šç”¨æ€§ï¼Œä¸€èˆ¬é‡‡ç”¨è´å¶æ–¯èšç±»æ¡†æ¶æˆ–è€…åŸºäºèƒ½é‡çš„æ¡†æ¶åœ¨ä½ç»´å‘é‡ç©ºé—´å­¦ä¹ å®ä½“çš„è¡¨å¾ã€‚è¿™äº›æ¨¡å‹çš„è¡¨ç°åŠ›çš„æå‡æ˜¯ä»¥æ¨¡å‹å¤æ‚åº¦çš„å¢åŠ ä½œä¸ºä»£ä»·ï¼Œè¿™å¯¼è‡´å…¶å»ºæ¨¡å‡è®¾éš¾ä»¥è§£é‡Šï¼ŒåŒæ—¶å¸¦æ¥è®¡ç®—æˆæœ¬çš„æé«˜ã€‚","text":"Motivation æœ¬æ–‡ä¸»è¦é’ˆå¯¹åœ¨ä½ç»´å‘é‡ç©ºé—´ä¸­åµŒå…¥å¤šå…³ç³»æ•°æ®(Multi-relational data)çš„å®ä½“å’Œå…³ç³»ä¿¡æ¯çš„é—®é¢˜ã€‚ Multi-relational Data, æŒ‡èŠ‚ç‚¹å½¢å¦‚ (head,label,tail)(head, label, tail)(head,label,tail) çš„æœ‰å‘å›¾ï¼ŒèŠ‚ç‚¹ä¸­çš„ä¸‰å…ƒç»„åˆ†åˆ«ä»£è¡¨å¤´å®ä½“(head entity), å°¾å®ä½“(tail entity)å’Œå¤´å°¾å®ä½“ä¹‹é—´çš„å…³ç³»(label)ã€‚æœ¬æ–‡çš„å·¥ä½œä¸»è¦å°±å…³æ³¨äºå¦‚ä½•å»ºæ¨¡ Multi-relation data çš„é—®é¢˜ã€‚ Modeling multi-relational data å¤šå…³ç³»æ•°æ®å»ºæ¨¡è¿‡ç¨‹å¯ä»¥å½’ç»“ä¸ºå®ä½“ä¹‹é—´çš„å±€éƒ¨æˆ–å…¨å±€å…³ç³»æ¨¡å¼çš„æŠ½å–è¿‡ç¨‹ï¼Œå¹¶æ ¹æ®è§‚å¯Ÿåˆ°çš„å…³ç³»æ¨¡å¼æ³›åŒ–åˆ°æ‰€æœ‰å®ä½“ä¹‹é—´è¿›è¡Œé¢„æµ‹ã€‚å•ä¸€å…³ç³»çš„å±€éƒ¨æ€§å¯èƒ½æ˜¯çº¯ç²¹ç»“æ„æ€§çš„ï¼Œä½†ä¹Ÿä¸å®ä½“ç±»å‹ç›¸å…³ã€‚ä¸€èˆ¬çš„å…³ç³»æ•°æ®åˆ™æ›´åŠ å¤æ‚ï¼ŒåŒæ—¶æ¶‰åŠå…³ç³»å’Œå®ä½“çš„ç±»å‹ã€‚å› æ­¤å…³ç³»æ•°æ®æ˜¯å¼‚æ„çš„ï¼Œéœ€è¦æ›´åŠ æ³›åŒ–æ€§çš„æ–¹æ³•å»ºæ¨¡ã€‚ ç°å­˜çš„æ–¹æ³•å¤§å¤šåŸºäºéšå¼å±æ€§å­¦ä¹ çš„æ¡†æ¶ï¼Œå³é€šè¿‡å­¦ä¹ å®ä½“å’Œå…³ç³»æ•°æ®çš„éšè—è¡¨å¾è¿›è¡Œå»ºæ¨¡ã€‚è¿™äº›å·¥ä½œé›†ä¸­äºå¢åŠ æ¨¡å‹çš„è¡¨ç°åŠ›å’Œé€šç”¨æ€§ï¼Œä¸€èˆ¬é‡‡ç”¨è´å¶æ–¯èšç±»æ¡†æ¶æˆ–è€…åŸºäºèƒ½é‡çš„æ¡†æ¶åœ¨ä½ç»´å‘é‡ç©ºé—´å­¦ä¹ å®ä½“çš„è¡¨å¾ã€‚è¿™äº›æ¨¡å‹çš„è¡¨ç°åŠ›çš„æå‡æ˜¯ä»¥æ¨¡å‹å¤æ‚åº¦çš„å¢åŠ ä½œä¸ºä»£ä»·ï¼Œè¿™å¯¼è‡´å…¶å»ºæ¨¡å‡è®¾éš¾ä»¥è§£é‡Šï¼ŒåŒæ—¶å¸¦æ¥è®¡ç®—æˆæœ¬çš„æé«˜ã€‚ Methodology æœ¬æ–‡æå‡º TransE æ¨¡å‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºå®ä½“ä½ç»´åµŒå…¥å­¦ä¹ çš„åŸºäºèƒ½é‡çš„æ¨¡å‹ã€‚ TransE å°†å…³ç³»è§†ä¸ºåµŒå…¥ç©ºé—´ä¸­çš„è½¬ç§»ï¼Œå³ï¼šå¦‚æœå…³ç³» (h,l,t)(h, l, t)(h,l,t) å­˜åœ¨ï¼Œé‚£ä¹ˆå°¾å®ä½“ ttt çš„ embedding åº”è¯¥ä¸å¤´å®ä½“ hhh çš„ embedding å’Œä¸€äº›ä¸å…³ç³» lll ç›¸å…³çš„å‘é‡çš„åŠ å’Œç›¸è¿‘ã€‚ Translation-based model å®šä¹‰è®­ç»ƒé›† SSS, SSS ä¸­çš„å…ƒç´ ä¸ºä¸‰å…ƒç»„ (h,l,t)(h, l, t)(h,l,t). å®šä¹‰å®ä½“é›† EEE, å…³ç³»é›† LLL, è®­ç»ƒé›†ä¸­ä¸‰å…ƒç»„çš„ h,lâˆˆEh, l \\in Eh,lâˆˆE å’Œ lll åˆ†åˆ«ä¸º EEE ä¸­çš„å®ä½“å’Œ LLL ä¸­çš„å…³ç³»ã€‚æ¨¡å‹ä¸ºå®ä½“å’Œå…³ç³»å­¦ä¹  kkk ç»´åµŒå…¥å‘é‡ h,l,tâˆˆRk\\mathbf{h, l, t} \\in \\mathbb{R}^kh,l,tâˆˆRk. æ¨¡å‹çš„åŸºæœ¬æ€è·¯æ˜¯ï¼šå½“å…³ç³» (h,l,t)(h, l, t)(h,l,t) å­˜åœ¨æ—¶ï¼Œä½¿å…³ç³» h+lâ‰ˆt\\mathbf{h} + \\mathbf{l} \\approx \\mathbf{t}h+lâ‰ˆt ä¹Ÿæˆç«‹( t\\mathbf{t}t åº”è¯¥æ˜¯è·ç¦» h+l\\mathbf{h + l}h+l æœ€è¿‘çš„å‘é‡ )ã€‚ æ ¹æ®åŸºäºèƒ½é‡çš„æ¡†æ¶(Energy-based Framework), ä¸€ä¸ªä¸‰å…ƒç»„çš„èƒ½é‡ç­‰äº d(h+l,t)d(\\mathbf{h} + \\mathbf{l}, \\mathbf{t})d(h+l,t), å…¶ä¸­ ddd æ˜¯æŸç§ä¸ç›¸ä¼¼æ€§è¯„ä»·å‡½æ•°( L1L_1L1â€‹ æˆ– L2L_2L2â€‹ èŒƒæ•° )ã€‚ è®­ç»ƒæ—¶ï¼Œåœ¨è®­ç»ƒé›†ä¸Šæœ€å°åŒ–ä¸‹é¢åŸºäºè¾¹é™…çš„æ’åºæ ‡å‡†(margin-based ranking criterion): L=âˆ‘(h,l,t)âˆˆSâˆ‘(hâ€²,l,tâ€²)âˆˆS(h,l,t)â€²[Î³+d(h+l,t)âˆ’d(hâ€²+l,tâ€²)]+\\mathcal{L} = \\sum_{(h, l, t) \\in S}\\sum_{(h&#x27;, l, t&#x27;) \\in S&#x27;_{(h, l, t)}}[\\gamma + d(\\mathbf{h} + \\mathbf{l}, \\mathbf{t}) - d(\\mathbf{h&#x27;} + \\mathbf{l}, \\mathbf{t&#x27;})]_+ L=(h,l,t)âˆˆSâˆ‘â€‹(hâ€²,l,tâ€²)âˆˆS(h,l,t)â€²â€‹âˆ‘â€‹[Î³+d(h+l,t)âˆ’d(hâ€²+l,tâ€²)]+â€‹ å…¶ä¸­çš„ [x]+[x]_+[x]+â€‹ è¡¨ç¤º xxx çš„æ­£å€¼éƒ¨åˆ†ï¼ŒÎ³&gt;0\\gamma &gt; 0Î³&gt;0 æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼Œ Sâ€²S&#x27;Sâ€² å®šä¹‰å¦‚ä¸‹ï¼š S(h,l,t)â€²={(hâ€²,l,t)âˆ£hâ€²âˆˆE}âˆª{(h,l,tâ€²)âˆ£tâ€²âˆˆE}S&#x27;_{(h, l, t)} = \\{(h&#x27;, l, t)|h&#x27; \\in E\\} \\cup \\{(h, l, t&#x27;)|t&#x27; \\in E\\} S(h,l,t)â€²â€‹={(hâ€²,l,t)âˆ£hâ€²âˆˆE}âˆª{(h,l,tâ€²)âˆ£tâ€²âˆˆE} Sâ€²S&#x27;Sâ€² ç”±è®­ç»ƒé›†ä¸­çš„ä¸‰å…ƒç»„éšæœºæ›¿æ¢ä¸€ä¸ªå¤´å®ä½“æˆ–å°¾å®ä½“(åŒæ—¶åªæ›¿æ¢ä¸€ä¸ª)ç»„æˆã€‚ ä¼˜åŒ–çš„è¿‡ç¨‹é€šè¿‡åœ¨æ‰€æœ‰å¯èƒ½çš„ (h,l,t)(h, l, t)(h,l,t) ä¸Šè¿›è¡Œéšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•å®Œæˆ(minibatch mode), ä¸€ä¸ªé™„åŠ é™åˆ¶æ˜¯å­¦ä¹ åˆ°çš„æ‰€æœ‰å®ä½“çš„åµŒå…¥å…¶ L2L_2L2â€‹ èŒƒæ•°ç­‰äº 111(å…³ç³»çš„åµŒå…¥ä¸å—æ­¤é™åˆ¶) ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢è®­ç»ƒè¿‡ç¨‹é€šè¿‡å‡å°å®ä½“çš„åµŒå…¥å‘é‡æ¥æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚ TransE çš„è®­ç»ƒè¿‡ç¨‹å¦‚ä¸‹ï¼š æ‰€æœ‰å®ä½“å’Œå…³ç³»çš„åµŒå…¥å‘é‡é¦–å…ˆç”±éšæœºè¿‡ç¨‹åˆå§‹åŒ–ï¼Œåœ¨æ¯æ¬¡è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆå½’ä¸€åŒ–å®ä½“çš„åµŒå…¥å‘é‡(å½’ä¸€åŒ–é™åˆ¶), ç„¶åä»è®­ç»ƒé›†ä¸­é‡‡æ ·ä¸€ä¸ªå°çš„å­é›†ä½œä¸ºè®­ç»ƒçš„ minibatch ã€‚å¯¹äºæ¯ä¸€ä¸ªè®­ç»ƒä¸‰å…ƒç»„ï¼Œä¸ºå…¶é‡‡æ ·ä¸€ä¸ªå—æŸæ ·æœ¬ï¼Œç„¶ååœ¨æ’å®šå­¦ä¹ ç‡ä¸‹æ ¹æ®æ¢¯åº¦æ›´æ–°å‚æ•°ã€‚","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"Knowledge Embedding","slug":"Knowledge-Embedding","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Embedding/"},{"name":"TransE","slug":"TransE","permalink":"https://blog.zhuwenq.cc/tags/TransE/"}]},{"title":"ERNIE: Enhanced Language Representation with Informative Entities","slug":"ERNIE-Enhanced-Language-Representation-with-Informative-Entities","date":"2021-10-09T16:00:00.000Z","updated":"2023-06-21T06:51:28.788Z","comments":true,"path":"ERNIE-Enhanced-Language-Representation-with-Informative-Entities/","link":"","permalink":"https://blog.zhuwenq.cc/ERNIE-Enhanced-Language-Representation-with-Informative-Entities/","excerpt":"Motivition BERT ç­‰åœ¨å¤§è§„æ¨¡è¯­æ–™åº“ä¸Šè®­ç»ƒçš„è¯­è¨€è¡¨å¾æ¨¡å‹å¯ä»¥æå–åˆ°ä¸°å¯Œçš„è¯­ä¹‰ä¿¡æ¯ï¼Œä½œè€…è®¤ä¸ºç»“åˆçŸ¥è¯†å›¾è°±ä¸­çš„å®ä½“ä¿¡æ¯å¯ä»¥å¼•å…¥é¢å¤–çŸ¥è¯†æ¥å¢å¼ºè¯­è¨€è¡¨å¾ã€‚ BERT ç­‰è¯­è¨€è¡¨å¾æ¨¡å‹è™½ç„¶å·²ç»ä½œä¸ºè®¸å¤š NLP ä»»åŠ¡çš„ä¸€éƒ¨åˆ†å–å¾—äº†å¾ˆå¥½çš„ç»“æœï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰å¼•å…¥å…ˆéªŒçŸ¥è¯†ï¼Œåœ¨è¯­è¨€ç†è§£ç±»ä»»åŠ¡ä¸­å­˜åœ¨åŠ£åŠ¿ã€‚ä¾‹å¦‚å¯¹äºè‡ªç„¶è¯­è¨€è¯­å¥ï¼šBob Dylan wrote Blowinâ€™ in the Wind in 1962, and wrote Chronicles: Volume One in 2004.\\text{Bob Dylan wrote Blowinâ€™ in the Wind in 1962, and wrote Chronicles: Volume One in 2004.}Bob Dylan wrote Blowinâ€™ in the Wind in 1962, and wrote Chronicles: Volume One in 2004., å¦‚æœä¸çŸ¥é“ Blowinâ€™ in the Wind\\text{Blowinâ€™ in the Wind}Blowinâ€™ in the Wind å’Œ Chronicles: Volume One\\text{Chronicles: Volume One}Chronicles: Volume One æ˜¯æ­Œæ›²ï¼Œåœ¨å®ä½“åˆ†ç±»ä»»åŠ¡ä¸­å°±æ— æ³•åˆ†è¾¨ Bob Dylan\\text{Bob Dylan}Bob Dylan ç©¶ç«Ÿæ˜¯ä½œå®¶è¿˜æ˜¯æ­Œæ‰‹ã€‚åŒæ—¶ä¹Ÿå‡ ä¹æ— æ³•æå–ç»†ç²’åº¦å…³ç³»ã€‚å› æ­¤ï¼Œå¼•å…¥å¼•å…¥é¢å¤–çš„çŸ¥è¯†ä¿¡æ¯å¯ä»¥åœ¨è®¸å¤šåŸºäºçŸ¥è¯†çš„ä»»åŠ¡ä¸­å—ç›Šï¼Œä¾‹å¦‚å®ä½“åˆ†ç±»å’Œå…³ç³»è¯†åˆ«ä»»åŠ¡ã€‚","text":"Motivition BERT ç­‰åœ¨å¤§è§„æ¨¡è¯­æ–™åº“ä¸Šè®­ç»ƒçš„è¯­è¨€è¡¨å¾æ¨¡å‹å¯ä»¥æå–åˆ°ä¸°å¯Œçš„è¯­ä¹‰ä¿¡æ¯ï¼Œä½œè€…è®¤ä¸ºç»“åˆçŸ¥è¯†å›¾è°±ä¸­çš„å®ä½“ä¿¡æ¯å¯ä»¥å¼•å…¥é¢å¤–çŸ¥è¯†æ¥å¢å¼ºè¯­è¨€è¡¨å¾ã€‚ BERT ç­‰è¯­è¨€è¡¨å¾æ¨¡å‹è™½ç„¶å·²ç»ä½œä¸ºè®¸å¤š NLP ä»»åŠ¡çš„ä¸€éƒ¨åˆ†å–å¾—äº†å¾ˆå¥½çš„ç»“æœï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰å¼•å…¥å…ˆéªŒçŸ¥è¯†ï¼Œåœ¨è¯­è¨€ç†è§£ç±»ä»»åŠ¡ä¸­å­˜åœ¨åŠ£åŠ¿ã€‚ä¾‹å¦‚å¯¹äºè‡ªç„¶è¯­è¨€è¯­å¥ï¼šBob Dylan wrote Blowinâ€™ in the Wind in 1962, and wrote Chronicles: Volume One in 2004.\\text{Bob Dylan wrote Blowinâ€™ in the Wind in 1962, and wrote Chronicles: Volume One in 2004.}Bob Dylan wrote Blowinâ€™ in the Wind in 1962, and wrote Chronicles: Volume One in 2004., å¦‚æœä¸çŸ¥é“ Blowinâ€™ in the Wind\\text{Blowinâ€™ in the Wind}Blowinâ€™ in the Wind å’Œ Chronicles: Volume One\\text{Chronicles: Volume One}Chronicles: Volume One æ˜¯æ­Œæ›²ï¼Œåœ¨å®ä½“åˆ†ç±»ä»»åŠ¡ä¸­å°±æ— æ³•åˆ†è¾¨ Bob Dylan\\text{Bob Dylan}Bob Dylan ç©¶ç«Ÿæ˜¯ä½œå®¶è¿˜æ˜¯æ­Œæ‰‹ã€‚åŒæ—¶ä¹Ÿå‡ ä¹æ— æ³•æå–ç»†ç²’åº¦å…³ç³»ã€‚å› æ­¤ï¼Œå¼•å…¥å¼•å…¥é¢å¤–çš„çŸ¥è¯†ä¿¡æ¯å¯ä»¥åœ¨è®¸å¤šåŸºäºçŸ¥è¯†çš„ä»»åŠ¡ä¸­å—ç›Šï¼Œä¾‹å¦‚å®ä½“åˆ†ç±»å’Œå…³ç³»è¯†åˆ«ä»»åŠ¡ã€‚ Challenge ä¸ºäº†åœ¨è¯­è¨€è¡¨å¾ä¸­å¼•å…¥é¢å¤–çŸ¥è¯†ï¼Œæœ‰ä»¥ä¸‹ä¸¤ä¸ªæŒ‘æˆ˜ï¼š ç»“æ„åŒ–çŸ¥è¯†ç¼–ç ï¼šå³å¦‚ä½•ä»çŸ¥è¯†å›¾è°±ä¸­æå–å’Œç¼–ç ä¸è¾“å…¥æ–‡æœ¬æœ‰å…³çš„çŸ¥è¯†ä¿¡æ¯ å¼‚æ„ä¿¡æ¯èåˆï¼šå³å¦‚ä½•è®¾è®¡ä¸€ç§ç‰¹æ®Šçš„é¢„è®­ç»ƒç›®æ ‡ï¼Œä»¥èåˆè¯­ä¹‰ï¼Œå¥æ³•å’ŒçŸ¥è¯†ä¿¡æ¯ Contribution é’ˆå¯¹ç»“æ„åŒ–çŸ¥è¯†ç¼–ç é—®é¢˜ï¼šä½œè€…é¦–å…ˆè¯†åˆ«å‡ºè¾“å…¥æ–‡æœ¬ä¸­æåŠçš„å®ä½“ï¼Œç„¶åå°†å…¶ä¸å…¶åœ¨çŸ¥è¯†å›¾è°±ä¸­ç›¸åº”çš„å®ä½“å¯¹é½(æå–)ã€‚åœ¨ç¼–ç æ–¹é¢ï¼Œä½œè€…ä½¿ç”¨çŸ¥è¯†åµŒå…¥ç®—æ³•ï¼ˆå¦‚ TransEï¼‰å¯¹çŸ¥è¯†å›¾è°±çš„å›¾ç»“æ„è¿›è¡Œç¼–ç ï¼Œå¹¶å°†ç¼–ç çš„çŸ¥è¯†åµŒå…¥ä½œä¸º ERNIE çš„è¾“å…¥ã€‚åŸºäºæ–‡æœ¬å’ŒçŸ¥è¯†å®ä½“ä¹‹é—´çš„å¯¹é½ï¼Œ ERINE å°†çŸ¥è¯†æ¨¡å—ä¸­çš„å®ä½“è¡¨å¾é›†æˆåˆ°äº†è¯­ä¹‰æ¨¡å—çš„åº•å±‚ ä¸ BERT ç±»ä¼¼ï¼Œä½œè€…ä½¿ç”¨äº† MLM å’Œ NSP ä½œä¸ºé¢„è®­ç»ƒç›®æ ‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½œè€…è®¾è®¡äº†ä¸€ç§æ–°çš„é¢„è®­ç»ƒç›®æ ‡ä»¥æ›´å¥½åœ°èåˆæ–‡æœ¬å’ŒçŸ¥è¯†ç‰¹å¾ï¼šéšæœºé®ä½è¾“å…¥æ–‡æœ¬ä¸­çš„ä¸€äº›å‘½åå®ä½“å¯¹é½ï¼Œå¹¶è®©æ¨¡å‹ä»çŸ¥è¯†å›¾è°±ä¸­é€‰æ‹©åˆé€‚çš„å®ä½“æ¥è¡¥å…¨é®ä½çš„éƒ¨åˆ†ã€‚è¿™ä½¿å¾—æ¨¡å‹å¿…é¡»ç»“åˆä¸Šä¸‹æ–‡ä¿¡æ¯å’ŒçŸ¥è¯†ä¿¡æ¯æ‰èƒ½é¢„æµ‹è¢«é®ä½çš„ tokens å’Œ entitiesï¼Œä»è€Œå®ç°äº†ä¸€ä¸ªçŸ¥è¯†æ€§çš„è¯­è¨€è¡¨å¾æ¨¡å‹ Methodology è¾“å…¥åºåˆ—è®°ä½œ {w1,...,wn}\\{w_1, ..., w_n\\}{w1â€‹,...,wnâ€‹}, å…¶ä¸­ nnn æ˜¯åºåˆ—çš„ token é•¿åº¦ã€‚è¾“å…¥åºåˆ—ä¸­çš„å®ä½“åºåˆ—è®°ä½œ {e1,...,em}\\{e_1, ..., e_m\\}{e1â€‹,...,emâ€‹}, å…¶ä¸­ mmm æ˜¯å®ä½“åºåˆ—çš„é•¿åº¦ã€‚å°†åŒ…å«æ‰€æœ‰ token çš„è¯å…¸è®°ä½œ V\\mathcal{V}V, åŒ…æ‹¬çŸ¥è¯†å›¾è°±ä¸­æ‰€æœ‰å®ä½“çš„å®ä½“åˆ—è¡¨è®°ä½œ E\\mathcal{E}Eã€‚å¦‚æœä¸€ä¸ª token wâˆˆVw \\in \\mathcal{V}wâˆˆV å±äºä¸€ä¸ªå®ä½“ eâˆˆEe \\in \\mathcal{E}eâˆˆE, åˆ™å®šä¹‰å®ƒä»¬çš„å¯¹é½ä¸ºï¼šf(w)=ef(w) = ef(w)=eã€‚æœ¬æ–‡ä¸­ï¼Œå°†æ‰€æœ‰çš„å®ä½“å¯¹é½åˆ°å®ä½“çŸ­è¯­çš„ç¬¬ä¸€ä¸ª tokenã€‚ æ¨¡å‹æ¶æ„ ERNIE çš„æ¶æ„åŒ…å«ä¸¤ä¸ªæ¨¡å—ï¼š åŸºç¡€çš„æ–‡æœ¬ç¼–ç å™¨ (T-Encoder\\text{T-Encoder}T-Encoder), è´Ÿè´£æ•æ‰åŸºç¡€çš„è¯­ä¹‰å’Œè¯­æ³•ä¿¡æ¯ã€‚ï¼ˆBERTï¼‰ ä¸Šå±‚çš„çŸ¥è¯†ç¼–ç å™¨ (K-Encoder\\text{K-Encoder}K-Encoder), è´Ÿè´£å°†é¢å¤–çš„ token å¯¼å‘çš„çŸ¥è¯†ä¿¡æ¯èåˆåˆ°æ–‡æœ¬ä¿¡æ¯çš„åº•å±‚ã€‚ T-Encoder,K-Encoder\\text{T-Encoder}, \\text{K-Encoder}T-Encoder,K-Encoder çš„å±‚æ•°åˆ†åˆ«ä¸º N,MN, MN,M å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå¯¹äºä¸€ä¸ªç»™å®šçš„ token åºåˆ— {w1,...,wn}\\{w_1, ..., w_n\\}{w1â€‹,...,wnâ€‹} å’Œå¯¹åº”çš„å®ä½“åºåˆ— {e1,...,em}\\{e_1, ..., e_m\\}{e1â€‹,...,emâ€‹}, æ–‡æœ¬ç¼–ç å™¨é¦–å…ˆå°†å¯¹æ¯ä¸ª token è®¡ç®—è¾“å…¥ embeddingï¼štoken embedding + segment embedding + positional embedding. ç„¶åè®¡ç®—è¯­æ³•è¯­ä¹‰ç‰¹å¾(BERT çš„è¿‡ç¨‹)ï¼š {w1,...,wn}=T-Encoder({w1,...,wn})\\{\\mathbf{w}_1, ..., \\mathbf{w}_n\\} = \\text{T-Encoder}(\\{w_1, ..., w_n\\}) {w1â€‹,...,wnâ€‹}=T-Encoder({w1â€‹,...,wnâ€‹}) å…¶ä¸­çš„ T-Encoder(â‹…)\\text{T-Encoder}(\\cdot)T-Encoder(â‹…) æ˜¯ä¸€ä¸ªå¤šå±‚åŒå‘ Transformer ç¼–ç å™¨ï¼Œä¸ BERT ç›¸åŒã€‚ ä¹‹åï¼ŒERNIE ä½¿ç”¨ä¸€ä¸ªçŸ¥è¯†ç¼–ç å™¨ K-Encoder\\text{K-Encoder}K-Encoder æ¥å‘è¯­è¨€è¡¨å¾æ’å…¥çŸ¥è¯†ä¿¡æ¯ã€‚å…·ä½“åœ°è¯´ï¼Œé¦–å…ˆä½¿ç”¨é¢„è®­ç»ƒçš„çŸ¥è¯†åµŒå…¥æ¨¡å‹ TransE [[Translating-Embeddings-for-Modeling-Multi-relational-Data]] è®¡ç®—å®ä½“åºåˆ— {e1,...,em}\\{e_1, ..., e_m\\}{e1â€‹,...,emâ€‹} çš„åµŒå…¥ {e1,...,em}\\{\\mathbf{e}_1, ..., \\mathbf{e}_m\\}{e1â€‹,...,emâ€‹}, ç„¶åå°† {w1,...,wn}\\{\\mathbf{w}_1, ..., \\mathbf{w}_n\\}{w1â€‹,...,wnâ€‹} å’Œ {e1,...,em}\\{\\mathbf{e}_1, ..., \\mathbf{e}_m\\}{e1â€‹,...,emâ€‹} é€å…¥ K-Encoder\\text{K-Encoder}K-Encoder è¿›è¡Œå¼‚æ„ä¿¡æ¯èåˆå¹¶è®¡ç®—æœ€ç»ˆçš„è¾“å‡ºåµŒå…¥ï¼š {w1o,...,wno},{e1o,...,emo}=K-Encoder({w1,...,wn},{e1,...,em})\\{\\mathbf{w}_1^o, ..., \\mathbf{w}_n^o\\}, \\{\\mathbf{e}_1^o, ..., \\mathbf{e}_m^o\\} = \\text{K-Encoder}(\\{\\mathbf{w}_1, ..., \\mathbf{w}_n\\}, \\{\\mathbf{e}_1, ..., \\mathbf{e}_m\\}) {w1oâ€‹,...,wnoâ€‹},{e1oâ€‹,...,emoâ€‹}=K-Encoder({w1â€‹,...,wnâ€‹},{e1â€‹,...,emâ€‹}) {w1o,...,wno},{e1o,...,emo}\\{\\mathbf{w}_1^o, ..., \\mathbf{w}_n^o\\}, \\{\\mathbf{e}_1^o, ..., \\mathbf{e}_m^o\\}{w1oâ€‹,...,wnoâ€‹},{e1oâ€‹,...,emoâ€‹} å°†è¢«ç”¨äºå…·ä½“çš„ä»»åŠ¡ã€‚ çŸ¥è¯†ç¼–ç å™¨ K-Encoder\\text{K-Encoder}K-Encoder ä¸­çš„ Multi-Head Attention\\text{Multi-Head Attention}Multi-Head Attention éƒ¨åˆ†å³æ­£å¸¸çš„è‡ªæ³¨æ„åŠ›è¿‡ç¨‹: {w~1(i),...,w~n(i)}=MH-ATT({w1(iâˆ’1),...,wn(iâˆ’1)}){e~1(i),...,e~m(i)}=MH-ATT({e1(iâˆ’1),...,em(iâˆ’1)})\\begin{array}{rl} \\{\\widetilde{\\mathbf{w}}_1^{(i)}, ..., \\widetilde{\\mathbf{w}}_n^{(i)}\\} &amp;= \\text{MH-ATT}(\\{\\mathbf{w}_1^{(i-1)}, ..., \\mathbf{w}_n^{(i-1)}\\})\\\\ \\{\\widetilde{\\mathbf{e}}_1^{(i)}, ..., \\widetilde{\\mathbf{e}}_m^{(i)}\\} &amp;= \\text{MH-ATT}(\\{\\mathbf{e}_1^{(i-1)}, ..., \\mathbf{e}_m^{(i-1)}\\}) \\end{array}{w1(i)â€‹,...,wn(i)â€‹}{e1(i)â€‹,...,em(i)â€‹}â€‹=MH-ATT({w1(iâˆ’1)â€‹,...,wn(iâˆ’1)â€‹})=MH-ATT({e1(iâˆ’1)â€‹,...,em(iâˆ’1)â€‹})â€‹ ç»è¿‡è‡ªæ³¨æ„ä¹‹åï¼Œç¬¬ iii ä¸ªèšåˆå™¨ç”¨äºå°† token å’Œ entity åºåˆ—ç›¸äº’èåˆï¼Œå¹¶ä¸ºæ¯ä¸ª token å’Œ entity è®¡ç®—ä¸€ä¸ªè¾“å‡º embeddingã€‚å¯¹äº token wjw_jwjâ€‹ å’Œå®ƒå¯¹åº”çš„å®ä½“ ek=f(wj)e_k = f(w_j)ekâ€‹=f(wjâ€‹), ä¿¡æ¯èåˆè¿‡ç¨‹å¦‚ä¸‹ï¼š hj=Ïƒ(W~t(i)w~j(i)+W~eie~k(i)+b~(i))wj(i)=Ïƒ(Wt(i)hj+bt(i))ek(i)=Ïƒ(W~e(i)hj+be(i))\\begin{array}{rl} \\mathbf{h}_j &amp;= \\sigma(\\widetilde{\\mathbf{W}}_t^{(i)}\\widetilde{\\mathbf{w}}_j^{(i)} + \\widetilde{\\mathbf{W}}_e^{i}\\widetilde{\\mathbf{e}}_k^{(i)} + \\widetilde{\\mathbf{b}}^{(i)})\\\\ \\mathbf{w}_j^{(i)} &amp;= \\sigma(\\mathbf{W}_t^{(i)}\\mathbf{h}_j + \\mathbf{b}_t^{(i)})\\\\ \\mathbf{e}_k^{(i)} &amp;= \\sigma(\\widetilde{\\mathbf{W}}_e^{(i)}\\mathbf{h}_j + \\mathbf{b}_e^{(i)}) \\end{array}hjâ€‹wj(i)â€‹ek(i)â€‹â€‹=Ïƒ(Wt(i)â€‹wj(i)â€‹+Weiâ€‹ek(i)â€‹+b(i))=Ïƒ(Wt(i)â€‹hjâ€‹+bt(i)â€‹)=Ïƒ(We(i)â€‹hjâ€‹+be(i)â€‹)â€‹ å…¶ä¸­çš„ hj\\mathbf{h}_jhjâ€‹ æ˜¯èšåˆäº† token å’Œ entity ä¿¡æ¯çš„å†…éƒ¨éšè—çŠ¶æ€ã€‚Ïƒ(â‹…)\\sigma(\\cdot)Ïƒ(â‹…) æ˜¯éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œé€šå¸¸æ˜¯ GELU å‡½æ•°ã€‚å¯¹äºä¸å±äºå®ä½“çŸ­è¯­çš„ tokens, ä¿¡æ¯èåˆå±‚è®¡ç®—å…¶è¾“å‡º embedding çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š hj=Ïƒ(W~t(i)w~j(i)+b~(i))wj(i)=Ïƒ(Wt(i)hj+bt(i))\\begin{array}{rl} \\mathbf{h}_j &amp;= \\sigma(\\widetilde{\\mathbf{W}}_t^{(i)}\\widetilde{\\mathbf{w}}_j^{(i)} + \\widetilde{\\mathbf{b}}^{(i)})\\\\ \\mathbf{w}_j^{(i)} &amp;= \\sigma(\\mathbf{W}_t^{(i)}\\mathbf{h}_j + \\mathbf{b}_t^{(i)}) \\end{array}hjâ€‹wj(i)â€‹â€‹=Ïƒ(Wt(i)â€‹wj(i)â€‹+b(i))=Ïƒ(Wt(i)â€‹hjâ€‹+bt(i)â€‹)â€‹ é¡¶éƒ¨çš„èšåˆå™¨è¾“å‡ºçš„ token å’Œ entity åµŒå…¥è¢«ç”¨ä½œ K-Encoder\\text{K-Encoder}K-Encoder çš„æœ€ç»ˆè¾“å‡ºåµŒå…¥ é¢„è®­ç»ƒ å»å™ªå®ä½“è‡ªåŠ¨ç¼–ç å™¨(denoision entity auto-encoder, dEA)ï¼šéšæœºé®ä½ä¸€äº› token-entity alignments, å¹¶è¦æ±‚ç³»ç»Ÿé¢„æµ‹æ‰€æœ‰å¯¹åº”çš„å®ä½“ã€‚ è€ƒè™‘åˆ°å®ä½“åˆ—è¡¨ E\\mathcal{E}E å¯èƒ½å¾ˆå¤§ï¼Œä»…è¦æ±‚ç³»ç»Ÿä»ç»™å®šçš„å®ä½“åˆ—è¡¨çš„å­é›†ä¸­é¢„æµ‹å®ä½“ã€‚ ç»™å®š token åºåˆ— {w1,...,wn}\\{w_1, ..., w_n\\}{w1â€‹,...,wnâ€‹} å’Œå¯¹åº”çš„å®ä½“åºåˆ— {e1,...,em}\\{e_1, ..., e_m\\}{e1â€‹,...,emâ€‹}, å®šä¹‰ token wiw_iwiâ€‹ çš„å®ä½“åˆ†å¸ƒä¸ºï¼š p(ejâˆ£wi)=expâ¡(linear(wio)â‹…ej)Î£k=1mexpâ¡(linear(wio)â‹…ek)p(e_j|w_i) = \\frac{\\exp(\\text{linear}(\\mathbf{w}_i^o)\\cdot \\mathbf{e}_j)}{\\Sigma_{k = 1}^{m}\\exp(\\text{linear}(\\mathbf{w}_i^o)\\cdot \\mathbf{e}_k)} p(ejâ€‹âˆ£wiâ€‹)=Î£k=1mâ€‹exp(linear(wioâ€‹)â‹…ekâ€‹)exp(linear(wioâ€‹)â‹…ejâ€‹)â€‹ å…¶ä¸­çš„ linear(â‹…)\\text{linear}(\\cdot)linear(â‹…) æ˜¯ä¸€ä¸ªçº¿æ€§å±‚ï¼Œä¸Šå¼è¢«ç”¨æ¥è®¡ç®— dEA ç›®æ ‡çš„äº¤å‰ç†µæŸå¤±å‡½æ•°ã€‚ å¾®è°ƒ ä¸ BERT ç±»ä¼¼ï¼ŒERNIE è¾“å…¥åºåˆ—çš„ç¬¬ä¸€ä¸ª token ä¹Ÿæ˜¯ç‰¹æ®Šçš„ token [CLS]\\text{[CLS]}[CLS]ï¼Œç”¨äºç‰¹æ®Šçš„ä»»åŠ¡ã€‚ å¯¹äºå…³ç³»åˆ†ç±»ä»»åŠ¡ï¼Œç³»ç»Ÿéœ€è¦æ ¹æ®ä¸Šä¸‹æ–‡æ¥ä¸ºç»™å®šçš„å®ä½“å¯¹åˆ†ç±»ã€‚æœ¬æ–‡æå‡ºçš„æ–¹æ³•æ˜¯ï¼Œä¿®æ”¹è¾“å…¥åºåˆ—ï¼Œåœ¨åºåˆ—ä¸­çš„å®ä½“ä¸¤ç«¯æ·»åŠ ç‰¹æ®Šçš„ mark token ï¼Œè¿™äº› mark token åœ¨å…³ç³»åˆ†ç±»æ¨¡å‹ä¸­èµ·åˆ°ç±»ä¼¼ä½ç½®åµŒå…¥çš„ä½œç”¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåˆ†åˆ«ä½¿ç”¨ [HD]\\text{[HD]}[HD] å’Œ [TL]\\text{[TL]}[TL] æ¥æ ‡è®°å¤´éƒ¨çš„å®ä½“å’Œå°¾éƒ¨çš„å®ä½“ã€‚ å¯¹äºå®ä½“åˆ†ç±»ä»»åŠ¡ï¼Œå…¶å¾®è°ƒè¿‡ç¨‹æ˜¯å…³ç³»åˆ†ç±»ä»»åŠ¡çš„ç®€åŒ–ç‰ˆæœ¬ã€‚æ—©å‰çš„æ¨¡å‹åŒæ—¶åˆ©ç”¨äº†ä¸Šä¸‹æ–‡åµŒå…¥(context embedding) å’Œå®ä½“æåŠåµŒå…¥(entity mention embedding)ï¼Œä½œè€…è®¤ä¸ºä¿®æ”¹è¾“å…¥åºåˆ—åœ¨å®ä½“æåŠçš„ä¸¤ç«¯åŠ ä¸Šç‰¹æ®Šçš„ token [ENT]\\text{[ENT]}[ENT] å¯ä»¥å¼•å¯¼ ERNIE ç»“åˆä¸Šä¸‹æ–‡ä¿¡æ¯å’Œå®ä½“æåŠä¿¡æ¯ã€‚ å®éªŒ é¢„è®­ç»ƒ é¢„è®­ç»ƒæ—¶çš„ token ç¼–ç å™¨(T-Encoder)ç›´æ¥åº”ç”¨ BERT çš„å‚æ•°ã€‚é¢„è®­ç»ƒçš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªå¤šä»»åŠ¡(MLM, NSP, dEA)çš„è¿‡ç¨‹ï¼Œä½œè€…ä½¿ç”¨è‹±æ–‡ç»´åŸºä½œä¸ºè¯­æ–™åº“ã€‚æ€»å…±çº¦æœ‰ 4500M ä¸ªå­è¯å’Œ 140M ä¸ªå®ä½“ã€‚ é¢„è®­ç»ƒä¹‹å‰ï¼Œå…ˆåˆ©ç”¨ç”±ç»´åŸºæ•°æ®è®­ç»ƒçš„çŸ¥è¯†åµŒå…¥ TransE ä½œä¸ºå®ä½“çš„è¾“å…¥åµŒå…¥ã€‚å…·ä½“åœ°è¯´ï¼Œä½œè€…é‡‡æ ·äº†ç»´åŸºæ•°æ®ä¸­çš„ 5040986 ä¸ªå®ä½“å’Œ 24267796 ä¸ªä¸‰å…ƒç»„ã€‚å®ä½“çš„çŸ¥è¯†åµŒå…¥åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å›ºå®šï¼Œå®ä½“ç¼–ç æ¨¡å—å‚æ•°éšæœºåˆå§‹åŒ–ã€‚ å®ä½“åˆ†ç±» åˆ†åˆ«åœ¨ FIGER å’Œ Open Entity æ•°æ®é›†ä¸Šä¸ NFGEC, UEFT å’Œ BERT ä½œæ¯”è¾ƒã€‚è¯æ˜äº† é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹æ¯”ä¼ ç»Ÿçš„å®ä½“åˆ†ç±»æ¨¡å‹æ›´å…·è¡¨å¾èƒ½åŠ›ï¼Œèƒ½å¤Ÿå……åˆ†åˆ©ç”¨è®­ç»ƒæ•°æ®ä¸­çš„ä¿¡æ¯ã€‚ ä¸ BERT ç›¸æ¯”ï¼ŒERNIE ç”±äºå¼•å…¥äº†é¢å¤–çŸ¥è¯†æé«˜äº†åˆ†ç±»ç²¾åº¦ã€‚ å…³ç³»åˆ†ç±» åœ¨æ•°æ®é›† FewRel, TACRED ä¸Šä¸æ¨¡å‹ CNN, PA-LSTM, C-GCN å’Œ BERT å¯¹æ¯”ã€‚ç»“æœè¯æ˜ï¼š é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹åœ¨å…³ç³»åˆ†ç±»æ–¹é¢å¯ä»¥æä¾›æ›´å¤šçš„ä¿¡æ¯ ERNIE åœ¨ä¸¤ä¸ªæ•°æ®é›†ä¸Šå…³ç³»åˆ†ç±»è¡¨ç°éƒ½ä¼˜äº BERTï¼Œå°¤å…¶åœ¨å°è§„æ¨¡æ•°æ®é›†ä¸Šã€‚è¯æ˜é¢å¤–çŸ¥è¯†ä¿¡æ¯å¸®åŠ©æ¨¡å‹æ›´å¥½åœ°åˆ©ç”¨å°çš„è®­ç»ƒæ•°æ®é›† GLUE åœ¨é€šç”¨è‡ªç„¶è¯­è¨€ç†è§£ä¸­çš„8ä¸ªæ•°æ®é›†ä¸Šä¸ BERT è¿›è¡Œäº†å¯¹æ¯”ã€‚","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"PLM","slug":"PLM","permalink":"https://blog.zhuwenq.cc/tags/PLM/"},{"name":"NLP","slug":"NLP","permalink":"https://blog.zhuwenq.cc/tags/NLP/"},{"name":"Knowledge Graph","slug":"Knowledge-Graph","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Graph/"},{"name":"Knowledge Embedding","slug":"Knowledge-Embedding","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Embedding/"}]},{"title":"ERNIE: Enhanced Representation through Knowledge Integration","slug":"ERNIE-Enhanced-Representation-through-Knowledge-Integration","date":"2021-10-09T16:00:00.000Z","updated":"2023-06-21T06:51:28.788Z","comments":true,"path":"ERNIE-Enhanced-Representation-through-Knowledge-Integration/","link":"","permalink":"https://blog.zhuwenq.cc/ERNIE-Enhanced-Representation-through-Knowledge-Integration/","excerpt":"ç™¾åº¦ ERNIE, ä¸æ¸…å ERNIE (ERNIE-Enhanced-Language-Representation-with-Informative-Entities) åŒå","text":"ç™¾åº¦ ERNIE, ä¸æ¸…å ERNIE (ERNIE-Enhanced-Language-Representation-with-Informative-Entities) åŒå Motivation ç°æœ‰çš„è¡¨å¾å­¦ä¹ æ–¹æ³•åœ¨å­¦ä¹  token embedding æ—¶æ²¡æœ‰è€ƒè™‘è¯­å¥ä¸­çš„å…ˆéªŒçŸ¥è¯†ï¼Œä½œè€…è®¤ä¸ºå¦‚æœæ¨¡å‹èƒ½å¤Ÿå­¦ä¹ åˆ°å…ˆéªŒçŸ¥è¯†ï¼Œåˆ™å¯ä»¥è·å¾—æ›´å¯é çš„è¯­è¨€è¡¨å¾ã€‚ Methodology ERNIE ä½¿ç”¨ knowledge masking ç­–ç•¥éšå¼åœ°å­¦ä¹ å…ˆéªŒçŸ¥è¯†ï¼Œé™¤äº†æ ‡å‡†çš„éšæœº masking æ–¹æ³•ä¹‹å¤–ï¼ŒERNIE å¼•å…¥äº†ä¸¤ç§ç‰¹æ®Šçš„ maksing ç­–ç•¥ï¼šphrase-level å’Œ entity-levelï¼Œå³åˆ†åˆ«å°†ä¸€ä¸ªçŸ­è¯­æˆ–ä¸€ä¸ªå®ä½“ä½œä¸ºä¸€ä¸ªåŸºæœ¬å•å…ƒè¿›è¡Œ maskingã€‚ BERT as Backbone è¯­è¨€è¡¨å¾çš„åŸºç¡€ç¼–ç å™¨é‡‡ç”¨å’Œ BERT ç­‰æ¨¡å‹ç›¸åŒçš„å¤šå±‚ Transformer ç»“æ„ã€‚é’ˆå¯¹ä¸­æ–‡è¯­æ–™ï¼Œä½œè€…å°†æ¯ä¸ªå­—ç”¨ç©ºæ ¼åˆ†å¼€ï¼Œå¹¶é‡‡ç”¨ WordPiece è¿›è¡Œ tokenizeã€‚æ¯ä¸ª token çš„è¾“å…¥ embedding ç”± token embedding, segment embedding å’Œ position embedding ç›¸åŠ æ„æˆ(ä¸ BERT ç›¸åŒ)ï¼Œæ¯ä¸ªè¾“å…¥åºåˆ—çš„ç¬¬ä¸€ä¸ª token æ˜¯ç‰¹æ®Šçš„åˆ†ç±» token ([CLS][CLS][CLS])(ä¸ BERT ç›¸åŒ) multi-stage knowledge masking strategy Base-Level Masking ç¬¬ä¸€é˜¶æ®µå°†è¾“å…¥è¯­å¥è§†ä¸ºåŸºæœ¬çš„è¯­è¨€å•å…ƒçš„åºåˆ—(å¯¹äºè‹±æ–‡ï¼ŒåŸºæœ¬å•å…ƒæ˜¯è¯ï¼›å¯¹äºä¸­æ–‡ï¼ŒåŸºæœ¬å•å…ƒæ˜¯å­—)ã€‚è¿™ä¸€é˜¶æ®µç›´æ¥ä½¿ç”¨ BERT çš„ Masking æ–¹æ³•ã€‚ä½œè€…è®¤ä¸ºæ­¤é˜¶æ®µéš¾ä»¥å¯¹é«˜é˜¶è¯­ä¹‰çŸ¥è¯†å»ºæ¨¡ã€‚ Phrase-Level Masking ç¬¬äºŒé˜¶æ®µå°†è¯­å¥ä¸­çš„çŸ­è¯­è§†ä¸º Mask çš„åŸºæœ¬å•å…ƒã€‚éšæœºé€‰æ‹©å¥å­ä¸­çš„ä¸€éƒ¨åˆ†çŸ­è¯­è¿›è¡Œ Masking ï¼Œç„¶åé¢„æµ‹è¢« Masking çš„çŸ­è¯­åŒ…å«çš„æ‰€æœ‰åŸºæœ¬è¯­è¨€å•å…ƒã€‚ Entity-Level Masking ç¬¬ä¸‰ä¸ªé˜¶æ®µä»è¯­å¥ä¸­åˆ†æå‡ºå‘½åå®ä½“çš„å­˜åœ¨(ä½¿ç”¨é¢å¤–å·¥å…·)ï¼Œç„¶åå¯¹å®ä½“è¿›è¡Œ Masking å¹¶é¢„æµ‹å®ä½“æ‰€åŒ…å«çš„æ‰€æœ‰è¯­è¨€å•å…ƒã€‚ å®éªŒ å¯¹äºå¯¹è¯è¯­è¨€æ¨¡å‹ä»»åŠ¡(DLM)ï¼ŒERINE ä½¿ç”¨ dialogue embedding æ¥æ ‡ç¤ºå¯¹è¯ä¸­çš„è§’è‰²ã€‚å¦å¤–è¿˜æ„å»ºäº†å‡æ ·æœ¬ç”¨äºè®­ç»ƒæ¨¡å‹åˆ†è¾¨ä¸€ç»„å¤šè½®å¯¹è¯æ•°æ®æ˜¯çœŸçš„å¯¹è¯è¿˜æ˜¯å‡çš„å¯¹è¯ã€‚","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"PLM","slug":"PLM","permalink":"https://blog.zhuwenq.cc/tags/PLM/"},{"name":"NLP","slug":"NLP","permalink":"https://blog.zhuwenq.cc/tags/NLP/"},{"name":"Knowledge Embedding","slug":"Knowledge-Embedding","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Embedding/"}]},{"title":"Tail-to-Tail Non-Autoregressive Sequence Prediction for Chinese Grammatical Error Correction","slug":"Tail-to-Tail-Non-Autoregressive-Sequence-Prediction-for-Chinese-Grammatical-Error-Correction","date":"2021-09-30T16:00:00.000Z","updated":"2023-06-21T06:51:28.920Z","comments":true,"path":"Tail-to-Tail-Non-Autoregressive-Sequence-Prediction-for-Chinese-Grammatical-Error-Correction/","link":"","permalink":"https://blog.zhuwenq.cc/Tail-to-Tail-Non-Autoregressive-Sequence-Prediction-for-Chinese-Grammatical-Error-Correction/","excerpt":"Motivition CGEC ä¸­æ–‡è¯­æ³•çº é”™ï¼Œæ—¨åœ¨è‡ªåŠ¨æ£€æµ‹å’Œçº æ­£ä¸­æ–‡è¯­å¥ä¸­çš„è¯­æ³•é”™è¯¯ã€‚ ä¸­æ–‡è¯­æ³•çº é”™éœ€è¦çš„æ“ä½œç§ç±»ï¼š æ›¿æ¢ï¼Œä¸­æ–‡ä¸­å¸¸å¸¸å‡ºç°åŒéŸ³å­—(æ‹¼éŸ³è¾“å…¥æ³•)å’Œé”™åˆ«å­—çš„é”™è¯¯ã€‚å¯ä»¥é€šè¿‡æ›¿æ¢å¯¹åº”çš„å­—çº æ­£ åˆ é™¤å’Œæ’å…¥ï¼Œåˆ†åˆ«åº”å¯¹æ–‡å­—çš„å†—ä½™å’Œé—æ¼é—®é¢˜ æœ¬åœ°é‡Šä¹‰ï¼Œæœ‰æ—¶è¯­æ³•é”™è¯¯è¦æ±‚é€šè¿‡é‡æ–°æ’åˆ—ç­‰æ–¹å¼é‡æ–°é‡Šä¹‰åºåˆ—ä¸­çš„éƒ¨åˆ†è¯ å…¶ä¸­æ’å…¥åˆ é™¤å’Œæœ¬åœ°é‡Šä¹‰æ˜¯å˜é•¿æ“ä½œï¼Œæ›¿æ¢æ˜¯å®šé•¿æ“ä½œ","text":"Motivition CGEC ä¸­æ–‡è¯­æ³•çº é”™ï¼Œæ—¨åœ¨è‡ªåŠ¨æ£€æµ‹å’Œçº æ­£ä¸­æ–‡è¯­å¥ä¸­çš„è¯­æ³•é”™è¯¯ã€‚ ä¸­æ–‡è¯­æ³•çº é”™éœ€è¦çš„æ“ä½œç§ç±»ï¼š æ›¿æ¢ï¼Œä¸­æ–‡ä¸­å¸¸å¸¸å‡ºç°åŒéŸ³å­—(æ‹¼éŸ³è¾“å…¥æ³•)å’Œé”™åˆ«å­—çš„é”™è¯¯ã€‚å¯ä»¥é€šè¿‡æ›¿æ¢å¯¹åº”çš„å­—çº æ­£ åˆ é™¤å’Œæ’å…¥ï¼Œåˆ†åˆ«åº”å¯¹æ–‡å­—çš„å†—ä½™å’Œé—æ¼é—®é¢˜ æœ¬åœ°é‡Šä¹‰ï¼Œæœ‰æ—¶è¯­æ³•é”™è¯¯è¦æ±‚é€šè¿‡é‡æ–°æ’åˆ—ç­‰æ–¹å¼é‡æ–°é‡Šä¹‰åºåˆ—ä¸­çš„éƒ¨åˆ†è¯ å…¶ä¸­æ’å…¥åˆ é™¤å’Œæœ¬åœ°é‡Šä¹‰æ˜¯å˜é•¿æ“ä½œï¼Œæ›¿æ¢æ˜¯å®šé•¿æ“ä½œ Pervious Works åºåˆ—ç¿»è¯‘(sequence translation)å’Œæ ‡è®°(sequence tagging)æ˜¯å¸¸ç”¨äºæ–‡æœ¬è¯­æ³•çº é”™çš„æ–¹æ³•ã€‚ å¯¹äºåºåˆ—ç¿»è¯‘æ–¹æ³•ï¼šè™½ç„¶è¿™ç§æ¨¡å¼å¯ä»¥åº”å¯¹ä»»æ„ç±»å‹çš„è¯­æ³•é”™è¯¯ï¼Œä½†æ˜¯ç”±äºexposure bias issueå’Œphenomenon of hallucinationé—®é¢˜çš„å­˜åœ¨ï¼Œå³ä½¿å¼•å…¥å¤åˆ¶æœºåˆ¶ä¹Ÿæ— æ³•ä¿è¯ç»“æœçš„å¯ä¿¡æ€§ã€‚ å¯¹äºtaggingçš„æ–¹æ³•ï¼Œè¯¥æ¨¡å¼ä½¿ç”¨æ ‡è®°æ¥æŒ‡å¯¼çº é”™æ“ä½œï¼š éœ€è¦å°†è¯å…¸æ‰©å±•åˆ°åŸå…ˆçš„çº¦ä¸‰å€ éœ€è¦å¯¹åºåˆ—è¿›è¡Œå¤šéé¢„æµ‹ï¼Œç›´åˆ°é¢„æµ‹ä¸å‡ºæ–°çš„é”™è¯¯ä¸ºæ­¢ è®¡ç®—å¼€é”€è¿‡å¤§ã€‚ æœ€æ–°çš„å·¥ä½œå°è¯•å¾®è°ƒ BERT æ¥è§£å†³ CGEC é—®é¢˜ï¼Œä½†æ˜¯ç”±äº BERT æ¨¡å‹ç»“æ„çš„é™åˆ¶ï¼Œå¤§å¤šæ•°åªèƒ½è§£å†³å®šé•¿çº é”™çš„åœºæ™¯ CGEC ä¸­å¤§å¤šæ•° tokens éƒ½æ²¡æœ‰é”™è¯¯ï¼Œåº”è¯¥è¢«ç›´æ¥å¤åˆ¶ã€‚è¿™é€ æˆåœ¨åºåˆ—æ ‡è®°å’Œåºåˆ—ç¿»è¯‘ä»»åŠ¡ä¸­å¸¸ç”¨çš„å‚æ•°å­¦ä¹ æ–¹æ³• MLE å—åˆ°æ ‡ç­¾ä¸å¹³è¡¡çš„å½±å“ã€‚ä¹‹å‰çš„å·¥ä½œæ²¡æœ‰æ¢ç´¢è¿™ç§ä¸å¹³è¡¡é—®é¢˜ã€‚ Contribution æå‡ºä¸€ä¸ªåä¸º tail-to-tail non-autoregressive sequence prediction(TtT) çš„è§£å†³ CGEC é—®é¢˜çš„ç»“æ„ ä½¿ç”¨ BERT ç¼–ç å™¨å’Œä¸€ä¸ª CRF å±‚ä½œä¸ºä¸»å¹²æ¡†æ¶ï¼ŒåŒæ—¶å¯ä»¥è¿›è¡Œæ›¿æ¢ï¼Œæ’å…¥ï¼Œåˆ é™¤å’Œæœ¬åœ°é‡Šä¹‰æ“ä½œ è€ƒè™‘åˆ°å¥å­ä¸­å¤§å¤šæ•° tokens éƒ½ä¸éœ€è¦æ“ä½œçš„ä¸å¹³è¡¡æ€§ï¼Œé‡‡ç”¨ Focal Loss æƒ©ç½šç­–ç•¥ç¼“è§£ å»ºç«‹äº†ä¸€ä¸ªå˜é•¿ CGEC æ•°æ®é›†ï¼Œå¹¶åœ¨ä¸Šé¢å®éªŒï¼Œè¯æ˜äº†æ–¹æ³•çš„æ•ˆæœ Method æ¨¡å‹çš„è¾“å…¥æ˜¯ä¸€ä¸ªå¸¦æœ‰è¯­æ³•é”™è¯¯çš„å¥å­ X=(x1,x2,...,xT)X = (x_1, x_2, ..., x_T)X=(x1â€‹,x2â€‹,...,xTâ€‹), å…¶ä¸­ xix_ixiâ€‹ æ˜¯å¥å­ä¸­çš„ tokenï¼ŒTTT æ˜¯å¥å­çš„é•¿åº¦ã€‚æ¨¡å‹çš„è¾“å‡ºæ˜¯ç»è¿‡çº æ­£çš„å¥å­ Y=(y1,y2,...,yTâ€²)Y = (y_1, y_2, ..., y_{T&#x27;})Y=(y1â€‹,y2â€‹,...,yTâ€²â€‹), å…¶ä¸­ Tâ€²T&#x27;Tâ€² ä¸ TTT å¹¶ä¸å¿…é¡»ç›¸ç­‰ã€‚ å˜é•¿åœºæ™¯ å‡è®¾è¾“å…¥æ˜¯ X=(x1,x2,x3,...,&lt;eos&gt;)X = (x_1, x_2, x_3, ..., &lt;eos&gt;)X=(x1â€‹,x2â€‹,x3â€‹,...,&lt;eos&gt;), é•¿åº¦æ˜¯ TTTï¼›è¾“å‡ºæ˜¯ Y=(y1,y2,y3,...,&lt;eos&gt;)Y = (y_1, y_2, y_3, ..., &lt;eos&gt;)Y=(y1â€‹,y2â€‹,y3â€‹,...,&lt;eos&gt;), é•¿åº¦æ˜¯ Tâ€²T&#x27;Tâ€² T = Tâ€™ï¼Œä¸éœ€è¦é¢å¤–çš„å¤„ç† T &gt; Tâ€™ï¼Œå³ä»è¾“å…¥åºåˆ—ä¸­åˆ é™¤äº†éƒ¨åˆ† tokenï¼Œå¯ä»¥åœ¨è¾“å‡ºåºåˆ—çš„æœ«å°¾è¡¥å…… Tâˆ’Tâ€²T - T&#x27;Tâˆ’Tâ€² ä¸ªç‰¹æ®Šçš„ token &lt;pad&gt;&lt;pad&gt;&lt;pad&gt; æ¥ä½¿è¾“å…¥è¾“å‡ºåºåˆ—é•¿åº¦ç›¸ç­‰ã€‚Y=(y1,y2,...,&lt;eos&gt;,&lt;pad&gt;)Y = (y_1, y_2, ..., &lt;eos&gt;, &lt;pad&gt;)Y=(y1â€‹,y2â€‹,...,&lt;eos&gt;,&lt;pad&gt;) T &lt; Tâ€™ï¼Œå³åœ¨è¾“å…¥åºåˆ—ä¸­æ’å…¥éƒ¨åˆ† tokenï¼Œå¯ä»¥åœ¨è¾“å…¥åºåˆ—çš„æœ«å°¾è¡¥å……ç‰¹æ®Šçš„ token &lt;mask&gt;&lt;mask&gt;&lt;mask&gt; ä½¿è¾“å…¥è¾“å‡ºç›¸ç­‰ã€‚X=(x1,x2,...,&lt;eos&gt;,&lt;mask&gt;)X = (x_1, x_2, ..., &lt;eos&gt;, &lt;mask&gt;)X=(x1â€‹,x2â€‹,...,&lt;eos&gt;,&lt;mask&gt;) åŒå‘è¯­ä¹‰å»ºæ¨¡ å³æ ‡å‡†çš„ BERT è¿‡ç¨‹ï¼š Ht0=Ewt+EptQ0,K0,V0=H0WQ,H0WK,H0WVHt1=LN(SELF-ATT(Qt0,K0,V0)+Ht0)Ht1=LN(FFN(Ht1)+Ht1)\\begin{array}{rl} \\mathbf{H}_t^0 &amp;= \\mathbf{E}_{w_t}+\\mathbf{E}_{p_t}\\\\ \\mathbf{Q}^0, \\mathbf{K}^0, \\mathbf{V}^0 &amp;= \\mathbf{H}^0\\mathbf{W}^Q, \\mathbf{H}^0\\mathbf{W}^K, \\mathbf{H}^0\\mathbf{W}^V\\\\ \\mathbf{H}_t^1 &amp;= \\text{LN}(\\text{SELF-ATT}(\\mathbf{Q}_t^0, \\mathbf{K}^0, \\mathbf{V}^0) + \\mathbf{H}_t^0)\\\\ \\mathbf{H}_t^1 &amp;= \\text{LN}(\\text{FFN}(\\mathbf{H}_t^1) + \\mathbf{H}_t^1) \\end{array}Ht0â€‹Q0,K0,V0Ht1â€‹Ht1â€‹â€‹=Ewtâ€‹â€‹+Eptâ€‹â€‹=H0WQ,H0WK,H0WV=LN(SELF-ATT(Qt0â€‹,K0,V0)+Ht0â€‹)=LN(FFN(Ht1â€‹)+Ht1â€‹)â€‹ è¯¥éƒ¨åˆ†å³ä¸€ä¸ª BERT ç¼–ç å™¨ï¼Œç»è¿‡ L å±‚çš„ç¼–ç åï¼Œæœ€ç»ˆè¾“å‡ºçš„è¯­è¨€è¡¨å¾å‘é‡ä¸º HLâˆˆRmax(T,Tâ€²)Ã—d\\mathbf{H}^L \\in \\mathbb{R}^{\\text{max}(T, T&#x27;)\\times d}HLâˆˆRmax(T,Tâ€²)Ã—d éè‡ªå›å½’åºåˆ—é¢„æµ‹ ç›´æ¥é¢„æµ‹ã€‚å¯¹äºç»è¿‡ BERT ç¼–ç å™¨å¾—åˆ°çš„è¯­è¨€è¡¨å¾ï¼Œå¯ä»¥ç›´æ¥åœ¨è¡¨å¾å‘é‡ä¸Šåº”ç”¨ softmax æ“ä½œè¿›è¡Œé¢„æµ‹ã€‚å…·ä½“åœ°è¯´ï¼Œé¦–å…ˆåœ¨è¾“å‡ºçš„è¯­è¨€è¡¨å¾ä¸Šè¿›è¡Œä¸€æ¬¡çº¿æ€§æŠ•å½±ï¼š st=htTWs+bs\\mathbf{s}_t = \\mathbf{h}_t^T\\mathbf{W}_s + \\mathbf{b}_s stâ€‹=htTâ€‹Wsâ€‹+bsâ€‹ å…¶ä¸­ btâˆˆRd\\mathbf{b}_t \\in \\mathbb{R}^dbtâ€‹âˆˆRd è¡¨ç¤ºè¾“å…¥åºåˆ—ä¸­ç¬¬ ttt ä¸ª token çš„è¡¨å¾ï¼Œæ¥è‡ª HL\\mathbf{H}^LHL, WsâˆˆRdÃ—âˆ£Vâˆ£,bsâˆˆRâˆ£Vâˆ£\\mathbf{W}_s \\in \\mathbb{R}^{d\\times |\\mathcal{V}|}, \\mathbf{b}_s \\in \\mathbb{R}^{|\\mathcal{V}|}Wsâ€‹âˆˆRdÃ—âˆ£Vâˆ£,bsâ€‹âˆˆRâˆ£Vâˆ£ æ˜¯æŠ•å½±å‚æ•°ã€‚å¦‚æ­¤å¾—åˆ° token çš„è¡¨å¾å‘é‡æŠ•å½±åˆ°è¯å…¸ç»´åº¦çš„å‘é‡ st\\mathbf{s}_tstâ€‹ ç„¶åå¯¹ st\\mathbf{s}_tstâ€‹ è¿›è¡Œ softmax æ“ä½œï¼Œè·å¾—è¯¥ token åœ¨ç›®æ ‡è¯å…¸ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒï¼š Pdp(yt)=softmax(st)P_{dp}(y_t) = \\text{softmax}(\\mathbf{s}_t) Pdpâ€‹(ytâ€‹)=softmax(stâ€‹) è¿™ç§ç›´æ¥çš„é¢„æµ‹å¯ä»¥è§£å†³å®šé•¿çš„è¯­æ³•çº é”™é—®é¢˜ï¼Œä½†æ˜¯åªèƒ½è¿›è¡Œæ›¿æ¢æ“ä½œï¼Œå¯¹äºå…¶ä»–ç§ç±»çš„æ“ä½œæ— èƒ½ä¸ºåŠ›ã€‚ éè‡ªå›å½’çš„åºåˆ—é¢„æµ‹æ–¹æ³•è¿˜æœ‰å¿½ç•¥æ‰äº†é‚»å±… token ä¹‹é—´çš„ä¾èµ–å…³ç³»çš„é—®é¢˜ã€‚ é€šè¿‡ CRF è¿›è¡Œä¾èµ–å»ºæ¨¡ã€‚å¯¹äºç»™å®šçš„é•¿åº¦ä¸º TTT çš„è¾“å…¥åºåˆ— XXXï¼Œ è¾“å‡ºçš„é•¿åº¦ä¸º Tâ€²T&#x27;Tâ€² çš„åºåˆ— YYY çš„ä¼¼ç„¶å‡½æ•°ä¸ºï¼š Pcrf(Yâˆ£X)=1Z(X)expâ¡(âˆ‘t=1Tâ€²s(yt)+âˆ‘t=2Tâ€²t(ytâˆ’1,yt))P_{\\text{crf}}(Y|X) = \\frac{1}{Z(X)}\\exp \\left(\\sum_{t = 1}^{T&#x27;}s(y_t) + \\sum_{t = 2}^{T&#x27;}t(y_{t-1}, y_t)\\right) Pcrfâ€‹(Yâˆ£X)=Z(X)1â€‹expââ›â€‹t=1âˆ‘Tâ€²â€‹s(ytâ€‹)+t=2âˆ‘Tâ€²â€‹t(ytâˆ’1â€‹,ytâ€‹)â ââ€‹ å…¶ä¸­ Z(X)Z(X)Z(X) æ˜¯å½’ä¸€åŒ–å‚æ•°ï¼Œs(yt)s(y_t)s(ytâ€‹) å³ token yty_tytâ€‹ çš„æ ‡ç­¾åˆ†æ•°ï¼Œæ¥è‡ªç¬¬ ttt ä¸ª token çš„è¡¨å¾ç»è¿‡æŠ•å½±çš„å‘é‡ st\\mathbf{s}_tstâ€‹, ç›¸å½“äº st(Vyt)s_t(\\mathcal{V}^{y_t})stâ€‹(Vytâ€‹), Vyt\\mathcal{V}^{y_t}Vytâ€‹ æ˜¯ token yty_tytâ€‹ åœ¨è¯å…¸ä¸­çš„ç´¢å¼•ã€‚ t(ytâˆ’1,yt)=Mytâˆ’1,ytt(y_{t-1}, y_t) = \\mathbf{M}_{y_{t-1}, y_t}t(ytâˆ’1â€‹,ytâ€‹)=Mytâˆ’1â€‹,ytâ€‹â€‹, ä»£è¡¨ä» token ytâˆ’1y_{t-1}ytâˆ’1â€‹ åˆ° yty_tytâ€‹ çš„è½¬ç§»åˆ†æ•°ã€‚å…¶ä¸­ MâˆˆRâˆ£Vâˆ£Ã—âˆ£Vâˆ£\\mathbf{M}\\in \\mathbb{R}^{|\\mathcal{V}|\\times |\\mathcal{V}|}MâˆˆRâˆ£Vâˆ£Ã—âˆ£Vâˆ£ æ˜¯è½¬ç§»çŸ©é˜µã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼ŒM\\mathbf{M}M å¯ä»¥é€šè¿‡ä½œä¸ºç¥ç»ç½‘ç»œçš„å‚æ•°é€šè¿‡ç«¯åˆ°ç«¯å­¦ä¹ å¾—åˆ°ï¼Œä½†æ˜¯ç”±äºç»´åº¦è¿‡å¤§(è¯å…¸çš„ç»´åº¦)ï¼Œæ— æ³•æœ‰æ•ˆè·å–ã€‚ ä½œè€…ä½¿ç”¨ä½ç§©åˆ†è§£çš„æ–¹æ³•å®šä¹‰ä¸¤ä¸ªä½ç§©çŸ©é˜µ E1,E2âˆˆRâˆ£Vâˆ£Ã—dm\\mathbf{E}_1, \\mathbf{E}_2 \\in \\mathbb{R}^{|\\mathcal{V}|\\times d_m}E1â€‹,E2â€‹âˆˆRâˆ£Vâˆ£Ã—dmâ€‹ æ¥é€¼è¿‘ M\\mathbf{M}M: M=E1E2T\\mathbf{M} = \\mathbf{E}_1\\mathbf{E}_2^T M=E1â€‹E2Tâ€‹ å¯¹äºå½’ä¸€åŒ–å‚æ•° Z(X)Z(X)Z(X), ä½¿ç”¨ç»´ç‰¹æ¯”ç®—æ³•è¿›è¡Œæœç´¢ã€‚ è®­ç»ƒ åœ¨è®­ç»ƒæ—¶ï¼š å°†è§£å†³å®šé•¿é—®é¢˜çš„ç›´æ¥é¢„æµ‹å’Œè§£å†³å˜é•¿é—®é¢˜çš„CRF ä¾èµ–å»ºæ¨¡ç»“åˆ ä½¿ç”¨æœ€å¤§ä¼¼ç„¶ä¼°è®¡ä½œä¸ºå‚æ•°å­¦ä¹ æ–¹æ³•ï¼Œè´Ÿå¯¹æ•°ä¼¼ç„¶ä½œä¸ºæŸå¤±å‡½æ•° ç›´æ¥é¢„æµ‹çš„æŸå¤±å‡½æ•°(ä¼˜åŒ–ç›®æ ‡)æ˜¯ï¼š Ldp=âˆ’âˆ‘t=1Tâ€²logâ¡Pdp(ytâˆ£X)\\mathcal{L}_\\text{dp} = -\\sum_{t = 1}^{T&#x27;}\\log P_{dp}(y_t|X) Ldpâ€‹=âˆ’t=1âˆ‘Tâ€²â€‹logPdpâ€‹(ytâ€‹âˆ£X) CRF ä¾èµ–å»ºæ¨¡çš„æŸå¤±å‡½æ•°æ˜¯ï¼š Lcrf=âˆ’logPcrf(Yâˆ£X)\\mathcal{L}_\\text{crf} = -log P_\\text{crf}(Y|X) Lcrfâ€‹=âˆ’logPcrfâ€‹(Yâˆ£X) æ€»çš„æŸå¤±å‡½æ•°ï¼šL=Ldp+Lcrf\\mathcal{L} = \\mathcal{L}_\\text{dp} + \\mathcal{L}_\\text{crf}L=Ldpâ€‹+Lcrfâ€‹ ä¸ºç¼“è§£æ ·æœ¬ä¸å¹³è¡¡(å¤§å¤šæ•° token ä¸éœ€è¦çº æ­£)é—®é¢˜ï¼Œä½¿ç”¨ Focal Lossï¼š Ldpfl=âˆ’âˆ‘t=1Tâ€²(1âˆ’Pdp(ytâˆ£X))Î³logâ¡Pdp(ytâˆ£X)Lcrffl=âˆ’(1âˆ’Pcrf(Yâˆ£X))Î³logâ¡Pcrf(Yâˆ£X)Lfl=Ldpfl+Lcrffl\\begin{array}{rl} \\mathcal{L}_\\text{dp}^\\text{fl} &amp;= -\\sum_{t = 1}^{T&#x27;}(1 - P_\\text{dp}(y_t|X))^\\gamma \\log P_\\text{dp}(y_t|X)\\\\ \\mathcal{L}_\\text{crf}^\\text{fl} &amp;= -(1 - P_\\text{crf}(Y|X))^\\gamma \\log P_\\text{crf}(Y|X)\\\\ \\mathcal{L}^{fl} &amp;= \\mathcal{L}_\\text{dp}^\\text{fl} + \\mathcal{L}_\\text{crf}^\\text{fl} \\end{array} Ldpflâ€‹Lcrfflâ€‹Lflâ€‹=âˆ’âˆ‘t=1Tâ€²â€‹(1âˆ’Pdpâ€‹(ytâ€‹âˆ£X))Î³logPdpâ€‹(ytâ€‹âˆ£X)=âˆ’(1âˆ’Pcrfâ€‹(Yâˆ£X))Î³logPcrfâ€‹(Yâˆ£X)=Ldpflâ€‹+Lcrfflâ€‹â€‹","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"NLP","slug":"NLP","permalink":"https://blog.zhuwenq.cc/tags/NLP/"},{"name":"Sequence Prediction","slug":"Sequence-Prediction","permalink":"https://blog.zhuwenq.cc/tags/Sequence-Prediction/"},{"name":"CGEC","slug":"CGEC","permalink":"https://blog.zhuwenq.cc/tags/CGEC/"}]},{"title":"Xlnet: Generalized autoregressive pretraining for language understanding","slug":"XLNet","date":"2021-09-25T16:00:00.000Z","updated":"2023-06-21T06:51:28.932Z","comments":true,"path":"XLNet/","link":"","permalink":"https://blog.zhuwenq.cc/XLNet/","excerpt":"æå‡ºäº†åŒæµæ³¨æ„åŠ›æ¨¡å‹","text":"æå‡ºäº†åŒæµæ³¨æ„åŠ›æ¨¡å‹ æ ‡å‡†è¯­è¨€æ¨¡å‹(Autoregressive)å’Œ BERT(MLM) BERT æ˜¯ä¸€ç§è‡ªç¼–ç æ¨¡å‹ï¼Œå®ƒä½¿ç”¨ MLM è®­ç»ƒç›®æ ‡ï¼Œè¯•å›¾ä»è¢«é®ç½©çš„è¯­å¥æ¢å¤è¢«é®ä½çš„ tokenã€‚è€Œè‡ªå›å½’æ¨¡å‹æ˜¯æ ¹æ®åºåˆ—ä¸­é å‰ä½ç½®çš„ token é¢„æµ‹ä¸‹ä¸€ä¸ª tokenï¼Œå¯¹äºç»™å®šçš„æ–‡æœ¬åºåˆ— x=[x1,...,xT]\\mathbf{x} = [x_1, ..., x_T]x=[x1â€‹,...,xTâ€‹], è‡ªå›å½’è¯­è¨€æ¨¡å‹çš„ç›®æ ‡æ˜¯è°ƒæ•´å‚æ•°ä½¿å¾—è®­ç»ƒæ•°æ®ä¸Šçš„ä¼¼ç„¶å‡½æ•°æœ€å¤§ï¼š maxâ¡Î¸logâ¡pÎ¸(x)=âˆ‘t=1Tlogâ¡pÎ¸(xtâˆ£x&lt;t)=âˆ‘t=1Tlogâ¡expâ¡(hÎ¸(x1:tâˆ’1)Te(xt))Î£xâ€²expâ¡(hÎ¸(x1:tâˆ’1)Te(xâ€²))\\max_\\theta \\log p_\\theta(\\mathbf{x}) = \\sum_{t=1}^T\\log p_\\theta(x_t|\\mathbf{x}_{&lt;t}) = \\sum_{t=1}^T\\log \\frac{\\exp(h_\\theta(\\mathbf{x}_{1:t-1})^Te(x_t))}{\\Sigma_{x&#x27;}\\exp(h_\\theta(\\mathbf{x}_{1:t-1})^Te(x&#x27;))} Î¸maxâ€‹logpÎ¸â€‹(x)=t=1âˆ‘Tâ€‹logpÎ¸â€‹(xtâ€‹âˆ£x&lt;tâ€‹)=t=1âˆ‘Tâ€‹logÎ£xâ€²â€‹exp(hÎ¸â€‹(x1:tâˆ’1â€‹)Te(xâ€²))exp(hÎ¸â€‹(x1:tâˆ’1â€‹)Te(xtâ€‹))â€‹ å…¶ä¸­ x&lt;t\\mathbf{x}_{&lt; t}x&lt;tâ€‹ è¡¨ç¤º x\\mathbf{x}x ä¸­ä½ç½® ttt ä¹‹å‰çš„æ‰€æœ‰ xxxï¼Œå³ x1:tâˆ’1\\mathbf{x}_{1:t-1}x1:tâˆ’1â€‹ã€‚hÎ¸(x1:tâˆ’1)h_\\theta(\\mathbf{x}_{1:t-1})hÎ¸â€‹(x1:tâˆ’1â€‹) æ˜¯ RNN æˆ– Transformer ç¼–ç çš„éšè—çŠ¶æ€ã€‚e(x)e(x)e(x) æ˜¯ token xxx çš„ embeddingã€‚ è€Œ BERT æ˜¯å»å™ªè‡ªç¼–ç çš„æ–¹æ³•ï¼Œå¯¹äºåºåˆ— x\\mathbf{x}x, BERT ç»è¿‡éšæœºæŒ‘é€‰ token è¿›è¡Œé®ç½©å°†å…¶å˜æˆå¸¦æœ‰å™ªå£°çš„ x^\\hat{\\mathbf{x}}x^, å‡è®¾è¢«é®ç½©çš„ token åŸå§‹å€¼æ˜¯ xâ€¾\\overline{\\mathbf{x}}x, BERT æ ¹æ®ä¸Šä¸‹æ–‡æ¢å¤é™¤è¢«é®ç½©çš„ token çš„åŸå§‹å€¼ï¼Œå³ï¼š maxâ¡Î¸logâ¡pÎ¸(xâ€¾âˆ£x^)â‰ˆâˆ‘t=1Tmtlogâ¡pÎ¸(xtâˆ£x^)=âˆ‘t=1Tmtlogâ¡expâ¡(HÎ¸(x)tTe(xt))Î£xâ€²expâ¡(HÎ¸(x)tTe(xâ€²))\\max_\\theta \\log p_\\theta(\\overline{\\mathbf{x}}|\\hat{\\mathbf{x}})\\approx\\sum_{t = 1}^{T}m_t\\log p_\\theta(x_t|\\hat{\\mathbf{x}}) = \\sum_{t = 1}^{T}m_t\\log \\frac{\\exp(H_\\theta(\\mathbf{x})_t^Te(x_t))}{\\Sigma_{x&#x27;}\\exp(H_\\theta(\\mathbf{x})_t^Te(x&#x27;))} Î¸maxâ€‹logpÎ¸â€‹(xâˆ£x^)â‰ˆt=1âˆ‘Tâ€‹mtâ€‹logpÎ¸â€‹(xtâ€‹âˆ£x^)=t=1âˆ‘Tâ€‹mtâ€‹logÎ£xâ€²â€‹exp(HÎ¸â€‹(x)tTâ€‹e(xâ€²))exp(HÎ¸â€‹(x)tTâ€‹e(xtâ€‹))â€‹ å¼ä¸­ mt=1m_t = 1mtâ€‹=1 è¡¨ç¤ºä½ç½® ttt æ˜¯ä¸€ä¸ª MASKï¼Œéœ€è¦è¢«æ¢å¤ã€‚HÎ¸H_\\thetaHÎ¸â€‹ æ˜¯ä¸€ä¸ª Transformerï¼Œå®ƒå°†é•¿åº¦ä¸º TTT çš„åºåˆ— x\\mathbf{x}x æ˜ å°„ä¸ºéšè—çŠ¶æ€åºåˆ— HÎ¸(x)=[HÎ¸(x)1,...,HÎ¸(x)T]H_\\theta(\\mathbf{x}) = [H_\\theta(\\mathbf{x})_1, ..., H_\\theta(\\mathbf{x})_T]HÎ¸â€‹(x)=[HÎ¸â€‹(x)1â€‹,...,HÎ¸â€‹(x)Tâ€‹]ã€‚ï¼ˆè¿™é‡Œçš„ BERT å¯ä»¥æ³¨æ„åˆ°æ•´ä¸ªåºåˆ—æ‰€æœ‰çš„ tokenï¼Œå› æ­¤è®°ä½œ HÎ¸(x)H_\\theta(\\mathbf{x})HÎ¸â€‹(x), å‰é¢çš„è‡ªå›å½’æ¨¡å‹åªèƒ½æ³¨æ„åˆ°ä½ç½® ttt ä¹‹å‰çš„ tokenï¼Œå› æ­¤è®°ä½œ hÎ¸(x1:tâˆ’1)h_\\theta(\\mathbf{x}_{1:t-1})hÎ¸â€‹(x1:tâˆ’1â€‹)ï¼‰ å¯¹äº BERTï¼Œå…¶ç¼ºé™·æœ‰ï¼š ç‹¬ç«‹å‡è®¾ æ³¨æ„åˆ° BERT çš„è®­ç»ƒç›®æ ‡è¡¨è¾¾å¼ä¸­ä½¿ç”¨äº† â‰ˆ\\approxâ‰ˆ, æ„ä¸ºåœ¨ç»™å®šçš„é®ç½©ä¿¡æ¯ x^\\hat{\\mathbf{x}}x^ çš„æ¡ä»¶ä¸‹ï¼Œè¢«é®ç½©çš„ token ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œè¿™ä¸ªå‡è®¾æ˜¾ç„¶ä¸æˆç«‹ã€‚ä¾‹å¦‚è¯­å¥ New York is a city\\text{New York is a city}New York is a city ï¼Œå‡è®¾è¢«é®ä½çš„æ˜¯ New\\text{New}New å’Œ York\\text{York}Yorkï¼Œé‚£ä¹ˆåœ¨ç»™å®š is a city\\text{is a city}is a city çš„æ¡ä»¶ä¸‹ä¸¤ä¸ªè¢«é®ä½çš„ token å¹¶ä¸ç‹¬ç«‹ã€‚ é¢„è®­ç»ƒä¸å¾®è°ƒçš„å‰²è£‚ BERT åœ¨é¢„è®­ç»ƒæ—¶ä¼šæœ‰ç‰¹æ®Šçš„ token MASKï¼Œè¿™ç§ token åœ¨ä¸‹æ¸¸çš„å¾®è°ƒè¿‡ç¨‹ä¸­ä¸ä¼šå‡ºç° å¯¹äºæ ‡å‡†è¯­è¨€æ¨¡å‹ï¼Œå…¶ç¼ºé™·æœ‰ï¼š åŒå‘ä¸Šä¸‹æ–‡ æ ‡å‡†è¯­è¨€æ¨¡å‹åªèƒ½åˆ©ç”¨ä¸€ä¸ªæ–¹å‘çš„ä¸Šä¸‹æ–‡ æ’åˆ—è¯­è¨€æ¨¡å‹(Permutation Language Model) XLNet ä½¿ç”¨æ’åˆ—è¯­è¨€æ¨¡å‹å®ç°äº†ç»“åˆä¸Šä¸‹æ–‡ä¿¡æ¯å¹¶ä¸”ä¸å¼•å…¥ [MASK] æ ‡è®°ï¼ŒåŒæ—¶ç±»ä¼¼è‡ªå›å½’çš„é¢„æµ‹è¿‡ç¨‹é¿å¼€äº†ç‹¬ç«‹å‡è®¾çš„é™åˆ¶ã€‚ è¯­åºåˆ†è§£ å¯¹äºç»™å®šé•¿åº¦ TTT çš„åºåˆ— x\\mathbf{x}xï¼Œæ€»å…±æœ‰ T!T!T! ç§æ’åˆ—é¡ºåºï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è‡ªå›å½’æ—¶æœ‰ T!T!T! ç§é“¾å¼åˆ†è§£æ–¹æ³•ã€‚å‡è®¾ x=[x1,x2,x3]\\mathbf{x} = [x_1, x_2, x_3]x=[x1â€‹,x2â€‹,x3â€‹], åˆ™æ€»å…±æœ‰ 3!=63! = 63!=6 ç§åˆ†è§£æ–¹å¼ï¼š p(x)=p(x1)p(x2âˆ£x1)p(x3âˆ£x1x2)â‡’1â†’2â†’3p(x)=p(x1)p(x2âˆ£x1x3)p(x3âˆ£x1)â‡’1â†’3â†’2p(x)=p(x1âˆ£x2)p(x2)p(x3âˆ£x1x2)â‡’2â†’1â†’3p(x)=p(x1âˆ£x2x3)p(x2)p(x3âˆ£x2)â‡’2â†’3â†’1p(x)=p(x1âˆ£x3)p(x2âˆ£x1x3)p(x3)â‡’3â†’1â†’2p(x)=p(x1âˆ£x2x3)p(x2âˆ£x3)p(x3)â‡’3â†’2â†’1\\begin{array}{c} p(\\mathbf{x}) = p(x_1)p(x_2|x_1)p(x_3|x_1x_2)\\Rightarrow 1\\rightarrow 2\\rightarrow 3\\\\ p(\\mathbf{x}) = p(x_1)p(x_2|x_1x_3)p(x_3|x_1)\\Rightarrow 1\\rightarrow 3\\rightarrow 2\\\\ p(\\mathbf{x}) = p(x_1|x_2)p(x_2)p(x_3|x_1x_2)\\Rightarrow 2\\rightarrow 1\\rightarrow 3\\\\ p(\\mathbf{x}) = p(x_1|x_2x_3)p(x_2)p(x_3|x_2)\\Rightarrow 2\\rightarrow 3\\rightarrow 1\\\\ p(\\mathbf{x}) = p(x_1|x_3)p(x_2|x_1x_3)p(x_3)\\Rightarrow 3\\rightarrow 1\\rightarrow 2\\\\ p(\\mathbf{x}) = p(x_1|x_2x_3)p(x_2|x_3)p(x_3)\\Rightarrow 3\\rightarrow 2\\rightarrow 1 \\end{array}p(x)=p(x1â€‹)p(x2â€‹âˆ£x1â€‹)p(x3â€‹âˆ£x1â€‹x2â€‹)â‡’1â†’2â†’3p(x)=p(x1â€‹)p(x2â€‹âˆ£x1â€‹x3â€‹)p(x3â€‹âˆ£x1â€‹)â‡’1â†’3â†’2p(x)=p(x1â€‹âˆ£x2â€‹)p(x2â€‹)p(x3â€‹âˆ£x1â€‹x2â€‹)â‡’2â†’1â†’3p(x)=p(x1â€‹âˆ£x2â€‹x3â€‹)p(x2â€‹)p(x3â€‹âˆ£x2â€‹)â‡’2â†’3â†’1p(x)=p(x1â€‹âˆ£x3â€‹)p(x2â€‹âˆ£x1â€‹x3â€‹)p(x3â€‹)â‡’3â†’1â†’2p(x)=p(x1â€‹âˆ£x2â€‹x3â€‹)p(x2â€‹âˆ£x3â€‹)p(x3â€‹)â‡’3â†’2â†’1â€‹ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ’åºè¯­è¨€æ¨¡å‹ä¸­çš„è¯­åºå¹¶æ²¡æœ‰æ”¹å˜ï¼Œåªæ˜¯é¢„æµ‹çš„é¡ºåºå‘ç”Ÿäº†æ”¹å˜ã€‚ä¾‹å¦‚ p(x2âˆ£x1x3)p(x_2|x_1x_3)p(x2â€‹âˆ£x1â€‹x3â€‹) æŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ª token æ˜¯ x1x_1x1â€‹ï¼Œç¬¬ä¸‰ä¸ª token æ˜¯ x3x_3x3â€‹ çš„æƒ…å†µä¸‹ç¬¬äºŒä¸ªè¯æ˜¯ x2x_2x2â€‹ çš„æ¦‚ç‡ï¼Œè€Œä¸æ˜¯ç¬¬ä¸€ä¸ª token æ˜¯ x1x_1x1â€‹ï¼Œç¬¬äºŒä¸ª token æ˜¯ x3x_3x3â€‹ çš„æƒ…å†µä¸‹ç¬¬ä¸‰ä¸ª token æ˜¯ x2x_2x2â€‹ çš„æ¦‚ç‡ã€‚ å¯¹äºè¿™ T!T!T! ç§æ’åºæ–¹æ³•ï¼Œå¦‚æœæ¨¡å‹å¯ä»¥éå†æ‰€æœ‰çš„æƒ…å†µï¼Œå¹¶ä¸”å‚æ•°æ˜¯å…±äº«çš„ï¼Œåˆ™è¿™ä¸ªæ¨¡å‹å°±èƒ½å­¦ä¹ åˆ°å„ç§çš„ä¸Šä¸‹æ–‡ã€‚ä½†æ˜¯è¿™ç§ç­–ç•¥çš„è®¡ç®—å¼€é”€éå¸¸å¤§ï¼Œå®é™…ä¸Šåªèƒ½éšæœºé‡‡æ ·éƒ¨åˆ†æ’åˆ—æ–¹å¼ã€‚ç”¨æ•°å­¦è¯­è¨€æè¿°æ’åˆ—è¯­è¨€æ¨¡å‹çš„ç›®æ ‡ä¸ºï¼š maxâ¡Î¸Ezâˆ¼ZT[âˆ‘t=1Tlogâ¡pÎ¸(xztâˆ£xz&lt;t)]\\max_\\theta \\mathbb{E}_{z\\sim\\mathcal{Z}_T}[\\sum_{t = 1}^{T}\\log p_\\theta(x_{z_t|\\mathbf{x}_{z_{&lt;t}}})] Î¸maxâ€‹Ezâˆ¼ZTâ€‹â€‹[t=1âˆ‘Tâ€‹logpÎ¸â€‹(xztâ€‹âˆ£xz&lt;tâ€‹â€‹â€‹)] å³è°ƒæ•´å‚æ•°ä½¿å¾—ä¼¼ç„¶æ¦‚ç‡æœ€å¤§ã€‚å…¶ä¸­ ZT\\mathcal{Z}_TZTâ€‹ è¡¨ç¤ºé•¿åº¦ä¸º TTT çš„åºåˆ—ä¸­æ‰€æœ‰çš„æ’åˆ—æ–¹å¼çš„é›†åˆï¼ŒzâˆˆZTz\\in \\mathcal{Z}_TzâˆˆZTâ€‹ è¡¨ç¤ºå…¶ä¸­çš„ä¸€ç§æ’åˆ—æ–¹æ³•ã€‚ztz_tztâ€‹ è¡¨ç¤ºç¬¬ ttt ç§æ’åˆ—ï¼Œz&lt;tz_{&lt;t}z&lt;tâ€‹ è¡¨ç¤º zzz çš„ç¬¬ 1âˆ¼tâˆ’11\\sim t - 11âˆ¼tâˆ’1 ä¸ªå…ƒç´ ã€‚ åœ¨å®é™…çš„å®ç°ä¸­ï¼ŒXLNet æ˜¯é€šè¿‡ Attention çš„ Mask æ¥å®ç°ä¸åŒçš„æ’åºæ–¹å¼ã€‚ä¾‹å¦‚ p(x1âˆ£x3)p(x2âˆ£x1x3)p(x3)p(x_1|x_3)p(x_2|x_1x_3)p(x_3)p(x1â€‹âˆ£x3â€‹)p(x2â€‹âˆ£x1â€‹x3â€‹)p(x3â€‹) ,å¯ä»¥åœ¨ Transformer ç¼–ç  x1x_1x1â€‹ çš„æ—¶å€™ attend to x3x_3x3â€‹, åŒæ—¶æŠŠ x2x_2x2â€‹ Mask æ‰ï¼Œå°±å®ç°äº† p(x1âˆ£x3)p(x_1|x_3)p(x1â€‹âˆ£x3â€‹)ã€‚ åŒæµæ³¨æ„åŠ›æœºåˆ¶(Two-Stream Self-Attention for Target-Aware Repersentations) ä½ç½®ä¿¡æ¯é—®é¢˜ ä¸Šè¿°çš„æ’åºè¯­è¨€æ¨¡å‹å­˜åœ¨ä½ç½®ä¿¡æ¯ç¼ºå¤±çš„é—®é¢˜ã€‚ä¾‹å¦‚è¾“å…¥çš„å¥å­æ˜¯ I like New York\\text{I like New York}I like New York, å¹¶ä¸”é‡‡æ ·åˆ°çš„ä¸€ç§æ’åºä¸º z=[1,3,4,2]z = [1, 3, 4, 2]z=[1,3,4,2], åœ¨é¢„æµ‹ z3=4z_3 = 4z3â€‹=4 ä½ç½®æ—¶ï¼Œæ ¹æ®å…¬å¼ï¼š pÎ¸(Xz3=xâˆ£xz1z2)=pÎ¸(X4=xâˆ£x1x3)=expâ¡(e(x)ThÎ¸(x1x3))Î£xâ€²expâ¡(e(xâ€²)ThÎ¸(x1x3))p_\\theta(X_{z_3} = x|x_{z_1z_2}) = p_\\theta(X_4 = x|x_1x_3) = \\frac{\\exp(e(x)^Th_\\theta(x_1x_3))}{\\Sigma_{x&#x27;}\\exp(e(x&#x27;)^Th_\\theta(x_1x_3))} pÎ¸â€‹(Xz3â€‹â€‹=xâˆ£xz1â€‹z2â€‹â€‹)=pÎ¸â€‹(X4â€‹=xâˆ£x1â€‹x3â€‹)=Î£xâ€²â€‹exp(e(xâ€²)ThÎ¸â€‹(x1â€‹x3â€‹))exp(e(x)ThÎ¸â€‹(x1â€‹x3â€‹))â€‹ ä¸Šå¼ç”¨è‡ªç„¶è¯­è¨€æè¿°ä¸ºï¼Œç¬¬ä¸€ä¸ªè¯æ˜¯ I\\text{I}I, ç¬¬ä¸‰ä¸ªè¯æ˜¯ New\\text{New}New çš„æ¡ä»¶ä¸‹ç¬¬å››ä¸ªè¯æ˜¯ York\\text{York}York çš„æ¦‚ç‡ã€‚ å¦å¤–å†çœ‹å¦ä¸€ç§æ’åˆ— zâ€²=[1,3,2,4]z&#x27; = [1, 3, 2, 4]zâ€²=[1,3,2,4], åœ¨é¢„æµ‹ z3=2z_3 = 2z3â€‹=2 æ—¶ï¼š pÎ¸(Xz3=xâˆ£xz1z2)=pÎ¸(X2=xâˆ£x1x3)=expâ¡(e(x)ThÎ¸(x1x3))Î£xâ€²expâ¡(e(xâ€²)ThÎ¸(x1x3))p_\\theta(X_{z_3} = x|x_{z_1z_2}) = p_\\theta(X_2 = x|x_1x_3) = \\frac{\\exp(e(x)^Th_\\theta(x_1x_3))}{\\Sigma_{x&#x27;}\\exp(e(x&#x27;)^Th_\\theta(x_1x_3))} pÎ¸â€‹(Xz3â€‹â€‹=xâˆ£xz1â€‹z2â€‹â€‹)=pÎ¸â€‹(X2â€‹=xâˆ£x1â€‹x3â€‹)=Î£xâ€²â€‹exp(e(xâ€²)ThÎ¸â€‹(x1â€‹x3â€‹))exp(e(x)ThÎ¸â€‹(x1â€‹x3â€‹))â€‹ è¡¨ç¤ºç¬¬ä¸€ä¸ªè¯æ˜¯ I\\text{I}Iï¼Œç¬¬ä¸‰ä¸ªè¯æ˜¯ New\\text{New}New çš„æ¡ä»¶ä¸‹ç¬¬äºŒä¸ªè¯æ˜¯ York\\text{York}York çš„æ¦‚ç‡ã€‚å¯¹æ¯”å‘ç°ä¸Šé¢ä¸¤ä¸ªæ¦‚ç‡æ˜¯ç›¸åŒçš„ï¼Œè¿™ä¸ç¬¦åˆæ—¥å¸¸ç»éªŒã€‚é—®é¢˜çš„å…³é”®å°±åœ¨äºæ¨¡å‹æ— æ³•è·çŸ¥è¦é¢„æµ‹çš„è¯åœ¨åŸå§‹è¯­å¥ä¸­çš„ä½ç½®ã€‚ åŒæµæ³¨æ„åŠ› åœ¨ Transformer ä¸­ï¼Œtoken çš„ä½ç½®ä¿¡æ¯ä½¿ç”¨ positional embedding ç¼–ç å¹¶åŠ åˆ° embedding ä¸­ï¼Œç„¶åéš token è¾“å…¥åˆ°æ¨¡å‹ä¸­ã€‚è¿™ä½¿å¾—æ¨¡å‹åªèƒ½è·å–æ³¨æ„åˆ°çš„ token çš„ä½ç½®ä¿¡æ¯ï¼Œä¸èƒ½è·å–è¦é¢„æµ‹çš„ token çš„ä½ç½®ä¿¡æ¯ã€‚ä¾‹å¦‚ p(X4=xâˆ£x1x3)p(X_4 = x|x_1x_3)p(X4â€‹=xâˆ£x1â€‹x3â€‹) ä¸­æ¨¡å‹ attend to x1,x3x_1, x_3x1â€‹,x3â€‹, åˆ™æ¨¡å‹åœ¨è·å¾— x1,x3x_1, x_3x1â€‹,x3â€‹ çš„ embedding çš„åŒæ—¶å¯ä»¥è·å¾—å…¶ä½ç½®ä¿¡æ¯ï¼Œä½†æ˜¯å¯¹äºè¦é¢„æµ‹çš„ token X4X_4X4â€‹, åˆ™ä¸å¯èƒ½è·å–å…¶ embeddingï¼Œä¹Ÿå°±æ— æ³•è·å–ä½ç½®ä¿¡æ¯ã€‚ å› æ­¤å¿…é¡»æ˜¾ç¤ºåœ°å‘Šè¯‰æ¨¡å‹è¦é¢„æµ‹çš„è¯å¤„äºåºåˆ—ä¸­çš„ä½ç½®ã€‚å¯¹äºç»™å®šçš„æ’åˆ— zzzï¼Œè¦è®¡ç®— pÎ¸(Xzt=xâˆ£xz&lt;t)p_\\theta(X_{z_t} = x|\\mathbf{x}_{z_{&lt;t}})pÎ¸â€‹(Xztâ€‹â€‹=xâˆ£xz&lt;tâ€‹â€‹) æ—¶ï¼Œæœ´ç´ çš„ Transformer è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š pÎ¸(Xzt=xâˆ£xz&lt;t)=expâ¡(e(x)ThÎ¸(xz&lt;t))Î£xâ€²expâ¡(e(xâ€²)ThÎ¸(xz&lt;t))p_\\theta(X_{z_t} = x|\\mathbf{x}_{z_{&lt;t}}) = \\frac{\\exp(e(x)^Th_\\theta(\\mathbf{x}_{z_{&lt;t}}))}{\\Sigma_{x&#x27;}\\exp(e(x&#x27;)^Th_\\theta(\\mathbf{x}_{z_{&lt;t}}))} pÎ¸â€‹(Xztâ€‹â€‹=xâˆ£xz&lt;tâ€‹â€‹)=Î£xâ€²â€‹exp(e(xâ€²)ThÎ¸â€‹(xz&lt;tâ€‹â€‹))exp(e(x)ThÎ¸â€‹(xz&lt;tâ€‹â€‹))â€‹ è¿™æ ·å¯¹äºç›¸åŒçš„ä¸Šä¸‹æ–‡å’Œç›¸åŒçš„è¯ï¼Œå…¶å¤„åœ¨ä¸åŒä½ç½®çš„æ¦‚ç‡æ˜¯ç›¸åŒçš„ã€‚ä¸ºè§£å†³è¿™ä¸€é—®é¢˜ï¼ŒXLNet å°†è¦é¢„æµ‹çš„ä½ç½® ztz_tztâ€‹ æ”¾åœ¨æ¨¡å‹ä¸­ï¼š pÎ¸(Xzt=xâˆ£xz&lt;t)=expâ¡(e(x)TgÎ¸(xz&lt;t,zt))Î£xâ€²expâ¡(e(xâ€²)TgÎ¸(xz&lt;t,zt))p_\\theta(X_{z_t} = x|\\mathbf{x}_{z_{&lt;t}}) = \\frac{\\exp(e(x)^Tg_\\theta(\\mathbf{x}_{z_{&lt;t}}, z_t))}{\\Sigma_{x&#x27;}\\exp(e(x&#x27;)^Tg_\\theta(\\mathbf{x}_{z_{&lt;t}}, z_t))} pÎ¸â€‹(Xztâ€‹â€‹=xâˆ£xz&lt;tâ€‹â€‹)=Î£xâ€²â€‹exp(e(xâ€²)TgÎ¸â€‹(xz&lt;tâ€‹â€‹,ztâ€‹))exp(e(x)TgÎ¸â€‹(xz&lt;tâ€‹â€‹,ztâ€‹))â€‹ è¦æ‰¾åˆ°ä¸€ä¸ªæ¨¡å‹æ¥å®ç° gÎ¸(xz&lt;t,zt)g_\\theta(\\mathbf{x}_{z_{&lt;t}}, z_t)gÎ¸â€‹(xz&lt;tâ€‹â€‹,ztâ€‹) çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°éœ€è¦æ»¡è¶³ä¸¤ç‚¹è¦æ±‚ï¼š ä¸ºäº†é¢„æµ‹ xztx_{z_t}xztâ€‹â€‹, gÎ¸(xz&lt;t,zt)g_\\theta(\\mathbf{x}_{z_{&lt;t}}, z_t)gÎ¸â€‹(xz&lt;tâ€‹â€‹,ztâ€‹) åªèƒ½ä½¿ç”¨ä½ç½®ä¿¡æ¯ ztz_tztâ€‹ è€Œä¸èƒ½ä½¿ç”¨ xztx_{z_t}xztâ€‹â€‹(å¦åˆ™æ¨¡å‹ç›´æ¥çœ‹åˆ°äº†è¦é¢„æµ‹çš„è¯) ä¸ºäº†é¢„æµ‹ ztz_tztâ€‹ ä¹‹åçš„è¯ï¼ŒgÎ¸(xz&lt;t,zt)g_\\theta(\\mathbf{x}_{z_{&lt;t}}, z_t)gÎ¸â€‹(xz&lt;tâ€‹â€‹,ztâ€‹) å¿…é¡»ç¼–ç  xztx_{z_t}xztâ€‹â€‹ çš„è¯­ä¹‰ä¿¡æ¯ è¿™ä¸¤ç‚¹å¯¹äºæœ´ç´ çš„ Transformer æ¥è¯´æ˜¯çŸ›ç›¾çš„ï¼Œä¾‹å¦‚åœ¨ç¬¬ä¸€å±‚ Attention ç¼–ç  xz1x_{z_1}xz1â€‹â€‹ æ—¶ï¼Œå¦‚æœåˆ©ç”¨äº† xz1x_{z_1}xz1â€‹â€‹ çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå¯ä»¥è·å¾—å…¶ä½ç½®ä¿¡æ¯ï¼Œä½†åŒæ—¶å®ƒæœ¬èº«çš„è¯­ä¹‰ä¿¡æ¯ä¹Ÿæ³„éœ²äº†ã€‚å¦‚æœä¸åˆ©ç”¨ xz1x_{z_1}xz1â€‹â€‹ çš„è¯­ä¹‰ä¿¡æ¯ï¼Œåªåˆ©ç”¨å…¶ä½ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆåœ¨ä¸‹ä¸€å±‚çš„ Attention ç¼–ç  xz2x_{z_2}xz2â€‹â€‹ æ—¶ï¼Œç¼–ç çš„ä¾èµ–æ¡ä»¶ä¹‹ä¸€ h10(xz1)h_1^0(x_{z_1})h10â€‹(xz1â€‹â€‹) ä¸­æ²¡æœ‰è¯­ä¹‰ä¿¡æ¯ï¼Œç›¸å½“äºå‡­ç©ºå¯¹ xz2x_{z_2}xz2â€‹â€‹ ç¼–ç ã€‚ å› æ­¤éœ€è¦å¼•å…¥åŒæµæ³¨æ„åŠ›ï¼Œå³ä¸¤ä¸ªéšè—çŠ¶æ€ï¼š å†…å®¹éšè—çŠ¶æ€ hÎ¸(xz&lt;t)h_\\theta(\\mathbf{x}_{z_{&lt;t}})hÎ¸â€‹(xz&lt;tâ€‹â€‹), ç®€å†™ä¸º hzth_{z_t}hztâ€‹â€‹, å’Œæ ‡å‡†çš„ Transformer ä¸­çš„éšè—çŠ¶æ€ä¸€æ ·ï¼Œå³ç¼–ç ä¸Šä¸‹æ–‡ä¹Ÿç¼–ç  xztx_{z_t}xztâ€‹â€‹ æœ¬èº«çš„å†…å®¹ æŸ¥è¯¢éšè—çŠ¶æ€ gÎ¸(xz&lt;t,zt)g_\\theta(\\mathbf{x}_{z_{&lt;t}}, z_t)gÎ¸â€‹(xz&lt;tâ€‹â€‹,ztâ€‹), ç®€å†™ä¸º gztg_{z_t}gztâ€‹â€‹, å®ƒåªç¼–ç ä¸Šä¸‹æ–‡å’Œè¦é¢„æµ‹çš„ä½ç½® ztz_tztâ€‹ï¼Œä¸åŒ…å« xztx_{z_t}xztâ€‹â€‹ çš„è¯­ä¹‰ä¿¡æ¯ åœ¨å®é™…è®¡ç®—æ—¶ï¼Œç¬¬0å±‚çš„ä¸¤ç§éšè—çŠ¶æ€ gi0,hi0g_i^0, h_i^0gi0â€‹,hi0â€‹ åˆ†åˆ«è¢«åˆå§‹åŒ–ä¸ºéšæœºå˜é‡ www å’Œè¯çš„ embedding e(xi)e(x_i)e(xiâ€‹)ã€‚æ¥ç€å‘é«˜å±‚ä¼ é€’æ—¶ï¼ŒæŒ‰ç…§ä¸‹é¢çš„è¿‡ç¨‹é€å±‚ä¼ é€’ï¼š gztmâ†Attention(Q=gztmâˆ’1,KV=hz&lt;tmâˆ’1;Î¸)hztmâ†Attention(Q=hztmâˆ’1,KV=hzâ‰¤tmâˆ’1;Î¸)\\begin{array}{c} g_{z_t}^m\\leftarrow Attention(Q = g_{z_t}^{m-1}, KV = h_{z_{&lt;t}}^{m-1}; \\theta)\\\\ h_{z_t}^m\\leftarrow Attention(Q = h_{z_t}^{m-1}, KV = h_{z_{\\leq t}}^{m-1}; \\theta) \\end{array}gztâ€‹mâ€‹â†Attention(Q=gztâ€‹mâˆ’1â€‹,KV=hz&lt;tâ€‹mâˆ’1â€‹;Î¸)hztâ€‹mâ€‹â†Attention(Q=hztâ€‹mâˆ’1â€‹,KV=hzâ‰¤tâ€‹mâˆ’1â€‹;Î¸)â€‹ ä¸Šè¿°ä¸¤ä¸ªæµåˆ†åˆ«æ˜¯ Query æµå’Œ Content æµã€‚å…¶ä¸­ Query æµä¸­çš„ QQQ æ¥è‡ªä¸Šä¸€å±‚çš„ gztg_{z_t}gztâ€‹â€‹, Content æµçš„ QQQ æ¥è‡ªä¸Šä¸€å±‚çš„ hzth_{z_t}hztâ€‹â€‹, è€Œä¸¤ä¸ªæµçš„ K,VK, VK,V éƒ½æ¥è‡ªä¸Šä¸€å±‚çš„ hhh, å…¶ä¸­ Query æµçš„ K,VK, VK,V æ¥è‡ª hz&lt;th_{z_{&lt;t}}hz&lt;tâ€‹â€‹, ä»£è¡¨å…¶ä¸èƒ½è®¿é—®å½“å‰ token çš„ä¿¡æ¯ï¼ŒContent æµçš„ K,VK, VK,V æ¥è‡ª hzâ‰¤th_{z_{\\leq t}}hzâ‰¤tâ€‹â€‹, åŒ…å«å½“å‰ token çš„è¯­ä¹‰ä¿¡æ¯ã€‚ å¦‚å›¾æ˜¯åŒæµæ³¨æ„åŠ›æ¨¡å‹çš„ç¤ºæ„å›¾ã€‚ (a) å›¾æ‰€ç¤ºæ˜¯ Content æµçš„è®¡ç®—è¿‡ç¨‹ï¼Œå‡è®¾æ’åˆ—ä¸º 3â†’2â†’4â†’13\\rightarrow 2\\rightarrow 4\\rightarrow 13â†’2â†’4â†’1, å¹¶ä¸”å½“å‰æ­£åœ¨ç¼–ç çš„æ˜¯ç¬¬ä¸€ä¸ªè¯ã€‚Content æµå¯ä»¥å‚è€ƒæ‰€æœ‰ token çš„ä¿¡æ¯ï¼Œå› æ­¤ KV=[h10,h20,h30,h40]KV = [h_1^0, h_2^0, h_3^0, h_4^0]KV=[h10â€‹,h20â€‹,h30â€‹,h40â€‹], è€Œ Q=h10Q = h_1^0Q=h10â€‹ã€‚ (b) å›¾æ‰€ç¤ºæ˜¯ Query æµçš„è®¡ç®—è¿‡ç¨‹ï¼Œå› ä¸º Query æµä¸èƒ½å‚è€ƒè‡ªå·±çš„å†…å®¹ï¼Œå› æ­¤ KV=[h20,h30,h40]KV = [h_2^0, h_3^0, h_4^0]KV=[h20â€‹,h30â€‹,h40â€‹], è€Œ Q=g10Q = g_1^0Q=g10â€‹ Â© å›¾æ˜¯å®Œæ•´çš„è®¡ç®—è¿‡ç¨‹ï¼ŒæŒ‰ç…§ä»ä¸‹è€Œä¸Šçš„é¡ºåºï¼Œé¦–å…ˆ h0,g0h^0, g^0h0,g0 åˆ†åˆ«è¢«åˆå§‹åŒ–ä¸ºè¯åµŒå…¥ e(xi)e(x_i)e(xiâ€‹) å’Œéšæœºå˜é‡ wwwï¼Œç„¶å Content Mask å’Œ Query Mask è®¡ç®—ç¬¬ä¸€å±‚çš„è¾“å‡º h1,g1h^1, g^1h1,g1, é€å±‚ä¼ é€’ã€‚å›¾ä¸­çš„ Attention Mask ä¸­ï¼Œçºµåæ ‡ä»ä¸Šåˆ°ä¸‹è¡¨ç¤ºå½“å‰é¢„æµ‹çš„ token ç¼–å·ï¼Œæ¨ªåæ ‡ä»å·¦åˆ°å³è¡¨ç¤ºå¯ä»¥ Attend to çš„ token ç¼–å·ï¼Œå…¶ä¸­çº¢ç‚¹è¡¨ç¤ºå¯ä»¥ Attend to, ç™½ç‚¹è¡¨ç¤ºä¸èƒ½ Attend toã€‚å› æ­¤ï¼Œ Content Mask ç¬¬ä¸€è¡Œè¡¨ç¤ºï¼šé¢„æµ‹ç¬¬ä¸€ä¸ª token æ—¶å¯ä»¥ Attend to æ‰€æœ‰çš„ tokenï¼Œç¬¬ä¸‰è¡Œè¡¨ç¤ºé¢„æµ‹ç¬¬ä¸‰ä¸ª token æ—¶åªèƒ½ Attend to è‡ªå·±ã€‚Query Mask çš„å¯¹è§’çº¿å…¨ç™½è¡¨ç¤º Query Stream ä¸èƒ½ Attend to è‡ªèº«ã€‚ éƒ¨åˆ†é¢„æµ‹ æ’åˆ—è¯­è¨€æ¨¡å‹å¯ä»¥åˆ©ç”¨æ¯ç§æ’åˆ—ä¸­çš„æ¯ä¸€ä¸ª tokenï¼Œç”±äºè®¡ç®—é‡çš„åŸå› ï¼Œåªåœ¨æ‰€æœ‰æ’åˆ—ä¸­éšæœºæŠ½å–éƒ¨åˆ†æ’åˆ—ï¼ŒåŒæ—¶ç”±äºå¯¹æ‰€æœ‰çš„ token è¿›è¡Œé¢„æµ‹æ¨¡å‹éš¾ä»¥æ”¶æ•›ï¼ŒXLNet åªé€‰æ‹©æ’åˆ—çš„æœ€å 1K\\frac{1}{K}K1â€‹ token è¿›è¡Œé¢„æµ‹ã€‚ å¯ä»¥å°†ä¸€ä¸ªæ’åˆ— zzz åˆ†æˆä¸¤ä¸ªå­åºåˆ— zâ‰¤cz_{\\leq c}zâ‰¤câ€‹ å’Œ z&gt;cz_{&gt;c}z&gt;câ€‹, åˆ†åˆ«å«åš non-target åºåˆ—å’Œ target åºåˆ—ï¼Œccc æ˜¯åˆ†å‰²ç‚¹ã€‚å› æ­¤æœ‰ï¼šâˆ£zâˆ£âˆ’câˆ£zâˆ£=1K\\frac{|z| - c}{|z|} = \\frac{1}{K}âˆ£zâˆ£âˆ£zâˆ£âˆ’câ€‹=K1â€‹ ç»“åˆ Transformer-XL çš„æ€æƒ³ ç›¸å¯¹ä½ç½®ç¼–ç  cache éšçŠ¶æ€ å‡è®¾æœ‰ä¸¤ä¸ªä»åŸå§‹åºåˆ— s\\mathbf{s}s ä¸­æŠ½å–çš„ segmentï¼Œx~=s1:T\\widetilde{x} = s_{1:T}x=s1:Tâ€‹ å’Œ x=sT+1:2Tx = s_{T+1:2T}x=sT+1:2Tâ€‹ã€‚åŒæ—¶å‡è®¾ z~,z\\widetilde{z}, zz,z åˆ†åˆ«æ˜¯ [1,...,T],[T+1,...,2T][1, ..., T], [T+1, ..., 2T][1,...,T],[T+1,...,2T] çš„ä¸€ä¸ªæ’åˆ—ã€‚ç„¶åæ ¹æ®æ’åˆ— z~\\widetilde{z}z çš„é“¾å¼åˆ†è§£è®¡ç®—ç¬¬ä¸€ä¸ª segmentï¼Œå¹¶ä¸”æŠŠ Content æµçš„éšçŠ¶æ€ h~\\widetilde{h}h ç¼“å­˜ä¸‹æ¥ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ª segment çš„ Content æµè®¡ç®—æ–¹æ³•å¦‚ä¸‹ hztmâ†Attention(Q=hztmâˆ’1,KV=[h~mâˆ’1,hzâ‰¤tmâˆ’1];Î¸)h_{z_t}^m \\leftarrow Attention(Q = h_{z_t}^{m-1}, KV = [\\widetilde{h}^{m-1}, h_{z\\leq t}^{m-1}]; \\theta) hztâ€‹mâ€‹â†Attention(Q=hztâ€‹mâˆ’1â€‹,KV=[hmâˆ’1,hzâ‰¤tmâˆ’1â€‹];Î¸) ç”¨è‡ªç„¶è¯­è¨€æè¿°ä¸ºï¼šè®¡ç®— ztz_tztâ€‹ ç¬¬ mmm å±‚çš„éšè—çŠ¶æ€æ—¶ï¼ŒQuery æ˜¯ä¸Šä¸€å±‚çš„éšè—çŠ¶æ€ hztmâˆ’1h_{z_t}^{m - 1}hztâ€‹mâˆ’1â€‹, è€Œ Key å’Œ Value é™¤äº† z1,...,ztz_1, ..., z_tz1â€‹,...,ztâ€‹ ç¬¬ mâˆ’1m-1mâˆ’1 å±‚çš„éšçŠ¶æ€ï¼Œè¿˜è¦ Attend to ç¼“å­˜çš„ä¸Šä¸€ä¸ª segment çš„æ‰€æœ‰ä½ç½®çš„éšè—çŠ¶æ€ã€‚ ä¸ BERT å¯¹æ¯” BERT ä½¿ç”¨ MLMï¼Œå› æ­¤åªèƒ½é¢„æµ‹éƒ¨åˆ†è¯ã€‚XLNet ç†è®ºä¸Šå¯ä»¥é¢„æµ‹æ‰€æœ‰è¯ï¼Œä½†å‡ºäºæ€§èƒ½è€ƒè™‘åªé¢„æµ‹éƒ¨åˆ†è¯ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒBERT ç”±äºç‹¬ç«‹æ€§å‡è®¾çš„åŸå› ï¼Œä¿¡æ¯çš„åˆ©ç”¨ç‡å¼±äº XLNetã€‚ ä¾‹å¦‚å‡è®¾è¾“å…¥æ˜¯ [New, York, is, a, city]\\text{[New, York, is, a, city]}[New, York, is, a, city], å¹¶ä¸” XLNet å’Œ BERT éƒ½é€‰ä¸­äº†ä½¿ç”¨ [is, a, city]\\text{[is, a, city]}[is, a, city] æ¥é¢„æµ‹ New\\text{New}New å’Œ York\\text{York}Yorkã€‚åŒæ—¶å‡è®¾ XLNet ä½¿ç”¨çš„æ’åˆ—é¡ºåºæ˜¯ is, a, city, New, York\\text{is, a, city, New, York}is, a, city, New, Yorkã€‚é‚£ä¹ˆä¸¤ä¸ªæ¨¡å‹è¦ä¼˜åŒ–çš„ç›®æ ‡å‡½æ•°åˆ†åˆ«ä¸ºï¼š JBERT=logâ¡p(New|is a city)+logâ¡p(York|is a city)JXLNet=logâ¡p(New|is a city)+logâ¡p(York|New is a city)\\begin{array}{c} \\mathcal{J}_\\text{BERT} = \\log p(\\text{New|is a city}) + \\log p(\\text{York|is a city})\\\\ \\mathcal{J}_\\text{XLNet} = \\log p(\\text{New|is a city}) + \\log p(\\text{York|\\color{red}{New} \\color{normal}{is a city}}) \\end{array} JBERTâ€‹=logp(New|is a city)+logp(York|is a city)JXLNetâ€‹=logp(New|is a city)+logp(York|New is a city)â€‹ å‚è€ƒ http://papers.nips.cc/paper/8812-xlnet-generalizedautoregressive-pretraining-for-language-understanding.pdf http://fancyerii.github.io/2019/06/30/xlnet-theory/ https://zhuanlan.zhihu.com/p/70257427","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"PLM","slug":"PLM","permalink":"https://blog.zhuwenq.cc/tags/PLM/"},{"name":"NLP","slug":"NLP","permalink":"https://blog.zhuwenq.cc/tags/NLP/"},{"name":"Transformer","slug":"Transformer","permalink":"https://blog.zhuwenq.cc/tags/Transformer/"},{"name":"XLNet","slug":"XLNet","permalink":"https://blog.zhuwenq.cc/tags/XLNet/"}]},{"title":"RoBERTa: A Robustly Optimized BERT Pre-training Approach","slug":"RoBERTa-A-Robustly-Optimized-BERT-Pretraining-Approach","date":"2021-09-10T16:00:00.000Z","updated":"2023-06-21T06:51:28.884Z","comments":true,"path":"RoBERTa-A-Robustly-Optimized-BERT-Pretraining-Approach/","link":"","permalink":"https://blog.zhuwenq.cc/RoBERTa-A-Robustly-Optimized-BERT-Pretraining-Approach/","excerpt":"Introduction RoBERTaæ˜¯ä¸€ç§æ–°çš„BERTè®­ç»ƒæ–¹æ³•ï¼Œè¶…è¿‡äº†æ‰€æœ‰çš„post-BERTæ–¹æ³•çš„æ€§èƒ½ã€‚ æœ¬æ–‡é€šè¿‡é‡å¤BERTçš„ç ”ç©¶è¿‡ç¨‹ï¼Œå‘ç°BERTæ˜¯ä¸¥é‡æ¬ è®­ç»ƒçš„ã€‚æœ¬æ–‡æ—¨åœ¨ä»”ç»†è¯„ä¼°è¶…å‚æ•°å’Œè®­ç»ƒé›†çš„å¤§å°å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ã€‚ RoBERTaå¯¹BERTåšå‡ºçš„ä¿®æ”¹å¦‚ä¸‹ï¼š æ€»ä½“ä¸Šï¼Œæœ¬æ–‡çš„è´¡çŒ®ä¸ºï¼š å±•ç¤ºäº†ä¸€ç³»åˆ—BERTè®¾è®¡å’Œè®­ç»ƒçš„é€‰æ‹©å’Œç­–ç•¥ï¼Œä»‹ç»äº†å¯ä»¥æé«˜ä¸‹æ¸¸ä»»åŠ¡æ€§èƒ½çš„é€‰æ‹© ä½¿ç”¨äº†ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼šCC-NEWSï¼Œç¡®è®¤äº†ä½¿ç”¨æ›´å¤šæ•°æ®è¿›è¡Œé¢„è®­ç»ƒèƒ½å¤Ÿè¿›ä¸€æ­¥æé«˜ä¸‹æ¸¸ä»»åŠ¡ä¸Šçš„è¡¨ç° å®éªŒè¯æ˜äº†MLMåœ¨æ­£ç¡®çš„è®¾è®¡ä¸‹ä¼˜äºæœ€è¿‘æ–°æå‡ºçš„æ‰€æœ‰æ–¹æ³•","text":"Introduction RoBERTaæ˜¯ä¸€ç§æ–°çš„BERTè®­ç»ƒæ–¹æ³•ï¼Œè¶…è¿‡äº†æ‰€æœ‰çš„post-BERTæ–¹æ³•çš„æ€§èƒ½ã€‚ æœ¬æ–‡é€šè¿‡é‡å¤BERTçš„ç ”ç©¶è¿‡ç¨‹ï¼Œå‘ç°BERTæ˜¯ä¸¥é‡æ¬ è®­ç»ƒçš„ã€‚æœ¬æ–‡æ—¨åœ¨ä»”ç»†è¯„ä¼°è¶…å‚æ•°å’Œè®­ç»ƒé›†çš„å¤§å°å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ã€‚ RoBERTaå¯¹BERTåšå‡ºçš„ä¿®æ”¹å¦‚ä¸‹ï¼š æ€»ä½“ä¸Šï¼Œæœ¬æ–‡çš„è´¡çŒ®ä¸ºï¼š å±•ç¤ºäº†ä¸€ç³»åˆ—BERTè®¾è®¡å’Œè®­ç»ƒçš„é€‰æ‹©å’Œç­–ç•¥ï¼Œä»‹ç»äº†å¯ä»¥æé«˜ä¸‹æ¸¸ä»»åŠ¡æ€§èƒ½çš„é€‰æ‹© ä½¿ç”¨äº†ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼šCC-NEWSï¼Œç¡®è®¤äº†ä½¿ç”¨æ›´å¤šæ•°æ®è¿›è¡Œé¢„è®­ç»ƒèƒ½å¤Ÿè¿›ä¸€æ­¥æé«˜ä¸‹æ¸¸ä»»åŠ¡ä¸Šçš„è¡¨ç° å®éªŒè¯æ˜äº†MLMåœ¨æ­£ç¡®çš„è®¾è®¡ä¸‹ä¼˜äºæœ€è¿‘æ–°æå‡ºçš„æ‰€æœ‰æ–¹æ³• Background BERTçš„ä»‹ç» [[BERT-Pre-training-of-Deep-Bidirectional-Transformers-for-Language-Understanding]] Experimental Setup å®ç°BERT ä½¿ç”¨åŸå§‹BERTé™¤äº†å­¦ä¹ ç‡å’Œçƒ­èº«æ­¥æ•°çš„ä¼˜åŒ–è¶…å‚æ•°å®ç°ã€‚åœ¨è¾“å…¥åºåˆ—é•¿åº¦ä¸Šï¼Œä½¿ç”¨é•¿åº¦ T=512T = 512T=512çš„è®¾å®šã€‚ä¸éšæœºæ’å…¥çŸ­åºåˆ—ï¼Œä»…ä»…åœ¨å…¨é•¿åº¦åºåˆ—ä¸Šè®­ç»ƒ(BERTåœ¨å‰90%çš„æ›´æ–°ä¸Šä½¿ç”¨ç¼©çŸ­çš„åºåˆ—) æ•°æ® è¯­è¨€æ¨¡å‹é¢„è®­ç»ƒä¸¥é‡ä¾èµ–å¤§å‹æ•°æ®é›†ï¼Œå¾ˆå¤šå·¥ä½œä½¿ç”¨çš„æ•°æ®é›†ä¸èƒ½å…¬å¼€ï¼Œæœ¬æ–‡æ”¶é›†æ•´ç†äº†è¶…è¿‡160GBçš„æœªå‹ç¼©æ–‡æœ¬ï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹çš„æ–‡æœ¬è¯­æ–™åº“ï¼š BookCorpus+EnglishWikipediaBook Corpus+ English WikipediaBookCorpus+EnglishWikipedia: åŸå§‹BERTé¢„è®­ç»ƒä½¿ç”¨çš„æ•°æ®ï¼ˆ16GBï¼‰ CCâˆ’NewsCC-NewsCCâˆ’News: æ”¶é›†è‡ªCommonCrawæ–°é—»æ•°æ®é›†çš„è‹±æ–‡éƒ¨åˆ†ã€‚åŒ…å«2016å¹´9æœˆåˆ°2019å¹´2æœˆä¹‹é—´çˆ¬å–çš„6åƒ3ç™¾ä¸‡ç¯‡è‹±æ–‡æ–°é—»æ–‡ç« ï¼ˆè¿‡æ»¤å76GBï¼‰ OpenWebTextOpen Web TextOpenWebText: WebTextè¯­æ–™åº“çš„å¼€æºå®ç°ï¼Œæ¥è‡ªRedditä¸Šè‡³å°‘æœ‰ä¸‰ä¸ªèµçš„webå†…å®¹ StoriesStoriesStories: CommonCrawlæ•°æ®é›†çš„ç¬¦åˆWinogradæ¶æ„æ•…äº‹çš„å­é›† è¯„ä¼° åœ¨ä»¥ä¸‹benchmarksä¸Šè¯„ä¼°é¢„è®­ç»ƒæ¨¡å‹çš„æ€§èƒ½ï¼š GLUEï¼šæˆ‘ä»¬å°†æ¨¡å‹åœ¨GLUEçš„æ¯ä¸ªå•ç‹¬çš„ä»»åŠ¡æ•°æ®ä¸Šè¿›è¡Œå¾®è°ƒï¼Œç„¶åè¿›è¡Œè¯„ä¼° SQuADï¼šåˆ†åˆ«åœ¨V1.1å’ŒV2.0ä¸¤ä¸ªç‰ˆæœ¬ä¸Šè¿›è¡Œè¯„ä¼°ã€‚åœ¨V1.1ä¸Šï¼Œä½¿ç”¨ä¸BERTä¸€æ ·çš„èŒƒå›´é¢„æµ‹æ–¹æ³•ï¼Œåœ¨V2.0ä¸Šï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªé¢å¤–çš„äºŒåˆ†ç±»å±‚ç”¨äºé¢„æµ‹è¿™ä¸ªé—®é¢˜æ˜¯å¦å¯å›ç­”(ç­”æ¡ˆæ˜¯å¦åœ¨ç»™å®šçš„æ–‡æœ¬å†…)ï¼Œç„¶åå°†è¿™ä¸ªäºŒåˆ†ç±»å±‚ä¸èŒƒå›´é¢„æµ‹çš„Lossç›¸åŠ æ¥è”åˆè®­ç»ƒã€‚åœ¨è¯„ä¼°æ—¶ï¼Œä»…ä»…å¯¹äºŒåˆ†ç±»å±‚è¾“å‡ºä¸ºå¯ä»¥å›ç­”çš„é—®é¢˜è¿›è¡Œé¢„æµ‹ã€‚ RACEï¼šRACEæ•°æ®é›†ä¸­å¯¹äºæ¯ä¸ªé—®é¢˜çš„ç›¸å…³æ–‡æœ¬ç›¸æ¯”å…¶ä»–æ•°æ®é›†æ›´é•¿ï¼Œä¸”æ•°æ®é›†ä¸­éœ€è¦æ¨ç†çš„é—®é¢˜å æ¯”å¾ˆå¤§ benchmarkçš„ä»‹ç»è§ï¼š [[Data-Set-and-Benchmark]] è®­ç»ƒè¿‡ç¨‹åˆ†æ ä»¥ä¸‹çš„å®éªŒå’Œåˆ†ææ—¨åœ¨æ¢ç´¢å’Œé‡åŒ–åœ¨é¢„è®­ç»ƒBERTçš„è¿‡ç¨‹ä¸­é‡è¦çš„å‚æ•°é€‰æ‹© é™æ€/åŠ¨æ€é®ç½© åŸå§‹çš„BERTä½¿ç”¨static maskingï¼Œåœ¨æ•°æ®å¤„ç†æ—¶ç”Ÿæˆé™æ€çš„maskï¼Œç„¶ååœ¨è®­ç»ƒæ—¶ä½¿ç”¨ã€‚ä¸ºäº†é¿å…å¥å­åœ¨ä¸åŒçš„epochä¸­maskç›¸åŒï¼Œå°†æ¯ä¸ªå¥å­å¤åˆ¶10æ¬¡ï¼Œç”Ÿæˆ10ç§ä¸åŒçš„maskï¼Œç„¶ååœ¨40ä¸ªepochç§ä½¿ç”¨ã€‚ dynamic maskingå³æ¯ä¸ªåºåˆ—åœ¨é€å…¥æ¨¡å‹ä¹‹å‰æ‰éšæœºç”Ÿæˆmaskï¼Œè¿™ç§æ–¹æ³•åœ¨æˆ‘ä»¬çš„å®éªŒä¸­æœ‰è½»å¾®ä¼˜åŠ¿ æ¨¡å‹çš„è¾“å…¥æ ¼å¼å’ŒNSP BERTçš„å®éªŒè§‚å¯Ÿåˆ°ç§»é™¤NSPä¼šå¯¹æ¨¡å‹æ€§èƒ½äº§ç”Ÿå½±å“ã€‚ä½†æ˜¯æœ€è¿‘çš„å·¥ä½œ(XLNet, SpanBERT)è´¨ç–‘NSPçš„å¿…è¦æ€§ã€‚æœ¬æ–‡é€šè¿‡ä¸‹é¢çš„å®éªŒç ”ç©¶NSPçš„ä½œç”¨ SEGMENT-PAIR+NSP\\text{SEGMENT-PAIR+NSP}SEGMENT-PAIR+NSP: åŸå§‹BERTä¸­ä½¿ç”¨çš„è®¾å®šã€‚è¾“å…¥åŒ…å«ä¸¤ä¸ªæ–‡æœ¬æ®µï¼Œæ¯ä¸ªæ®µå¯èƒ½åŒ…å«è‹¥å¹²ä¸ªå¥å­ï¼Œæ€»çš„tokenæ•°ä¸è¶…è¿‡512ã€‚ä¸¤ä¸ªæ–‡æœ¬æ®µç­‰æ¦‚ç‡åœ°ä»åŒä¸€æ–‡æ¡£æˆ–ä¸åŒæ–‡æ¡£ä¸­é‡‡æ ·ã€‚ SENTENCE-PAIR+NSP\\text{SENTENCE-PAIR+NSP}SENTENCE-PAIR+NSP: è¾“å…¥ä¸­åŒ…å«ä¸¤ä¸ªè‡ªç„¶è¯­è¨€å¥å­ï¼Œä¸¤ä¸ªå¥å­ä»åŒä¸€æ–‡æ¡£ä¸­è¿ç»­é‡‡é›†æˆ–ä»ä¸åŒæ–‡æ¡£åˆ†åˆ«é‡‡é›†çš„æ¦‚ç‡ç›¸ç­‰ã€‚å› ä¸ºå¥å­ä¸­çš„tokenæ•°æ˜¾è‘—å°‘äº512ï¼Œæˆ‘ä»¬å¢åŠ äº†batch sizeä»¥ä¿è¯æ¯ä¸ªbatchä¸­çš„tokenæ•°ä¸ SEGMENT-PAIR + NSP\\text{SEGMENT-PAIR + NSP}SEGMENT-PAIR + NSPçš„ç›¸è¿‘ FULL-SENTENCES\\text{FULL-SENTENCES}FULL-SENTENCES: è¾“å…¥ä»ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æ¡£ä¸­è¿ç»­é‡‡é›†ï¼Œä½¿å¾—æ¯ä¸ªè¾“å…¥çš„tokené•¿åº¦éƒ½æ˜¯512ã€‚è¾“å…¥å¯èƒ½è·¨è¶Šæ–‡æ¡£çš„è¾¹ç•Œï¼Œåœ¨æ–‡æ¡£åˆ†ç•Œå‡ºæ·»åŠ é¢å¤–çš„åˆ†éš”ç¬¦ã€‚ç§»é™¤äº†NSP Loss DOC-SENTENCES\\text{DOC-SENTENCES}DOC-SENTENCES: ä¸ FULL-SENTENCES\\text{FULL-SENTENCES}FULL-SENTENCES ç›¸ä¼¼ï¼Œä½†æ˜¯è¾“å…¥ä¸å†è·¨æ–‡æ¡£é‡‡é›†ã€‚å½“é‡‡é›†åˆ°æ–‡æ¡£æœ«å°¾æ—¶ï¼Œè¾“å…¥ä¸­çš„tokenæ•°é‡å¯èƒ½ä¼šå°‘äº512ã€‚è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬é€šè¿‡åŠ¨æ€æ”¹å˜batch sizeæ¥ä½¿tokenæ•°ç›®è¾¾åˆ°å·®ä¸å¤šçš„æ°´å¹³ã€‚ç§»é™¤äº†NSP Loss å®éªŒç»“æœï¼š ä½¿ç”¨å¥å­ä½œä¸ºè¾“å…¥ä¼šé™ä½æ¨¡å‹åœ¨ä¸‹æ¸¸ä»»åŠ¡çš„æ€§èƒ½ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºä½¿ç”¨å¥å­è€Œä¸æ˜¯æ–‡æœ¬æ®µä½¿æ¨¡å‹æ— æ³•å­¦ä¹ é•¿è·ç¦»ä¾èµ–ã€‚ ç§»é™¤NSP Lossä¸å½±å“ç”šè‡³ç•¥æœ‰æé«˜åœ¨ä¸‹æ¸¸ä»»åŠ¡çš„æ€§èƒ½ã€‚è¿™ä¸BERTçš„å®éªŒç»“æœç›¸åï¼Œå¯èƒ½æ˜¯å› ä¸ºBERTçš„å®éªŒä¸­ä»…ä»…å»é™¤äº†NSP Lossï¼Œä½†æ˜¯å…¶è¾“å…¥æ ¼å¼ä»ç„¶ä¿æŒ SEGMENT-PAIR\\text{SEGMENT-PAIR}SEGMENT-PAIR çš„æ ¼å¼(ä¸¤ä¸ªåˆ†æ®µå¯èƒ½ä»ä¸åŒæ–‡æ¡£é‡‡é›†) è®©è¾“å…¥åºåˆ—ä»åŒä¸€ä¸ªæ–‡æ¡£ä¸­é‡‡é›†( DOC-SENTENCES\\text{DOC-SENTENCES}DOC-SENTENCES )ç›¸æ¯”å°†ä¸åŒæ–‡æ¡£çš„å¥å­æ‰“åŒ…åœ¨ä¸€èµ· ( FULL-SENTENCES\\text{FULL-SENTENCES}FULL-SENTENCES )æœ‰è½»å¾®çš„ä¼˜åŠ¿ã€‚ä½†æ˜¯ç”±äº DOC-SENTENCES\\text{DOC-SENTENCES}DOC-SENTENCES éœ€è¦åŠ¨æ€æ”¹å˜batch sizeï¼Œå› æ­¤åç»­çš„å®éªŒä¸­ä½¿ç”¨ FULL-SENTENCES\\text{FULL-SENTENCES}FULL-SENTENCES ä½¿ç”¨æ›´å¤§çš„batchè®­ç»ƒ åŸå§‹çš„ BERTBASE\\text{BERT}_\\text{BASE}BERTBASEâ€‹ ä½¿ç”¨ batch size = 256ä¸ªåºåˆ—è®­ç»ƒäº†1M æ­¥ï¼Œè¿™åœ¨è®¡ç®—é‡ä¸Šç›¸å½“äºé€šè¿‡æ¢¯åº¦ç´¯ç§¯åœ¨ batch size = 2K ä¸ªåºåˆ—è®­ç»ƒ 125K æ­¥ï¼Œæˆ–è€… batch size = 8K ä¸ªåºåˆ—è®­ç»ƒ 31K æ­¥ åç»­çš„å®éªŒé‡‡ç”¨ batch size = 8K çš„è®¾ç½® æ–‡æœ¬ç¼–ç  åŸå§‹çš„BERTä½¿ç”¨å­—ç¬¦çº§çš„BPEï¼Œæœ¬æ–‡ä½¿ç”¨å­—èŠ‚çº§çš„BPEã€‚ä¸¤è€…åœ¨æ€§èƒ½ä¸Šç›¸å·®æ— å‡ ï¼Œä½†æ˜¯å­—èŠ‚çº§çš„BPEæ›´å…·é€šç”¨æ€§ã€‚ Byte-Pair Encoding, BPE: RoBERTa å°†ä»¥ä¸Šæåˆ°çš„æ”¹è¿›æ±‡æ€»ï¼Œç§°ä¹‹ä¸ºRobustly optimized BERT approach, RoBERTaã€‚å…·ä½“åœ°è¯´ï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ”¹è¿›ï¼š åŠ¨æ€é®ç½© FULL-SENTENCES\\text{FULL-SENTENCES}FULL-SENTENCES with out NSP æ›´å¤§çš„batch size å­—èŠ‚çº§BPE é¢„è®­ç»ƒæ•°æ® è®­ç»ƒçš„æ¬¡æ•° å¯¹äºå‰å››ç‚¹æ”¹è¿›ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸åŸå§‹BERTçš„è®­ç»ƒæ•°æ®ç›¸å½“çš„æ•°æ®(16GB)è®­ç»ƒRoBERTaï¼ŒéªŒè¯æ”¹è¿›çš„æœ‰æ•ˆæ€§ ç„¶åç»“åˆé¢å¤–çš„æ•°æ®(160GB)ï¼Œç›¸åŒçš„è®­ç»ƒæ­¥æ•°ï¼ˆ100Kï¼‰è¿›è¡Œé¢„è®­ç»ƒï¼Œå–å¾—äº†æ€§èƒ½çš„æé«˜ï¼Œè¯æ˜äº†æ•°æ®å¤§å°å’Œå¤šå…ƒåŒ–çš„é‡è¦æ€§ æœ€åå°†è®­ç»ƒæ­¥æ•°æé«˜åˆ°300Kå’Œ500Kè¿›è¡Œé¢„è®­ç»ƒï¼Œè§‚å¯Ÿåˆ°æ˜¾è‘—çš„æå‡ã€‚è¯´æ˜è®­ç»ƒé‡çš„é‡è¦æ€§ã€‚å¹¶ä¸”è§‚å¯Ÿåˆ°æœ€é•¿çš„è®­ç»ƒéƒ½æ²¡æœ‰å¯¼è‡´è¿‡æ‹Ÿåˆã€‚ æœ€åå°†RoBERTaåˆ†åˆ«åœ¨GLUEï¼ŒSQuADï¼ŒRACEä¸Šè¿›è¡Œè¯„ä¼°","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"PLM","slug":"PLM","permalink":"https://blog.zhuwenq.cc/tags/PLM/"},{"name":"NLP","slug":"NLP","permalink":"https://blog.zhuwenq.cc/tags/NLP/"},{"name":"BERT","slug":"BERT","permalink":"https://blog.zhuwenq.cc/tags/BERT/"}]},{"title":"BART: Bidirectional and Auto-Regressive Transformers","slug":"BART-Denoising-Sequence-to-Sequence-Pre-training-for-Natural-Language-Generation-Translation-and-Comprehension","date":"2021-09-06T16:00:00.000Z","updated":"2023-06-21T06:51:28.776Z","comments":true,"path":"BART-Denoising-Sequence-to-Sequence-Pre-training-for-Natural-Language-Generation-Translation-and-Comprehension/","link":"","permalink":"https://blog.zhuwenq.cc/BART-Denoising-Sequence-to-Sequence-Pre-training-for-Natural-Language-Generation-Translation-and-Comprehension/","excerpt":"Introduction BARTæ˜¯ä¸€ç§ç”¨äºé¢„è®­ç»ƒseq2seqæ¨¡å‹çš„é™å™ªè‡ªåŠ¨ç¼–ç å™¨ã€‚BARTä½¿ç”¨æ ‡å‡†çš„Transformeræ¶æ„ï¼Œè®­ç»ƒæ—¶ä½¿ç”¨ä»»æ„å™ªå£°å‡½æ•°å¯¹æ–‡æœ¬åŠ å™ªï¼Œç„¶åè¯•å›¾é‡å»ºå—æŸçš„æ–‡æœ¬ã€‚ BARTçš„ä¸€ä¸ªå…³é”®ä¼˜åŠ¿åœ¨äºå®ƒçš„é¢„è®­ç»ƒè¿‡ç¨‹ä½¿ç”¨ä»»æ„çš„å™ªå£°å‡½æ•°ï¼ŒåŒ…æ‹¬æ‰“ä¹±åŸå§‹å¥å­çš„é¡ºåºï¼Œå¯¹ä»»æ„é•¿åº¦çš„æ–‡æœ¬ç‰‡æ®µè¿›è¡Œæ©ç æ›¿æ¢ç­‰ã€‚è¿™è¿«ä½¿æ¨¡å‹å¯¹å¥å­çš„æ•´ä½“é•¿åº¦è¿›è¡Œæ›´å¤šæ¨ç†ï¼Œå¹¶å¯¹è¾“å…¥è¿›è¡Œæ›´é•¿èŒƒå›´çš„è½¬æ¢ã€‚ BARTæ ¼å¤–é€‚åˆå¾®è°ƒåˆ°ç”Ÿæˆä»»åŠ¡ï¼Œåœ¨é˜…è¯»ç†è§£ï¼ŒæŠ½è±¡å¯¹è¯ï¼Œé—®ç­”å’Œæ€»ç»“ä»»åŠ¡ä¸­ä¹Ÿæœ‰å¾ˆå¥½çš„æ•ˆæœã€‚æœ¬æ–‡è¿˜åŸºäºBARTä»‹ç»äº†ä¸€ç§æ–°çš„æœºå™¨ç¿»è¯‘çš„æ¨¡å¼ï¼Œå³åœ¨BARTä¹‹ä¸Šæ·»åŠ ä¸€äº›é¢å¤–çš„Transformerå±‚æ¥å°†å¤–è¯­è½¬æ¢ä¸ºå¸¦æœ‰å™ªå£°çš„ç›®æ ‡è¯­è¨€ï¼Œä»è€Œä½¿ç”¨BARTä½œä¸ºç›®æ ‡ç«¯è¯­è¨€æ¨¡å‹è¿›è¡Œå»å™ªã€‚","text":"Introduction BARTæ˜¯ä¸€ç§ç”¨äºé¢„è®­ç»ƒseq2seqæ¨¡å‹çš„é™å™ªè‡ªåŠ¨ç¼–ç å™¨ã€‚BARTä½¿ç”¨æ ‡å‡†çš„Transformeræ¶æ„ï¼Œè®­ç»ƒæ—¶ä½¿ç”¨ä»»æ„å™ªå£°å‡½æ•°å¯¹æ–‡æœ¬åŠ å™ªï¼Œç„¶åè¯•å›¾é‡å»ºå—æŸçš„æ–‡æœ¬ã€‚ BARTçš„ä¸€ä¸ªå…³é”®ä¼˜åŠ¿åœ¨äºå®ƒçš„é¢„è®­ç»ƒè¿‡ç¨‹ä½¿ç”¨ä»»æ„çš„å™ªå£°å‡½æ•°ï¼ŒåŒ…æ‹¬æ‰“ä¹±åŸå§‹å¥å­çš„é¡ºåºï¼Œå¯¹ä»»æ„é•¿åº¦çš„æ–‡æœ¬ç‰‡æ®µè¿›è¡Œæ©ç æ›¿æ¢ç­‰ã€‚è¿™è¿«ä½¿æ¨¡å‹å¯¹å¥å­çš„æ•´ä½“é•¿åº¦è¿›è¡Œæ›´å¤šæ¨ç†ï¼Œå¹¶å¯¹è¾“å…¥è¿›è¡Œæ›´é•¿èŒƒå›´çš„è½¬æ¢ã€‚ BARTæ ¼å¤–é€‚åˆå¾®è°ƒåˆ°ç”Ÿæˆä»»åŠ¡ï¼Œåœ¨é˜…è¯»ç†è§£ï¼ŒæŠ½è±¡å¯¹è¯ï¼Œé—®ç­”å’Œæ€»ç»“ä»»åŠ¡ä¸­ä¹Ÿæœ‰å¾ˆå¥½çš„æ•ˆæœã€‚æœ¬æ–‡è¿˜åŸºäºBARTä»‹ç»äº†ä¸€ç§æ–°çš„æœºå™¨ç¿»è¯‘çš„æ¨¡å¼ï¼Œå³åœ¨BARTä¹‹ä¸Šæ·»åŠ ä¸€äº›é¢å¤–çš„Transformerå±‚æ¥å°†å¤–è¯­è½¬æ¢ä¸ºå¸¦æœ‰å™ªå£°çš„ç›®æ ‡è¯­è¨€ï¼Œä»è€Œä½¿ç”¨BARTä½œä¸ºç›®æ ‡ç«¯è¯­è¨€æ¨¡å‹è¿›è¡Œå»å™ªã€‚ Background æ—©æœŸçš„è¯­è¨€æ¨¡å‹ä½¿ç”¨L2R(GPT)æˆ–è€…L2Rå’ŒR2Lå åŠ (ELMo)çš„æ–¹æ³•ï¼Œè¿™æ ·åªèƒ½åŸºäºä¸€ä¾§çš„ä¿¡æ¯æˆ–è€…æ— æ³•æå–ä¸¤ä¾§ä¿¡æ¯çš„äº¤äº’ï¼Œåœ¨ä¸€äº›ä»»åŠ¡ä¸Šæœ‰é—®é¢˜ã€‚ï¼ˆè‡ªå›å½’æ¨¡å‹ï¼Œåœ¨ç”Ÿæˆä»»åŠ¡ä¸Šè¡¨ç°è¾ƒå¥½ï¼Œä½†åœ¨åˆ†ç±»ä»»åŠ¡ä¸Šè¾ƒå·®ï¼‰ BERTä½¿ç”¨MLMï¼Œå…è®¸åœ¨é¢„è®­ç»ƒè¿‡ç¨‹ä¸­å­¦ä¹ ä¸¤ä¾§ä¿¡æ¯çš„äº¤äº’ï¼Œä½†æ˜¯ç”±äºé¢„æµ‹è¿‡ç¨‹ä¸æ˜¯è‡ªå›å½’çš„ï¼Œåœ¨ç”Ÿæˆä»»åŠ¡ä¸Šä¸æ˜¯æœ€ä¼˜çš„ã€‚ Model BARTæ˜¯ä¸€ä¸ªæ ‡å‡†çš„seq2seqæ¨¡å‹ï¼Œå…¶ç¼–ç å™¨æ˜¯åŒå‘çš„ï¼Œè§£ç å™¨æ˜¯L2Rè‡ªå›å½’çš„ã€‚åœ¨é¢„è®­ç»ƒæ—¶æˆ‘ä»¬ä¼˜åŒ–é‡å»ºæ–‡æœ¬å’ŒåŸå§‹æ–‡æœ¬çš„è´Ÿå¯¹æ•°ä¼¼ç„¶(negative log likehood) Architecture BARTä½¿ç”¨æ ‡å‡†çš„Transformeræ¶æ„ï¼Œä½†æ˜¯å°†ReLuæ¿€æ´»å‡½æ•°æ›¿æ¢ä¸ºGeLusï¼Œå¹¶ä¸”ä»åˆ†å¸ƒ N(0,0.02)N(0, 0.02)N(0,0.02) ä¸­åˆå§‹åŒ–å‚æ•°ã€‚ BARTçš„æ¨¡å‹ç»“æ„ä¸BERTç›¸ä¼¼ï¼Œæœ‰ä»¥ä¸‹ä¸åŒï¼š decoderçš„æ¯ä¸€å±‚é¢å¤–çš„åœ¨encoderçš„æœ€ç»ˆéšè—å±‚ä¸Šåšäº¤å‰æ³¨æ„ BERTåœ¨æ‰§è¡Œå•è¯é¢„æµ‹ä¹‹å‰è¿˜æœ‰ä¸€å±‚å‰é¦ˆç½‘ç»œï¼Œä½†BARTæ²¡æœ‰ Pre-training BART BARTåŸºäºå—æŸæ–‡æœ¬é‡å»ºä»»åŠ¡è¿›è¡Œé¢„è®­ç»ƒï¼Œé‡å»ºæŸå¤±å³decoderçš„è¾“å‡ºå’ŒåŸå§‹æ–‡æœ¬ä¹‹é—´çš„äº¤å‰ç†µã€‚ BARTå…è®¸ä½¿ç”¨ä»»æ„ç±»å‹çš„å™ªå£°ã€‚å®éªŒä¸­æˆ‘ä»¬ä½¿ç”¨äº†ä»¥ä¸‹å‡ ç§ï¼š Token Masking: ä¸BERTä½¿ç”¨çš„ç›¸åŒï¼Œå³éšæœºé‡‡æ ·ä¸€äº›tokenså¹¶ä½¿ç”¨[MASK]æ›¿æ¢ Token Deletion: éšæœºåˆ å»ä¸€äº›tokensï¼Œä¸Token Maskingç›¸æ¯”ï¼Œè¿™ç§æ–¹æ³•è¿«ä½¿æ¨¡å‹é¢„æµ‹è¢«åˆ é™¤çš„ä½ç½® Text Infilling: éšæœºé‡‡æ ·ä¸€äº›é•¿åº¦ç¬¦åˆæ³Šæ¾åˆ†å¸ƒ( Î»=3\\lambda = 3Î»=3 ) çš„æ–‡æœ¬ç‰‡æ®µï¼Œå¹¶ç”¨é®ç½© [MASK] æ›¿æ¢ã€‚å¯¹äºé•¿åº¦ä¸º0çš„æ–‡æœ¬ç‰‡æ®µï¼Œç›¸å½“äºæ’å…¥äº†[MASK]ã€‚è¿™ç§å™ªå£°è¿«ä½¿æ¨¡å‹é¢„æµ‹è¢«æ›¿æ¢çš„æ–‡æœ¬ç‰‡æ®µçš„é•¿åº¦ã€‚ Sentence Permutation: å°†æ–‡æ¡£æŒ‰ç…§å¥å·åˆ†å‰²æˆä¸åŒçš„å¥å­ï¼Œç„¶åéšæœºæ’åˆ—å¥å­çš„é¡ºåºã€‚è¿™ç§å™ªå£°è¿«ä½¿æ¨¡å‹å­¦ä¹ åŒä¸€æ–‡æ¡£ä¸­å¥å­çš„é¡ºåºã€‚ Document Rotation: éšæœºé€‰æ‹©ä¸€ä¸ªtokenï¼Œç„¶åå°†æ–‡æœ¬æ—‹è½¬åˆ°ä»¥è¿™ä¸ªtokenä¸ºå¼€å¤´çš„çŠ¶æ€ã€‚è¿™ç§å™ªå£°è®­ç»ƒæ¨¡å‹è¯†åˆ«æ–‡æœ¬å¼€å¤´çš„èƒ½åŠ›ã€‚ Fine-tuning BART åºåˆ—åˆ†ç±»ä»»åŠ¡ å¯¹äºåºåˆ—åˆ†ç±»ä»»åŠ¡ï¼Œå°†è¾“å…¥åŒæ—¶é€è¿›encoderå’Œdecoderï¼Œä¸BERTçš„[CLS] tokenç±»ä¼¼ï¼ŒBARTåœ¨decoderè¾“å‡ºçš„æœ«å°¾ä½ç½®æ·»åŠ ä¸€ä¸ªtokenä¸“é—¨ç”¨äºåˆ†ç±»ä»»åŠ¡ï¼Œå¯¹åº”äºè¿™ä¸ªtokençš„æœ€ç»ˆéšè—å±‚è¾“å‡ºç»è¿‡ä¸€ä¸ªçº¿æ€§åˆ†ç±»å™¨å¾—åˆ°è¾“å…¥åºåˆ—çš„åˆ†ç±» åœ¨æœ«å°¾æ·»åŠ çš„åŸå› æ˜¯è¿™æ ·decoderä¸­è¿™ä¸ªtokençš„è¡¨å¾å¯ä»¥æ³¨æ„åˆ°æ•´ä¸ªè¾“å…¥åœ¨decoderä¸­çš„ä¿¡æ¯ã€‚ Tokenåˆ†ç±»ä»»åŠ¡ å¯¹äºTokenåˆ†ç±»ä»»åŠ¡ï¼Œå°†å®Œæ•´çš„è¾“å…¥æ–‡æœ¬é€å…¥encoderå’Œdecoderï¼Œç„¶åä½¿ç”¨decoderçš„é¡¶éƒ¨éšè—çŠ¶æ€(top hidden state)ä½œä¸ºæ¯ä¸ªè¯çš„è¡¨å¾ï¼Œè¿™ä¸ªè¡¨å¾ç”¨äºtokençš„åˆ†ç±»(å³æ¯ä¸ªè¯å±äºæŸç§token)ã€‚ åºåˆ—ç”Ÿæˆä»»åŠ¡ BARTçš„decoderæ˜¯è‡ªå›å½’çš„ï¼Œå› æ­¤å®ƒå¯ä»¥ç›´æ¥å¾®è°ƒåˆ°å¦‚æŠ½å–å¼é—®ç­”å’Œæ€»ç»“ç±»çš„ç”Ÿæˆä»»åŠ¡ã€‚åœ¨è¿™ç±»ä»»åŠ¡ä¸­ï¼Œä¿¡æ¯ç›´æ¥ä»è¾“å…¥ä¸­æŠ½å–å¹¶ä¿®æ”¹ï¼Œè¿™ä¸BARTçš„å»å™ªé¢„è®­ç»ƒç›®æ ‡å»åˆã€‚ æœºå™¨ç¿»è¯‘ä»»åŠ¡ å¯¹äºç¿»è¯‘ä»»åŠ¡ï¼ŒBARTé€šè¿‡å°†encoderçš„embeddingå±‚æ›¿æ¢ä¸ºå°‘é‡éšæœºåˆå§‹åŒ–çš„encoderå±‚ï¼Œåˆ©ç”¨è¿™ä¸ªæ–°çš„encoderå°†å¤–è¯­ç¼–ç æˆæœ‰å™ªå£°çš„ç›®æ ‡è¯­è¨€çš„ç¼–ç ã€‚ç„¶åå°†è¯¥æœ‰å™ªå£°çš„ç¼–ç ä½œä¸ºBARTçš„è¾“å…¥ï¼Œç”±BARTå°†å…¶é™å™ªæˆé«˜è´¨é‡çš„ç¿»è¯‘ç»“æœã€‚å³ï¼ŒBARTä½œä¸ºç›®æ ‡è¯­è¨€ç«¯è§£ç å™¨ï¼Œæ–°æ·»åŠ çš„encoderä½œä¸ºå¤–è¯­ç«¯ç¼–ç å™¨ï¼Œç»„æˆäº†ä¸€ä¸ªæ–°çš„seq2seqæœºå™¨ç¿»è¯‘æ¨¡å‹ã€‚ å…·ä½“åœ°è¯´ï¼Œå¾®è°ƒè¯¥ç¿»è¯‘ä»»åŠ¡åˆ†ä¸ºä¸¤æ­¥ï¼š ä¿æŒå¤§å¤šæ•°çš„BARTå‚æ•°ä¸å˜ï¼Œä»…æ›´æ–°æ–°æ·»åŠ çš„encoderï¼ŒBARTçš„ä½ç½®åµŒå…¥å±‚å’ŒBARTçš„encoderä¸­ç¬¬ä¸€å±‚è‡ªæ³¨æ„åŠ›å±‚çš„æŠ•å½±çŸ©é˜µ( WQ,WK,WVW_Q, W_K, W_VWQâ€‹,WKâ€‹,WVâ€‹ ) åœ¨å°‘é‡è¿­ä»£ä¸‹æ›´æ–°æ‰€æœ‰çš„å‚æ•° æ•°æ®/ä»»åŠ¡é›† SQuAD, MNLI, ELI5, XSumã€‚è¯¦æƒ…å‚è€ƒï¼š [[Data-Set-and-Benchmark]] å®éªŒè¯´æ˜çš„ä¸€äº›ç»“è®º å®éªŒç»“æœï¼š é¢„è®­ç»ƒæ–¹æ³•çš„æ€§èƒ½å› ä»»åŠ¡è€Œå¼‚ Token Maskingæ˜¯ååˆ†é‡è¦çš„é¢„è®­ç»ƒç›®æ ‡ L2Rçš„é¢„è®­ç»ƒèƒ½å¤Ÿæé«˜ç”Ÿæˆä»»åŠ¡çš„æ€§èƒ½ å¯¹äºSQuADä»»åŠ¡ï¼ŒåŒå‘ç¼–ç å™¨ååˆ†é‡è¦(åœ¨åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œç»“åˆtokenä¹‹åçš„ä¿¡æ¯ååˆ†å…³é”®) é¢„è®­ç»ƒç›®æ ‡ä¸æ˜¯å”¯ä¸€å…³é”®çš„å› ç´ ","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"PLM","slug":"PLM","permalink":"https://blog.zhuwenq.cc/tags/PLM/"},{"name":"NLP","slug":"NLP","permalink":"https://blog.zhuwenq.cc/tags/NLP/"},{"name":"Transformer","slug":"Transformer","permalink":"https://blog.zhuwenq.cc/tags/Transformer/"},{"name":"Autoregressive","slug":"Autoregressive","permalink":"https://blog.zhuwenq.cc/tags/Autoregressive/"}]},{"title":"Attention is all you need","slug":"Attention-is-all-you-need","date":"2021-09-01T16:00:00.000Z","updated":"2023-06-21T06:51:28.776Z","comments":true,"path":"Attention-is-all-you-need/","link":"","permalink":"https://blog.zhuwenq.cc/Attention-is-all-you-need/","excerpt":"Introduction åºåˆ—è½¬å¯¼æ¨¡å‹çš„ç¼–ç å™¨å’Œè§£ç å™¨ä¸»è¦åŸºäºå¤æ‚çš„é€’å½’æˆ–å·ç§¯ç¥ç»ç½‘ç»œï¼Œå…¶ä¸­è¡¨ç°æœ€å¥½çš„æ¨¡å‹åœ¨ç¼–ç å™¨å’Œè§£ç å™¨ä¹‹é—´é€šè¿‡ä¸€ä¸ªæ³¨æ„åŠ›æœºåˆ¶å±‚ç›¸è¿ã€‚æˆ‘ä»¬æå‡ºä¸€ç§ç®€å•çš„æ¨¡å‹æ¶æ„ï¼šTransformerã€‚ä»…ä»…åŸºäºæ³¨æ„åŠ›æœºåˆ¶ï¼Œå®Œå…¨å»é™¤é€’å½’å’Œå·ç§¯ã€‚åŒæ—¶Transformerå¯ä»¥å¾ˆå¥½åœ°æ¨å¹¿åˆ°å…¶ä»–ä»»åŠ¡ä¸­ã€‚","text":"Introduction åºåˆ—è½¬å¯¼æ¨¡å‹çš„ç¼–ç å™¨å’Œè§£ç å™¨ä¸»è¦åŸºäºå¤æ‚çš„é€’å½’æˆ–å·ç§¯ç¥ç»ç½‘ç»œï¼Œå…¶ä¸­è¡¨ç°æœ€å¥½çš„æ¨¡å‹åœ¨ç¼–ç å™¨å’Œè§£ç å™¨ä¹‹é—´é€šè¿‡ä¸€ä¸ªæ³¨æ„åŠ›æœºåˆ¶å±‚ç›¸è¿ã€‚æˆ‘ä»¬æå‡ºä¸€ç§ç®€å•çš„æ¨¡å‹æ¶æ„ï¼šTransformerã€‚ä»…ä»…åŸºäºæ³¨æ„åŠ›æœºåˆ¶ï¼Œå®Œå…¨å»é™¤é€’å½’å’Œå·ç§¯ã€‚åŒæ—¶Transformerå¯ä»¥å¾ˆå¥½åœ°æ¨å¹¿åˆ°å…¶ä»–ä»»åŠ¡ä¸­ã€‚ Background å¯¹äºé€’å½’æ¨¡å‹ï¼Œå…¶é€šå¸¸æ²¿ç€è¾“å…¥å’Œè¾“å‡ºåºåˆ—çš„ç¬¦å·ä½ç½®è¿›è¡Œå› æ•°è®¡ç®—ï¼Œå°†ä½ç½®ä¸è®¡ç®—æ—¶é—´ä¸­çš„æ­¥éª¤å¯¹å…¶ï¼Œ ttt æ—¶åˆ»çš„éšè—çŠ¶æ€ hth_thtâ€‹ ä½œä¸ºä¸‹ä¸€æ—¶åˆ» t+1t+1t+1 è®¡ç®—çš„è¾“å…¥ã€‚è¿™ç§å›ºæœ‰çš„é¡ºåºé™åˆ¶äº†è®­ç»ƒæ—¶çš„å¹¶è¡ŒåŒ–ã€‚æœ¬æ–‡æå‡ºçš„Transformerå®Œå…¨ä¾é æ³¨æ„åŠ›æœºåˆ¶æ¥è®¡ç®—è¾“å…¥å’Œè¾“å‡ºä¹‹é—´çš„å…¨å±€å…³ç³»ã€‚ å¯¹äºä½¿ç”¨å·ç§¯ç¥ç»ç½‘ç»œå‡å°‘é¡ºåºè®¡ç®—çš„æ¨¡å‹ï¼Œå°†æ¥è‡ªä¸åŒä½ç½®çš„è¾“å…¥æˆ–è¾“å‡ºä¿¡å·å…³è”èµ·æ¥æ‰€éœ€çš„è®¡ç®—æ“ä½œéšç€ä¿¡å·ä¹‹é—´çš„è·ç¦»çš„å¢åŠ è€Œå¢åŠ ã€‚è¿™ä½¿å¾—å­¦ä¹ è¿œè·ç¦»ä½ç½®ä¿¡æ¯ä¹‹é—´çš„ä¾èµ–å…³ç³»å˜å¾—å›°éš¾ã€‚åœ¨Transformerä¸­ï¼Œè¿™ç§æ“ä½œçš„æ•°é‡è¢«æ§åˆ¶ä¸ºä¸€ä¸ªæ’å®šçš„å¸¸æ•°ï¼ˆå°½ç®¡ç”±äºå¹³å‡æ³¨æ„åŠ›åŠ æƒä½ç½®è€Œé™ä½äº†æœ‰æ•ˆåˆ†è¾¨ç‡ï¼ŒTransformerä½¿ç”¨Multi-Head Attentionæ¥è§£å†³ï¼‰ã€‚ Self-attentionï¼Œæœ‰æ—¶ç§°ä¸ºintra-attentionã€‚æ˜¯ä¸€ç§æ³¨æ„åŠ›æœºåˆ¶ï¼Œå°†å•ä¸ªåºåˆ—çš„ä¸åŒä½ç½®è”ç³»èµ·æ¥ï¼Œä»¥è®¡ç®—åºåˆ—çš„è¡¨ç¤ºã€‚ Model Architecture TransformeråŸºäºencoder-decoder æ¶æ„ã€‚å…¶ä¸­ï¼Œencoderå°†ç”±ç¬¦å·è¡¨å¾çš„è¾“å…¥åºåˆ— (x1,...,xn)(x_1, ..., x_n)(x1â€‹,...,xnâ€‹) æ˜ å°„ä¸ºè¿ç»­çš„åºåˆ—è¡¨å¾ z=(z1,...,zn)\\mathbf{z} = (z_1, ..., z_n)z=(z1â€‹,...,znâ€‹)ã€‚å¯¹äºç»™å®šçš„ z\\mathbf{z}z ï¼Œdecoderåˆ©ç”¨å…¶ç”Ÿæˆä¸€ä¸ªè¾“å‡ºçš„ç¬¦å·åºåˆ— (y1,...,yn)(y_1, ..., y_n)(y1â€‹,...,ynâ€‹) ã€‚åœ¨encoderå’Œdecoderä¸­ï¼Œä½¿ç”¨å †æ ˆå¼è‡ªæ³¨æ„åŠ›å’Œé€ç‚¹çš„å…¨è¿æ¥å±‚ã€‚ Encoder å’Œ Decoder Encoder : Encoder ç”± N=6N = 6N=6 ä¸ªç›¸åŒçš„å±‚ç»„æˆï¼Œæ¯ä¸ªå±‚éƒ½æœ‰ä¸¤ä¸ªå­å±‚ã€‚ç¬¬ä¸€ä¸ªå­å±‚æ˜¯å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶(multi-head self-attention mechanism)ï¼Œç¬¬äºŒä¸ªå­å±‚æ˜¯ä¸€ä¸ªé€ä½ç½®çš„å…¨è¿æ¥å‰é¦ˆç½‘ç»œ(position-wise fully connected feed-forward network) æ¯ä¸ªå­å±‚ä¹‹åéƒ½æœ‰ä¸€ä¸ªLayer normalizationå±‚ï¼Œå¹¶é€šè¿‡æ®‹å·®è¿æ¥ç›¸è¿ã€‚å³ï¼Œæ¯ä¸ªå­å±‚çš„è¾“å‡ºæ˜¯ï¼š LayerNorm(x+Sublayer(x))\\text{LayerNorm}(x + \\text{Sublayer}(x))LayerNorm(x+Sublayer(x))ï¼Œå…¶ä¸­çš„ Sublayer(x)\\text{Sublayer}(x)Sublayer(x) è¡¨ç¤ºå­å±‚æ‰€å®ç°çš„æ“ä½œã€‚ä¸ºäº†åº”ç”¨æ®‹å·®è¿æ¥ï¼Œæ¨¡å‹ä¸­çš„æ‰€æœ‰å­å±‚ï¼ŒåŒ…æ‹¬åµŒå…¥å±‚ï¼Œè¾“å‡ºç»´åº¦éƒ½æ˜¯ dmodel=512d_{model} = 512dmodelâ€‹=512 Decoder : Decoder ä¹Ÿæ˜¯ç”± N=6N = 6N=6 ä¸ªç›¸åŒçš„å±‚ç»„æˆï¼Œæ¯ä¸ªå±‚ä¸­é™¤äº†ä¸encoderç›¸åŒçš„ä¸¤ä¸ªå­å±‚å¤–ï¼Œdecoderè¿˜æ’å…¥äº†ç¬¬ä¸‰ä¸ªå­å±‚ï¼Œç”¨äºå¯¹encoder stackçš„è¾“å‡ºè¿›è¡Œmulti-head attentionã€‚ ä¸encoderç±»ä¼¼ï¼Œdecoderä¸­ä¹Ÿä½¿ç”¨äº†æ®‹å·®è¿æ¥çš„layer normalizationå±‚ã€‚decoderä¸­ä¿®æ”¹äº†stackä¸­çš„è‡ªæ³¨æ„åŠ›å±‚(Masked Multi-head Attention)ï¼Œé˜²æ­¢å¯¹æŸä½ç½®çš„è§£ç è¿‡ç¨‹ä¸­æ¶‰åŠåç»­ä½ç½®çš„ä¿¡æ¯ã€‚è¿™ç§é®è”½å¼çš„ä¿®æ”¹ï¼Œé…åˆè¾“å‡ºçš„embeddingåç§»ä¸€ä¸ªä½ç½®çš„è®¾ç½®ï¼Œç¡®ä¿äº†å¯¹ iii ä½ç½®çš„é¢„æµ‹åªä¾èµ–å°äº iii ä½ç½®å¤„çš„å·²çŸ¥è¾“å‡ºã€‚ Attention æ³¨æ„åŠ›å‡½æ•° (attention function) å°±æ˜¯å°†ä¸€ä¸ª query å’Œä¸€ç³»åˆ— key-value å¯¹æ˜ å°„åˆ°ä¸€ä¸ªè¾“å‡º(output)çš„è¿‡ç¨‹ï¼Œå…¶ä¸­çš„ query, key, valueå’Œoutputéƒ½æ˜¯å‘é‡ã€‚outputç”±valuesçš„åŠ æƒå’Œè®¡ç®—ï¼Œå…¶ä¸­åˆ†é…ç»™æ¯ä¸ªvalueçš„æƒé‡ç”±querryå’Œç›¸åº”çš„keyç»è¿‡ä¸€ä¸ªå‡½æ•°è®¡ç®—ã€‚ è¿™é‡Œæåˆ°çš„ querriesï¼Œkeyså’Œvaluesæ˜¯ç”±è¾“å…¥ XXX è®¡ç®—å¾—åˆ°çš„ Scaled Dot-Product Attention æˆ‘ä»¬ä½¿ç”¨çš„Attentionç§°ä¸º Scaled Dot-Product Attentionã€‚å®ƒçš„è¾“å…¥åŒ…æ‹¬ç»´åº¦ä¸º dkd_kdkâ€‹ çš„querieså’Œkeysï¼Œä»¥åŠç»´åº¦ä¸º dvd_vdvâ€‹ çš„valuesã€‚æˆ‘ä»¬è®¡ç®—æ¯ä¸ª querry ä¸æ‰€æœ‰ keys çš„ç‚¹ä¹˜ï¼Œå¹¶é™¤ä»¥ dk\\sqrt{d_k}dkâ€‹â€‹ ï¼Œç„¶åç»è¿‡ä¸€ä¸ª softmax è·å–æ‰€æœ‰ values çš„æƒé‡ã€‚ å®è·µä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å°†querriesæ‰“åŒ…è¿›åŒä¸€ä¸ªçŸ©é˜µ QQQ æ¥å¹¶è¡ŒåŒ–attention functionçš„è®¡ç®—ã€‚keyså’Œvaluesä¹Ÿè¢«åˆ†åˆ«æ‰“åŒ…ä¸ºçŸ©é˜µ KKK å’Œ VVVï¼Œè®¡ç®—è¿‡ç¨‹ä¸ºï¼š Attention(Q,K,V)=softmax(QKTdk)V\\text{Attention}(Q, K, V) = \\text{softmax}(\\frac{QK^T}{\\sqrt{d_k}})VAttention(Q,K,V)=softmax(dkâ€‹â€‹QKTâ€‹)V æˆ‘ä»¬çš„attention functioné™¤äº†ä¹˜ä»¥ä¸€ä¸ªç¼©æ”¾å› å­ 1dk\\frac{1}{\\sqrt{d_k}}dkâ€‹â€‹1â€‹ ä¹‹å¤–ä¸ dot-product attentionç›¸åŒã€‚ç¼©æ”¾çš„åŸå› æ˜¯ï¼š[æˆ‘ä»¬æ€€ç–‘]å¯¹äºè¾ƒå¤§çš„ç»´åº¦å€¼ dkd_kdkâ€‹ ï¼Œç‚¹ç§¯è¿ç®—ç»“æœçš„å¢é•¿å¹…åº¦è¾ƒå¤§ï¼Œä¼šå°† softmaxå‡½æ•°çš„æ¢¯åº¦æ¨å‘éå¸¸å°çš„åŒºåŸŸã€‚ Multi-Head Attention ä¸åœ¨ä¸€ä¸ªå•ç‹¬çš„attention functionä¸Šå¯¹ dmodeld_{model}dmodelâ€‹ ç»´åº¦çš„ querries, keys å’Œ valuesè¿›è¡Œè®¡ç®—ç›¸æ¯”ï¼Œå°† querriesï¼Œkeys å’Œ values ä»¥ä¸åŒçš„ï¼Œå¯å­¦ä¹ çš„çº¿æ€§æŠ•å½±åˆ†åˆ«æŠ•å°„åˆ° hhh ä¸ªé€šé“ä¸Šå¹¶è¡Œè¿›è¡Œ attention functionæ›´æœ‰å¥½å¤„ï¼Œåœ¨æ¯ä¸ªé€šé“ä¸Šï¼Œquerries, keyså’Œvaluesåˆ†åˆ«ä¸º dk,dkå’Œdvd_k, d_kå’Œd_vdkâ€‹,dkâ€‹å’Œdvâ€‹ç»´åº¦ã€‚åœ¨ hhh ä¸ªé€šé“ä¸Šå¹¶è¡Œè¿›è¡Œçš„attention functionæœ€ç»ˆå¾—åˆ° hhh ä¸ªè¾“å‡ºçŸ©é˜µï¼Œå°†å…¶è¿æ¥èµ·æ¥å†ç»è¿‡ä¸€ä¸ªæŠ•å½±çŸ©é˜µï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚è¿™ç§æœºåˆ¶å…è®¸æ¨¡å‹åŒæ—¶å…³æ³¨æ¥è‡ªä¸åŒä½ç½®çš„ä¸åŒè¡¨å¾å­ç©ºé—´çš„ä¿¡æ¯ã€‚åœ¨åªæœ‰ä¸€ä¸ªattention headæ—¶ï¼ŒåŠ æƒå¹³å‡æŠ‘åˆ¶äº†è¿™ç§ç‰¹æ€§ã€‚ Multi-Head Attentionçš„æ•°å­¦è¿‡ç¨‹ä¸ºï¼š MultiHead(Q,K,V)=Concat(head1,...,headh)WO\\text{MultiHead}(Q, K, V) = \\text{Concat}(head_1, ..., head_h)W^OMultiHead(Q,K,V)=Concat(head1â€‹,...,headhâ€‹)WO, å…¶ä¸­ headi=Attention(QWiQ,KWiK,VWiV)head_i = \\text{Attention}(QW_i^Q, KW_i^K, VW_i^V)headiâ€‹=Attention(QWiQâ€‹,KWiKâ€‹,VWiVâ€‹) å…¶ä¸­çš„ WiQâˆˆRdmodelÃ—dk,WiKâˆˆRdmodelÃ—dk,WiVâˆˆRdmodelÃ—dvW_i^Q \\in \\mathbb{R}^{d_{model}\\times d_k}, W_i^K \\in \\mathbb{R}^{d_{model}\\times d_k}, W_i^V \\in \\mathbb{R}^{d_{model} \\times d_v}WiQâ€‹âˆˆRdmodelâ€‹Ã—dkâ€‹,WiKâ€‹âˆˆRdmodelâ€‹Ã—dkâ€‹,WiVâ€‹âˆˆRdmodelâ€‹Ã—dvâ€‹å³æ˜¯åˆ†åˆ«ç”¨åœ¨ Q,K,VQ, K, VQ,K,V ä¸Šçš„æŠ•å½±çŸ©é˜µï¼Œ WOâˆˆRhdvÃ—dmodelW^O\\in \\mathbb{R}^{hd_v\\times d_{model}}WOâˆˆRhdvâ€‹Ã—dmodelâ€‹æ˜¯ç”¨ä½œè¿æ¥åçš„ç»“æœçŸ©é˜µçš„æŠ•å½±çŸ©é˜µã€‚ åœ¨æœ¬æ–‡çš„å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† h=8h = 8h=8 ä¸ªå¹¶è¡Œattentionå±‚(heads)ï¼Œå¯¹äºæ¯ä¸€ä¸ªå¹¶è¡Œå±‚ï¼Œä½¿ç”¨ dk=dv=dmodel/h=64d_k = d_v = d_{model}/h = 64dkâ€‹=dvâ€‹=dmodelâ€‹/h=64 Applications of Attention in our Model åœ¨encoder-decoder attentionå±‚ï¼ˆdecoderçš„ç¬¬äºŒä¸ªmulti-attentionå±‚ï¼‰ï¼Œquerriesæ¥è‡ªä¸Šä¸€å±‚decoderçš„è¾“å‡ºï¼Œkeyså’Œvaluesåˆ™ç”±encoderçš„è¾“å‡ºè®¡ç®—å¾—åˆ°ã€‚è¿™ç§æœºåˆ¶ä½¿decoderåœ¨æ¯ä¸€ä¸ªä½ç½®ä¸Šéƒ½å¯ä»¥æ³¨æ„åˆ°è¾“å…¥æ‰€æœ‰ä½ç½®ä¸Šçš„ä¿¡æ¯ã€‚ åœ¨encoderçš„self-attentionå±‚ä¸­ï¼Œæ‰€æœ‰çš„querriesï¼Œkeyså’Œvalueséƒ½æ¥è‡ªä¸Šä¸€å±‚encoderçš„è¾“å‡ºï¼Œencoderçš„æ¯ä¸€ä¸ªä½ç½®éƒ½å¯ä»¥æ³¨æ„ä¸Šä¸€å±‚encoderè¾“å‡ºçš„æ‰€æœ‰ä½ç½® decoderä¸­çš„self-attentionå±‚ï¼ˆç¬¬ä¸€ä¸ªMulti-attentionå±‚ï¼‰å…è®¸æ¯ä¸ªä½ç½®æ³¨æ„åˆ°è¿™ä¸ªä½ç½®ä¹‹å‰åŒ…æ‹¬è¿™ä¸ªä½ç½®çš„ä¿¡æ¯ï¼Œä½†æ˜¯ç¦æ­¢å·¦ä¾§ä½ç½®å‚è€ƒå³ä¾§çš„ä¿¡æ¯ï¼Œä»¥ä¿æŒæ¨¡å‹çš„è‡ªå›å½’ç‰¹æ€§ã€‚æˆ‘ä»¬é€šè¿‡å°†softmaxçš„è¾“å…¥ä¸­æ‰€æœ‰éæ³•è¿æ¥çš„å€¼è®¾ç½®ä¸º âˆ’infâ¡-\\infâˆ’inf æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ é€ä½ç½®å‰é¦ˆç½‘ç»œ(Position-wise Feed-Forward Networks) åœ¨encoderå’Œdecoderçš„æ¯ä¸€å±‚ä¸­ï¼Œéƒ½åŒ…å«ä¸€ä¸ªå…¨è¿æ¥çš„å‰é¦ˆç½‘ç»œå±‚ï¼Œå¯¹æ‰€æœ‰ä½ç½®åˆ†åˆ«è¿›è¡Œç›¸åŒçš„æ“ä½œã€‚ç”±ä¸¤ä¸ªå…¨è¿æ¥å±‚ç»„æˆï¼Œç¬¬ä¸€ä¸ªå…¨è¿æ¥å±‚çš„æ¿€æ´»å‡½æ•°æ˜¯ReLuï¼Œç¬¬äºŒä¸ªä¸éœ€è¦æ¿€æ´»å‡½æ•°ï¼šFFN(x)=max(0,xW1+b1)W2+b2\\text{FFN}(x) = max(0, xW_1+b_1)W_2 + b_2FFN(x)=max(0,xW1â€‹+b1â€‹)W2â€‹+b2â€‹ æ¯ä¸€å±‚ä¸åŒä½ç½®ä¸Šçš„çº¿æ€§å˜æ¢ç›¸åŒï¼Œä½†ä¸åŒå±‚ä¸Šçš„å‚æ•°ä¸åŒã€‚å¦ä¸€ç§æè¿°è¿™ç§è¿‡ç¨‹çš„æ–¹å¼æ˜¯ä½¿ç”¨ä¸¤ä¸ªsizeä¸º1çš„å·ç§¯æ ¸è¿›è¡Œä¸¤æ¬¡å·ç§¯ï¼Œå…¶ä¸­è¾“å…¥å’Œè¾“å‡ºç»´åº¦ä¸º dmodel=512d_{model}=512dmodelâ€‹=512ï¼Œå†…å±‚ç»´åº¦ä¸º dff=2048d_{ff} = 2048dffâ€‹=2048 ä½ç½®ç¼–ç (Positional Encoding) Transformeræ¨¡å‹ä¸­æ²¡æœ‰ä½¿ç”¨é€’å½’å’Œå·ç§¯ï¼Œå› æ­¤å¿…é¡»åœ¨è¾“å…¥ä¸­æ’å…¥å…³äºtokenåœ¨åºåˆ—ä¸­ä½ç½®çš„ä¿¡æ¯ï¼Œä»è€Œä½¿æ¨¡å‹èƒ½å¤Ÿåˆ©ç”¨åºåˆ—çš„é¡ºåºä¿¡æ¯ã€‚æˆ‘ä»¬å°†ä¸embeddingç›¸åŒç»´åº¦çš„positional encodingä¸embeddingç›¸åŠ ä½œä¸ºencoderå’Œdecoderçš„è¾“å…¥ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ˜¯coså‡½æ•°çš„è°ƒé¢‘ç¼–ç ï¼š {PE(pos,2i)=sinâ¡(pos/100002i/dmodel)PE(pos,2i+1)=cosâ¡(pos/100002i/dmodel)\\begin{cases}PE_{(pos, 2i)} &amp;= \\sin(pos/10000^{2i/d_{model}}) \\\\PE_{(pos, 2i+1)} &amp;= \\cos(pos/10000^{2i/d_{model}})\\end{cases}{PE(pos,2i)â€‹PE(pos,2i+1)â€‹â€‹=sin(pos/100002i/dmodelâ€‹)=cos(pos/100002i/dmodelâ€‹)â€‹ å…¶ä¸­ï¼Œ pospospos æ˜¯tokençš„ä½ç½®ï¼Œ iii æ˜¯ç»´åº¦ã€‚å³ï¼Œæ¯ä¸ªç»´åº¦çš„ä½ç½®ç¼–ç å¯¹åº”ç€ä¸€ä¸ªæ­£å¼¦æ³¢ï¼Œä¸åŒç»´åº¦çš„æ­£å¼¦æ³¢çš„æ³¢é•¿å½¢æˆ 2Ï€âˆ’10000â‹…2Ï€2\\pi - 10000\\cdot 2\\pi2Ï€âˆ’10000â‹…2Ï€èŒƒå›´çš„å‡ ä½•çº§æ•°ã€‚æˆ‘ä»¬é€‰æ‹©è¿™ç§ç¼–ç æ˜¯å› ä¸ºå¯¹äºä»»æ„çš„offset kkkï¼Œ PEpos+KPE_{pos+K}PEpos+Kâ€‹å¯ä»¥è¡¨ç¤ºä¸º PEposPE_{pos}PEposâ€‹çš„çº¿æ€§å˜æ¢ï¼Œå› æ­¤æˆ‘ä»¬å‡è®¾è¿™ç§ç¼–ç æ–¹æ³•å¯ä»¥ä½¿æ¨¡å‹è½»æ˜“å­¦ä¹ åˆ°æ³¨æ„ç›¸å¯¹ä½ç½®ç‰¹å¾ã€‚ Why Self-Attention self-attentionå±‚ä¸é€’å½’å’Œå·ç§¯å±‚ç›¸æ¯”åœ¨åºåˆ—è½¬å¯¼æ¨¡å‹ä¸­çš„ä¼˜åŠ¿ï¼š æ¯å±‚çš„æ€»è®¡ç®—å¤æ‚åº¦ å¯ä»¥è¢«å¹¶è¡ŒåŒ–çš„è®¡ç®—é‡ï¼Œç”±å¿…è¦çš„æœ€å°é¡ºåºåŒ–æ“ä½œæ•°é‡è¡¡é‡ åœ¨ç½‘ç»œä¸­è®¡ç®—long-rangeä¾èµ–éœ€è¦çš„è®¡ç®—è·¯å¾„é•¿åº¦ã€‚å³ä¸ºäº†å­¦ä¹ long-rangeä¾èµ–ï¼Œä¿¡å·åœ¨ç½‘ç»œä¸­å¿…é¡»è¦ç»è¿‡çš„è·¯å¾„é•¿åº¦ï¼Œè¿™ä¸ªé•¿åº¦è¶ŠçŸ­ï¼Œæ¨¡å‹å°±è¶Šå®¹æ˜“å­¦ä¹ long-rangeä¾èµ–ã€‚ è®­ç»ƒ ä¼˜åŒ–å™¨ Adam optimizerï¼Œå‚æ•°è®¾ç½®ä¸ºï¼š Î²1=0.9,Î²2=0.98,Ïµ=10âˆ’9\\beta_1 = 0.9, \\beta_2 = 0.98, \\epsilon = 10^{-9}Î²1â€‹=0.9,Î²2â€‹=0.98,Ïµ=10âˆ’9ã€‚å­¦ä¹ ç‡åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æŒ‰ç…§ä»¥ä¸‹å…¬å¼å˜åŒ–ï¼š lrate=dmodelâˆ’0.5â‹…min(step_numâˆ’0.5,step_numâ‹…warmup_stepsâˆ’1.5)lrate = d_{model}^{-0.5}\\cdot \\text{min}(step\\_num^{-0.5}, step\\_num\\cdot warmup\\_steps^{-1.5})lrate=dmodelâˆ’0.5â€‹â‹…min(step_numâˆ’0.5,step_numâ‹…warmup_stepsâˆ’1.5) å…¶ä¸­ warmup_steps=4000warmup\\_steps = 4000warmup_steps=4000 æ­£åˆ™åŒ– Residual Dropout 1. åœ¨æ¯ä¸ªå­å±‚çš„è¾“å‡ºä½ç½®ï¼Œæ®‹å·®è¿æ¥ä¹‹å‰ã€‚2. åœ¨encoderåŠdecoderçš„embeddingå’Œpositional encodingç›¸åŠ çš„ä½ç½®ã€‚å‚æ•°ä¸º pdrop=0.1p_{drop} = 0.1pdropâ€‹=0.1 Label Smoothing è®­ç»ƒæ—¶ä½¿ç”¨äº† Ïµls=0.1\\epsilon_{ls} = 0.1Ïµlsâ€‹=0.1çš„æ ‡ç­¾å¹³æ»‘","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"PLM","slug":"PLM","permalink":"https://blog.zhuwenq.cc/tags/PLM/"},{"name":"NLP","slug":"NLP","permalink":"https://blog.zhuwenq.cc/tags/NLP/"},{"name":"Transformer","slug":"Transformer","permalink":"https://blog.zhuwenq.cc/tags/Transformer/"}]},{"title":"Pretrain,Â Prompt,Â andÂ Predict:Â AÂ SystematicÂ SurveyÂ ofÂ PromptingÂ MethodsÂ inÂ NaturalÂ LanguageÂ Processing","slug":"Pre-train-Prompt-and-Predict","date":"2021-08-29T16:00:00.000Z","updated":"2023-06-21T06:51:28.832Z","comments":true,"path":"Pre-train-Prompt-and-Predict/","link":"","permalink":"https://blog.zhuwenq.cc/Pre-train-Prompt-and-Predict/","excerpt":"åˆ˜é¹é£åšå£«è‘— Prompt èŒƒå¼ç»¼è¿°","text":"åˆ˜é¹é£åšå£«è‘— Prompt èŒƒå¼ç»¼è¿° NLPä¸­çš„ä¸¤æ¬¡å·¨å˜ feature/architecture engineering to objective engineering æ—©æœŸçš„NLPä¸»è¦é‡‡ç”¨å®Œå…¨ç›‘ç£å­¦ä¹ æ–¹æ³•ï¼Œç”¨äºç‰¹å®šä»»åŠ¡çš„æ¨¡å‹ä»…åœ¨ç‰¹å®šçš„æ•°æ®é›†ä¸Šè®­ç»ƒã€‚ç”±äºå®Œå…¨ç›‘ç£çš„æ–¹æ³•éœ€è¦å¤§é‡é«˜è´¨é‡çš„æœ‰æ ‡ç­¾æ•°æ®é›†ï¼Œæ—©æœŸçš„NLPæ¨¡å‹ååˆ†ä¾èµ–ç ”ç©¶è€…çš„ä¸“ä¸šé¢†åŸŸçŸ¥è¯†ä»¥ä¾¿ä»åŸå§‹æ•°æ®ä¸­å®šä¹‰å’ŒæŠ½å–ç‰¹å¾ï¼Œå¹¶ä¸”ç»™æ¨¡å‹ä»¥æ°å½“çš„å½’çº³åç½®(inductive bias)ï¼Œè¿™è¢«ç§°ä¸ºç‰¹å¾å·¥ç¨‹(feature engineering) éšç€ç¥ç»ç½‘ç»œçš„å‘å±•ï¼Œæ¨¡å‹å¯ä»¥åœ¨è®­ç»ƒä¸­å­¦ä¹ ç‰¹å¾ã€‚ç ”ç©¶è€…ä¸»è¦é€šè¿‡è®¾è®¡æœ‰åˆ©äºå­¦ä¹ æŸç±»ç‰¹å¾çš„ç‰¹æ®Šçš„ç½‘ç»œæ¶æ„æ¥æä¾›å½’çº³åå·®ï¼Œè¿™è¢«ç§°ä¸ºæ¶æ„å·¥ç¨‹(architecture engineering) ç¬¬ä¸€ä¸ªå·¨å˜å‘ç”Ÿåœ¨2017-2019å¹´ï¼ŒNLPçš„æ–¹å‘è½¬ä¸ºé¢„è®­ç»ƒå’Œå¾®è°ƒçš„æ¨¡å¼ï¼Œå®Œå…¨ç›‘ç£çš„æ–¹æ³•ä»æ­¤å¼å¾®ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªå›ºå®šæ¶æ„çš„é¢„è®­ç»ƒæ¨¡å‹ä»å¤§å‹æ•°æ®é›†ä¸­æŠ½å–è¯­è¨€çš„é€šç”¨ç‰¹å¾ï¼Œç„¶åé€šè¿‡å¼•å…¥é¢å¤–çš„å‚æ•°å¹¶ä½¿ç”¨ç‰¹å®šä»»åŠ¡çš„ç›®æ ‡å‡½æ•°å¯¹å®ƒä»¬å¾®è°ƒæ¥é€‚åº”ä¸åŒçš„ä¸‹æ¸¸ä»»åŠ¡ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼ŒNLPçš„ä¸»è¦ä»»åŠ¡æ˜¯è®¾è®¡åœ¨é¢„è®­ç»ƒå’Œå¾®è°ƒæ—¶çš„ç›®æ ‡å‡½æ•°ï¼Œç§°ä¸ºç›®æ ‡å·¥ç¨‹(objective engineering) objective engineering to promot engineering 2021å¹´æ­£å¤„äºç¬¬äºŒæ¬¡å·¨å˜ä¸­ï¼Œâ€œé¢„è®­ç»ƒ-å¾®è°ƒâ€çš„è¿‡ç¨‹è¢«æˆ‘ä»¬ç§°ä¸ºâ€œé¢„è®­ç»ƒ-æç¤º-é¢„æµ‹â€çš„è¿‡ç¨‹æ›¿ä»£ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œä¸‹æ¸¸ä»»åŠ¡é€šè¿‡é‡ç»„æ¥é€‚é…è¯­è¨€æ¨¡å‹ï¼Œè€Œä¸æ˜¯è¯­è¨€æ¨¡å‹é€šè¿‡å¾®è°ƒæ¥é€‚é…ä¸‹æ¸¸ä»»åŠ¡ã€‚è¿™ç§æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯ï¼Œä¸€ä¸ªå®Œå…¨æ— ç›‘ç£é¢„è®­ç»ƒå‡ºçš„æ¨¡å‹åœ¨æ°å½“çš„æç¤ºä¸‹å¯ä»¥è§£å†³å¤šç§é—®é¢˜ã€‚æ­¤æ—¶NLPçš„ä¸»è¦ä»»åŠ¡å°±å˜æˆäº†è®¾è®¡å‡ºæ°å½“çš„æç¤ºï¼Œç§°ä¸ºæç¤ºå·¥ç¨‹(promot engineering) Prompting çš„æ­£å¼æè¿° ä¼ ç»Ÿç›‘ç£å­¦ä¹ çš„NLP ä¼ ç»Ÿçš„ç›‘ç£å­¦ä¹ çš„NLPè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹ P(yâˆ£x;Î¸)P(y|x;\\theta)P(yâˆ£x;Î¸) å¯¹äºè¾“å…¥xxxé¢„æµ‹å‡ºè¾“å‡ºyyyã€‚ä¸ºäº†å­¦ä¹ å‚æ•°Î¸\\thetaÎ¸ï¼Œé€šå¸¸éœ€è¦æˆç»„çš„è¾“å…¥å’Œè¾“å‡ºæ•°æ®é›†(æœ‰æ ‡ç­¾æ•°æ®)æ¥è¿›è¡Œè®­ç»ƒä»¥å¯¹æ¡ä»¶æ¦‚ç‡è¿›è¡Œé¢„æµ‹ã€‚åœ¨å¾ˆå¤šä»»åŠ¡èƒŒæ™¯ä¸‹è¿™æ ·çš„æ•°æ®é›†æ•°é‡ä¸å¤Ÿ Prompting çš„åŸºæœ¬è¿‡ç¨‹å’Œæ¦‚å¿µ åŸºäºPromoptingçš„å­¦ä¹ æ–¹æ³•é€šè¿‡è®¡ç®—æ–‡æœ¬xxxæœ¬èº«çš„æ¦‚ç‡è€Œä¸æ˜¯æ¡ä»¶æ¦‚ç‡æ¥é¢„æµ‹è¾“å‡ºyyyå‡å°‘ç”šè‡³æ¶ˆé™¤å¯¹å¤§è§„æ¨¡ç›‘ç£æ•°æ®é›†çš„éœ€æ±‚ ä¸‹è¡¨æ˜¯Promptingçš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š åŸºäºPromptingçš„æ–¹æ³•åˆ†ä¸‰æ­¥æ¥é¢„æµ‹è¾“å‡ºy^\\widehat{y}yâ€‹ Prompting function ç¬¬ä¸€æ­¥é€šè¿‡å½¢å¦‚ fprompt(â‹…)f_{prompt}(\\cdot)fpromptâ€‹(â‹…) çš„prompting functionæ¥ä¿®æ”¹è¾“å…¥çš„æ–‡æœ¬xxxä¸º xâ€²=fprompt(x)x&#x27;=f_{prompt}(x)xâ€²=fpromptâ€‹(x)ã€‚è¿™ä¸ªå‡½æ•°åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼š ä½¿ç”¨ä¸€ä¸ªæ–‡æœ¬æ¨¡æ¿ï¼Œè¯¥æ¨¡æ¿æœ‰ä¸¤ä¸ªæ’æ§½ï¼šè¾“å…¥æ’æ§½ [X][X][X] ç”¨æ¥æ”¾è¾“å…¥xxx, ç­”æ¡ˆæ’æ§½[Z][Z][Z]ç”¨æ¥æ”¾æ¨¡å‹ç”Ÿæˆçš„ç­”æ¡ˆzzz æŠŠè¾“å…¥æ–‡æœ¬xxxæ”¾è¿›è¾“å…¥æ’æ§½[X][X][X] æ³¨æ„ï¼š ä¸Šè¿°çš„Promptsæœ‰ä¸€ä¸ªå¾…å¡«å……çš„ç©ºæ’æ§½[Z][Z][Z]ï¼Œæ’æ§½ä½äºPromptsä¸­é—´çš„ç§°ä¸ºcloze promptï¼Œ æ’æ§½ä½äºæœ«å°¾çš„ç§°ä¸ºprefix prompt è®¸å¤šæƒ…å†µä¸‹ï¼Œæ¨¡æ¿å¹¶ä¸å¿…é¡»ç”±è‡ªç„¶è¯­è¨€æ ‡è®°ç»„æˆï¼Œå¯ä»¥åµŒå…¥è™šæ‹Ÿçš„å­—(å¦‚æ•°å­—id)ï¼Œç”šè‡³æŸäº›promptingæ–¹æ³•å¯ä»¥ç”Ÿæˆè¿ç»­çš„å‘é‡ è¾“å…¥æ’æ§½[X][X][X]å’Œç­”æ¡ˆæ’æ§½[Z][Z][Z]çš„æ•°é‡å¯ä»¥æ ¹æ®ä»»åŠ¡çš„éœ€è¦çµæ´»è°ƒæ•´ ç­”æ¡ˆæœ€å¤§åŒ–æœç´¢ ç»è¿‡ prompting function ä¹‹åï¼Œè¾“å…¥æ–‡æœ¬ xxx å˜ä¸ºå¸¦æœ‰ç­”æ¡ˆæ’æ§½çš„ xâ€²x&#x27;xâ€²ï¼Œéšåæˆ‘ä»¬æœç´¢è·å¾—æœ€é«˜åˆ†æ•°çš„ç­”æ¡ˆæ–‡æœ¬ z^\\widehat{z}zã€‚å®šä¹‰ Z\\mathcal{Z}Z ä¸º zzz æ‰€æœ‰å¯èƒ½å€¼çš„é›†åˆï¼Œä¾‹å¦‚åœ¨æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ä¸­ï¼Œ Z\\mathcal{Z}Z å¯èƒ½åŒ…æ‹¬æ‰€æœ‰è¯­è¨€çš„èŒƒå›´ï¼Œè€Œåœ¨æ–‡æœ¬è¯†åˆ«çš„ä»»åŠ¡ä¸­ï¼Œ Z\\mathcal{Z}Z åªæ˜¯ä¸€ä¸ªå°çš„å­é›†ã€‚ å®šä¹‰å‡½æ•° ffill(xâ€²,z)f_{fill}(x&#x27;, z)ffillâ€‹(xâ€²,z) ç”¨äºå°†å¯èƒ½çš„ç­”æ¡ˆ zzz å¡«å……è¿› prompt xâ€²x&#x27;xâ€² çš„æ’æ§½ [X][X][X] ä¸­ï¼Œå°†ç»è¿‡è¿™ä¸€æ­¥éª¤çš„ prompt ç§°ä¸º filled prompt ï¼Œå¦‚æœå¡«å……çš„æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œç§°ä¸º answered prompt ã€‚ æœç´¢çš„è¿‡ç¨‹å®é™…æ˜¯ï¼šå¯¹äº Z\\mathcal{Z}Z ä¸­æ¯ä¸€ä¸ªå¯èƒ½çš„ç­”æ¡ˆ zzz ï¼Œåˆ©ç”¨é¢„è®­ç»ƒçš„ LM: P(â‹…;Î¸)P(\\cdot; \\theta)P(â‹…;Î¸) æ¥è®¡ç®—å…¶æ¦‚ç‡ï¼Œå¹¶å–å…¶ä¸­æ¦‚ç‡æœ€å¤§çš„ç­”æ¡ˆï¼š z^=searchzâˆˆZP(ffill(xâ€²,z);Î¸)\\widehat{z} = \\underset{z\\in \\mathcal{Z}}{\\text{search}} P(f_{\\text{fill}}(x&#x27;, z); \\theta) z=zâˆˆZsearchâ€‹P(ffillâ€‹(xâ€²,z);Î¸) ç­”æ¡ˆæ˜ å°„ æœ€åï¼Œè¿˜éœ€è¦å°†æœ€é«˜åˆ†çš„ç­”æ¡ˆ z^\\widehat{z}z æ˜ å°„ä¸ºæœ€é«˜åˆ†çš„è¾“å‡º y^\\widehat{y}yâ€‹ï¼Œåœ¨æŸäº›åº”ç”¨ä¸­ï¼Œç­”æ¡ˆ z^\\widehat{z}z å°±æ˜¯éœ€è¦çš„è¾“å‡º y^\\widehat{y}yâ€‹ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥éª¤å¹¶ä¸ä¸€å®šæ˜¯å¿…é¡»çš„ è®¾è®¡Promptingçš„å‡ ä¸ªè¦ç‚¹ é¢„è®­ç»ƒæ¨¡å‹çš„é€‰æ‹© æ„å»ºpromptå‡½æ•° fprompt(x)f_{prompt}(x)fpromptâ€‹(x) çš„æ–¹æ³• å¯èƒ½çš„ç­”æ¡ˆé›† Z\\mathcal{Z}Z çš„è®¾è®¡æ–¹æ³•å’Œç­”æ¡ˆæ˜ å°„çš„æ–¹æ³• å¯¹äºç‰¹å®šçš„ä»»åŠ¡å¯¹promptæ¨¡å¼çš„æ‰©å±• prompt æ¨¡å‹çš„è®­ç»ƒç­–ç•¥ é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ Training Objectivesï¼ˆæŸå¤±å‡½æ•°ï¼‰ Standard Language Model, SLM æ ‡å‡†è¯­è¨€æ¨¡å‹é€šè¿‡è®­ç»ƒæ¥ä¼˜åŒ–å¯¹æ–‡æœ¬çš„é¢„æµ‹æ¦‚ç‡ P(x)P(x)P(x)ï¼Œé€šå¸¸æ˜¯è‡ªå›å½’(autoregressive) çš„æ–¹å¼å¯¹æ–‡æœ¬åºåˆ—ä¸­ä»å·¦åˆ°å³çš„ tokens è¿›è¡Œé¢„æµ‹ è¾ƒä¸ºæµè¡Œçš„ç”¨äºæ›¿æ¢ SLM çš„ Objective æ˜¯ noise objective ï¼Œé€šè¿‡å™ªå£°å‡½æ•° x^=fnoise(x)\\widehat{x}=f_{noise}(x)x=fnoiseâ€‹(x) å‘è¾“å…¥æ–‡æœ¬åºåˆ—æ·»åŠ å™ªå£°ï¼Œç„¶åæ ¹æ®å™ªå£°åºåˆ—é¢„æµ‹åŸå§‹æ–‡æœ¬åºåˆ— P(xâˆ£x^)P(x|\\widehat{x})P(xâˆ£x)ã€‚ noise objective æœ‰ä»¥ä¸‹ä¸¤ç§ä¸»è¦çš„å½¢å¼ï¼š Corrupted Text Reconstruction, CTR è¿™ç§ç›®æ ‡é€šè¿‡è®¡ç®—æ–‡æœ¬ä¸­å—æŸçš„lossæ¥æ¢å¤å¤„ç†åçš„æ–‡æœ¬ Full Text Reconstruction, FTR è¿™ç§ç›®æ ‡é€šè¿‡è®¡ç®—æ•´ä¸ªæ–‡æœ¬åºåˆ—çš„lossæ¥æ¢å¤å¤„ç†åçš„æ–‡æœ¬ ## å™ªå£°å‡½æ•° åœ¨åŸºäºé‡å»ºçš„è®­ç»ƒç›®æ ‡ä¸­ï¼Œä¸åŒçš„å™ªå£°å‡½æ•°ä¼šå½±å“è®­ç»ƒçš„æ•ˆæœï¼Œå¦å¤–ï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶å™ªå£°çš„ç§ç±»å¼•å…¥å…ˆéªŒçŸ¥è¯†ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä¸“æ³¨äºå¥å­ä¸­å®ä½“çš„å™ªå£°å‡½æ•°ï¼Œé¢„è®­ç»ƒå‡ºçš„è¯­è¨€æ¨¡å‹å°±ä¼šåœ¨å®ä½“ä¸Šæœ‰è¾ƒé«˜çš„é¢„æµ‹æ€§èƒ½ Masking: ç”¨ä¸€ä¸ªMASKæ›¿æ¢æ–‡æœ¬ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªtoken Replacement: ç”¨ä¸€æ®µæ–‡æœ¬æ›¿æ¢ä¸€ä¸ªæˆ–å¤šä¸ªtoken, è€Œä¸æ˜¯å›ºå®šçš„MASK Deletion: åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªtokenï¼Œé€šå¸¸å’ŒFTR Lossä¸€èµ·ä½¿ç”¨ Permutation: æŠŠæ–‡æœ¬åˆ†æˆä¸åŒçš„å—ï¼Œç„¶åé‡æ–°ç»„åˆ ä¸‹è¡¨æ˜¯è¿™å‡ ç§å™ªå£°å‡½æ•°çš„ä¾‹å­ï¼š ## Directionality of Representations Left-to-Right: æ¯ä¸ªè¯çš„è¡¨ç¤ºç”±è¯æœ¬èº«å’Œå¥å­ä¸­å‰é¢çš„æ‰€æœ‰è¯è®¡ç®—ï¼Œå¸¸ç”¨äºSLMå’ŒFTR Bidirectional: æ¯ä¸ªè¯çš„è¡¨ç¤ºç”±å¥å­ä¸­æ‰€æœ‰è¯è®¡ç®— æ··åˆçš„æ¨¡å¼: å°†ä»¥ä¸Šä¸¤ç§ç­–ç•¥æ··ç”¨ï¼Œæ³¨æ„åŠ›æœºåˆ¶ ä¸‹å›¾æ˜¯è¡¨ç¤ºé¡ºåºçš„æ¨¡å¼ç¤ºæ„å›¾ï¼š ## å…¸å‹çš„é¢„è®­ç»ƒæ–¹æ³• ç”±ä¸åŒçš„æŸå¤±å‡½æ•°ï¼Œå™ªå£°å‡½æ•°å’Œæ–¹å‘æ€§å¯ä»¥ç»„åˆå‡ºä¸åŒçš„é¢„è®­ç»ƒæ–¹æ³•ï¼š Left-to-Right Language Model, L2R LMs è‡ªå›å½’è¯­è¨€æ¨¡å‹çš„ä¸€ç§ï¼Œç”¨äºé¢„æµ‹å³å°†å‡ºç°çš„è¯æˆ–ç»™å‡ºä¸€ç»„è¯çš„æ¦‚ç‡ P(x),x=x1,x2,...,xnP(\\mathbf{x}), \\mathbb{x} = x_1, x_2, ..., x_nP(x),x=x1â€‹,x2â€‹,...,xnâ€‹ã€‚ P(x)P(\\mathbf{x})P(x) é€šå¸¸ç”±é“¾å¼æ³•åˆ™è®¡ç®—ï¼š P(x)=P(x1)Ã—...P(xnâˆ£x1...xnâˆ’1)P(\\mathbf{x}) = P(x_1)\\times ... P(x_n|x_1...x_{n - 1})P(x)=P(x1â€‹)Ã—...P(xnâ€‹âˆ£x1â€‹...xnâˆ’1â€‹) L2R LM ç”±é©¬å°”å¯å¤«åœ¨1913å¹´æå‡ºå¹¶è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå…·æœ‰ä»£è¡¨æ€§çš„ç°ä»£L2R LMæœ‰ï¼šGPT-3, GPT-Neo Masked Language Models, Mask L2R LM æ˜¯å»ºæ¨¡æ–‡æœ¬æ¦‚ç‡çš„åˆ©å™¨ï¼Œä½†æ˜¯å®ƒè¦æ±‚å¿…é¡»æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ¥è®¡ç®—è¡¨ç¤ºã€‚è¿™ç§é¡ºåºçš„è¡¨ç¤ºå¯¹äºæŸäº›ä¸‹æ¸¸ä»»åŠ¡ï¼ˆå¦‚åˆ†ç±»ï¼‰å¯èƒ½ä¸æ˜¯æœ€åˆé€‚çš„ã€‚ åœ¨ representation learning ä¸­å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§åŒå‘ç›®æ ‡å‡½æ•°Masked Language Modelç”¨äºæ ¹æ®å‘¨å›´çš„æ–‡æœ¬é¢„æµ‹è¢«Maskedçš„æ–‡æœ¬ç‰‡æ®µã€‚å³ï¼š P(xiâˆ£x1,...xiâˆ’1,xi+1,...,xn)P(x_i|x_1,...x_{i - 1}, x_{i+1}, ... ,x_n)P(xiâ€‹âˆ£x1â€‹,...xiâˆ’1â€‹,xi+1â€‹,...,xnâ€‹) ä»£è¡¨è¯ xix_ixiâ€‹ è¢«ç»™å®šä¸Šä¸‹æ–‡åŒ…å›´çš„æ¦‚ç‡ ä½¿ç”¨MLMçš„ä»£è¡¨æ€§é¢„è®­ç»ƒæ¨¡å‹æœ‰ï¼šBERTï¼Œ ERNIEã€‚MLMé€šå¸¸éå¸¸é€‚åˆå¦‚ æ–‡æœ¬åˆ†ç±» ç­‰è‡ªç„¶è¯­è¨€ç†è§£å’Œåˆ†æçš„ä»»åŠ¡ã€‚ Prefix and Encoder-Decoder å¯¹äºæ¡ä»¶æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ä¾‹å¦‚ç¿»è¯‘å’Œæ–‡æœ¬æ‘˜è¦ä»»åŠ¡ï¼Œå³ç»™å®šè¾“å…¥æ–‡æœ¬ x=x1,..,xn\\mathbf{x} = x_1,..,x_nx=x1â€‹,..,xnâ€‹ ï¼Œè¦æ±‚ç”Ÿæˆç›®æ ‡æ–‡æœ¬ y\\mathbf{y}yï¼Œéœ€è¦ä¸€ä¸ªæ—¢èƒ½å¤Ÿç¼–ç è¾“å…¥æ–‡æœ¬åˆèƒ½å¤Ÿè§£ç è¾“å‡ºæ–‡æœ¬çš„æ¨¡å‹ã€‚ å¯¹æ­¤æœ‰ä¸¤ç§æµè¡Œçš„æ¶æ„ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸‹é¢çš„æµç¨‹ï¼š1. ä½¿ç”¨å…·æœ‰å®Œå…¨è¿æ¥æ©ç çš„ç¼–ç å™¨é¦–å…ˆå¯¹æº x\\mathbf{x}x è¿›è¡Œç¼–ç ï¼Œç„¶å2. è‡ªåŠ¨å›å½’ä»å·¦åˆ°å³è§£ç  y\\mathbf{y}y Prefix Language Model: PLMæ˜¯ä¸€ä¸ªä»å·¦åˆ°å³çš„LMï¼Œå®ƒä»¥å‰ç¼€åºåˆ— x\\mathbf{x}x ä¸ºæ¡ä»¶è§£ç  y\\mathbf{y}yã€‚ç¼–ç å’Œè§£ç çš„æ¨¡å‹å‚æ•°ç›¸åŒ ä»£è¡¨æ€§æ¨¡å‹ï¼šUniLM 1-2, ERNIE-M Encoder-decoder: ä½¿ç”¨ L2R LMæ¥è§£ç  y\\mathbf{y}y ï¼Œä½†æ˜¯ç¼–ç  x\\mathbf{x}x çš„ç¼–ç å™¨æ˜¯ç‹¬ç«‹çš„ ä»£è¡¨æ€§æ¨¡å‹ï¼šBART, MASS å¸¸ç”¨äºæ–‡æœ¬ç”Ÿæˆä»»åŠ¡ï¼Œåœ¨æ°å½“çš„ prompts ä¸‹ä¹Ÿå¯ä»¥ç”¨äºä¿¡æ¯æå–ï¼Œé—®ç­”å’Œæ–‡æœ¬ç”Ÿæˆè¯„ä¼°ä»»åŠ¡ ä¸‹é¢æ˜¯å‡ ç§LMçš„ç»“æ„ç¤ºæ„å›¾å’Œä¸åŒå‡½æ•°çš„çš„ç»„åˆè¡¨ï¼š # Prompt Engineering Prompt Engineering å°±æ˜¯ä¸ºä¸‹æ¸¸ä»»åŠ¡æ„å»ºæœ€ä½³promptå‡½æ•° fprompt(x)f_{prompt}(\\mathbf{x})fpromptâ€‹(x) çš„è¿‡ç¨‹ï¼Œéœ€è¦è€ƒè™‘ä¸¤ä¸ªå…³é”®ç‚¹ï¼š prompt shape å’Œ manual/automated åœ¨ç°æœ‰çš„å·¥ä½œä¸­ï¼ŒPrompt Engineeringæ˜¯ä¸€ä¸ªå¯»æ‰¾æœ€ä½³prompt templateçš„è¿‡ç¨‹ï¼Œå³prompt template engineering ## Prompt Shape cloze prompts: æ›´é€‚åˆäºä½¿ç”¨Masked LMè§£å†³çš„ä»»åŠ¡ prefix prompts: ç”Ÿæˆä»»åŠ¡ï¼Œæˆ–ä½¿ç”¨æ ‡å‡†è‡ªå›å½’LMè§£å†³çš„ä»»åŠ¡æ›´é€‚åˆ ## Manual Template Engineering æ ¹æ®äººç±»çš„çŸ¥è¯†å’Œç»éªŒæ‰‹åŠ¨åˆ›å»ºç›´è§‚çš„æ¨¡æ¿ï¼Œä»£è¡¨æ€§å·¥ä½œï¼š cloze prompt: Language Models as Knowledge Bases? prefix prompt: Language Models are Few-Shot Learners ## Automated Template Learning æ‰‹åŠ¨åˆ›å»ºçš„æ¨¡æ¿å…·æœ‰ä¸€å®šçš„å‡†ç¡®æ€§ï¼Œä½†æ˜¯ï¼š1. éœ€è¦ä¸€å®šçš„ç»éªŒå’Œæ—¶é—´ï¼Œ2. æœ‰ç»éªŒçš„è®¾è®¡è€…ä¹Ÿæ— æ³•ä¿è¯è®¾è®¡å‡ºæœ€ä½³çš„prompts é’ˆå¯¹è¿™äº›é—®é¢˜ï¼Œæå‡ºäº†è‡ªåŠ¨çš„æ¨¡æ¿è®¾è®¡æ–¹æ³•ï¼Œå¯ä»¥åˆ†ä¸º discrete prompts å’Œ continuous prompts ### Discrete Prompts ç¦»æ•£çš„promptsï¼Œåˆåhard promptsï¼Œè¿™ç±»promptsæ˜¯ä¸€ä¸²å®é™…çš„æ–‡æœ¬ã€‚å®ƒçš„è‡ªåŠ¨è®¾è®¡è¿‡ç¨‹å°±æ˜¯åœ¨ä¸€ä¸ªç¦»æ•£ç©ºé—´ï¼ˆé€šå¸¸æ˜¯è‡ªç„¶è¯­è¨€çŸ­è¯­ï¼‰ä¸­æœç´¢æœ€ä½³çš„æ¨¡æ¿ã€‚ ä¸‹é¢æ˜¯å‡ ç§å…·ä½“çš„æ–¹æ³•ï¼š Prompt Mining: æŒ–æ˜æ–¹æ³•åŸºäºä¸€ç»„ç»™å®šçš„è¾“å…¥ xxx å’Œè¾“å‡º yyy è‡ªåŠ¨å¯»æ‰¾æœ€ä½³çš„æ¨¡æ¿ï¼Œè¯¥æ–¹æ³•ä¸ºåŒ…å« xxx å’Œ yyy çš„å­—ç¬¦ä¸²æŠ“å–ä¸€ä¸ªå¤§å‹è¯­æ–™åº“ï¼Œç„¶åå¯»æ‰¾è¾“å…¥å’Œè¾“å‡ºä¹‹é—´çš„ä¸­é—´è¯æˆ–ä¾èµ–è·¯å¾„ï¼Œé¢‘ç¹å‡ºç°çš„ä¸­é—´è¯æˆ–ä¾èµ–è·¯å¾„å¯ä»¥ä½œä¸ºæ¨¡æ¿ã€‚ How Can We Know What Language Models Know? Prompt Paraphrasing: é€šè¿‡ä¸€ä¸ªç°æœ‰çš„ç§å­promptæ¥å˜æ¢å‡ºä¸€ç»„å€™é€‰promptsï¼Œç„¶åé€‰æ‹©å…¶ä¸­è·å¾—ç›®æ ‡ä»»åŠ¡æœ€é«˜è®­ç»ƒå‡†ç¡®æ€§çš„ã€‚ paraphrasing æœ‰å¾ˆå¤šç§å…·ä½“æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š ç¿»è¯‘æˆåˆ«çš„è¯­è¨€å†ç¿»è¯‘å›æ¥ How Can We Know What Language Models Know? ä½¿ç”¨åŒä¹‰è¯æ›¿æ¢éƒ¨åˆ†è¯ BARTScore: Evaluating Generated Text as Text Generation ä½¿ç”¨ä¸“é—¨ä¼˜åŒ–è¿‡çš„ç¥ç»ç½‘ç»œé‡å†™prompts BERTese: Learning to Speak to BERT è¿˜å¯ä»¥åœ¨è¾“å…¥æ–‡æœ¬ xxx æ”¾è¿›ç§å­æ¨¡æ¿åå†æ‰§è¡Œparaphrasingï¼Œè¿™æ ·å¯ä»¥ä¸ºæ¯ä¸ªè¾“å…¥ç”Ÿæˆä¸€ä¸ªä¸åŒçš„paraphraseï¼š BERTese: Learning to Speak to BERT Gradient-based Search:å¯¹ä¸€ä¸ªpromptä¸­çš„æ‰€æœ‰tokenè¿›è¡Œæ¢¯åº¦è¿­ä»£æœç´¢ã€‚ Universal Adversarial Triggers for Attacking and Analyzing NLP AutoPrompt: Eliciting Knowledge from Language Models with Automatically Generated Prompts Prompt Generation : æŠŠç”Ÿæˆpromptsçš„ä»»åŠ¡çœ‹ä½œæ˜¯ä¸€ä¸ªæ–‡æœ¬ç”Ÿæˆä»»åŠ¡ï¼Œä½¿ç”¨ æ ‡å‡†è‡ªç„¶è¯­è¨€ç”Ÿæˆæ¨¡å‹ è¿›è¡Œç”Ÿæˆ Making Pre-trained Language Models Better Few-shot Learners PADA: A Prompt-based Autoregressive Approach for Adaptation to Unseen Domains Prompt Scoring : Commonsense Knowledge Mining from Pretrained Models ### Continuous Prompts promptsæ²¡æœ‰å¿…è¦é™åˆ¶åœ¨è‡ªç„¶è¯­è¨€çš„èŒƒå›´å†…ï¼Œè¿ç»­çš„promptså¯ä»¥ç›´æ¥å­˜åœ¨äºæ¨¡å‹çš„åµŒå…¥ç©ºé—´å†…ï¼Œè¿™ç±»promptsè¢«ç§°ä¸ºcontinuous promptsæˆ–soft promptsã€‚å…·ä½“æ¥è¯´ï¼Œè¿ç»­çš„promptså»é™¤äº†ä¸¤æ¡é™åˆ¶ï¼š1. promptsçš„å†…å®¹å¿…é¡»æ˜¯è‡ªç„¶è¯­è¨€ï¼Œ 2. æ¨¡æ¿å¿…é¡»è¢«é¢„è®­ç»ƒæ¨¡å‹çš„å‚æ•°å‚æ•°åŒ–ã€‚æ¨¡æ¿æœ‰è‡ªå·±çš„å¯è®­ç»ƒå‚æ•°å¯ä»¥ä½¿ç”¨ä¸‹æ¸¸ä»»åŠ¡çš„æ•°æ®è®­ç»ƒã€‚ ä¸‹é¢æ˜¯å‡ ç§å…·ä½“çš„æ–¹æ³•ï¼š Prefix Tuning : ä¿æŒLMçš„å‚æ•°ä¸å˜ï¼Œå°†ä¸€ç³»åˆ—ä¸ä»»åŠ¡å¼ºç›¸å…³çš„å‘é‡æ·»åŠ åˆ°è¾“å…¥ä¸­ã€‚æ•°å­¦ä¸Šæ¥è®²ï¼Œè¿™åŒ…æ‹¬åœ¨ç»™å®šå¯è®­ç»ƒçš„å‰ç¼€çŸ©é˜µ MÏ•M_{\\phi}MÏ•â€‹ å’Œå‚æ•°ä¸º Î¸\\thetaÎ¸ çš„LMçš„æƒ…å†µä¸‹ä¼˜åŒ–ä»¥ä¸‹ç±»å¯¹æ•°ç›®æ ‡ï¼š maxÏ•logP(yâˆ£x;Î¸;Ï•)=maxÏ•Î£yilogP(yiâˆ£h&lt;i;Î¸;Ï•)max_{\\phi}log P(\\mathbf{y}|\\mathbf{x}; \\theta; \\phi) = max_{\\phi}\\Sigma_{y_i}log P(y_i|h_{&lt;i}; \\theta; \\phi) maxÏ•â€‹logP(yâˆ£x;Î¸;Ï•)=maxÏ•â€‹Î£yiâ€‹â€‹logP(yiâ€‹âˆ£h&lt;iâ€‹;Î¸;Ï•) Prefix-Tuning: Optimizing Continuous Prompts for Generation The Power of Scale for Parameter-Efficient Prompt Tuning Tuning Initialized with Discrete Prompts : ä½¿ç”¨ç¦»æ•£æ–¹æ³•ç”Ÿæˆçš„promptsæ¥åˆå§‹åŒ–æœç´¢ã€‚ ä½¿ç”¨ç¦»æ•£æ–¹æ³•ç”Ÿæˆè™šæ‹Ÿtoken: Factual Probing Is [MASK]: Learning vs. Learning to Recall ä½¿ç”¨ç¦»æ•£æ–¹æ³•ç”Ÿæˆåˆå§‹æ¨¡æ¿é›†ï¼š Learning How to Ask: Querying LMs with Mixtures of Soft Prompts æ ¹æ®æ‰‹åŠ¨æ„å»ºæ¨¡æ¿çš„ç»“æ„ç”Ÿæˆè¿ç»­æ¨¡æ¿ï¼š WARP: Word-level Adversarial ReProgramming Hard-Soft Prompt Hybrid Tuning : æ··åˆçš„æ–¹æ³•ï¼Œåœ¨å›ºå®šçš„hard prompt templateä¸­æ’å…¥ä»¥ä¸‹å¯å˜å‚æ•°ã€‚é™¤æ­¤ä¹‹å¤–ï¼š åœ¨æ¨¡æ¿ä¸­æ’å…¥ä»»åŠ¡ç›¸å…³çš„é”šè®°ï¼š ä½¿ç”¨äººå·¥æ„å»ºçš„å­æ¨¡æ¿æ¥æ„å»ºæ¨¡æ¿ï¼Œå®ç°åœ¨é€»è¾‘è§„åˆ™ä¸‹æ„å»ºæ¨¡æ¿ï¼š PTR: Prompt Tuning with Rules for Text Classification # Answer Engineering Answer Engineeringç”¨äºæœç´¢ç­”æ¡ˆç©ºé—´ Z\\mathcal{Z}Z ï¼Œå¹¶å°†ç­”æ¡ˆæ˜ å°„ä¸ºè¾“å‡º Y\\mathcal{Y}Yã€‚ä¸»è¦éœ€è¦è€ƒè™‘çš„æ˜¯ answer shape å’Œ answer design method ## Answer Shape Answer Shapeå³ç­”æ¡ˆçš„ç²’åº¦ï¼Œä¸»è¦æœ‰ä¸‰ç§ï¼š Tokens : é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹çš„è¯æ±‡è¡¨ä¸­çš„ä¸€ä¸ªè¯æˆ–ä¸€ä¸ªå­é›† Span : A short multi-token span, é€šå¸¸å’Œcloze promptså…±åŒä½¿ç”¨ Sentence : ä¸€ä¸ªå¥å­æˆ–æ–‡æ¡£ï¼Œé€šå¸¸å’Œprefix promptså…±åŒä½¿ç”¨ Answer Shapeçš„é€‰æ‹©é€šå¸¸è·Ÿä»»åŠ¡ç›¸å…³ï¼Œ Tokens å’Œ Span å¸¸ç”¨äºåˆ†ç±»ä»»åŠ¡æˆ–å…³ç³»æŠ½å–ï¼Œå‘½åå®ä½“è¯†åˆ«ä»»åŠ¡ã€‚æ›´é•¿çš„ Sentence å¸¸ç”¨äºè¯­è¨€ç”Ÿæˆä»»åŠ¡æˆ–å¤šé€‰æ‹©é—®ç­”ä»»åŠ¡ã€‚ ## Answer Space Design Methods å³è®¾è®¡åˆé€‚çš„ç­”æ¡ˆç©ºé—´ Z\\mathcal{Z}Z ä»¥åŠåˆé€‚çš„æ˜ å°„åˆ°è¾“å‡º Y\\mathcal{Y}Y çš„æ–¹æ³• ### Manual Design Unconstrained Spaces : æ— çº¦æŸç©ºé—´ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œ Z\\mathcal{Z}Z æ˜¯ä¸€ä¸ªæ‰€æœ‰tokenï¼Œå›ºå®šé•¿åº¦çš„spanæˆ–token åºåˆ—çš„ç©ºé—´ Constrained Spaces : çº¦æŸç©ºé—´ã€‚æ–‡æœ¬åˆ†ç±»ï¼Œå®ä½“è¯†åˆ«ç­‰ä»»åŠ¡ä¸‹å¯èƒ½çš„è¾“å‡ºè¢«é™åˆ¶åœ¨ä¸€ä¸ªèŒƒå›´å†… ### Auto Design Discrete Answer Search Answer Paraphrasing : ç»™å®šä¸€ä¸ªåˆå§‹ç­”æ¡ˆç©ºé—´ Zâ€²\\mathcal{Z}&#x27;Zâ€² ï¼Œç„¶ååˆ©ç”¨paraphrasingæ–¹æ³•æ¥æ‰©å±•è¿™ä¸ªç©ºé—´ How Can We Know When Language Models Know? On the Calibration of Language Models for Question Answering Prune-then-Search : Making Pre-trained Language Models Better Few-shot Learners Label Decomposition : AdaPrompt: Adaptive Prompt-based Finetuning for Relation Extraction Continuous Answer Search WARP: Word-level Adversarial ReProgramming # Multi-Prompt Learning åœ¨æŸäº›é—®é¢˜ä¸­ä½¿ç”¨å¤šä¸ªPromptèƒ½å¤Ÿæé«˜æœ‰æ•ˆæ€§ã€‚ ## Prompt-ensembling æ¨ç†æ—¶å¯¹äºåŒä¸€ä¸ªè¾“å…¥ä½¿ç”¨å¤šä¸ªæœªè§£ç­”çš„promptsæ¥è¿›è¡Œé¢„æµ‹ï¼Œè¿™ç§ç»¼åˆç­–ç•¥å¯ä»¥ï¼š åˆ©ç”¨ä¸åŒæç¤ºä¹‹é—´çš„äº’è¡¥ å› ä¸ºé€‰æ‹©ä¸€ä¸ªæ•ˆæœæœ€å¥½çš„æç¤ºéå¸¸æœ‰æŒ‘æˆ˜æ€§ï¼Œè¿™æ ·å¯ä»¥é™ä½ prompt engineering çš„æˆæœ¬ ç¨³å®šä¸‹æ¸¸ä»»åŠ¡çš„æ€§èƒ½è¡¨ç° ç›®å‰ä¸»è¦çš„å‡ ä¸ªæ–¹å‘ï¼š Uniform averaging : å–ä¸åŒæç¤ºçš„æ¦‚ç‡å¹³å‡å€¼ï¼Œæ˜¯æœ€ä¸ºç›´è§‚çš„æ–¹æ³•ã€‚å…·ä½“æ¥è¯´ï¼Œæ¦‚ç‡æ˜¯ï¼š P(zâˆ£x):=1KÎ£iKP(zâˆ£fprompt,i(x))P(\\mathbb{z}|\\mathbb{x}):=\\frac{1}{K}\\Sigma_i^KP(\\mathbb{z}|f_{prompt, i}(\\mathbb{x}))P(zâˆ£x):=K1â€‹Î£iKâ€‹P(zâˆ£fprompt,iâ€‹(x))ï¼Œå…¶ä¸­ fprompt,i(â‹…)f_{prompt, i}(\\cdot)fprompt,iâ€‹(â‹…) æ˜¯ç¬¬ iii ä¸ªprompt Exploiting Cloze Questions for Few Shot Text Classification and Natural Language Inference BARTScore: Evaluating Generated Text as Text Generation Weighted averaging : å¹³å‡çš„æ–¹æ³•å¯èƒ½æ˜¯æ¬¡ä¼˜çš„ï¼Œæœ‰ä¸€äº›ç ”ç©¶ä½¿ç”¨åŠ æƒå¹³å‡çš„prompt ensembling Exploiting Cloze Questions for Few Shot Text Classification and Natural Language Inference Majority voting : å¯¹äºåˆ†ç±»ä»»åŠ¡ï¼Œå¯ä»¥ç»“åˆæŠ•ç¥¨çš„æ–¹æ³• The Power of Scale for Parameter-Efficient Prompt Tuning WARP: Word-level Adversarial ReProgramming Knowledge distillation ï¼ˆçŸ¥è¯†è’¸é¦ï¼‰: ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹æ ‡è®°æ•°æ®ï¼Œç”¨äºè®­ç»ƒå¦ä¸€ä¸ªæ¨¡å‹(è’¸é¦çŸ¥è¯†) Exploiting Cloze Questions for Few Shot Text Classification and Natural Language Inference Itâ€™s Not Just Size That Matters: Small Language Models Are Also Few-Shot Learners Prompt ensembling for text generation : è¿™æ–¹é¢çš„å·¥ä½œè¾ƒå°‘ï¼Œä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ ‡å‡†æ–¹æ³•åŸºäºä¸‹ä¸€ä¸ªè¯æ¦‚ç‡æ¥ç”Ÿæˆè¾“å‡ºï¼š P(ztâˆ£x,z&lt;t):=1KÎ£iKP(ztâˆ£fprompt,i(x),z&lt;t)P(z_t|\\mathbb{x}, z_{&lt;t}):=\\frac{1}{K}\\Sigma_i^KP(z_t|f_{prompt, i(\\mathbb{x})}, z_{&lt;t})P(ztâ€‹âˆ£x,z&lt;tâ€‹):=K1â€‹Î£iKâ€‹P(ztâ€‹âˆ£fprompt,i(x)â€‹,z&lt;tâ€‹) Few-Shot Text Generation with Pattern-Exploiting Training ## Prompt Augmentation æç¤ºå¢å¼ºï¼Œæœ‰æ—¶è¢«ç§°ä¸ºç¤ºèŒƒå­¦ä¹ (demonstration learning)ï¼Œå³åœ¨è¾“å…¥ä¸­æä¾›å‡ ç§å·²ç»å›ç­”çš„æç¤º(answered prompts)æ¥å‘LMç¤ºèŒƒå¦‚ä½•ä¸ºè¾“å…¥ x\\mathbb{x}x ç”Ÿæˆè¾“å‡ºã€‚è¿™ç§å°‘é‡çš„ç¤ºèŒƒåˆ©ç”¨äº†å¼ºå¤§çš„è¯­è¨€æ¨¡å‹å­¦ä¹ é‡å¤æ¨¡å¼çš„èƒ½åŠ›ã€‚ prompt augmentationçš„æ€æƒ³å¾ˆç®€å•ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªæ–¹é¢éœ€è¦æ¢ç´¢ï¼š1. Sample Selection 2. Sample Prdering Sample Selection : æ ¹æ®ç¤ºèŒƒç”¨ä¾‹é€‰æ‹©çš„ä¸åŒï¼Œæ¨¡å‹çš„è¡¨ç°å¯èƒ½æ˜¯ä¹±çŒœå’Œstate-of-artçš„åŒºåˆ«ã€‚ Making Pre-trained Language Models Better Few-shot Learners What Makes Good In-Context Examples for GPT-333? Natural Instructions: Benchmarking Generalization to New Tasks from Natural Language Instructions Sample Ordering : æç¤ºç”¨ä¾‹çš„é¡ºåºå¯¹æ¨¡å‹çš„è¡¨ç°ä¹Ÿååˆ†é‡è¦ Fantastically Ordered Prompts and Where to Find Them: Overcoming Few-Shot Prompt Order Sensitivity Reordering Examples Helps during Priming-based Few-Shot Learning ## Prompt Composition å¯¹äºå¯ç»„åˆçš„ä»»åŠ¡ï¼Œå³å¯ä»¥ç”±æ›´åŸºæœ¬çš„å­ä»»åŠ¡ç»„åˆè€Œæˆçš„ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨æç¤ºé‡ç»„ã€‚å³ä½¿ç”¨å¤šä¸ªå­æç¤ºï¼Œæ¯ä¸ªå­æç¤ºé’ˆå¯¹ä¸€ä¸ªå­ä»»åŠ¡ï¼Œç„¶ååŸºäºå­æç¤ºå®šä¹‰ä¸€ä¸ªç»„åˆæç¤ºã€‚ä¾‹å¦‚å¯¹äºå…³ç³»æå–ä»»åŠ¡ï¼Œå¯ä»¥é‡ç»„ä¸ºè¯†åˆ«å®ä½“ç‰¹å¾ä»»åŠ¡å’Œå…³ç³»åˆ†ç±»ä»»åŠ¡ã€‚ PTR: Prompt Tuning with Rules for Text Classification ## Prompt Decomposition å¯¹äºå¦‚åºåˆ—æ ‡è®°çš„ä»»åŠ¡ï¼Œéœ€è¦å¯¹åŒä¸€ä¸ªæ ·æœ¬åšå¤šæ¬¡é¢„æµ‹ã€‚æ­¤æ—¶è¾ƒéš¾ç»™è¾“å…¥ç›´æ¥å®šä¹‰ä¸€ä¸ªæ•´ä½“çš„æç¤ºã€‚ä¸€ä¸ªå¯è¡Œçš„æ–¹æ³•æ˜¯å°†æ•´ä½“åˆ†è§£ä¸ºä¸åŒçš„å­æç¤ºï¼Œç„¶ååˆ†åˆ«å›ç­”æ¯ä¸ªå­æç¤ºã€‚å¦‚åœ¨NERä»»åŠ¡ä¸­ï¼š Template-Based Named Entity Recognition Using BART ä¸Šé¢æåˆ°çš„å››ç§å¤šæç¤ºæ–¹æ³•ç¤ºæ„å›¾å¦‚ä¸‹ï¼š # è®­ç»ƒç­–ç•¥ ## Training Settings è®¸å¤šæƒ…å†µä¸‹ï¼Œæç¤ºæ–¹æ³•å¯ä»¥åœ¨æ²¡æœ‰é¢å¤–è®­ç»ƒçš„æ¡ä»¶ä¸‹ä½¿ç”¨ï¼Œè¿™ç§æƒ…å†µç§°ä¸ºé›¶æ ·æœ¬ (zero-shot)ã€‚ é™¤ zero-shot å¤–ï¼Œè¿˜æœ‰ full-data learning å’Œ few-shot learning ã€‚ç‰¹åˆ«æ˜¯åœ¨ few-shot learning ä¸­ï¼Œpromptæ–¹æ³•ååˆ†é€‚ç”¨ ## å‚æ•°æ›´æ–°æ–¹æ³• åœ¨åŸºäºæç¤ºçš„ä¸‹æ¸¸ä»»åŠ¡å­¦ä¹ ä¸­ï¼Œé€šå¸¸æœ‰ä¸¤ç§å‚æ•°ï¼šé¢„è®­ç»ƒæ¨¡å‹çš„å‚æ•°å’Œæç¤ºå‚æ•°ã€‚æ ¹æ® 1. é¢„è®­ç»ƒæ¨¡å‹çš„å‚æ•°æ˜¯å¦æ›´æ–°ï¼Œ2. æ˜¯å¦å¼•å…¥æç¤ºå‚æ•°å’Œ3. æç¤ºå‚æ•°æ˜¯å¦æ›´æ–°ï¼Œå¯ä»¥æŠŠå‚æ•°å‚æ•°æ›´æ–°æ–¹æ³•åˆ†ä¸ºä»¥ä¸‹äº”ç±»ï¼š **Promptless Fine-tuningï¼š**ä¸ä½¿ç”¨promptçš„æ¨¡å¼ï¼Œä»…æ›´æ–°è¯­è¨€æ¨¡å‹çš„å‚æ•°ã€‚ ä¼˜ç‚¹ï¼šç®€å•ï¼Œä¸éœ€è¦è®¾è®¡æç¤ºï¼Œæ›´å®¹æ˜“é€‚é…è¾ƒå¤§çš„è®­ç»ƒé›† æ¨¡å‹å¯èƒ½ä¼šè¿‡æ‹Ÿåˆæˆ–è€…åœ¨å°å‹æ•°æ®é›†ä¸Šä¸å¤Ÿç¨³å®šã€‚å¯èƒ½å‘ç”Ÿç¾éš¾æ€§é—å¿˜(catastrophic forgetting)ï¼Œå³å¾®è°ƒåçš„æ¨¡å‹æ— æ³•åšåˆ°å¾®è°ƒå‰å¯ä»¥åšåˆ°çš„äº‹ Tuning-free Prompting: å³ä¸è¿›è¡Œé¢å¤–è®­ç»ƒï¼Œç›´æ¥åˆ©ç”¨é¢„è®­ç»ƒæ¨¡å‹é…åˆpromptå®ç°åŠŸèƒ½ ä¼˜ç‚¹ï¼šé«˜æ•ˆï¼Œæ²¡æœ‰å‚æ•°æ›´æ–°çš„è¿‡ç¨‹ï¼Œä¸ä¼šå‘ç”Ÿç¾éš¾æ€§é—å¿˜ï¼Œé€‚åˆé›¶æ ·æœ¬åœºæ™¯ ç¼ºç‚¹ï¼špromptæ˜¯æä¾›ç»™æ¨¡å‹çš„å”¯ä¸€ä¸ä»»åŠ¡ç›¸å…³çš„ä¿¡æ¯ï¼Œå› æ­¤éœ€è¦ç¹é‡çš„prompt engineeringæ¥ä¿è¯å‡†ç¡®æ€§ Fixed-LM Prompt Tuning: å¼•å…¥é¢å¤–çš„prompt-relevant å‚æ•°ï¼Œç„¶ååœ¨è®­ç»ƒæ—¶ä»…æ›´æ–°è¯¥å‚æ•°ï¼Œä¿æŒé¢„è®­ç»ƒæ¨¡å‹ä¸å˜ ä¼˜ç‚¹ï¼šå¯ä»¥ç»´æŒé¢„è®­ç»ƒæ¨¡å‹ä¸­çš„çŸ¥è¯†ï¼Œä¸ä¼šå‘ç”Ÿç¾éš¾æ€§é—å¿˜ï¼Œæ›´é€‚åˆå°æ ·æœ¬åœºæ™¯ã€‚é€šå¸¸ç²¾ç¡®æ€§ä¼šä¼˜äºtuning-free prompting ç¼ºç‚¹ï¼šä¸é€‚åˆé›¶æ ·æœ¬åœºæ™¯ï¼Œåœ¨å¤§é‡æ•°æ®çš„åœºæ™¯ä¸‹å—è¡¨å¾èƒ½åŠ›çš„é™åˆ¶ã€‚éœ€è¦è¿›è¡Œprompting engineeringã€‚prompté€šå¸¸ä¸æ˜¯äººç±»å¯è¯»çš„ Fixed-prompt LM Tuning: å³åœ¨promptless fine-tuningæ¨¡å¼ä¸‹å¢åŠ å›ºå®šçš„promptå‚æ•°ï¼Œåœ¨å°æ ·æœ¬åœºæ™¯ä¸‹å¯èƒ½å¸¦æ¥æå‡ ä¼˜ç‚¹ï¼šprompt/answer engineeringæ›´åŠ å…¨é¢åœ°æè¿°ç‰¹å®šä»»åŠ¡ï¼Œå¯ä»¥è¿›è¡Œæ›´æœ‰æ•ˆçš„å­¦ä¹  ç¼ºç‚¹ï¼šä»ç„¶éœ€è¦prompt/answer engineeringï¼Œåœ¨ä¸€ä¸ªä¸‹æ¸¸ä»»åŠ¡ä¸Šçš„å¾®è°ƒå¯èƒ½å¯¹å¦ä¸€ä¸ªä»»åŠ¡æ— æ•ˆ Prompt+LM Tuning: æ—¢å¼•å…¥äº†prompt-relevantå‚æ•°ï¼ŒåˆåŒæ—¶æ›´æ–°è¯­è¨€æ¨¡å‹å’Œå¼•å…¥çš„å‚æ•°ï¼ˆéƒ¨åˆ†æˆ–å…¨éƒ¨çš„ï¼‰ ä¼˜ç‚¹ï¼šè¡¨å¾èƒ½åŠ›æœ€å¼ºçš„æ–¹æ³•ï¼Œé€‚åˆå¤šæ ·æœ¬åœºæ™¯ ç¼ºç‚¹ï¼šéœ€è¦è®­ç»ƒå’Œå‚¨å­˜æ‰€æœ‰çš„å‚æ•°ã€‚åœ¨å°æ•°æ®é›†ä¸Šå®¹æ˜“è¿‡æ‹Ÿåˆ","categories":[{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"}],"tags":[{"name":"PLM","slug":"PLM","permalink":"https://blog.zhuwenq.cc/tags/PLM/"},{"name":"NLP","slug":"NLP","permalink":"https://blog.zhuwenq.cc/tags/NLP/"},{"name":"Prompt","slug":"Prompt","permalink":"https://blog.zhuwenq.cc/tags/Prompt/"},{"name":"Survey","slug":"Survey","permalink":"https://blog.zhuwenq.cc/tags/Survey/"}]},{"title":"Ubuntu(WSL2) ç¼–è¯‘å®‰è£…Qt-5.15.2","slug":"Ubuntu-WSL2-ç¼–è¯‘å®‰è£…Qt-5-15-2","date":"2021-08-02T07:24:43.000Z","updated":"2023-06-21T06:51:28.932Z","comments":true,"path":"Ubuntu-WSL2-ç¼–è¯‘å®‰è£…Qt-5-15-2/","link":"","permalink":"https://blog.zhuwenq.cc/Ubuntu-WSL2-%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Qt-5-15-2/","excerpt":"ä»¥å¾€éƒ½æ˜¯é€šè¿‡ç¦»çº¿å®‰è£…åŒ…æˆ–è€…åœ¨çº¿å®‰è£…å™¨å®‰è£…Qtï¼Œè‡ªåŠ¨Qtä¸æä¾›ç¦»çº¿å®‰è£…åŒ…ä»¥åï¼Œåœ¨æŸäº›æ— æ³•è”ç½‘çš„åœºæ™¯ä¸‹åªèƒ½é€šè¿‡æºç ç¼–è¯‘å®‰è£…ã€‚æœ¬æ¬¡åœ¨ WSL çš„ç¯å¢ƒä¸‹è™½ç„¶å¯ä»¥è”ç½‘ï¼Œä½†æƒå½“ä¸€æ¬¡ä½“éªŒç¼–è¯‘å®‰è£…çš„æœºä¼šã€‚","text":"ä»¥å¾€éƒ½æ˜¯é€šè¿‡ç¦»çº¿å®‰è£…åŒ…æˆ–è€…åœ¨çº¿å®‰è£…å™¨å®‰è£…Qtï¼Œè‡ªåŠ¨Qtä¸æä¾›ç¦»çº¿å®‰è£…åŒ…ä»¥åï¼Œåœ¨æŸäº›æ— æ³•è”ç½‘çš„åœºæ™¯ä¸‹åªèƒ½é€šè¿‡æºç ç¼–è¯‘å®‰è£…ã€‚æœ¬æ¬¡åœ¨ WSL çš„ç¯å¢ƒä¸‹è™½ç„¶å¯ä»¥è”ç½‘ï¼Œä½†æƒå½“ä¸€æ¬¡ä½“éªŒç¼–è¯‘å®‰è£…çš„æœºä¼šã€‚ é¦–å…ˆä»qtçš„IOç½‘ç«™æˆ–è€…æ¸…åé•œåƒç«™æˆ–è€…å…¶ä»–ä»»ä½•æ‰˜ç®¡æœ‰qtæºç çš„é•œåƒç«™ä¸‹è½½æºä»£ç ï¼ˆä»¥5.15.2ä¸ºä¾‹ï¼‰ã€‚ç„¶åéœ€è¦å‡†å¤‡ç¼–è¯‘ç¯å¢ƒï¼Œè¿™é‡Œå»ºè®®å‚è€ƒQtçš„ç¼–è¯‘æŒ‡å¯¼æ¥å®‰è£…ç¼–è¯‘æ‰€éœ€è¦çš„ç¯å¢ƒã€‚ å®‰è£…å®Œæˆåï¼Œå°±å¯ä»¥å¼€å§‹é…ç½®æ„å»ºé€‰é¡¹ã€‚è¿™é‡Œå»ºè®®åœ¨æºä»£ç çš„å¹³è¡Œç›®å½•ä¸­è¿›è¡Œï¼Œå³å‡è®¾æºä»£ç çš„ç›®å½•æ˜¯ï¼š~/qt-srcï¼Œé‚£ä¹ˆå»ºè®®åœ¨ç±»ä¼¼ ~/qt-build çš„ç›®å½•ä¸­è¿›è¡Œã€‚åœ¨æ„å»ºç›®å½•ä¸­ï¼Œè¿è¡Œ ./configure è„šæœ¬å¯ä»¥è¿›è¡Œç¼–è¯‘å‰çš„é…ç½®ï¼Œconfigure è„šæœ¬æœ‰å¾ˆå¤šå¯é€‰çš„å‚æ•°ï¼Œå…·ä½“çš„åˆ—è¡¨å¯ä»¥æ‰“å¼€æºç ç›®å½•ä¸‹çš„ qtbase/config_help.txt æŸ¥çœ‹ã€‚ configure è„šæœ¬æ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœè„šæœ¬çš„è¾“å‡ºæ²¡æœ‰æç¤ºç¯å¢ƒçš„ä¸æ”¯æŒï¼Œå°±å¯ä»¥æ‰§è¡Œ make å¼€å§‹ç¼–è¯‘ã€‚è¿™é‡Œå› è¯¥éœ€è¦ç¼–è¯‘ä¸€å¤©å·¦å³ï¼Œæˆ‘çš„æœºå™¨ä¸Šå°±ä»ä¸‹åˆä¸‰ç‚¹åŠç¼–è¯‘åˆ°ç¬¬äºŒå¤©çš„åäºŒç‚¹å››åï¼Œå¤§çº¦21å°æ—¶ã€‚ ç¼–è¯‘å®Œæˆåå°±å¯ä»¥æ‰§è¡Œ make install è¿›è¡Œå®‰è£…ï¼Œé»˜è®¤çš„å®‰è£…ç›®å½•æ˜¯ /usr/local/Qt-5.15.2ã€‚æ­¤æ—¶æ‰§è¡Œ qmake æ˜¯æ‰¾ä¸åˆ°ç›®æ ‡çš„ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ åˆ° PATH æˆ–è€…ä½¿ç”¨ qtchooser å·¥å…·ã€‚ä»¥ qtchooser ä¸ºä¾‹ï¼Œå®ƒæ‰€é»˜è®¤çš„qtè·¯å¾„åº”è¯¥æ˜¯ /usr/lib/x86_64-linux-gnu/qt5ã€‚å› æ­¤éœ€è¦æ›´æ”¹å®ƒçš„é…ç½®æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶ /usr/lib/x86_64-linux-gnu/qt-default/qtchooser/default.confï¼Œå°†å†…å®¹æ”¹æˆï¼š 12/usr/local/Qt-5.15.2/bin/usr/local/Qt-5.15.2/lib å°±å®Œæˆäº†ã€‚","categories":[{"name":"è®°å½•å¤‡å¿˜","slug":"è®°å½•å¤‡å¿˜","permalink":"https://blog.zhuwenq.cc/categories/%E8%AE%B0%E5%BD%95%E5%A4%87%E5%BF%98/"}],"tags":[{"name":"Qt","slug":"Qt","permalink":"https://blog.zhuwenq.cc/tags/Qt/"}]},{"title":"IEEE754æµ®ç‚¹æ•°","slug":"IEEE754æµ®ç‚¹æ•°","date":"2021-07-31T12:10:57.000Z","updated":"2023-06-21T06:51:28.792Z","comments":true,"path":"IEEE754æµ®ç‚¹æ•°/","link":"","permalink":"https://blog.zhuwenq.cc/IEEE754%E6%B5%AE%E7%82%B9%E6%95%B0/","excerpt":"äºŒè¿›åˆ¶å°æ•° è€ƒè™‘åè¿›åˆ¶ä¸‹çš„å°æ•°è¡¨ç¤ºï¼š[dmdmâˆ’1â€¦d1d0â‹…dâˆ’1dâˆ’2â€¦dâˆ’n][d_m d_{mâˆ’1}â€¦d_1 d_0\\cdot d_{âˆ’1} d_{âˆ’2}â€¦d_{âˆ’n}][dmâ€‹dmâˆ’1â€‹â€¦d1â€‹d0â€‹â‹…dâˆ’1â€‹dâˆ’2â€‹â€¦dâˆ’nâ€‹]ï¼Œå…¶ä¸­æ¯ä¸ªåè¿›åˆ¶æ•° did_idiâ€‹ å–å€¼èŒƒå›´æ˜¯ 0 90~90 9ã€‚è¿™ä¸ªè¡¨è¾¾å¼æ‰€æè¿°çš„æ•°å€¼ ddd çš„å®šä¹‰ä¸ºï¼šd=Î£i=âˆ’nm10iÃ—did= \\Sigma^m_{i = -n}10^i\\times d_id=Î£i=âˆ’nmâ€‹10iÃ—diâ€‹ ã€‚æ•°å­—æƒçš„å®šä¹‰ä¸å°æ•°ç‚¹ç›¸å…³ï¼Œåœ¨å°æ•°ç‚¹çš„å·¦ä¾§ï¼Œæ•°å­—çš„æƒå€¼æ˜¯10çš„æ­£å¹‚ï¼Œå¾—åˆ°æ•´æ•°å€¼ã€‚è€Œå°æ•°ç‚¹çš„å³ä¾§æ•°å­—æƒå€¼æ˜¯10çš„è´Ÿå¹‚ï¼Œå¾—åˆ°å°æ•°å€¼ã€‚å¦‚ 12.341012.34_{10}12.3410â€‹ è¡¨ç¤ºæ•°å­— 1Ã—101+2Ã—100+3Ã—10âˆ’1+4Ã—10âˆ’2=12341001 Ã— 10^1 + 2 Ã— 10^0 + 3 Ã— 10^{âˆ’1} + 4 Ã— 10^{âˆ’2} = 12\\frac{34}{100}1Ã—101+2Ã—100+3Ã—10âˆ’1+4Ã—10âˆ’2=1210034â€‹ ã€‚ ç±»ä¼¼åœ°ï¼Œè€ƒè™‘ä¸€ä¸ªå½¢å¦‚ [bmbmâˆ’1â€¦b1b0â‹…bâˆ’1bâˆ’2â€¦bâˆ’n][b_m b_{mâˆ’1}â€¦b_1 b_0\\cdot b_{âˆ’1} b_{âˆ’2}â€¦b_{âˆ’n}][bmâ€‹bmâˆ’1â€‹â€¦b1â€‹b0â€‹â‹…bâˆ’1â€‹bâˆ’2â€‹â€¦bâˆ’nâ€‹] çš„è¡¨è¾¾å¼ï¼Œå…¶ä¸­çš„æ¯ä¸ªäºŒè¿›åˆ¶æ•°å­— bib_ibiâ€‹ çš„å–å€¼èŒƒå›´æ˜¯ 000 å’Œ 111ï¼Œè¿™ç§è¡¨ç¤ºæ–¹æ³•è¡¨ç¤ºçš„æ•°å®šä¹‰ä¸ºï¼šb=Î£i=âˆ’nm2iÃ—bib=\\Sigma_{i=âˆ’n}^m 2^i Ã— b_ib=Î£i=âˆ’nmâ€‹2iÃ—biâ€‹ ã€‚åŒæ ·çš„ï¼Œå°æ•°ç‚¹çš„å·¦ä¾§æ•°å­—æƒå€¼ä¸º 222 çš„æ­£å¹‚ï¼Œå³ä¾§æ•°å­—æƒå€¼ä¸º 222 çš„è´Ÿå¹‚ã€‚å¦‚ 101.112101.11_2101.112â€‹ è¡¨ç¤ºæ•°å­— 1Ã—22+0Ã—21+1Ã—20+1Ã—2âˆ’1+1Ã—2âˆ’2=5341 Ã— 2^2 + 0 Ã— 2^1 + 1 Ã— 2^0 + 1 Ã— 2^{âˆ’1} + 1 Ã— 2^{âˆ’2} = 5\\frac{3}{4}1Ã—22+0Ã—21+1Ã—20+1Ã—2âˆ’1+1Ã—2âˆ’2=543â€‹ ã€‚è¿™ç§è¡¨ç¤ºæ³•ç§°ä¸ºæµ®ç‚¹æ•°çš„å®šç‚¹è¡¨ç¤ºæ³•ã€‚ å¦‚æœä»…è€ƒè™‘æœ‰é™é•¿åº¦çš„ç¼–ç ï¼Œé‚£ä¹ˆä¸Šè¿°åè¿›åˆ¶å°æ•°æ— æ³•å‡†ç¡®è¡¨ç¤ºå¦‚ 1/3,5/71/3,5/71/3,5/7 è¿™æ ·çš„æ•°ã€‚ç±»ä¼¼åœ°ï¼Œå°æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ³•ä¹Ÿæ™ºèƒ½è¡¨ç¤ºå…·æœ‰ xÃ—2yxÃ—2^yxÃ—2y å½¢å¼çš„æ•°ï¼Œå…¶ä»–çš„å€¼åªèƒ½è¿‘ä¼¼è¡¨ç¤ºã€‚","text":"äºŒè¿›åˆ¶å°æ•° è€ƒè™‘åè¿›åˆ¶ä¸‹çš„å°æ•°è¡¨ç¤ºï¼š[dmdmâˆ’1â€¦d1d0â‹…dâˆ’1dâˆ’2â€¦dâˆ’n][d_m d_{mâˆ’1}â€¦d_1 d_0\\cdot d_{âˆ’1} d_{âˆ’2}â€¦d_{âˆ’n}][dmâ€‹dmâˆ’1â€‹â€¦d1â€‹d0â€‹â‹…dâˆ’1â€‹dâˆ’2â€‹â€¦dâˆ’nâ€‹]ï¼Œå…¶ä¸­æ¯ä¸ªåè¿›åˆ¶æ•° did_idiâ€‹ å–å€¼èŒƒå›´æ˜¯ 0 90~90 9ã€‚è¿™ä¸ªè¡¨è¾¾å¼æ‰€æè¿°çš„æ•°å€¼ ddd çš„å®šä¹‰ä¸ºï¼šd=Î£i=âˆ’nm10iÃ—did= \\Sigma^m_{i = -n}10^i\\times d_id=Î£i=âˆ’nmâ€‹10iÃ—diâ€‹ ã€‚æ•°å­—æƒçš„å®šä¹‰ä¸å°æ•°ç‚¹ç›¸å…³ï¼Œåœ¨å°æ•°ç‚¹çš„å·¦ä¾§ï¼Œæ•°å­—çš„æƒå€¼æ˜¯10çš„æ­£å¹‚ï¼Œå¾—åˆ°æ•´æ•°å€¼ã€‚è€Œå°æ•°ç‚¹çš„å³ä¾§æ•°å­—æƒå€¼æ˜¯10çš„è´Ÿå¹‚ï¼Œå¾—åˆ°å°æ•°å€¼ã€‚å¦‚ 12.341012.34_{10}12.3410â€‹ è¡¨ç¤ºæ•°å­— 1Ã—101+2Ã—100+3Ã—10âˆ’1+4Ã—10âˆ’2=12341001 Ã— 10^1 + 2 Ã— 10^0 + 3 Ã— 10^{âˆ’1} + 4 Ã— 10^{âˆ’2} = 12\\frac{34}{100}1Ã—101+2Ã—100+3Ã—10âˆ’1+4Ã—10âˆ’2=1210034â€‹ ã€‚ ç±»ä¼¼åœ°ï¼Œè€ƒè™‘ä¸€ä¸ªå½¢å¦‚ [bmbmâˆ’1â€¦b1b0â‹…bâˆ’1bâˆ’2â€¦bâˆ’n][b_m b_{mâˆ’1}â€¦b_1 b_0\\cdot b_{âˆ’1} b_{âˆ’2}â€¦b_{âˆ’n}][bmâ€‹bmâˆ’1â€‹â€¦b1â€‹b0â€‹â‹…bâˆ’1â€‹bâˆ’2â€‹â€¦bâˆ’nâ€‹] çš„è¡¨è¾¾å¼ï¼Œå…¶ä¸­çš„æ¯ä¸ªäºŒè¿›åˆ¶æ•°å­— bib_ibiâ€‹ çš„å–å€¼èŒƒå›´æ˜¯ 000 å’Œ 111ï¼Œè¿™ç§è¡¨ç¤ºæ–¹æ³•è¡¨ç¤ºçš„æ•°å®šä¹‰ä¸ºï¼šb=Î£i=âˆ’nm2iÃ—bib=\\Sigma_{i=âˆ’n}^m 2^i Ã— b_ib=Î£i=âˆ’nmâ€‹2iÃ—biâ€‹ ã€‚åŒæ ·çš„ï¼Œå°æ•°ç‚¹çš„å·¦ä¾§æ•°å­—æƒå€¼ä¸º 222 çš„æ­£å¹‚ï¼Œå³ä¾§æ•°å­—æƒå€¼ä¸º 222 çš„è´Ÿå¹‚ã€‚å¦‚ 101.112101.11_2101.112â€‹ è¡¨ç¤ºæ•°å­— 1Ã—22+0Ã—21+1Ã—20+1Ã—2âˆ’1+1Ã—2âˆ’2=5341 Ã— 2^2 + 0 Ã— 2^1 + 1 Ã— 2^0 + 1 Ã— 2^{âˆ’1} + 1 Ã— 2^{âˆ’2} = 5\\frac{3}{4}1Ã—22+0Ã—21+1Ã—20+1Ã—2âˆ’1+1Ã—2âˆ’2=543â€‹ ã€‚è¿™ç§è¡¨ç¤ºæ³•ç§°ä¸ºæµ®ç‚¹æ•°çš„å®šç‚¹è¡¨ç¤ºæ³•ã€‚ å¦‚æœä»…è€ƒè™‘æœ‰é™é•¿åº¦çš„ç¼–ç ï¼Œé‚£ä¹ˆä¸Šè¿°åè¿›åˆ¶å°æ•°æ— æ³•å‡†ç¡®è¡¨ç¤ºå¦‚ 1/3,5/71/3,5/71/3,5/7 è¿™æ ·çš„æ•°ã€‚ç±»ä¼¼åœ°ï¼Œå°æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ³•ä¹Ÿæ™ºèƒ½è¡¨ç¤ºå…·æœ‰ xÃ—2yxÃ—2^yxÃ—2y å½¢å¼çš„æ•°ï¼Œå…¶ä»–çš„å€¼åªèƒ½è¿‘ä¼¼è¡¨ç¤ºã€‚ IEEEæµ®ç‚¹è¡¨ç¤º å®šç‚¹è¡¨ç¤ºæ³•æ— æ³•æœ‰æ•ˆè¡¨ç¤ºéå¸¸å¤§çš„æ•°å­—ã€‚ä¾‹å¦‚è¡¨è¾¾å¼ 5Ã—21005Ã—2^1005Ã—2100 æ˜¯ç”¨ 101101101 åé¢è·Ÿéš 100100100 ä¸ªé›¶çš„ä½æ¨¡å¼æ¥è¡¨ç¤ºã€‚ IEEEæµ®ç‚¹æ ‡å‡†ç”¨ V=(âˆ’1)sÃ—MÃ—2EV=(âˆ’1)^sÃ—MÃ—2^EV=(âˆ’1)sÃ—MÃ—2E çš„å½¢å¼æ¥è¡¨ç¤ºä¸€ä¸ªæ•°ï¼š ç¬¦å·(sign)så†³å®šè¿™ä¸ªæ•°æ˜¯æ­£æ•° (s=0)(s=0)(s=0) è¿˜æ˜¯è´Ÿæ•° (s=1)(s=1)(s=1)ï¼Œæ•°å€¼ä¸º000æ—¶ç¬¦å·ä½çš„è§£é‡Šä½œä¸ºç‰¹æ®Šæƒ…å†µå¤„ç† å°¾æ•°(significand)Mæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å°æ•°ï¼Œå®ƒçš„èŒƒå›´æ˜¯ 1âˆ¼2âˆ’Ïµ1\\thicksim 2âˆ’Ïµ1âˆ¼2âˆ’Ïµï¼Œæˆ–æ˜¯ 01âˆ¼Ïµ01\\thicksim Ïµ01âˆ¼Ïµ é˜¶ç (exponent)Eçš„ä½œç”¨æ˜¯å¯¹æµ®ç‚¹æ•°åŠ æƒï¼Œè¿™ä¸ªæƒé‡æ˜¯ 222 çš„ EEE (å¯èƒ½æ˜¯è´Ÿæ•°)æ¬¡å¹‚ å°†æµ®ç‚¹æ•°çš„ä½è¡¨ç¤ºåˆ’åˆ†ä¸ºä¸‰ä¸ªå­—æ®µï¼Œåˆ†åˆ«å¯¹è¿™äº›å€¼è¿›è¡Œç¼–ç ï¼š ä¸€ä¸ªå•ç‹¬çš„ç¬¦å·ä½ s ç›´æ¥ç¼–ç ç¬¦å· s kä½çš„é˜¶ç å­—æ®µ exp=ekâˆ’1â€¦e1e0exp=e_{kâˆ’1}â€¦e_1 e_0exp=ekâˆ’1â€‹â€¦e1â€‹e0â€‹ ç¼–ç é˜¶ç  E nä½å°æ•°å­—æ®µ frac=fnâˆ’1â€¦f1f0frac=f_{nâˆ’1}â€¦f_1 f_0frac=fnâˆ’1â€‹â€¦f1â€‹f0â€‹ ç¼–ç å°¾æ•° Mï¼Œè¯¥å­—æ®µçš„è§£é‡Šä¾èµ–äºé˜¶ç å­—æ®µçš„å€¼æ˜¯å¦ä¸º0 ä¸‹å›¾æ‰€ç¤ºæ˜¯è¿™ä¸‰ä¸ªå­—æ®µåœ¨å­—ä¸­çš„ä¸¤ç§æœ€å¸¸è§æ ¼å¼ï¼Œå¯¹äºå•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œsï¼Œexp å’Œ fracå­—æ®µåˆ†åˆ«ä¸º 1ï¼Œ8ï¼Œ23 ä½ï¼›å¯¹äºåŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œsï¼Œexp å’Œ frac å­—æ®µåˆ†åˆ«ä¸º 1ï¼Œ11ï¼Œ52 ä½ã€‚ å¯¹äºä¸€ä¸ªç»™å®šçš„æµ®ç‚¹æ•°ä½è¡¨ç¤ºï¼Œå¯¹å…¶çš„è§£é‡Šæ ¹æ®é˜¶ç å­—æ®µçš„å€¼å¯ä»¥åˆ†æˆä¸‰ç§æƒ…å†µ(æœ€åä¸€ç§æƒ…å†µæœ‰ä¸¤ä¸ªå˜ç§)ï¼š æƒ…å†µ1ï¼šè§„æ ¼åŒ–çš„å€¼ è¿™æ˜¯æœ€æ™®éçš„æƒ…å†µã€‚å½“ expçš„ä½æ¨¡å¼æ—¢ä¸å…¨ä¸ºé›¶(æ•°å€¼0)ï¼Œä¹Ÿä¸å…¨ä¸º1 (å•ç²¾åº¦æƒ…å†µä¸‹æ•°å€¼ä¸º255ï¼ŒåŒç²¾åº¦æ•°å€¼ä¸º2047)æ—¶ï¼Œå±äºè¿™ç§æƒ…å†µã€‚ æ­¤æ—¶é˜¶ç å­—æ®µè¢«è§£é‡Šä¸ºä»¥ åç½®(biased) å½¢å¼çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œå³ï¼šE=eâˆ’BiasE = e - BiasE=eâˆ’Biasï¼Œå…¶ä¸­ eee æ˜¯é˜¶ç å­—æ®µç¼–ç çš„æ— ç¬¦å·æ•°ï¼ŒBiasBiasBias æ˜¯ä¸€ä¸ªç­‰äº 2kâˆ’1âˆ’12^{kâˆ’1}âˆ’12kâˆ’1âˆ’1(å•ç²¾åº¦æ˜¯ 127127127ï¼ŒåŒç²¾åº¦æ˜¯ 102310231023 )çš„åç½®å€¼ ã€‚æ­¤æ—¶äº§ç”Ÿçš„æŒ‡æ•°èŒƒå›´ï¼Œå¯¹äºå•ç²¾åº¦æ˜¯ âˆ’126âˆ¼+127âˆ’126\\thicksim +127âˆ’126âˆ¼+127ï¼Œå¯¹äºåŒç²¾åº¦æ˜¯ âˆ’1022âˆ¼+1023âˆ’1022\\thicksim +1023âˆ’1022âˆ¼+1023ã€‚ å°æ•°å­—æ®µ fracfracfrac è¢«è§£é‡Šä¸ºå°æ•°å€¼ fffï¼Œå…¶ä¸­ 0â‰¤f&lt;10â‰¤f&lt;10â‰¤f&lt;1ï¼Œå…¶äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š$ 0.f_{nâˆ’1}â€¦f_1 f_0$ ï¼Œå³æ‰€æœ‰ä½çš„æƒéƒ½æ˜¯2çš„è´Ÿå¹‚ã€‚å°¾æ•° MMM å®šä¹‰ä¸º M=1+fM=1+fM=1+f ã€‚è¿™ç§æ–¹å¼å«åšéšå«çš„ä»¥1å¼€å¤´çš„(implied leading 1)è¡¨ç¤ºï¼Œå¯ä»¥å°†ä½æ•°çš„ä½è¡¨ç¤ºçœ‹ä½œ 1.fnâˆ’1â€¦f1f01.f_{nâˆ’1}â€¦f_1 f_01.fnâˆ’1â€‹â€¦f1â€‹f0â€‹ã€‚ç”±äºæ€»æ˜¯å¯ä»¥é€šè¿‡è°ƒæ•´é˜¶ç  EEEï¼Œä½¿å¾—å°¾æ•° MMM ä¿æŒåœ¨èŒƒå›´ 1â‰¤M&lt;21â‰¤M&lt;21â‰¤M&lt;2 ä¸­ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•å¯ä»¥æ— ä»£ä»·çš„è·å¾—ä¸€ä¸ªé¢å¤–çš„ç²¾åº¦ä½ã€‚ æƒ…å†µ2ï¼šéè§„æ ¼åŒ–çš„å€¼ å½“é˜¶ç åŸŸä¸ºå…¨0æ—¶ï¼Œæ‰€è¡¨ç¤ºçš„æ•°æ˜¯éè§„æ ¼åŒ–çš„å€¼ã€‚æ­¤æ—¶é˜¶ç å€¼æ˜¯E=1âˆ’BiasE = 1-BiasE=1âˆ’Biasï¼Œå°¾æ•°çš„å€¼æ˜¯M=fM = fM=fï¼Œä¸åŒ…å«éšå«å¼€å¤´çš„111 éè§„æ ¼åŒ–çš„è¡¨ç¤ºæœ‰ä¸¤ä¸ªç”¨é€”ï¼š å®ƒæä¾›äº†ä¸€ç§è¡¨ç¤º000çš„æ–¹æ³•ï¼Œåœ¨è§„æ ¼åŒ–çš„æƒ…å†µä¸‹ï¼ŒMMMæ€»æ˜¯å¤§äºç­‰äº111çš„ï¼Œå› æ­¤æ— æ³•è¡¨ç¤º000ã€‚å®é™…ä¸Šï¼Œ+0.0+0.0+0.0çš„ä½æ¨¡å¼ä¸ºå…¨000ï¼Œç¬¦å·ä½ï¼Œé˜¶ç å’Œå°æ•°åŸŸå…¨ä¸º000ï¼›è€Œå½“ç¬¦å·ä½ä¸º111ï¼Œé˜¶ç å’Œå°æ•°åŸŸä¸º000æ—¶ï¼Œè¯¥å€¼è¢«è§£é‡Šä¸ºâˆ’0.0-0.0âˆ’0.0 éè§„æ ¼åŒ–æ•°çš„ç¬¬äºŒä¸ªåŠŸèƒ½æ˜¯è¡¨ç¤ºéå¸¸æ¥è¿‘0.00.00.0çš„æ•°ã€‚å®ƒæä¾›äº†ä¸€ç§ç§°ä¸ºé€æ¸ä¸‹æº¢(gradual underflow)çš„ç‰¹æ€§ï¼Œè®©æ•°å€¼çš„åˆ†å¸ƒå‡åŒ€åœ°æ¥è¿‘0.00.00.0 Note: ä½¿é˜¶ç å€¼ä¸º1-Biasè€Œä¸æ˜¯ç®€å•çš„-Biasæ˜¯å› ä¸ºè¿™æ ·å¯ä»¥è¡¥å¿å°¾æ•°å€¼ç”±M=f+1å˜ä¸ºM=fåé€ æˆçš„æ•°å€¼çªå˜ï¼Œä½¿æ•°å€¼ä»éè§„æ ¼æ•°åˆ°è§„æ ¼æ•°èƒ½å¤Ÿæ›´åŠ å¹³æ»‘çš„å˜åŒ– æƒ…å†µ3ï¼šç‰¹æ®Šå€¼ æœ€åä¸€ç±»æ•°å€¼æ˜¯å½“é˜¶ç å…¨ä¸º1æ—¶å‡ºç°çš„ã€‚ å½“å°æ•°åŸŸå…¨ä¸º 000 æ—¶ï¼Œå¾—åˆ°çš„å€¼è¡¨ç¤ºæ— ç©·ï¼Œå½“ s=0s=0s=0 æ—¶è¡¨ç¤ºæ­£æ— ç©·ï¼Œæˆ–è€…å½“ s=1s=1s=1 æ—¶æ˜¯è´Ÿæ— ç©·ã€‚å½“æŠŠä¸¤ä¸ªéå¸¸å¤§çš„æ•°ç›¸ä¹˜ï¼Œæˆ–è€…é™¤ä»¥ 000 æ—¶ï¼Œæ— ç©·èƒ½å¤Ÿè¡¨ç¤ºæº¢å‡ºçš„ç»“æœã€‚ å½“å°æ•°åŸŸé0æ—¶ï¼Œç»“æœè¢«ç§°ä¸º&quot;NaN&quot;ï¼Œå³&quot;ä¸æ˜¯ä¸€ä¸ªæ•°&quot;ã€‚å¦‚ âˆ’1\\sqrt{-1}âˆ’1â€‹ æˆ– ]âˆâˆ’âˆ]\\infinâˆ’\\infin]âˆâˆ’âˆçš„ç»“æœæ˜¯NaNã€‚ Note: å‡å¦‚å°†ä»0åˆ°æœ€å¤§å€¼æ’åˆ—çš„ä¸€ç»„æ— ç¬¦å·æ•°çš„ä½æ¨¡å¼æŒ‰ç…§ç›¸åŒå­—é•¿çš„æµ®ç‚¹æ•°è§£é‡Šï¼Œåˆ™æµ®ç‚¹æ•°ç»“æœä¹Ÿæ˜¯é€’å¢çš„ã€‚IEEEæ ¼å¼è®¾è®¡ç‚¹ä¹‹ä¸€å°±æ˜¯ä¸ºäº†æµ®ç‚¹æ•°èƒ½å¤Ÿç›´æ¥ä½¿ç”¨æ•´æ•°çš„æ’åºå‡½æ•°ã€‚ å¯¹äºæœ‰kä½é˜¶ç å’Œnä½å°æ•°åŸŸçš„æµ®ç‚¹æ•°è¡¨ç¤ºï¼Œå…¶å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š æè¿° expexpexp fracfracfrac å€¼ï¼ˆå•ç²¾åº¦ï¼‰ åè¿›åˆ¶ï¼ˆå•ç²¾åº¦ï¼‰ å€¼ï¼ˆåŒç²¾åº¦ï¼‰ åè¿›åˆ¶ï¼ˆåŒç²¾åº¦ï¼‰ 000 00â€¦0000â€¦0000â€¦00 0â€¦000â€¦000â€¦00 000 0.00.00.0 000 0.00.00.0 æœ€å°éè§„æ ¼åŒ–æ­£æ•° 00â€¦0000â€¦0000â€¦00 0â€¦010â€¦010â€¦01 2âˆ’23Ã—2âˆ’1262^{âˆ’23}Ã—2^{âˆ’126}2âˆ’23Ã—2âˆ’126 1.4Ã—10âˆ’451.4Ã—10^{âˆ’45}1.4Ã—10âˆ’45 2âˆ’52Ã—2âˆ’10222^{âˆ’52}Ã—2^{âˆ’1022}2âˆ’52Ã—2âˆ’1022 4.9Ã—10âˆ’3244.9Ã—10^{âˆ’324}4.9Ã—10âˆ’324 æœ€å¤§éè§„æ ¼åŒ–æ•° 00â€¦0000â€¦0000â€¦00 1â€¦111â€¦111â€¦11 (1âˆ’Ïµ)Ã—2âˆ’126(1âˆ’Ïµ)Ã—2^{âˆ’126}(1âˆ’Ïµ)Ã—2âˆ’126 1.2Ã—10âˆ’381.2Ã—10^{âˆ’38}1.2Ã—10âˆ’38 (1âˆ’Ïµ)Ã—2âˆ’1022(1âˆ’Ïµ)Ã—2^{âˆ’1022}(1âˆ’Ïµ)Ã—2âˆ’1022 2.2Ã—10âˆ’3082.2Ã—10^{âˆ’308}2.2Ã—10âˆ’308 æœ€å°è§„æ ¼åŒ–æ•° 00â€¦0100â€¦0100â€¦01 0â€¦000â€¦000â€¦00 1Ã—2âˆ’1261Ã—2^{âˆ’126}1Ã—2âˆ’126 1.2Ã—10âˆ’381.2Ã—10^{âˆ’38}1.2Ã—10âˆ’38 1Ã—2âˆ’10221Ã—2^{âˆ’1022}1Ã—2âˆ’1022 2.2Ã—10âˆ’3082.2Ã—10^{âˆ’308}2.2Ã—10âˆ’308 111 01â€¦1101â€¦1101â€¦11 0â€¦000â€¦000â€¦00 1Ã—201Ã—2^01Ã—20 1.01.01.0 1Ã—201Ã—2^01Ã—20 1.01.01.0 æœ€å¤§è§„æ ¼åŒ–æ•° 11â€¦1011â€¦1011â€¦10 1â€¦111â€¦111â€¦11 (2âˆ’Ïµ)Ã—2127(2âˆ’Ïµ)Ã—2^{127}(2âˆ’Ïµ)Ã—2127 3.4Ã—10383.4Ã—10^{38}3.4Ã—1038 (2âˆ’Ïµ)Ã—21023(2âˆ’Ïµ)Ã—2^{1023}(2âˆ’Ïµ)Ã—21023 1.8Ã—103081.8Ã—10^{308}1.8Ã—10308 å€¼+0.0+0.0+0.0 æ€»æœ‰ä¸€ä¸ªå…¨0çš„è¡¨ç¤º æœ€å°çš„æ­£éè§„æ ¼åŒ–çš„å€¼çš„ä½è¡¨ç¤ºï¼Œæ˜¯ç”±æœ€ä½æœ‰æ•ˆä½ä¸º1è€Œå…¶ä»–æ‰€æœ‰ä½ä¸º000æ„æˆçš„ã€‚å®ƒå…·æœ‰å°æ•°(æ­¤æ—¶å³å°¾æ•°)å€¼M=f=2âˆ’nM=f=2^{âˆ’n}M=f=2âˆ’n å’Œé˜¶ç å€¼E=âˆ’2kâˆ’1+2E=âˆ’2^{kâˆ’1}+2E=âˆ’2kâˆ’1+2ã€‚å› æ­¤è¯¥è¡¨ç¤ºçš„æ•°å€¼ä¸ºV=2âˆ’nâˆ’2kâˆ’1+2V=2^{âˆ’nâˆ’2^{kâˆ’1}+2}V=2âˆ’nâˆ’2kâˆ’1+2 æœ€å¤§çš„éè§„æ ¼åŒ–å€¼çš„ä½æ¨¡å¼æ˜¯ç”±å…¨ä¸º000çš„é˜¶ç å­—æ®µå’Œå…¨ä¸º111çš„å°æ•°å­—æ®µç»„æˆçš„ã€‚å®ƒå…·æœ‰å°æ•°ï¼ˆæ­¤æ—¶å³å°¾æ•°ï¼‰å€¼M=f=1âˆ’2âˆ’nM=f=1âˆ’2^{âˆ’n}M=f=1âˆ’2âˆ’n (å†™æˆ1âˆ’Ïµ1âˆ’Ïµ1âˆ’Ïµ)å’Œé˜¶ç å€¼E=âˆ’2kâˆ’1+2E=âˆ’2^{kâˆ’1}+2E=âˆ’2kâˆ’1+2ï¼Œå› æ­¤æ•°å€¼V=(1âˆ’2âˆ’n)Ã—2âˆ’2kâˆ’1+2V=(1âˆ’2^{âˆ’n})Ã—2^{âˆ’2^{kâˆ’1}+2}V=(1âˆ’2âˆ’n)Ã—2âˆ’2kâˆ’1+2 æœ€å°çš„æ­£è§„æ ¼åŒ–å€¼ä½æ¨¡å¼çš„é˜¶ç å­—æ®µæœ€ä½æœ‰æ•ˆä½ä¸º111ï¼Œå…¶ä»–ä½å…¨ä¸º000ã€‚å®ƒçš„å°¾æ•°å€¼M=1M=1M=1ï¼Œè€Œé˜¶ç å€¼E=âˆ’2kâˆ’1+2E=âˆ’2^{kâˆ’1}+2E=âˆ’2kâˆ’1+2ã€‚å› æ­¤æ•°å€¼V=2âˆ’2kâˆ’1+2V=2^{âˆ’2^{kâˆ’1}+2}V=2âˆ’2kâˆ’1+2 ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¹‹æ¯”æœ€å¤§çš„éè§„æ ¼åŒ–å€¼å¤§ä¸€ç‚¹ã€‚ å€¼1.01.01.0 çš„ä½è¡¨ç¤ºé˜¶ç å­—æ®µé™¤äº†æœ€é«˜æœ‰æ•ˆä½ä¸º000ä¹‹å¤–ï¼Œæ‰€æœ‰å…¶ä»–ä½éƒ½ä¸º111ã€‚å®ƒçš„å°¾æ•°M=1M=1M=1ï¼Œå®ƒçš„é˜¶ç å€¼E=0E=0E=0 æœ€å¤§çš„è§„æ ¼åŒ–å€¼çš„ä½è¡¨ç¤ºçš„ç¬¦å·ä½ä¸º000ï¼Œé˜¶ç çš„æœ€ä½æœ‰æ•ˆä½ä¸º000ï¼Œå…¶ä»–ä½å‡ä¸º111ã€‚å®ƒçš„å°æ•°å€¼f=1âˆ’2âˆ’nf=1âˆ’2^{âˆ’n}f=1âˆ’2âˆ’nï¼Œå°¾æ•°å€¼M=2âˆ’2âˆ’nM=2âˆ’2^{âˆ’n}M=2âˆ’2âˆ’n (å†™ä½œ2âˆ’Ïµ2âˆ’Ïµ2âˆ’Ïµ)ã€‚é˜¶ç å€¼E=2kâˆ’1âˆ’1E=2^{kâˆ’1}âˆ’1E=2kâˆ’1âˆ’1ï¼Œå¾—åˆ°æ•°å€¼V=(2âˆ’2âˆ’n)Ã—22kâˆ’1âˆ’1V=(2âˆ’2^{âˆ’n} )Ã—2^{2^{kâˆ’1}âˆ’1}V=(2âˆ’2âˆ’n)Ã—22kâˆ’1âˆ’1 èˆå…¥ å¯¹äºæ— æ³•å‡†ç¡®è¡¨ç¤ºçš„å€¼ï¼Œæµ®ç‚¹æ•°é‡‡ç”¨ å‘å¶æ•°èˆå…¥(round to even) çš„è§„åˆ™æ¥è·å¾—ä¸€ä¸ªè¿‘ä¼¼å€¼ã€‚ å‘å¶æ•°èˆå…¥ä¹Ÿç§°å‘ æœ€è¿‘å€¼èˆå…¥(round to nearest) ï¼Œå®ƒè¯•å›¾æ‰¾åˆ°ä¸€ä¸ªæœ€æ¥è¿‘çš„åŒ¹é…å€¼ã€‚ä¾‹å¦‚ï¼Œå®ƒå°† 1.41.41.4 èˆå…¥æˆ111ï¼Œè€Œå°†1.61.61.6èˆå…¥æˆ222ï¼Œå› ä¸ºå®ƒä»¬æ˜¯æœ€æ¥è¿‘çš„å€¼ã€‚å¯¹äºå¤„äºä¸¤ä¸ªå¯èƒ½å€¼æ­£ä¸­é—´çš„å€¼ï¼Œå‘å¶æ•°èˆå…¥é‡‡å–çš„ç­–ç•¥æ˜¯ä½¿å¾—ç»“æœçš„æœ€ä½æœ‰æ•ˆæ•°å­—æ˜¯å¶æ•°ã€‚å› æ­¤è¿™ç§æ–¹æ³•å°†1.51.51.5å’Œ2.52.52.5éƒ½èˆå…¥æˆ222ã€‚ æµ®ç‚¹æ•°é‡‡ç”¨è¿™ç§èˆå…¥è§„åˆ™çš„åŸå› æ˜¯ï¼Œå¯¹äºä¸€ç»„æ•°æ®è€Œè¨€ï¼Œå¦‚æœéƒ½é‡‡ç”¨å‘ä¸Šèˆå…¥æˆ–å‘ä¸‹èˆå…¥ï¼Œä¼šä¸å¯é¿å…çš„å¸¦æ¥ç»Ÿè®¡åå·®ï¼Œè€Œå‘å¶æ•°èˆå…¥å¯ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹é¿å…è¿™ç§åå·®ã€‚ å¯¹äºäºŒè¿›åˆ¶å°æ•°æ¥è¯´ï¼Œå°†æœ€ä½æœ‰æ•ˆä½çš„å€¼000è§†ä¸ºå¶æ•°ï¼Œå€¼111è§†ä¸ºå¥‡æ•°ã€‚å¯¹äºå¤„äºä¸¤ç§å¯èƒ½å€¼æ­£ä¸­é—´çš„å€¼æ¥è¯´ï¼Œèˆå…¥åçš„ç»“æœè¦ä¿è¯æœ€ä½æœ‰æ•ˆä½ä¸º000ã€‚å¦‚10.111002(278)10.11100_2 (2 \\frac{7}{8})10.111002â€‹(287â€‹)è¢«èˆå…¥ä¸º11.002(3)11.00_2 (3)11.002â€‹(3) ï¼Œ10.101002(258)10.10100_2 (2 \\frac{5}{8})10.101002â€‹(285â€‹)è¢«èˆå…¥ä¸º10.102(212)10.10_2 (2 \\frac{1}{2})10.102â€‹(221â€‹)ã€‚ æµ®ç‚¹è¿ç®— IEEEè§„å®šçš„æµ®ç‚¹æ•°è¿ç®—ä¸­ï¼ŒæŠŠæµ®ç‚¹æ•°xxxå’Œyyyçœ‹ä½œæ˜¯å®æ•°ï¼Œæµ®ç‚¹æ•°x,yx,yx,yè¿ç®—çš„ç»“æœå®é™…ä¸Šæ˜¯å®æ•°x,yx,yx,yç²¾ç¡®è¿ç®—åèˆå…¥çš„ç»“æœã€‚ è€ƒè™‘åˆ°èˆå…¥çš„å½±å“ï¼Œå¯ä»¥å°†æµ®ç‚¹æ•°åŠ æ³•x+fyx+^f yx+fyå®šä¹‰ä¸ºRound(x+y)Round(x+y)Round(x+y)ï¼Œå³å¯¹å®æ•°ç»“æœèˆå…¥ã€‚å¯¹äºæ‰€æœ‰çš„æµ®ç‚¹æ•°ï¼Œè¯¥è¿ç®—æ˜¯å¯äº¤æ¢çš„ï¼Œå³x+fy=y+fxx+^f y=y+^f xx+fy=y+fxï¼Œå¦ä¸€æ–¹é¢ï¼Œè¯¥è¿ç®—æ˜¯ä¸å¯ç»“åˆçš„ï¼Œå³x+f(y+fz)â‰ (x+fy)+fzx+^f (y+^f z)\\neq (x+^f y) +^f zx+f(y+fz)î€ =(x+fy)+fzã€‚ä¾‹å¦‚åœ¨å•ç²¾åº¦æµ®ç‚¹æ•°ä¸­ï¼Œ(3.14+1e10)âˆ’1e10=0.0(3.14+1e10)âˆ’1e10=0.0(3.14+1e10)âˆ’1e10=0.0ï¼Œè¿™æ˜¯ç”±äºèˆå…¥ï¼Œåœ¨1e101e101e10çš„å¤§å°å°ºåº¦ä¸‹ï¼Œ3.143.143.14è¢«èˆå»äº†ï¼ŒåŒæ—¶3.14+(1e10âˆ’1e10)=3.143.14+(1e10âˆ’1e10)=3.143.14+(1e10âˆ’1e10)=3.14 å¯¹äºä¹˜æ³•æµ®ç‚¹æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„å±æ€§ï¼šæµ®ç‚¹æ•°ä¹˜æ³•æ˜¯å¯äº¤æ¢çš„ï¼Œå³xÃ—fy=yÃ—fxxÃ—^f y=yÃ—^f xxÃ—fy=yÃ—fxã€‚ä½†åŒæ—¶æ˜¯ä¸å¯ç»“åˆçš„ï¼Œä¾‹å¦‚åœ¨å•ç²¾åº¦æ¡ä»¶ä¸‹ï¼š(1e20âˆ—1e20)âˆ—1eâˆ’20=+âˆ(1e20âˆ—1e20)âˆ—1eâˆ’20=+âˆ(1e20âˆ—1e20)âˆ—1eâˆ’20=+âˆï¼Œè€Œ1e20âˆ—(1e20âˆ—1eâˆ’20)=1e201e20âˆ—(1e20âˆ—1eâˆ’20)=1e201e20âˆ—(1e20âˆ—1eâˆ’20)=1e20ã€‚å¦å¤–ï¼Œæµ®ç‚¹æ•°ä¹˜æ³•ä¸å…·åˆ†é…æ€§ï¼Œä¾‹å¦‚å•ç²¾åº¦æ¡ä»¶ä¸‹ï¼š1e20âˆ—(1e20âˆ’1e20)=0.01e20âˆ—(1e20âˆ’1e20)=0.01e20âˆ—(1e20âˆ’1e20)=0.0ï¼Œè€Œ1e20âˆ—1e20âˆ’1e20âˆ—1e20=NaN1e20âˆ—1e20âˆ’1e20âˆ—1e20=NaN1e20âˆ—1e20âˆ’1e20âˆ—1e20=NaNã€‚ æµ®ç‚¹æ•°è¿ç®—è¿˜å…·æœ‰å¦‚ä¸‹çš„æ€§è´¨ï¼Œå¯¹äºä»»æ„a,b,câ‰ NaNa, b ,c\\neq NaNa,b,cî€ =NaN: {aâ©¾b,câ©¾0â‡’aÃ—fcâ©¾bÃ—fcaâ©¾b,câ©½0â‡’aÃ—fcâ©½bÃ—fcaÃ—faâ©¾0\\begin{cases} a \\geqslant b, c \\geqslant 0 \\Rightarrow a \\times^f c \\geqslant b \\times^f c \\\\ a \\geqslant b, c \\leqslant 0 \\Rightarrow a \\times^f c \\leqslant b \\times^f c \\\\ a \\times^f a \\geqslant 0 \\end{cases}â©âªâªâ¨âªâªâ§â€‹aâ©¾b,câ©¾0â‡’aÃ—fcâ©¾bÃ—fcaâ©¾b,câ©½0â‡’aÃ—fcâ©½bÃ—fcaÃ—faâ©¾0â€‹ Note: Cè¯­è¨€æ ‡å‡†ä¸­å¹¶æœªè¦æ±‚æœºå™¨ä½¿ç”¨IEEEæµ®ç‚¹æ•°","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"æµ®ç‚¹æ•°","slug":"æµ®ç‚¹æ•°","permalink":"https://blog.zhuwenq.cc/tags/%E6%B5%AE%E7%82%B9%E6%95%B0/"},{"name":"ä½çº§è¡¨ç¤º","slug":"ä½çº§è¡¨ç¤º","permalink":"https://blog.zhuwenq.cc/tags/%E4%BD%8D%E7%BA%A7%E8%A1%A8%E7%A4%BA/"}]},{"title":"CS:APP Lab1: DataLab","slug":"CS-APP-Lab1-DataLab","date":"2021-07-28T13:06:15.000Z","updated":"2023-06-21T06:51:28.784Z","comments":true,"path":"CS-APP-Lab1-DataLab/","link":"","permalink":"https://blog.zhuwenq.cc/CS-APP-Lab1-DataLab/","excerpt":"0x00 ç®€ä»‹ ä¸€ç›´åœ¨å­¦ä¹ CS:APPè¿™æœ¬ä¹¦ï¼Œæœ¬ä»¥ä¸ºå¤§åé¼é¼çš„Labä¼šå‡ºç°åœ¨ä¹¦æœ¬ä¸Šï¼Œæ²¡æƒ³åˆ°ä¸€ç›´çœ‹åˆ°ç¬¬ä¸‰ç« ä¹Ÿæ²¡çœ‹è§ã€‚åœ¨ç½‘ä¸ŠæŸ¥äº†ä»¥ä¸‹æ‰çŸ¥é“æ˜¯åœ¨çº¿çš„ã€‚æƒ³æƒ³ä¹Ÿååˆ†åˆç†ï¼Œæ¯•ç«Ÿå¯èƒ½ä¼šç»å¸¸æœ‰æ›´æ–°ã€‚è¿™é‡Œå°±è®°å½•å®Œæˆç¬¬ä¸€ä¸ªLabâ€”â€”DataLabçš„è¿‡ç¨‹ã€‚ DataLabæ˜¯ä½¿ç”¨å—é™çš„Cè¯­è¨€è¿ç®—å­é›†æ¥å®ç°é€»è¾‘è¿ç®—/è¡¥ç è¿ç®—/æµ®ç‚¹è¿ç®—çš„å‡½æ•°ï¼Œä¾‹å¦‚ï¼Œå¯èƒ½ä¼šè¦æ±‚ä»…ä½¿ç”¨ä½çº§è¿ç®—å’Œçº¿æ€§çš„è¿‡ç¨‹æ¥å®ç°æ±‚ç»å¯¹å€¼çš„å‡½æ•°ã€‚è¿™ä¸ªLabå¯ä»¥å¸®åŠ©ç†è§£Cæ•°æ®ç±»å‹çš„ä½çº§è¡¨ç¤ºå’Œæ•°æ®æ“ä½œçš„ä½çº§è¡Œä¸ºã€‚","text":"0x00 ç®€ä»‹ ä¸€ç›´åœ¨å­¦ä¹ CS:APPè¿™æœ¬ä¹¦ï¼Œæœ¬ä»¥ä¸ºå¤§åé¼é¼çš„Labä¼šå‡ºç°åœ¨ä¹¦æœ¬ä¸Šï¼Œæ²¡æƒ³åˆ°ä¸€ç›´çœ‹åˆ°ç¬¬ä¸‰ç« ä¹Ÿæ²¡çœ‹è§ã€‚åœ¨ç½‘ä¸ŠæŸ¥äº†ä»¥ä¸‹æ‰çŸ¥é“æ˜¯åœ¨çº¿çš„ã€‚æƒ³æƒ³ä¹Ÿååˆ†åˆç†ï¼Œæ¯•ç«Ÿå¯èƒ½ä¼šç»å¸¸æœ‰æ›´æ–°ã€‚è¿™é‡Œå°±è®°å½•å®Œæˆç¬¬ä¸€ä¸ªLabâ€”â€”DataLabçš„è¿‡ç¨‹ã€‚ DataLabæ˜¯ä½¿ç”¨å—é™çš„Cè¯­è¨€è¿ç®—å­é›†æ¥å®ç°é€»è¾‘è¿ç®—/è¡¥ç è¿ç®—/æµ®ç‚¹è¿ç®—çš„å‡½æ•°ï¼Œä¾‹å¦‚ï¼Œå¯èƒ½ä¼šè¦æ±‚ä»…ä½¿ç”¨ä½çº§è¿ç®—å’Œçº¿æ€§çš„è¿‡ç¨‹æ¥å®ç°æ±‚ç»å¯¹å€¼çš„å‡½æ•°ã€‚è¿™ä¸ªLabå¯ä»¥å¸®åŠ©ç†è§£Cæ•°æ®ç±»å‹çš„ä½çº§è¡¨ç¤ºå’Œæ•°æ®æ“ä½œçš„ä½çº§è¡Œä¸ºã€‚ è¦æ±‚ è¿™ä¸ªLabä¸»è¦æ˜¯åœ¨ä¸€ä¸ªCè¯­è¨€æ–‡ä»¶ä¸­å®ç°å‡½æ•°ï¼Œåœ¨å®ç°æ—¶å¯¹äºä½¿ç”¨çš„è¿ç®—ç§ç±»å’Œæ•°é‡éƒ½æœ‰ä¸¥æ ¼çš„è¦æ±‚ã€‚åŒæ—¶Labæä¾›äº†ä¸€ç»„å·¥å…·ç”¨äºæ£€æŸ¥ä»£ç ä¸­ä½¿ç”¨çš„è¿ç®—æ˜¯å¦ç¬¦åˆè¦æ±‚ä»¥åŠç”¨äºæµ‹è¯•ä»£ç æ­£ç¡®ä¸å¦ã€‚è¿˜æä¾›äº†ä¸€ä¸ªå°å·¥å…·å¯ä»¥æ‰“å°æ•´å½¢æ•°æ®å’Œæµ®ç‚¹æ•°æ®çš„16è¿›åˆ¶æˆ–10ç¦æ­¢è¡¨ç¤ºã€‚ å…·ä½“çš„ç¼–ç è¦æ±‚é™„åœ¨æ–‡æœ«ï¼ŒåŒæ—¶æ¯é“é¢˜å¯èƒ½è¿˜æœ‰è‡ªå·±çš„æ›´åŠ ä¸¥æ ¼çš„è¦æ±‚ã€‚ æ¦‚è§ˆ æ€»å…±æœ‰ä¸åŒåˆ†å€¼çš„æ•´æ•°å’Œæµ®ç‚¹æ•°å‡½æ•°å…±13ä¸ªï¼š å‡½æ•° æè¿° åˆ†å€¼ bitXor è®¡ç®—å¼‚æˆ– 1 tmin è¿”å›æœ€å°è¡¥ç å€¼ 1 isTmax åˆ¤æ–­æ˜¯å¦æœ€å¤§è¡¥ç å€¼ 2 allOddBits åˆ¤æ–­æ˜¯å¦å¥‡æ•°ä½ç½®éƒ½ä¸º1 2 negate æ±‚ç›¸åæ•° 2 isAsciiDigit åˆ¤æ–­æ˜¯å¦Asciiæ•°å­— 3 conditional å®ç°æ¡ä»¶åˆ†æ”¯ 3 isLessOrEqual å®ç°å°äºç­‰äº 3 logicalNeg å®ç°é€»è¾‘é(!) 4 howManyBits è®¡ç®—èƒ½è¡¨è¾¾æ•°æ®çš„æœ€å°é•¿åº¦ 4 floatScale2 å®ç°ä½çº§æµ®ç‚¹æ•°*2 4 floatFloat2Int å®ç°ä½çº§floatè½¬int 4 floatPower2 å®ç°ä½çº§2.0^x 4 0x01 bitXor ç¬¬ä¸€é“é¢˜ç›®ï¼š 12345678910/* * bitXor - x^y using only ~ and &amp; * Example: bitXor(4, 5) = 1 * Legal ops: ~ &amp; * Max ops: 14 * Rating: 1 */int bitXor(int x, int y) &#123; return 2;&#125; åªä½¿ç”¨ ~ å’Œ &amp; è¿ç®—ç¬¦å®ç° ^ è¿ç®—ã€‚æœ€å¤šå¯ä»¥ä½¿ç”¨14ä¸ªè¿ç®—ç¬¦ã€‚ è€ƒè™‘ä½çº§å¼‚æˆ–è¿ç®—çš„çœŸå€¼è¡¨ï¼š x y x ^ y 0 0 0 0 1 1 1 0 1 1 1 0 å¯ä»¥çœ‹åˆ°ä»¤ x ^ y = 1 çš„æƒ…å†µåˆ†åˆ«æ˜¯ x = 0, y = 1 å’Œ x = 1, y = 0ï¼Œæ ¹æ®å¡è¯ºå›¾åŒ–ç®€çš„æ–¹æ³•å’Œé€»è¾‘ä»£æ•°çš„è¡¨è¾¾æ–¹å¼ï¼Œè¿™ä¸ªçœŸå€¼è¡¨å¯ä»¥åŒ–ç®€ä¸ºï¼šX'Y + XY'ï¼Œå³ï¼šx ^ y = (x &amp; ~y) | (~x &amp; y)ã€‚ ç”±äºé¢˜ç›®è¦æ±‚åªèƒ½ä½¿ç”¨ &amp; å’Œ ~ï¼Œæ¶ˆå»ä¸Šå¼ä¸­çš„ |ï¼š 12345(x &amp; ~y) | (~x &amp; y)= ~~((x &amp; ~y) | (~x &amp; y))= ~((~x | y) &amp; (x | ~y))= ~(~~(~x | y) &amp; ~~(x | ~y))= ~(~(x &amp; ~y) &amp; ~(~x &amp; y)) å› æ­¤ç›´æ¥å°†ä¸Šé¢çš„ return 2 æ”¹æˆ return ~(~(x &amp; ~y) &amp; ~(~x &amp; y)) å³å¯ã€‚ è¿™é“é¢˜ç›®è¿˜å¯ä»¥åœ¨å¡è¯ºå›¾åŒ–ç®€æ—¶é€‰æ‹©åå‡½æ•°ï¼Œå³åŒ–ç®€å‡º ~(x ^ y) çš„è¡¨è¾¾å¼ã€‚å…·ä½“æ¥è¯´ï¼Œæ˜¯é€‰æ‹©çœŸå€¼è¡¨ä¸­ç»“æœä¸º0çš„é¡¹è¿›è¡ŒåŒ–ç®€ï¼š~(x ^ y) = (x &amp; y) | (~x &amp; ~y)ã€‚è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œæœ‰ï¼š(x ^ y) = ~((x &amp; y) | (~x &amp; ~y)) = (~x | ~y) &amp; (x | y) = ~(x &amp; y) &amp; ~(~x &amp; ~y)ã€‚è¿™ä¸ªç»“æœæ¯”ä¸Šä¸€ä¸ªå°‘ç”¨äº†1ä¸ªè¿ç®—ç¬¦ã€‚ 0x02 tmin 123456789/* * tmin - return minimum two&#x27;s complement integer * Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt; * Max ops: 4 * Rating: 1 */int tmin(void) &#123; return 2;&#125; è¿™é“éå¸¸ç®€å•ï¼Œè¿”å›æœ€å°çš„è¡¥ç å€¼ï¼Œå³ 0x80000000ã€‚ç”±äºä¸èƒ½ä½¿ç”¨é™¤ 0x00~0xff ä¹‹å¤–çš„å¸¸æ•°ï¼Œç›´æ¥è¿”å› 0x01 &lt;&lt; 31 å³å¯ã€‚ 0x03 isTmax 12345678910/* * isTmax - returns 1 if x is the maximum, two&#x27;s complement number, * and 0 otherwise * Legal ops: ! ~ &amp; ^ | + * Max ops: 10 * Rating: 1 */int isTmax(int x) &#123; return 2;&#125; è¿™é“æ˜¯åˆ¤æ–­å‚æ•°æ˜¯å¦æ˜¯æœ€å¤§è¡¥ç å€¼ï¼Œå³ 0x7fffffffã€‚ä¸éš¾çŸ¥é“å¯¹äº 0x7fffffffï¼Œå…¶å¤„åœ¨æº¢å‡ºçš„è¾¹ç¼˜ï¼Œå†åŠ  1 å°±ä¼šå¾—åˆ°æœ€å°çš„è¡¥ç å€¼ 0x80000000ã€‚è§‚å¯Ÿæœ€å°è¡¥ç å€¼å’Œæœ€å¤§è¡¥ç å€¼çš„ä½æ¨¡å¼ï¼Œå¾—çŸ¥æœ€å°è¡¥ç å€¼åªæœ‰æœ€é«˜ä½ä¸º 1ï¼Œå…¶ä½™ä½ä¸º 0ï¼›è€Œæœ€å¤§è¡¥ç å€¼ç›¸åâ€”â€”åªæœ‰æœ€é«˜ä½ä¸º 0ï¼Œå…¶ä½™ä½ä¸º 1â€”â€”å› æ­¤æœ€å°è¡¥ç å€¼å–ååº”è¯¥ä¸ºæœ€å¤§è¡¥ç å€¼ã€‚ åŸºäºä»¥ä¸ŠåŸç†ï¼Œå½“ x = 0x7fffffff æ—¶ï¼Œ!(x ^ ~(x + 1)) = 1ã€‚è¿™å°±å®ç°äº†æœ€å¤§è¡¥ç å€¼æ—¶è¿”å› 1ã€‚ å®é™…æµ‹è¯•æ—¶å‘ç°ï¼Œå½“ x = 0xffffffff æ—¶ï¼Œç”±äºä¹Ÿå¤„äºæº¢å‡ºè¾¹ç¼˜ï¼Œä¹Ÿå…·æœ‰ä¸Šè¿°çš„æ€§è´¨ï¼Œå¯¹ç»“æœé€ æˆè¯¯åˆ¤ã€‚å› æ­¤éœ€è¦è¿‡æ»¤æ‰è¯¥ç§æƒ…å†µã€‚ å½“ x = 0xffffffff æ—¶ï¼Œå…¶ä½æ¨¡å¼æ˜¯æ‰€æœ‰ä½éƒ½ä¸º 1ã€‚å› æ­¤å¯¹å…¶å–åå¯ä»¥å¾—åˆ°ç‰¹æ®Šå€¼ 0ã€‚å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼ ~x è¿›è¡Œè¿‡æ»¤ï¼Œè¿™æ ·çš„è¯æ€»çš„ç»“æœå°±æ˜¯ !(x ^ ~(x + 1)) &amp; ~xã€‚å¯¹è¿™ä¸ªç»“æœä½¿ç”¨ x = 0x7fffffff è¿›è¡ŒéªŒè¯ï¼Œå‘ç° ~x = 0x80000000ï¼Œè¿™æ ·çš„è¯æœ€ç»ˆç»“æœå°±æ˜¯ 0x80000000 &amp; 0x1 = 0ï¼Œå› æ­¤è¿˜éœ€è¦å¯¹ ~x çš„å€¼è¿›è¡ŒäºŒå€¼åŒ–ï¼Œè®©å…¶å–å€¼åªè½åœ¨ 0 å’Œ 1 çš„èŒƒå›´å†…ã€‚å³ !!~xã€‚ æœ€ç»ˆç»“æœä¸º !(x ^ ~(x + 1)) &amp; (!!~x)ã€‚ 0x04 allOddBits 1234567891011/* * allOddBits - return 1 if all odd-numbered bits in word set to 1 * where bits are numbered from 0 (least significant) to 31 (most significant) * Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1 * Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt; * Max ops: 12 * Rating: 2 */int allOddBits(int x) &#123; return 2;&#125; è¿™é“é¢˜è¦æ±‚åˆ¤æ–­ç»™å®šçš„å‚æ•°å…¶ä½æ¨¡å¼çš„å¥‡æ•°ä½æ˜¯å¦éƒ½ä¸º 1ã€‚ä¾‹å¦‚ï¼Œæ•°æ® 0xFFFFFFFD çš„æœ€ä½å››ä½æ˜¯ 1101ï¼Œç¬¬1ä½ä¸º 0ï¼Œæ‰€ä»¥è¿”å› 0ã€‚æ•°æ® 0xAAAAAAAA åˆ™æ˜¯æ‰€æœ‰å¥‡æ•°ä½éƒ½ä¸º 1ï¼Œæ‰€æœ‰å¶æ•°ä½éƒ½ä¸º 0ï¼Œæ‰€ä»¥è¿”å› 1ã€‚ å› ä¸ºåªéœ€è¦åˆ¤æ–­å¥‡æ•°ä½ä¸Šçš„æƒ…å†µï¼Œå¶æ•°ä½åˆ™å¯ä»¥å¿½ç•¥ã€‚å› æ­¤å¯ä»¥ä½¿ç”¨æ•°æ® 0xAAAAAAAA ä½œä¸º mask æ¥å¯¹å‚æ•°è¿›è¡Œæ ¡éªŒã€‚å¦‚æœå‚æ•° x çš„å¥‡æ•°ä½éƒ½ä¸º 1 çš„è¯ï¼Œè¡¨è¾¾å¼ 0xAAAAAAAA &amp; x = 0xAAAAAAAA æˆç«‹ã€‚åˆ™å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼ !(0xAAAAAAAA ^ (0xAAAAAAAA &amp; x)) ä½œä¸ºç­”æ¡ˆã€‚å› ä¸ºä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ä¹ˆå¤§çš„å¸¸æ•°ï¼Œmask éœ€è¦ä» 0xAA ç»è¿‡è¿ç®—å¾—åˆ°ã€‚ä»¥ä¸‹è¡¨è¾¾å¼å¾—åˆ° mask = 0xAAAAAAAA: 123int mask = 0xAA;mask |= mask &lt;&lt; 8;mask |= mask &lt;&lt; 16; æ‰€ä»¥ç­”æ¡ˆæ˜¯ï¼š 123456int allOddBits(int x) &#123; int mask = 0xAA; mask |= mask &lt;&lt; 8; mask |= mask &lt;&lt; 16; return !((x &amp; mask) ^ mask);&#125; 0x05 negate 12345678910/* * negate - return -x * Example: negate(1) = -1. * Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt; * Max ops: 5 * Rating: 2 */int negate(int x) &#123; return 2;&#125; è¿™é“é¢˜è¦æ±‚ä½¿ç”¨5ä¸ªä»¥å†…ç»™å®šç§ç±»çš„è¿ç®—ç¬¦å®ç°è¡¥ç ç›¸åæ•°æ“ä½œã€‚ å¯¹äºè¡¥ç æ•´æ•°ï¼Œå…¶ç¼–ç ä¸æ— ç¬¦å·æ•°ç¼–ç ä¸€è‡´ï¼›å¯¹äºè¡¥ç è´Ÿæ•°ï¼Œå…¶ç¼–ç æ–¹å¼åˆ™æ˜¯æœ€é«˜ä½å–è´Ÿæƒï¼Œå…¶ä½™ä½å–æ­£æƒã€‚ é€šè¿‡å­¦ä¹ CS:APPç¬¬äºŒç« æˆ‘ä»¬çŸ¥é“ï¼Œè¡¥ç çš„éæœ‰ä¸¤ç§èªæ˜çš„æ±‚æ³•ï¼š å¯¹æ¯ä¸€ä½æ±‚è¡¥ï¼Œå†å¯¹ç»“æœåŠ  1ã€‚åœ¨Cè¯­è¨€ä¸­ï¼Œå¯¹äºä»»æ„æ•´æ•° xï¼Œè®¡ç®—è¡¨è¾¾å¼ -x å’Œ ~x+1 å¾—åˆ°çš„ç»“æœå®Œå…¨ä¸€æ ·ã€‚ å°†ä½å‘é‡åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå‡è®¾ kkk æ˜¯ä½å‘é‡ä¸­æœ€å³è¾¹çš„ 111 çš„ä½ç½®ï¼Œå› è€Œ xxx çš„ä½çº§è¡¨ç¤ºå½¢å¦‚ [x(wâˆ’1),x(wâˆ’2),â€¦,x(k+1),1,0,â€¦,0][x_{(wâˆ’1)}, x_{(wâˆ’2)}, â€¦,x_{(k+1)},1,0,â€¦,0][x(wâˆ’1)â€‹,x(wâˆ’2)â€‹,â€¦,x(k+1)â€‹,1,0,â€¦,0]ï¼Œè¿™ä¸ªå€¼çš„éçš„äºŒè¿›åˆ¶å½¢å¼ä¸ºï¼š[ x(wâˆ’1), x(wâˆ’2),â€¦, x(k+1),1,0,â€¦,0][~x_{(wâˆ’1)},~x_{(wâˆ’2)},â€¦,~x_{(k+1)},1,0,â€¦,0][ x(wâˆ’1)â€‹, x(wâˆ’2)â€‹,â€¦, x(k+1)â€‹,1,0,â€¦,0]ã€‚å³ï¼šå¯¹ä½ kkk å·¦è¾¹çš„æ‰€æœ‰ä½å–åã€‚ è¿™é¢˜ä¸­åº”ç”¨ç¬¬ä¸€ç§æ±‚æ³•ï¼Œå¾—åˆ°ç­”æ¡ˆï¼š~x + 1ã€‚ 0x06 isAsciiDigit 123456789101112/* * isAsciiDigit - return 1 if 0x30 &lt;= x &lt;= 0x39 (ASCII codes for characters &#x27;0&#x27; to &#x27;9&#x27;) * Example: isAsciiDigit(0x35) = 1. * isAsciiDigit(0x3a) = 0. * isAsciiDigit(0x05) = 0. * Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt; * Max ops: 15 * Rating: 3 */int isAsciiDigit(int x) &#123; return 2;&#125; è¿™é“é¢˜åˆ¤æ–­æ‰€ç»™å‚æ•°æ˜¯å¦æ˜¯ ASCII æ•°å­—ï¼Œå³åˆ¤æ–­ç»™å®šå‚æ•°æ˜¯å¦åœ¨ 0x30 ~ 0x39 èŒƒå›´å†…ã€‚ è§‚å¯Ÿ 0x30 ~ 0x39 è¿™åä¸ªæ•°å­—çš„ä½æ¨¡å¼ï¼Œå‘ç°å…¶é«˜28ä½éƒ½ç›¸åŒï¼Œä½4ä½ä¸­æ¶µç›–äº†ä» 0 åˆ° 9 çš„èŒƒå›´ã€‚ä¸‹é¢å¯¹ç…§4ä½äºŒè¿›åˆ¶æ•°çš„çœŸå€¼è¡¨è§‚å¯Ÿå…¶ç‰¹å¾ï¼š ä½æ¨¡å¼ æ•´æ•°å€¼ ä½æ¨¡å¼ æ•´æ•°å€¼ 0000 0 0101 5 0001 1 0110 6 0010 2 0111 7 0011 3 1000 8 0100 4 1001 9 å¯ä»¥çœ‹åˆ°èŒƒå›´å†…çš„å€¼é™¤äº† 8 å’Œ 9 ä¹‹å¤–æœ€é«˜ä½éƒ½ä¸º 0ï¼Œä¸”æœ€é«˜ä½ä¸º 0 æ—¶ï¼Œä½3ä½æ‰€æœ‰çš„å–å€¼æƒ…å†µéƒ½åœ¨èŒƒå›´å†…ã€‚å¯¹åº”åˆ°32ä½æ•´æ•°å°±æ˜¯é™¤äº† 0x38 å’Œ 0x39 ä¹‹å¤–ï¼Œé«˜29ä½éƒ½ç›¸åŒï¼Œä¸”ä½3ä½å¯ä»¥ä¸ºä»»æ„å€¼ã€‚ æˆ‘ä»¬å°† 0x38 å’Œ 0x39 è¿™ä¸¤ä¸ªæ•°å­—ä½œä¸ºç‰¹ä¾‹ï¼Œé™¤è¿™ä¸¤ä¸ªå€¼å¤–ï¼Œåˆ¤æ–­ x é«˜29ä½æ˜¯å¦æ˜¯åˆæ³•å€¼ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆè¯¥æ•°å­—ä¸€å®šæ˜¯ ASCII Codeã€‚å¦‚æœä¸æ˜¯ï¼Œå†åˆ¤æ–­æ˜¯å¦æ˜¯ä¸¤ä¸ªç‰¹ä¾‹å€¼ä¸­çš„ä¸€ä¸ªã€‚ åˆ¤æ–­é«˜29ä½çš„è¡¨è¾¾å¼ä¸ºï¼š!(((x &gt;&gt; 3) &lt;&lt; 3) ^ 0x30)ï¼Œåˆ¤æ–­ x æ˜¯å¦æ˜¯ç‰¹æ®Šå€¼çš„è¡¨è¾¾å¼æ˜¯ï¼š!((x ^ 0x38) &amp; (x ^ 0x39))ï¼Œæœ€ç»ˆç»“æœä¸ºï¼š!(((x &gt;&gt; 3) &lt;&lt; 3) ^ 0x30) | !((x ^ 0x38) &amp; (x ^ 0x39)) 0x07 conditional 12345678910/* * conditional - same as x ? y : z * Example: conditional(2,4,5) = 4 * Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt; * Max ops: 16 * Rating: 3 */int conditional(int x, int y, int z) &#123; return 2;&#125; ä½¿ç”¨ç»™å®šçš„å‡ ç§ä¸è¶…è¿‡16ä¸ªè¿ç®—å®ç°ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œå³ï¼šx ? y : zï¼Œè‹¥ x == 0ï¼Œè¿”å› zï¼Œå¦åˆ™è¿”å› yã€‚ åœ¨ä¸èƒ½ä½¿ç”¨æ¡ä»¶åˆ†æ”¯çš„æƒ…å†µä¸‹ï¼Œæ ¹æ® x çš„å–å€¼è¿›è¡Œè¿”å›ï¼Œé¦–å…ˆæ¯”è¾ƒå®¹æ˜“æƒ³åˆ°ä½¿ç”¨ x ä½œä¸º mask å¯¹ y å’Œ z è¿›è¡Œè¿‡æ»¤ã€‚æ¯”å¦‚å½“ x == 0 æ—¶ï¼Œå¯ä»¥ç”¨è¡¨è¾¾å¼ x &amp; y è¿‡æ»¤æ‰ yï¼›å½“ x != 0 æ—¶ï¼Œæ ¹æ®ç›¸åçš„åŸåˆ™ï¼Œé¦–å…ˆå°† x åšæˆæ‰€æœ‰ä½éƒ½ä¸º 1 çš„æ ·å­ï¼š~!!x + 1ï¼Œç„¶åè¡¨è¾¾å¼ x | z å¯ä»¥è¿‡æ»¤æ‰ zã€‚ æ ¹æ®ä¸Šé¢æ‰€è¯´çš„æƒ…å†µï¼Œå¯ä»¥çŸ¥é“ä½¿ç”¨ x çš„å€¼ä½œä¸º mask çš„æ€è·¯å¤§æ¦‚æ˜¯å¯è¡Œçš„ã€‚ä¸è¿‡è¦é¦–å…ˆå°† x è½¬æ¢ä¸ºå…¨ 0 æˆ–å…¨ 1 çš„å½¢å¼â€”â€”è¿™é‡Œä½¿ç”¨é¢å¤–çš„å˜é‡è¡¨ç¤ºâ€”â€”int isXZero = ~!!x + 1ã€‚å¯¹äºä¸¤ç§è¿‡æ»¤è¡¨è¾¾å¼ï¼Œè€ƒå¯Ÿå…¶å–å€¼ï¼š ç”±äºï¼š isXZero={0whenx=0âˆ’1whenxâ‰ 0\\mathrm{isXZero} = \\begin{cases} 0 &amp; when &amp; x = 0 \\\\ -1 &amp; when &amp; x \\neq 0 \\end{cases} isXZero={0âˆ’1â€‹whenwhenâ€‹x=0xî€ =0â€‹ æœ‰ï¼š isXZero &amp; y={0whenx=0ywhenxâ‰ 0\\mathrm{isXZero\\ \\&amp;\\ y} = \\begin{cases} 0 &amp; when &amp; x = 0 \\\\ y &amp; when &amp; x \\neq 0 \\end{cases}isXZero &amp; y={0yâ€‹whenwhenâ€‹x=0xî€ =0â€‹ å’Œï¼š isXZero âˆ£ z={âˆ’1whenxâ‰ 0zwhenx=0\\mathrm{isXZero\\ |\\ z} = \\begin{cases} -1 &amp; when &amp; x \\neq 0 \\\\ z &amp; when &amp; x = 0 \\end{cases}isXZero âˆ£ z={âˆ’1zâ€‹whenwhenâ€‹xî€ =0x=0â€‹ å¯ä»¥çœ‹åˆ°ä¸¤ç§æ»¤ç½‘æ»¤å‡ºçš„æ•°å€¼æ ¹æ® x çš„å–å€¼åˆ†åˆ«å–æœ‰æ•ˆå€¼å’Œè¾ƒä¸ºè§„åˆ™çš„æ— æ•ˆå€¼ï¼Œä¸”å–æœ‰æ•ˆå€¼çš„æƒ…å†µå½¼æ­¤ä¹‹é—´é”™å¼€ã€‚è¿™æ ·çš„æƒ…å†µå¾ˆå®¹æ˜“æƒ³åˆ°å°†å…¶ç›¸åŠ ï¼š (isXZero &amp; y)+(isXZero âˆ£ z)={zwhenx=0yâˆ’1whenxâ‰ 0\\mathrm{(isXZero\\ \\&amp;\\ y) + (isXZero\\ |\\ z)} = \\begin{cases} z &amp; when &amp; x = 0 \\\\ y - 1 &amp; when &amp; x \\neq 0 \\end{cases}(isXZero &amp; y)+(isXZero âˆ£ z)={zyâˆ’1â€‹whenwhenâ€‹x=0xî€ =0â€‹ è¿™æ ·ç­”æ¡ˆå°±è¾ƒä¸ºæ˜æ˜¾äº†ï¼Œåªéœ€åœ¨ x != 0 æ—¶å°†ä¸Šè¿°çš„å’Œå¼åŠ ä¸Š 1 å°±å¯ä»¥ã€‚å¯ä»¥è®¤ä¸º x == 0 æ—¶ä¸Šå¼åŠ ä¸Š 0ï¼Œè¿™æ ·åŠ ä¸Šçš„å®é™…ä¸Šæ˜¯ x çš„æŸç§å˜å½¢ï¼Œå³ ~!!xã€‚æ‰€ä»¥ç­”æ¡ˆä¸ºï¼š(isXZero | z) + (isXZero &amp; y) + !!x 0x08 isLessOrEqual 12345678910/* * isLessOrEqual - if x &lt;= y then return 1, else return 0 * Example: isLessOrEqual(4,5) = 1. * Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt; * Max ops: 24 * Rating: 3 */int isLessOrEqual(int x, int y) &#123; return 2;&#125; è¿™é“é¢˜è¦æ±‚å®ç° &lt;= è¿ç®—ã€‚ååˆ†è‡ªç„¶çš„æƒ³æ³•æ˜¯åˆ©ç”¨å‡æ³•è¿ç®— x - yï¼Œç„¶ååˆ¤æ–­ç»“æœçš„ç¬¦å·ä½ï¼Œçœ‹äº†ä¸€ä¸‹ä¸å…è®¸ä½¿ç”¨å‡æ³•ï¼Œåˆæƒ³äº†ä¸€ä¸‹æƒ³èµ·å¯ä»¥ç”¨å–ç›¸åæ•°çš„æ–¹æ³•è®¡ç®—å‡æ³•ï¼Œè€Œç›¸åæ•°åˆ™å¯ä»¥é€šè¿‡æŒ‰ä½å–åååŠ 1è·å¾—ã€‚ä¸çŸ¥é“è¿™æ ·ç®—ä¸ç®—æŠ•æœºå–å·§ã€‚äºæ˜¯é¦–å…ˆè¯•ä¸€ä¸‹ (x + (~y + 1) &gt;&gt; 31) &amp; 0x1ï¼Œå‘ç° isLessOrEqual(-2147483648[0x80000000],-2147483648[0x80000000]) è¿‡ä¸äº†ï¼Œè¿™æ‰å‘è§‰æœ‰æº¢å‡ºæ—¶ï¼Œç¬¦å·ä½ä¼šä¸¢å¤±ã€‚å› æ­¤ä¸‹é¢éœ€è¦å°†æº¢å‡ºçš„æƒ…å†µå•åˆ—ã€‚ ä¼—æ‰€å‘¨çŸ¥ ~y + 1 ä¸ -y å¯¹äºä»»æ„æ•´æ•° y ç»“æœéƒ½ç›¸åŒï¼Œé‚£ä¹ˆæº¢å‡ºçš„æƒ…å†µå®é™…ä¸Šå°±æ˜¯æ­£å¸¸çš„å‡æ³•æº¢å‡ºã€‚å¦‚è¾ƒå¤§(ç»å¯¹å€¼)çš„è´Ÿæ•°å‡å»è¾ƒå¤§çš„æ­£æ•°ï¼Œæˆ–è€…è¾ƒå¤§çš„æ­£æ•°å‡å»è¾ƒå¤§(ç»å¯¹å€¼)çš„è´Ÿæ•°ï¼Œè€Œå¯¹äºç¬¦å·ç›¸åŒçš„æƒ…å†µï¼Œå°±ç»ä¸ä¼šæº¢å‡ºã€‚æ€»è€Œè¨€ä¹‹ï¼Œè¦è¢«å•åˆ—çš„æƒ…å†µä¸€å®šæ˜¯ x å’Œ y å¼‚å·çš„æƒ…å†µï¼Œè€Œå¯¹äºå¼‚å·çš„æƒ…å†µï¼Œå…¶å¤§å°å…³ç³»åˆæ˜¯ç¡®å®šçš„ï¼Œå› æ­¤æœ¬é¢˜å°±å®¹æ˜“è§£äº†ã€‚ å¯¹äºæœ‰ç¬¦å·æ•´æ•° x å’Œ yï¼Œé™¤å» x == y == 0ï¼Œä»–ä»¬çš„æ­£è´Ÿå…±æœ‰ä»¥ä¸‹å››ç§æƒ…å†µï¼š {x&lt;0,y&gt;0 (1)x&gt;0,y&lt;0 (2)x&lt;0,y&lt;0 (3)x&gt;0,y&gt;0 (4)\\begin{cases} \\mathrm{x &lt; 0, y &gt; 0} \\ \\text{(1)} \\\\ \\mathrm{x &gt; 0, y &lt; 0} \\ \\text{(2)}\\\\ \\mathrm{x &lt; 0, y &lt; 0} \\ \\text{(3)}\\\\ \\mathrm{x &gt; 0, y &gt; 0} \\ \\text{(4)} \\end{cases}â©âªâªâªâªâ¨âªâªâªâªâ§â€‹x&lt;0,y&gt;0 (1)x&gt;0,y&lt;0 (2)x&lt;0,y&lt;0 (3)x&gt;0,y&gt;0 (4)â€‹ å¯¹äº1, 2ä¸¤ç§æƒ…å†µï¼Œå…¶å¤§å°å…³ç³»æ˜¯æ˜¾ç„¶çš„ï¼Œå¯¹äº3, 4ä¸¤ç§æƒ…å†µï¼Œå…¶å¤§å°å…³ç³»å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼ (x + (~y + 1) &gt;&gt; 31) &amp; 0x1 åˆ¤æ–­ï¼Œäºæ˜¯å¯ä»¥å¾—åˆ°ç­”æ¡ˆï¼Œç”±äºæƒ…å†µåˆ†æ”¯è¾ƒå¤šï¼Œç›´æ¥å†™ä½çº§è¿ç®—è¡¨è¾¾å¼ä¸æ–¹ä¾¿ï¼Œè¿™é‡Œä½¿ç”¨ä¸´æ—¶å˜é‡åˆ†æ­¥è®¡ç®—ï¼š 123456int xPositive = !((x &gt;&gt; 31) &amp; 0x1); // 1 if x &gt; 0int yPositive = !((y &gt;&gt; 31) &amp; 0x1); // 1 if y &gt; 0int xPosAndyNeg = xPositive &amp; (!yPositive); // 1 if x &gt; 0, y &lt; 0int xNegAndyPos = (!xPositive) &amp; yPositive; // 1 if x &lt; 0, y &gt; 0int xyPosOrNegAndxLessy = ((x + (~y + 1)) &gt;&gt; 31) &amp; 0x1; // 1 if x*y &gt;= 0, x &lt;= yreturn (!xPosAndyNeg) &amp; (xNegAndyPos | xyPosOrNegAndxLessy); è¿™æ ·çš„ç­”æ¡ˆå†æ¬¡æµ‹è¯•å‘ç°è¿˜æ˜¯æ— æ³•é€šè¿‡ä¸Šé¢é‚£ä¸ª 0x80000000 çš„ç”¨ä¾‹ï¼ŒåŸæ¥æ˜¯å› ä¸ºåªæ³¨æ„äº† ~y + 1 ä¸ -y çš„ç­‰ä»·æ€§ï¼Œå¿˜è®°äº† -y æœ¬èº«å°±å¯èƒ½æº¢å‡ºï¼Œè¿™ç§æº¢å‡ºæƒ…å†µå°±æ˜¯å¯¹äºæœ€å°çš„è´Ÿæ•° 0x80000000 æ‰ä¼šå‡ºç°çš„ï¼Œå…¶åŸå› åœ¨äºè¡¥ç æ­£è´ŸåŸŸçš„ä¸å¯¹ç§°æ€§ã€‚å› ä¸ºå½“ä¸”ä»…å½“ y = 0x80000000 æ—¶ï¼Œæ‰ä¼šå‡ºç°æº¢å‡ºï¼Œè€Œä¸”æ­¤æ—¶å½“ä¸”ä»…å½“ x = 0x80000000 æ—¶æ‰è¿”å› 1ï¼Œæ‰€ä»¥å¯ä»¥å°†è¿™ç§æƒ…å†µä½¿ç”¨ x == y çš„æ¡ä»¶è¿‡æ»¤æ‰ã€‚æœ€ç»ˆç­”æ¡ˆæ˜¯ï¼š 1234567int xPositive = !((x &gt;&gt; 31) &amp; 0x1); // 1 if x &gt; 0int yPositive = !((y &gt;&gt; 31) &amp; 0x1); // 1 if y &gt; 0int xPosAndyNeg = xPositive &amp; (!yPositive); // 1 if x &gt; 0, y &lt; 0int xNegAndyPos = (!xPositive) &amp; yPositive; // 1 if x &lt; 0, y &gt; 0int xyPosOrNegAndxLessy = ((x + (~y + 1)) &gt;&gt; 31) &amp; 0x1; // 1 if x*y &gt;= 0, x &lt;= yint xyEqual = !(x ^ y); // 1 if x == yreturn (!xPosAndyNeg) &amp; (xyEqual | xNegAndyPos | xyPosOrNegAndxLessy); 0x09 logicalNeg 1234567891011/* * logicalNeg - implement the ! operator, using all of * the legal operators except ! * Examples: logicalNeg(3) = 0, logicalNeg(0) = 1 * Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt; * Max ops: 12 * Rating: 4 */int logicalNeg(int x) &#123; return 2;&#125; è¿™é“é¢˜è¦æ±‚å®ç°é€»è¾‘éï¼Œå³è‹¥ x == 0ï¼Œè¿”å› 1ï¼Œå¦åˆ™è¿”å› 0ã€‚è€ƒè™‘è¡¥ç æ•´æ•°çš„ä½æ¨¡å¼ï¼Œå®¹æ˜“æƒ³åˆ°å½“ x == 0 æ—¶ï¼Œæ‰€æœ‰ä½éƒ½ä¸º 0ã€‚é’ˆå¯¹è¿™ä¸€ç‰¹å¾ï¼Œè‹¥æ‰€æœ‰ä½ç›¸äº’å–æˆ–ç»“æœä¸º 0ï¼Œé‚£ä¹ˆè¯¥ x ä¸€å®šæ˜¯ 0ã€‚ æƒ³èµ·leftmost_oneæˆ–è€…åˆ¤æ–­æ•´æ•°ä½æ¨¡å¼ä¸­æ˜¯å¦æœ‰å¶æ•°ä¸ª1æ‰€æåˆ°çš„å°†æ‰€æœ‰ä½å½¼æ­¤åšé€»è¾‘è¿ç®—çš„æ–¹æ³•ï¼Œå¯ä»¥çŸ¥é“ä»¥ä¸‹çš„æ“ä½œå°† x çš„æœ€ä½ä½è®¾ç½®æˆ x çš„æ‰€æœ‰ä½çš„æˆ–ï¼š 12345x |= x &gt;&gt; 16;x |= x &gt;&gt; 8;x |= x &gt;&gt; 4;x |= x &gt;&gt; 2;x |= x &gt;&gt; 1; è¿™æ ·è‹¥ x == 0ï¼Œåˆ™ (~x) &amp; 0x1 == 1ï¼Œåä¹‹ä»ç„¶æˆç«‹ã€‚å› æ­¤ç­”æ¡ˆæ˜¯ï¼š 123456x |= x &gt;&gt; 16;x |= x &gt;&gt; 8;x |= x &gt;&gt; 4;x |= x &gt;&gt; 2;x |= x &gt;&gt; 1;return (~x) &amp; 0x1; 0x0A howManyBits 123456789101112131415/* howManyBits - return the minimum number of bits required to represent x in * two&#x27;s complement * Examples: howManyBits(12) = 5 * howManyBits(298) = 10 * howManyBits(-5) = 4 * howManyBits(0) = 1 * howManyBits(-1) = 1 * howManyBits(0x80000000) = 32 * Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt; * Max ops: 90 * Rating: 4 */int howManyBits(int x) &#123; return 2;&#125; è¿™é“é¢˜è®¡ç®—è¦è¡¨ç¤ºç»™å®šçš„æ•´æ•°ï¼Œç”¨è¡¥ç æ–¹å¼æœ€å°‘éœ€è¦å¤šå°‘ä½ã€‚ä¾‹å¦‚ 12 = 0x0000000Cï¼Œä»…çœ‹ä½4ä½æ˜¯ 1100ã€‚ç”±äºè¡¥ç çš„æœ€é«˜ä½æ˜¯è´Ÿæƒï¼Œå¦‚æœä»…ç”¨4ä½ï¼Œé‚£ä¹ˆè¿™ä¸ªä½æ¨¡å¼è¡¨ç¤ºçš„å°±ä¸æ˜¯ 12 è€Œæ˜¯ -4ï¼Œæ‰€ä»¥è¡¨ç¤º 12 éœ€è¦ 4 + 1 = 5 ä½ã€‚å†å¦‚ -5 = 0xFFFFFFFBï¼Œå…¶ä½æ¨¡å¼ä½å››ä½æ˜¯ 1011ï¼Œè¿™ä¸ªä½æ¨¡å¼æœ€é«˜ä½æŒ‰è´Ÿæƒè§£é‡Šåˆšå¥½æ˜¯ -5ï¼Œå› æ­¤ -5 éœ€è¦4ä½ã€‚æ ¹æ®è¿™ç§è§£é‡Šæ–¹å¼ï¼Œå…¶ä»–æ•°æ®æ‰€éœ€çš„æœ€å°ä½æ•°ä¹Ÿå¯ä»¥æ¨å¯¼å¾—åˆ°ï¼Œä¸èµ˜è¿°ã€‚åŒæ—¶å¯ä»¥å‘ç°ä¸€ä¸ªè§„å¾‹ï¼šå¯¹äºæ­£æ•°ï¼Œæ‰€éœ€çš„ä½æ•°å°±æ˜¯ä½æ¨¡å¼ä¸­æœ€å·¦ä¾§é‚£ä¸ª 1 çš„ä½ç½®å†åŠ 1(ç¬¦å·ä½)ï¼Œè€Œå¯¹äºè´Ÿæ•°ï¼Œå…¶æ‰€éœ€çš„ä½æ•°åˆ™æ˜¯è¯¥è´Ÿæ•°ä½æ¨¡å¼æœ€å·¦ä¾§çš„ 0 æ‰€åœ¨çš„ä½ç½®å†åŠ 1ï¼Œå¯ä»¥å¯¹è´Ÿæ•°æŒ‰ä½å–åï¼Œè¿™æ ·å°±å¯ä»¥ç»Ÿä¸€ä¸ºæœ€å·¦ä¾§ 1 çš„ä½ç½®å†åŠ 1ã€‚ åŸºäºè¿™ä¸ªæ€æƒ³ï¼Œç›®å‰ç­”æ¡ˆçš„å…³é”®æ˜¯æ±‚å‡ºä½æ¨¡å¼æœ€å·¦ä¾§çš„ 1ã€‚å†æ¬¡æ ¹æ®leftmost_oneæ‰€ä½¿ç”¨çš„æ–¹å¼å’Œç¬¬ä¸ƒé¢˜æ‰€ä½¿ç”¨çš„æ— åˆ†æ”¯å®ç°conditionalæ–¹æ³•ï¼Œå¯ä»¥ç®—å‡º x çš„æœ€å·¦ä¾§çš„1çš„å½¢å¼ï¼š 123456789101112int isXNeg = x &gt;&gt; 31; // 0xffffffff if x &lt; 0; 0 if x &gt;= 0int xPositive = isXNeg | x + (isXNeg &amp; 0x1); // x if x &gt;= 0; -1 if x &lt; 0int xNegitive = (isXNeg &amp; (~x)); // ~x if x &lt; 0; 0 if x &gt;= 0int xAbs = xPositive + xNegitive; // x if x &gt;= 0; ~x if x &lt; 0// get leftmost_oneint leftmost_one = xAbs |= xAbs &gt;&gt; 1;leftmost_one |= leftmost_one &gt;&gt; 2;leftmost_one |= leftmost_one &gt;&gt; 4;leftmost_one |= leftmost_one &gt;&gt; 8;leftmost_one |= leftmost_one &gt;&gt; 16;leftmost_one &gt;&gt;= 1;leftmost_one += 1; è¿™æ—¶è¿˜å‰©ä¸‹ä¸€ä¸ªå…³é”®çš„é—®é¢˜ï¼šå¦‚ä½•å°†æœ€å·¦ä¾§çš„1å½¢å¼çš„äºŒè¿›åˆ¶æ•°è½¬æ¢ä¸º10è¿›åˆ¶æ•´æ•°çš„å½¢å¼ã€‚å…·ä½“æ¥è¯´ï¼šä»¥å››ä½æ•°ä¸ºä¾‹ï¼Œå°±æ˜¯æŠŠä¸‹è¡¨ä¸­ç”± Y3Y2Y1Y0\\mathrm{Y_3 Y_2 Y_1 Y_0}Y3â€‹Y2â€‹Y1â€‹Y0â€‹ ç»„æˆçš„äºŒè¿›åˆ¶æ•°è½¬æ¢ä¸ºç”± X2X1X0\\mathrm{X_2 X_1 X_0}X2â€‹X1â€‹X0â€‹ ç»„æˆçš„äºŒè¿›åˆ¶æ— ç¬¦å·æ•´æ•°ã€‚ Y3\\mathrm{Y_3}Y3â€‹ Y2\\mathrm{Y_2}Y2â€‹ Y1\\mathrm{Y_1}Y1â€‹ Y0\\mathrm{Y_0}Y0â€‹ X2\\mathrm{X_2}X2â€‹ X1\\mathrm{X_1}X1â€‹ X0\\mathrm{X_0}X0â€‹ 0 0 0 0 0 0 0 0 0 0 1 0 0 1 0 0 1 0 0 1 0 0 1 0 0 0 1 1 1 0 0 0 1 0 0 è¿™ä¸ªçœŸå€¼è¡¨å¦‚æœåè¿‡æ¥â€”â€”å°† X2X1X0\\mathrm{X_2 X_1 X_0}X2â€‹X1â€‹X0â€‹ ä½œä¸ºè¾“å…¥å‚æ•°ï¼Œè€Œ Y3Y2Y1Y0\\mathrm{Y_3 Y_2 Y_1 Y_0}Y3â€‹Y2â€‹Y1â€‹Y0â€‹ ä½œä¸ºè¾“å‡ºå‚æ•°â€”â€”æœ‰è¿‡æ•°å­—ç”µè·¯å­¦ä¹ ç»éªŒçš„å°±ä¼šçœ‹å‡ºè¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªè¯‘ç è¿‡ç¨‹ï¼Œæ›´å…·ä½“çš„è¯´ï¼Œæ˜¯ä¸€ä¸ª3-8è¯‘ç å™¨çš„çœŸå€¼è¡¨(X2X1X0\\mathrm{X_2 X_1 X_0}X2â€‹X1â€‹X0â€‹ éœ€è¦æ‰©å±•åˆ° Y7\\mathrm{Y_7}Y7â€‹)ã€‚ å¯¹äºä¸Šè¡¨æ‰€ç¤ºçš„4ä½çœŸå€¼è¡¨ï¼Œå¯¹ X2,X1,X0\\mathrm{X_2, X_1, X_0}X2â€‹,X1â€‹,X0â€‹ åˆ†åˆ«è¿›è¡Œå¡è¯ºå›¾åŒ–ç®€ï¼ˆå®é™…ä¸Šä¸éœ€è¦ä½¿ç”¨å¡è¯ºå›¾ï¼Œè¿™ç§ç±»å‹çš„è§£ç å™¨é€»è¾‘å¼æ˜¯ç›¸å½“å®¹æ˜“æ¨åˆ°çš„ï¼‰ï¼Œå¯ä»¥ç®—å‡ºï¼š {X0=Y0+Y2X1=Y1+Y2X2=Y3\\begin{cases} X_0 &amp; = &amp; Y_0 + Y_2 \\\\ X_1 &amp; = &amp; Y_1 + Y_2 \\\\ X_2 &amp; = &amp; Y_3 \\end{cases}â©âªâªâ¨âªâªâ§â€‹X0â€‹X1â€‹X2â€‹â€‹===â€‹Y0â€‹+Y2â€‹Y1â€‹+Y2â€‹Y3â€‹â€‹ è¿™ä¸ªå½¢å¼è§„å¾‹è¾ƒä¸ºæ··ä¹±ï¼ŒçŒœæµ‹ä¸»è¦åŸå› æ˜¯å¯¹äº4ä½çš„è¯‘ç è¾“å‡ºï¼Œåªéœ€è¦2ä½çš„æ•´æ•°è¾“å…¥å°±å¤Ÿäº†ã€‚ç„¶è€Œè¿™æ ·çš„è¯å°±è¦æ±‚å°† 0000 çš„æƒ…å†µå•åˆ—ï¼Œä» 0001 å¼€å§‹æ˜ å°„ä¸º2ä½è¾“å‡ºçš„ 00ã€‚å³å¦‚ä¸‹çš„çœŸå€¼è¡¨ï¼š Y3\\mathrm{Y_3}Y3â€‹ Y2\\mathrm{Y_2}Y2â€‹ Y1\\mathrm{Y_1}Y1â€‹ Y0\\mathrm{Y_0}Y0â€‹ X1\\mathrm{X_1}X1â€‹ X0\\mathrm{X_0}X0â€‹ 0 0 0 1 0 0 0 0 1 0 0 1 0 1 0 0 1 0 1 0 0 0 1 1 è¿™ç§æƒ…å†µä¸‹ X1,X0\\mathrm{X_1, X_0}X1â€‹,X0â€‹ çš„é€»è¾‘å¼ä¸ºï¼š {X0=Y1+Y3X1=Y2+Y3\\begin{cases} X_0 &amp; = &amp; Y_1 + Y_3 \\\\ X_1 &amp; = &amp; Y_2 + Y_3 \\\\ \\end{cases}{X0â€‹X1â€‹â€‹==â€‹Y1â€‹+Y3â€‹Y2â€‹+Y3â€‹â€‹ åšåˆ°è¿™é‡Œè¿˜æ˜¯æ²¡æœ‰ä»€ä¹ˆæ˜æ˜¾çš„å¤´ç»ªï¼Œæƒ³ç›´æ¥ç”»å‡º32ä½çš„çœŸå€¼è¡¨åˆæ„Ÿè§‰å¤ªæƒŠä¸–éª‡ä¿—ï¼Œçœ‹æ¥è¿™é“é¢˜ç»™äº†90ä¸ªè¿ç®—ç¬¦é™é¢çœŸä¸æ˜¯å¤ªç®€å•çš„ã€‚ï¼ˆ2021.7.30 21:50ï¼‰ ï¼ˆ2021.7.31 11:54ï¼‰è¿‡äº†ä¸€å¤œä¹Ÿæ²¡æƒ³å‡ºè§£æ³•ï¼Œæˆ‘å…ˆè¯•è¯•çœŸå€¼è¡¨èƒ½ä¸èƒ½è§£å‡ºæ¥ï¼š Y32...Y1Y0\\mathrm{Y_{32}...Y_1Y_0}Y32â€‹...Y1â€‹Y0â€‹ X4\\mathrm{X_4}X4â€‹ X3\\mathrm{X_3}X3â€‹ X2\\mathrm{X_2}X2â€‹ X1\\mathrm{X_1}X1â€‹ X0\\mathrm{X_0}X0â€‹ 0000 0000 0000 0000 0000 0000 0000 0001 0 0 0 0 0 0000 0000 0000 0000 0000 0000 0000 0010 0 0 0 0 1 0000 0000 0000 0000 0000 0000 0000 0100 0 0 0 1 0 0000 0000 0000 0000 0000 0000 0000 1000 0 0 0 1 1 0000 0000 0000 0000 0000 0000 0001 0000 0 0 1 0 0 0000 0000 0000 0000 0000 0000 0010 0000 0 0 1 0 1 0000 0000 0000 0000 0000 0000 0100 0000 0 0 1 1 0 0000 0000 0000 0000 0000 0000 1000 0000 0 0 1 1 1 0000 0000 0000 0000 0000 0001 0000 0000 0 1 0 0 0 0000 0000 0000 0000 0000 0010 0000 0000 0 1 0 0 1 0000 0000 0000 0000 0000 0100 0000 0000 0 1 0 1 0 0000 0000 0000 0000 0000 1000 0000 0000 0 1 0 1 1 0000 0000 0000 0000 0001 0000 0000 0000 0 1 1 0 0 0000 0000 0000 0000 0010 0000 0000 0000 0 1 1 0 1 0000 0000 0000 0000 0100 0000 0000 0000 0 1 1 1 0 0000 0000 0000 0000 1000 0000 0000 0000 0 1 1 1 1 0000 0000 0000 0001 0000 0000 0000 0000 1 0 0 0 0 0000 0000 0000 0010 0000 0000 0000 0000 1 0 0 0 1 0000 0000 0000 0100 0000 0000 0000 0000 1 0 0 1 0 0000 0000 0000 1000 0000 0000 0000 0000 1 0 0 1 1 0000 0000 0001 0000 0000 0000 0000 0000 1 0 1 0 0 0000 0000 0010 0000 0000 0000 0000 0000 1 0 1 0 1 0000 0000 0100 0000 0000 0000 0000 0000 1 0 1 1 0 0000 0000 1000 0000 0000 0000 0000 0000 1 0 1 1 1 0000 0001 0000 0000 0000 0000 0000 0000 1 1 0 0 0 0000 0010 0000 0000 0000 0000 0000 0000 1 1 0 0 1 0000 0100 0000 0000 0000 0000 0000 0000 1 1 0 1 0 0000 1000 0000 0000 0000 0000 0000 0000 1 1 0 1 1 0001 0000 0000 0000 0000 0000 0000 0000 1 1 1 0 0 0010 0000 0000 0000 0000 0000 0000 0000 1 1 1 0 1 0100 0000 0000 0000 0000 0000 0000 0000 1 1 1 1 0 1000 0000 0000 0000 0000 0000 0000 0000 1 1 1 1 1 æ­¤è¡¨å¯ä»¥æ¨å‡ºX4X3X2X1X0\\mathrm{X_4 X_3 X_2 X_1 X_0}X4â€‹X3â€‹X2â€‹X1â€‹X0â€‹çš„é€»è¾‘è¡¨è¾¾å¼ï¼š {X0=Y1+Y3+Y5+Y7+Y9+Y11+Y13+Y15+Y17+Y19+Y21+Y23+Y25+Y27+Y29+Y31X1=Y2+Y3+Y6+Y7+Y10+Y11+Y14+Y15+Y18+Y19+Y22+Y23+Y26+Y27+Y30+Y31X2=Y4+Y5+Y6+Y7+Y12+Y13+Y14+Y15+Y20+Y21+Y22+Y23+Y28+Y29+Y30+Y31X3=Y8+Y9+Y10+Y11+Y12+Y13+Y14+Y15+Y24+Y25+Y26+Y27+Y28+Y29+Y30+Y31X4=Y16+Y17+Y18+Y19+Y20+Y21+Y22+Y23+Y24+Y25+Y26+Y27+Y28+Y29+Y30+Y31\\begin{cases} \\mathrm{X_0} = \\mathrm{Y_{1} + Y_{3} + Y_{5} + Y_{7} + Y_{9} + Y_{11} + Y_{13} + Y_{15} + Y_{17} + Y_{19} + Y_{21} + Y_{23} + Y_{25} + Y_{27} + Y_{29} + Y_{31}} \\\\ \\mathrm{X_1} = \\mathrm{Y_{2} + Y_{3} + Y_{6} + Y_{7} + Y_{10} + Y_{11} + Y_{14} + Y_{15} + Y_{18} + Y_{19} + Y_{22} + Y_{23} + Y_{26} + Y_{27} + Y_{30} + Y_{31}} \\\\ \\mathrm{X_2} = \\mathrm{Y_{4} + Y_{5} + Y_{6} + Y_{7} + Y_{12} + Y_{13} + Y_{14} + Y_{15} + Y_{20} + Y_{21} + Y_{22} + Y_{23} + Y_{28} + Y_{29} + Y_{30} + Y_{31}} \\\\ \\mathrm{X_3} = \\mathrm{Y_{8} + Y_{9} + Y_{10} + Y_{11} + Y_{12} + Y_{13} + Y_{14} + Y_{15} + Y_{24} + Y_{25} + Y_{26} + Y_{27} + Y_{28} + Y_{29} + Y_{30} + Y_{31}} \\\\ \\mathrm{X_4} = \\mathrm{Y_{16} + Y_{17} + Y_{18} + Y_{19} + Y_{20} + Y_{21} + Y_{22} + Y_{23} + Y_{24} + Y_{25} + Y_{26} + Y_{27} + Y_{28} + Y_{29} + Y_{30} + Y_{31}} \\end{cases}â©âªâªâªâªâªâªâªâ¨âªâªâªâªâªâªâªâ§â€‹X0â€‹=Y1â€‹+Y3â€‹+Y5â€‹+Y7â€‹+Y9â€‹+Y11â€‹+Y13â€‹+Y15â€‹+Y17â€‹+Y19â€‹+Y21â€‹+Y23â€‹+Y25â€‹+Y27â€‹+Y29â€‹+Y31â€‹X1â€‹=Y2â€‹+Y3â€‹+Y6â€‹+Y7â€‹+Y10â€‹+Y11â€‹+Y14â€‹+Y15â€‹+Y18â€‹+Y19â€‹+Y22â€‹+Y23â€‹+Y26â€‹+Y27â€‹+Y30â€‹+Y31â€‹X2â€‹=Y4â€‹+Y5â€‹+Y6â€‹+Y7â€‹+Y12â€‹+Y13â€‹+Y14â€‹+Y15â€‹+Y20â€‹+Y21â€‹+Y22â€‹+Y23â€‹+Y28â€‹+Y29â€‹+Y30â€‹+Y31â€‹X3â€‹=Y8â€‹+Y9â€‹+Y10â€‹+Y11â€‹+Y12â€‹+Y13â€‹+Y14â€‹+Y15â€‹+Y24â€‹+Y25â€‹+Y26â€‹+Y27â€‹+Y28â€‹+Y29â€‹+Y30â€‹+Y31â€‹X4â€‹=Y16â€‹+Y17â€‹+Y18â€‹+Y19â€‹+Y20â€‹+Y21â€‹+Y22â€‹+Y23â€‹+Y24â€‹+Y25â€‹+Y26â€‹+Y27â€‹+Y28â€‹+Y29â€‹+Y30â€‹+Y31â€‹â€‹ æ¥ä¸‹æ¥å°±æ˜¯é€ä¸ªè®¡ç®—å‡ºå„ä¸ªä½çš„å€¼ã€‚è®¡ç®—çš„è¿‡ç¨‹å®é™…ä¸Šè¿˜æ˜¯ä¸leftmost_oneæˆ–è€…åˆ¤æ–­æ•´æ•°ä½æ¨¡å¼ä¸­æ˜¯å¦æœ‰å¶æ•°ä¸ª1ä¸­æåˆ°çš„é€ä½åšé€»è¾‘è¿ç®—çš„æ–¹æ³•ä¸€è‡´ï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯é€æ­¥ç§»ä½å¹¶ä¸ç§»ä½å‰çš„å€¼è¿ç®—ã€‚ å…³äºè®¡ç®—æ–¹æ³•ï¼Œè¿˜æœ‰è¿›ä¸€æ­¥è§£é‡Šçš„å¿…è¦ã€‚ä»¥ X0\\mathrm{X_0}X0â€‹ çš„è¡¨è¾¾å¼ä¸ºä¾‹ï¼Œå¯ä»¥çœ‹å‡ºå®ƒçš„å¼å­ä¸­æ˜¯ Y1âˆ£Y3âˆ£Y5âˆ£Y7...\\mathrm{Y_1 | Y_3 | Y_5 | Y_7...}Y1â€‹âˆ£Y3â€‹âˆ£Y5â€‹âˆ£Y7â€‹... å³æ‰€æœ‰çš„å¶æ•°(ä»ç¬¬0ä½å¼€å§‹ç®—)ä½ä¹‹é—´å–æˆ–ã€‚è¿™ç§æ¨¡å¼å°±å¯ä»¥å…ˆç§»åŠ¨ä¸¤ä½ä¸åŸæ•°å­—å–æˆ–ï¼Œåšåˆ° Y1âˆ£Y3\\mathrm{Y_1 | Y_3}Y1â€‹âˆ£Y3â€‹ å’Œ Y5âˆ£Y7\\mathrm{Y_5 | Y_7}Y5â€‹âˆ£Y7â€‹ ç­‰ã€‚ç„¶åç§»åŠ¨å››ä½ä¸ç§»åŠ¨ä¸¤ä½å–æˆ–çš„ç»“æœå–æˆ–ï¼Œåšåˆ° Y1âˆ£Y3âˆ£Y5âˆ£Y7\\mathrm{Y_1 | Y_3 | Y_5 | Y_7}Y1â€‹âˆ£Y3â€‹âˆ£Y5â€‹âˆ£Y7â€‹ ç­‰ã€‚æœ€ç»ˆç§»åŠ¨16ä½ä¸ä¸Šä¸€æ¬¡ç§»ä½å–æˆ–çš„ç»“æœå–æˆ–ï¼Œåšåˆ°æ‰€æœ‰å¶æ•°ä½å–æˆ–ã€‚æœ€ç»ˆå–æˆ–çš„ç»“æœæ€»æ˜¯åœ¨ä½å‘é‡çš„æœ€å·¦ä¾§æˆ–è€…æœ€å³ä¾§(å–å†³äºç§»ä½æ˜¯å‘å·¦ç§»è¿˜æ˜¯å‘å³ç§»)ã€‚ è§‚å¯Ÿä¸Šé¢5ä¸ªä½çš„è¡¨è¾¾å¼ï¼Œä¼šå‘ç°éƒ½å…·æœ‰ç±»ä¼¼çš„è§„å¾‹ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„è¿‡ç¨‹åˆ†åˆ«æ±‚å‡ºå…¶å€¼ï¼š 12345678910111213141516171819202122232425262728293031323334int X_0 = (leftmost_one | (leftmost_one &gt;&gt; 16));X_0 |= X_0 &gt;&gt; 8;X_0 |= X_0 &gt;&gt; 4;X_0 |= X_0 &gt;&gt; 2;X_0 &gt;&gt;= 1;X_0 &amp;= 0x1;int X_1 = leftmost_one | (leftmost_one &lt;&lt; 1);X_1 |= X_1 &lt;&lt; 4;X_1 |= X_1 &lt;&lt; 8;X_1 |= X_1 &lt;&lt; 16;X_1 &gt;&gt;= 31;X_1 &amp;= 0x1;int X_2 = leftmost_one | (leftmost_one &lt;&lt; 8);X_2 |= X_2 &lt;&lt; 16;X_2 |= X_2 &lt;&lt; 2;X_2 |= X_2 &lt;&lt; 1;X_2 &gt;&gt;= 31;X_2 &amp;= 0x1;int X_3 = leftmost_one | (leftmost_one &lt;&lt; 16);X_3 |= X_3 &lt;&lt; 4;X_3 |= X_3 &lt;&lt; 2;X_3 |= X_3 &lt;&lt; 1;X_3 &gt;&gt;= 31;X_3 &amp;= 0x1;int X_4 = leftmost_one | (leftmost_one &lt;&lt; 8);X_4 |= X_4 &lt;&lt; 4;X_4 |= X_4 &lt;&lt; 2;X_4 |= X_4 &lt;&lt; 1;X_4 &gt;&gt;= 31;X_4 &amp;= 0x1; æ±‚å‡ºæ¯ä¸€ä½çš„å€¼åï¼Œå°†è¿™5ä¸ªä½ç»„è£…åˆ°ä¸€ä¸ªæ•´æ•°ä¸­ï¼š 1234X_4 = X_3 | (X_4 &lt;&lt; 1);X_4 = X_2 | (X_4 &lt;&lt; 1);X_4 = X_1 | (X_4 &lt;&lt; 1);X_4 = X_0 | (X_4 &lt;&lt; 1); è¿™æ · X4\\mathrm{X_4}X4â€‹ å°±æ˜¯è§£ç å¾—åˆ°çš„æ•°ã€‚ä½†æ˜¯ç”±äºçœŸå€¼è¡¨æ˜¯ä» 00000 å¼€å§‹çš„ï¼Œå› æ­¤è¯¥å€¼è¿˜éœ€è¦åŠ ä¸Š 1 æ‰æ˜¯æœ€å·¦ä¾§çš„1çœŸå®çš„ä½ç½®ã€‚ æ ¹æ®ä¸Šæ–‡è¯´åˆ°çš„ï¼Œæœ€ç»ˆç»“æœå®é™…ä¸Šæ˜¯æœ€å·¦ä¾§1çš„ä½ç½®å†åŠ 1ï¼Œå› æ­¤ç­”æ¡ˆåº”è¯¥æ˜¯ X_4 + 1 + 1ã€‚ä½†æ˜¯è¿˜æœ‰ç‰¹ä¾‹ï¼š0 å’Œ -1ã€‚å¯¹äº 0ï¼Œå…¶åªéœ€è¦1ä½å³å¯è¡¨ç¤ºï¼Œä½†æ˜¯æ±‚è§£è¿‡ç¨‹ä¸­ X4==0\\mathrm{X_4} == 0X4â€‹==0ï¼Œæœ€ç»ˆè¿”å› 2ã€‚å¯¹äº -1ï¼Œå…¶ä¹Ÿæ˜¯åªéœ€ä¸€ä½ï¼Œä½†æ˜¯å¯¹å…¶æ±‚ååå®ƒçš„ä½æ¨¡å¼ä¸ 0ç›¸åŒï¼Œå› æ­¤è®¡ç®—çš„æœ€å·¦ä¾§1çš„ä½ç½®ä¹Ÿæ˜¯0ï¼Œæœ€ç»ˆè¿”å› 2ã€‚å¯ä»¥å‘ç°å¯¹äº xAbs ä½æ¨¡å¼ä¸ºå…¨é›¶çš„å€¼ï¼ŒçœŸå€¼è¡¨ä¸­æ²¡æœ‰ä½“ç°ï¼Œå®é™…è®¡ç®—æ—¶å¾—åˆ°çš„ X4\\mathrm{X_4}X4â€‹ å€¼ä¸ä½æ¨¡å¼ä¸ºæœ€ä½ä½ä¸º 1 çš„æƒ…å†µä¸€æ ·ï¼Œéƒ½æ˜¯ 0ã€‚å› æ­¤è¿™ç§æƒ…å†µåº”è¯¥ç‰¹æ®Šå¤„ç†ï¼Œå³å½“ xAbs != 0 æ—¶è¿”å› X_4 + 1 + 1ï¼Œå…¶ä»–æ—¶å€™è¿”å› X_4 + 1ã€‚æœ€ç»ˆç­”æ¡ˆæ˜¯ X_4 + 1 + (!!xAbs)ã€‚ æœ€ç»ˆä½¿ç”¨äº†81ä¸ªè¿ç®—ç¬¦æ‰è§£å‡ºç­”æ¡ˆï¼Œè€Œä¸”è¿‡ç¨‹ä¹Ÿååˆ†æ›²æŠ˜å’Œæ„šè ¢ï¼Œè®°å½•çš„ä¹Ÿéå¸¸æ‹–æ²“ç¼ºä¹æ¡ç†ã€‚å¦‚æœæœ‰æ›´å¥½çš„ç­”æ¡ˆï¼Œä¹Ÿè®¸æˆ‘ä¼šå­¦ä¹ ä¸€ä¸ªã€‚ 0x0B floatScale2 1234567891011121314/* * floatScale2 - Return bit-level equivalent of expression 2*f for * floating point argument f. * Both the argument and result are passed as unsigned int&#x27;s, but * they are to be interpreted as the bit-level representation of * single-precision floating point values. * When argument is NaN, return argument * Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while * Max ops: 30 * Rating: 4 */unsigned floatScale2(unsigned uf) &#123; return 2;&#125; è¿™ä¸€é¢˜æ˜¯è®¡ç®—æµ®ç‚¹æ•°çš„2å€ï¼Œä¸è¿‡æ˜¯ä»¥æ— ç¬¦å·æ•°çš„å½¢å¼è¿›è¡Œä½çº§çš„è®¡ç®—ï¼Œè¿™æ ·æ›´èƒ½å¤Ÿç†è§£å½“æµ®ç‚¹æ•°ä¹˜ä»¥2æ—¶ï¼Œåœ¨ä½çº§çš„å±‚é¢ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆã€‚ æ ¹æ®IEEE754æµ®ç‚¹æ•°çš„å®šä¹‰ï¼Œä¸€ä¸ª32ä½çš„å•ç²¾åº¦æµ®ç‚¹æ•°å¯ä»¥åˆ†ä¸ºç¬¦å·ä½ï¼Œé˜¶ç å’Œå°¾æ•°ä¸‰éƒ¨åˆ†ã€‚å…¶å…·ä½“çš„è§£é‡Šå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ã€‚ 123int sign = uf &gt;&gt; 31;int exp = (uf &gt;&gt; 23) &amp; 0xFF;int frac = (uf &lt;&lt; 9) &gt;&gt; 9; é¦–å…ˆå…³æ³¨ç‰¹æ®Šæƒ…å†µï¼Œå³é˜¶ç å…¨ä¸º 1 æˆ–å…¨ä¸º 0 æ—¶ï¼š å…¨ä¸º 1 æ—¶ï¼šè¯¥æµ®ç‚¹æ•°æ˜¯æ— ç©·å¤§æˆ– NaNã€‚ä¸ç®¡å“ªç§æƒ…å†µï¼Œåœ¨ä¹˜2çš„æƒ…å½¢ä¸‹éƒ½åº”è¯¥åŸæ ·è¿”å›ï¼š 1if(exp == 0xFF)return uf; å…¨ä¸º 0 æ—¶ï¼šè¯¥æµ®ç‚¹æ•°çš„å°¾æ•°ç›¸å½“çš„å°ï¼Œè‡³å°‘è¿˜æ²¡æœ‰ç”¨å®Œå°¾æ•°çš„è¡¨è¾¾ç©ºé—´ï¼Œæ­¤æ—¶æˆ‘ä»¬å°†å°¾æ•°å·¦ç§»1ä½ä½œä¸ºä¹˜2ï¼š 1if(exp == 0) frac &lt;&lt;= 1; å½“é˜¶ç æ—¢éå…¨ 1 ä¹Ÿéå…¨ 0 æ—¶ï¼Œå³å–è§„æ ¼åŒ–çš„å€¼æ—¶ï¼Œæ­¤æ—¶å°¾æ•°çš„ç¼–ç æ–¹å¼æ˜¯éšå«çš„ä»¥1å¼€å¤´çš„è¡¨ç¤ºï¼Œå…¶å€¼ä¸€å®šå¤§äº1è€Œå°äº2ï¼Œæ­¤æ—¶æ— æ³•é€šè¿‡æ”¹å˜å°¾æ•°æ¥å®ç°ä¹˜2ï¼Œä¸è¿‡æ ¹æ®æµ®ç‚¹æ•°çš„å…¬å¼ï¼šV=(âˆ’1)SÃ—MÃ—2EV = (-1)^S \\times M\\times 2^EV=(âˆ’1)SÃ—MÃ—2Eï¼Œé€šè¿‡é˜¶ç  EEE åŠ 1å¯ä»¥å®ç°ä¹˜ä»¥2ï¼š 1else exp++; å¯¹è¿™ä¸‰ç§æƒ…å†µï¼Œæƒ…å†µ1æœ€ä¸ºç®€å•ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚æƒ…å†µ2åˆ™éœ€è¦è€ƒè™‘æº¢å‡ºçš„é—®é¢˜ï¼šå½“å¯¹å°¾æ•°å·¦ç§»1ä½æ—¶ï¼Œæœ‰å¯èƒ½é€ æˆåŸæ¥å±äºå°¾æ•°çš„1è¢«ç§»å‡ºå°¾æ•°çš„èŒƒå›´ã€‚è¿™è¯´æ˜ç§»ä½åå°¾æ•°å€¼å¤§äº1ï¼Œæ— æ³•å†ç”¨é˜¶ç å…¨ä¸º 0 è¿™ç§æ–¹å¼è¡¨ç¤ºï¼Œåº”è¯¥å°†è¢«ç§»å‡ºçš„ä½æ”¾è¿›é˜¶ç ï¼Œå¦åˆ™ä¹˜2çš„è®¡ç®—å°±æ˜¯é”™è¯¯çš„ï¼Œå› æ­¤æœ€ç»ˆçš„ç­”æ¡ˆåº”è¯¥åŠ ä¸Šï¼š 12345exp += (frac &gt;&gt; 23);uf = s;uf = (uf &lt;&lt; 8) | exp;uf = (uf &lt;&lt; 23) | frac;return uf; 0x0C floatFloat2Int 123456789101112131415/* * floatFloat2Int - Return bit-level equivalent of expression (int) f * for floating point argument f. * Argument is passed as unsigned int, but * it is to be interpreted as the bit-level representation of a * single-precision floating point value. * Anything out of range (including NaN and infinity) should return * 0x80000000u. * Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while * Max ops: 30 * Rating: 4 */int floatFloat2Int(unsigned uf) &#123; return 2;&#125; è¿™é“é¢˜è¦æ±‚å®ç°ä¸€ä¸ªä½çº§çš„æµ®ç‚¹æ•°è½¬æ•´æ•°ã€‚è¿˜æ˜¯å…ˆå°†æµ®ç‚¹æ•°åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š 123int exp = (uf &gt;&gt; 23) &amp; 0xFF;int frac = (uf &lt;&lt; 9) &gt;&gt; 9;int sign = uf &gt;&gt; 31; ç„¶åæ ¹æ®è¿™ç¯‡æ–‡ç« å¯ä»¥çŸ¥é“ï¼šå½“é˜¶ç å°äº 0x7F æ—¶ï¼Œæµ®ç‚¹æ•°çš„ç»å¯¹å€¼éƒ½å°äº 1ã€‚å› æ­¤ï¼š 1if(exp &lt; 0x7F) return 0; åŒæ—¶æˆ‘ä»¬çŸ¥é“æœ€å¤§çš„è¡¥ç æ•´æ•°æ˜¯ 0x7FFFFFFFï¼Œå³ 1Ã—231âˆ’11\\times 2^{31} - 11Ã—231âˆ’1ï¼Œå¯¹åº”åˆ°æµ®ç‚¹æ•°æ˜¯ 2147483647.0=1Ã—2312147483647.0 = 1\\times 2^{31}2147483647.0=1Ã—231ï¼Œå› æ­¤å½“æŒ‡æ•°(E = e - 127)å¤§äº31æ—¶ï¼Œåº”è¯¥è¿”å›é¢˜ç›®è¦æ±‚çš„0x80000000uã€‚ é™¤å»ä»¥ä¸Šä¸¤ç§æƒ…å†µï¼Œå‰©ä¸‹çš„å°±æ˜¯æœ¬é¢˜çš„æ™®éæƒ…å†µã€‚æˆ‘ä»¬çŸ¥é“æµ®ç‚¹æ•°çš„ç¼–ç æ–¹å¼æ˜¯ V=MÃ—2EV = M\\times 2^{E}V=MÃ—2Eï¼Œå…¶ä¸­ MMM å°±æ˜¯å°¾æ•°ï¼ŒEEE å°±æ˜¯é˜¶ç ã€‚æˆ‘ä»¬è¿˜çŸ¥é“å°¾æ•°çš„ç¼–ç æ–¹å¼æ˜¯è´Ÿæƒçš„ï¼Œä¹Ÿå°±æ˜¯å¯¹äº M=100M = 100M=100 è¿™ç§ç¼–ç ï¼Œå®é™…ä¸Šå¯ä»¥çœ‹ä½œ M=1.100=1Ã—2âˆ’1M = 1.100 = 1\\times 2^{-1}M=1.100=1Ã—2âˆ’1ã€‚ç»“åˆé˜¶ç æ¥çœ‹ï¼Œå½“é˜¶ç çš„å€¼ä¸ºæ­£æ—¶(å¦‚æœé˜¶ç ä¸ºè´Ÿæ ¹æœ¬ä¸ä¼šè¿›å…¥è¿™ç§æƒ…å†µ)ï¼Œä¾‹å¦‚é˜¶ç ä¸º 2ï¼Œé‚£ä¹ˆè¯¥æµ®ç‚¹æ•°çš„ç»å¯¹å€¼å°±æ˜¯ï¼šâˆ£Vâˆ£=1Ã—2âˆ’1Ã—22=110.000|V| = 1\\times 2^{-1} \\times 2^2 = 110.000âˆ£Vâˆ£=1Ã—2âˆ’1Ã—22=110.000ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶å°¾æ•°çš„ç¼–ç æ˜¯è´Ÿæƒçš„ï¼Œä½†æ˜¯æ¯ä¸€ä½é˜¶ç éƒ½å¯ä»¥â€œè§£æ•‘â€ä¸€ä½å°¾æ•°æˆä¸ºæ­£æƒã€‚åè¿‡æ¥è¯´ï¼Œå¯¹äºå€¼ä¸º E çš„é˜¶ç å’Œ 23 ä½çš„å°¾æ•°ï¼Œå°†æœ‰ 23 - E ä½çš„å°¾æ•°(ä½ä½)æ‰€è¡¨ç¤ºçš„ä¿¡æ¯ä¼šç”±äºé˜¶ç ä¸å¤Ÿè€Œè¢«èˆå…¥ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œå°±æ˜¯å°¾æ•°å‘å³ç§»åŠ¨ 23 - E ä½å¾—åˆ°çš„å°±æ˜¯æµ®ç‚¹æ•°å¯¹åº”æ•´æ•°çš„ç»å¯¹å€¼ã€‚å½“ç„¶ä¸èƒ½å¿˜è®°è¯¥ç§æƒ…å†µä¸‹å°¾æ•°æ˜¯éšå«1çš„ï¼Œä¹Ÿå°±æ˜¯å°¾æ•°çš„æœ€é«˜ä½å‰é¢è¿˜è¦å¢åŠ ä¸€ä¸ª1ã€‚ ç”±äºè¯¥é¢˜å¯ä»¥ä½¿ç”¨ while è¯­å¥ï¼Œå› æ­¤è¿™éƒ¨åˆ†å¯ä»¥è¿™æ ·å®ç°ï¼š 1234int result = frac | (1 &lt;&lt; 23);int shift = 23 - E;while (shift--) result &gt;&gt;= 1; æœ€ååªéœ€è¦å¤„ç†ç¬¦å·éƒ¨åˆ†ï¼Œå½“æµ®ç‚¹æ•°ä¸ºè´Ÿæ—¶è¿”å›è´Ÿçš„è¡¥ç æ•°å°±å¯ä»¥ã€‚ 12if(s)return ~result + 1;return result; 0x0D floatPower2 12345678910111213141516/* * floatPower2 - Return bit-level equivalent of the expression 2.0^x * (2.0 raised to the power x) for any 32-bit integer x. * * The unsigned value that is returned should have the identical bit * representation as the single-precision floating-point number 2.0^x. * If the result is too small to be represented as a denorm, return * 0. If too large, return +INF. * * Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. Also if, while * Max ops: 30 * Rating: 4 */unsigned floatPower2(int x) &#123; return 2;&#125; è¿™é¢˜è¦æ±‚å®ç°ä½çº§2çš„å¹‚ã€‚2çš„å¹‚ä¸æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹å¼ååˆ†äº²å’Œï¼Œå› æ­¤è¿™é¢˜ä¹Ÿè¾ƒä¸ºç®€å•ã€‚æˆ‘ä»¬çŸ¥é“å•ç²¾åº¦æµ®ç‚¹æ•°èƒ½å¤Ÿè¡¨ç¤ºçš„èŒƒå›´åœ¨ (1âˆ’Ïµ)Ã—2âˆ’126âˆ½(2âˆ’Ïµ)Ã—2127(1 - \\epsilon)\\times 2^{-126} \\backsim (2 - \\epsilon)\\times 2^{127}(1âˆ’Ïµ)Ã—2âˆ’126âˆ½(2âˆ’Ïµ)Ã—2127ä¹‹é—´ï¼Œå› æ­¤å½“ x åœ¨ [-126, 127] èŒƒå›´ä¹‹å¤–æ—¶ï¼Œåº”å±äºç‰¹æ®Šæƒ…å†µï¼š 12if(x &gt; 127) return 0x7f800000;if(x &lt; -126) return 0; å…¶ä½™æƒ…å†µä¸‹ï¼Œå¯¹äºæµ®ç‚¹æ•° 2.0x2.0^x2.0xï¼Œå®ƒçš„ç¬¦å·å’Œå°¾æ•°åº”è¯¥å…¨éƒ¨æ˜¯ 0ï¼Œè€Œé˜¶æ•°åˆ™éšç€ x å˜åŒ–ã€‚å…·ä½“çš„è¯´ï¼Œç”±äºé˜¶ç å³2çš„å¹‚ï¼Œè€Œä¸”é˜¶æ•° E = e - 127ï¼Œå› æ­¤é˜¶ç  e = x + 127ã€‚å°†å…¶ç§»åŠ¨åˆ°é˜¶ç çš„ä½ç½®ï¼Œä¸éœ€è¦åŠ¨å…¶ä»–çš„ä½ï¼Œå°±æ˜¯æ­£ç¡®ç­”æ¡ˆäº†ï¼š 1return (127 + x) &lt;&lt; 23; 0x0E å‰åèŠ±äº†3å¤©ï¼Œç”šè‡³æ­£åœ¨å­¦ä¹ çš„ç¬¬ä¸‰ç« çš„å†…å®¹éƒ½è¢«æˆ‘æ”¾ä¸‹ï¼Œä¼˜å…ˆåšè¿™ä¸ªLabï¼Œæ„Ÿè§‰è¿˜æ˜¯ååˆ†æœ‰æ„æ€çš„ï¼Œå°¤å…¶æ˜¯åšçš„è¿‡ç¨‹ä¸­ä¸»åŠ¨å¤ä¹ äº†å¾ˆå¤šé€»è¾‘å‡½æ•°æ–¹é¢çš„çŸ¥è¯†ï¼Œå¯¹ç¬¬äºŒç« ä¸­çš„é‡ç‚¹ï¼šæ•°æ®çš„ç¼–ç æ–¹å¼å’Œä½çº§è¡Œä¸ºçš„è®¤è¯†ä¹Ÿæ›´åŠ æ¸…æ¥šã€‚æœ€åæ”¾ä¸€å¼ å…¨éƒ¨é€šè¿‡çš„æˆªå›¾å§ï¼Œå¸Œæœ›èƒ½å¤ŸåšæŒä¸‹å»åšå®Œæ‰€æœ‰çš„Labã€‚","categories":[{"name":"é¢˜è§£ç±»","slug":"é¢˜è§£ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E9%A2%98%E8%A7%A3%E7%B1%BB/"}],"tags":[{"name":"CS:APP","slug":"CS-APP","permalink":"https://blog.zhuwenq.cc/tags/CS-APP/"},{"name":"ä½è¿ç®—","slug":"ä½è¿ç®—","permalink":"https://blog.zhuwenq.cc/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"}]},{"title":"é€»è¾‘ä»£æ•°","slug":"é€»è¾‘ä»£æ•°","date":"2021-07-28T10:39:35.000Z","updated":"2023-06-21T06:51:28.948Z","comments":true,"path":"é€»è¾‘ä»£æ•°/","link":"","permalink":"https://blog.zhuwenq.cc/%E9%80%BB%E8%BE%91%E4%BB%A3%E6%95%B0/","excerpt":"0x00 å®šä¹‰ é€»è¾‘ä»£æ•°æ˜¯ä»£æ•°çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸æ™®é€šä»£æ•°ç›¸æ¯”ï¼Œé€»è¾‘ä»£æ•°ä¸»è¦å®šä¹‰äº†ä¸ï¼Œæˆ–ï¼Œéä¸‰ç§è¿ç®—ï¼Œæ˜¯ç”¨æ™®é€šä»£æ•°æè¿°æ•°å­—ä¹‹é—´å…³ç³»çš„æ–¹å¼æ¥æè¿°é€»è¾‘å…³ç³»çš„å½¢å¼ä¸»ä¹‰[^wikipedia]ã€‚ é€»è¾‘ä»£æ•°æ˜¯ä¹”æ²»Â·å¸ƒå°”ï¼ˆGeorge Booleï¼‰åœ¨ä»–çš„ç¬¬ä¸€æœ¬ä¹¦ã€Šé€»è¾‘çš„æ•°å­¦åˆ†æã€‹ï¼ˆ1847å¹´ï¼‰ä¸­å¼•å…¥çš„ï¼Œå¹¶åœ¨ä»–çš„ã€Šæ€æƒ³è§„å¾‹çš„ç ”ç©¶ã€‹ï¼ˆ1854å¹´ï¼‰ä¸­æ›´å……åˆ†çš„æå‡ºäº†é€»è¾‘ä»£æ•°ã€‚[^BooleGeorge]","text":"0x00 å®šä¹‰ é€»è¾‘ä»£æ•°æ˜¯ä»£æ•°çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸æ™®é€šä»£æ•°ç›¸æ¯”ï¼Œé€»è¾‘ä»£æ•°ä¸»è¦å®šä¹‰äº†ä¸ï¼Œæˆ–ï¼Œéä¸‰ç§è¿ç®—ï¼Œæ˜¯ç”¨æ™®é€šä»£æ•°æè¿°æ•°å­—ä¹‹é—´å…³ç³»çš„æ–¹å¼æ¥æè¿°é€»è¾‘å…³ç³»çš„å½¢å¼ä¸»ä¹‰[^wikipedia]ã€‚ é€»è¾‘ä»£æ•°æ˜¯ä¹”æ²»Â·å¸ƒå°”ï¼ˆGeorge Booleï¼‰åœ¨ä»–çš„ç¬¬ä¸€æœ¬ä¹¦ã€Šé€»è¾‘çš„æ•°å­¦åˆ†æã€‹ï¼ˆ1847å¹´ï¼‰ä¸­å¼•å…¥çš„ï¼Œå¹¶åœ¨ä»–çš„ã€Šæ€æƒ³è§„å¾‹çš„ç ”ç©¶ã€‹ï¼ˆ1854å¹´ï¼‰ä¸­æ›´å……åˆ†çš„æå‡ºäº†é€»è¾‘ä»£æ•°ã€‚[^BooleGeorge] 0x01 èµ·å›  åœ¨å­¦ä¹  CS:APP è¿™æœ¬ä¹¦çš„ç¬¬2ç« æ—¶ï¼Œå¸¸å¸¸ç”¨åˆ°ä½çº§è¿ç®—ï¼Œç”šè‡³å®ƒçš„ä¹ é¢˜è¿˜æœ‰åªå…è®¸ä½¿ç”¨éƒ¨åˆ†ä½çº§é€»è¾‘è¿ç®—çš„è§„çŸ©ã€‚å½“æ—¶åœ¨ç¬”è®°ä¸Šè®°ä¸‹äº†è¦å¤ä¹ æ•°å­—é€»è¾‘ç”µè·¯çš„çŸ¥è¯†ï¼Œä¸è¿‡ä¸€ç›´æ²¡æœ‰è¡ŒåŠ¨ã€‚ä»Šå¤©åœ¨åš CS:APP çš„ DataLab æ—¶ï¼Œæ›´æ˜¯æ„Ÿè§‰æ•°å­—é€»è¾‘ç”µè·¯ä¸­å¸¸ç”¨çš„ç»„åˆé€»è¾‘å‡½æ•°ååˆ†æœ‰ç”¨ã€‚åœ¨åæ‚”å¤§å­¦æ•°å­—ç”µè·¯æ²¡æœ‰å¥½å¥½å­¦ä¹ è€Œä¸”æ²¡æœ‰ç¬”è®°ä¹‹åï¼Œè¿˜æ˜¯å¾—é‡æ–°å­¦ä¹ è¿™æ–¹é¢çš„çŸ¥è¯†ã€‚ é€»è¾‘ä»£æ•°ä¸è®¡ç®—æœºç”µå­ç”µè·¯çš„è¡Œä¸ºç´§å¯†ç›¸å…³ï¼Œå®é™…ä¸Šï¼Œé¦™å†œåœ¨å®ƒçš„ç¡•å£«å­¦ä½è®ºæ–‡ä¸­è¯æ˜äº†ä¸¤è€…ä¹‹é—´çš„ç­‰ä»·æ€§[^Shannon]ã€‚åœ¨éç¡¬ä»¶çš„åœºåˆï¼Œä¹Ÿéå¸¸æœ‰ç”¨ï¼Œå¯ä»¥ç”¨å®ƒå¯¹å¤åˆæ¡ä»¶è¡¨è¾¾å¼åŒ–ç®€ï¼Œå†™å‡ºæœ€é«˜æ•ˆçš„é€»è¾‘è¡¨è¾¾å¼ï¼›æˆ–è€…å¯ä»¥ä½œä¸ºå®ŒæˆCS:APPä½œä¸šçš„åå¤‡çŸ¥è¯†ã€‚ ç”±äºè¯¾æœ¬æ—©å·²ä¸¢å¤±ï¼Œä»¥ä¸‹çš„å†…å®¹å‡æ¥è‡ªäº’è”ç½‘ã€‚å…·ä½“æ¥è¯´ï¼Œä¸»è¦æ¥è‡ªè¿™ç¯‡åšå®¢ã€‚ 0x02 åŸºæœ¬è§„å¾‹ åœ¨é€»è¾‘ä»£æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤§å†™å­—æ¯ A, B, C... ç­‰ä½œä¸ºåŸºæœ¬å•å…ƒï¼Œå®ƒä»¬å¯ä»¥æ˜¯å˜é‡æˆ–è€…é€»è¾‘è¡¨è¾¾å¼ã€‚åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¸¸ç”¨ &amp;, |, ~ æ¥è¡¨ç¤ºä½çº§çš„ä¸ï¼Œæˆ–ï¼Œéï¼Œåœ¨é€»è¾‘ä»£æ•°ä¸­ï¼ŒAB ä»£è¡¨ A &amp; Bï¼›A + B ä»£è¡¨ A | Bï¼›A' åˆ™ä»£è¡¨ ~Aã€‚ 0/1å¾‹ 0 + A = A 0Â·A = 0 1 + A = 1 1Â·A = A è¿™å‡ æ¡ååˆ†ç®€å•ï¼Œä¸å¤šè§£é‡Šã€‚ä½†æ˜¯å…¶å¸¸ç”¨äºå¤æ‚è¡¨è¾¾å¼çš„åŒ–ç®€è¿‡ç¨‹ä¸­ã€‚ è¿˜åŸå¾‹/é‡å å¾‹/äº’è¡¥å¾‹ A'' = A A + A = A, AÂ·A = A A + A' = 1, AÂ·A' = 0 äº¤æ¢å¾‹/ç»“åˆå¾‹/åˆ†é…å¾‹ å°†ä¸å’Œæˆ–çœ‹ä½œæ™®é€šä»£æ•°ä¸­çš„ä¹˜å’ŒåŠ ï¼Œè¿™äº›è§„å¾‹ä¹Ÿä¸æ™®é€šä»£æ•°ä¸­å…·æœ‰çš„ç±»ä¼¼ã€‚ A + B = B + A AÂ·B = BÂ·A (A + B) + C = A + (B + C) (AB)Â·C = AÂ·(BC) A(B + C) = AB + AC A + BC = (A + B)(A + C) è¾ƒä¸ºç‰¹æ®Šçš„æ˜¯æœ€åä¸€æ¡æˆ–å¯¹ä¸çš„åˆ†é…å¾‹ï¼Œå®ƒä¸å€’æ•°ç¬¬äºŒæ¡ä¸å¯¹æˆ–çš„åˆ†é…å¾‹å½¢å¼ä¸ŠåŒæ„ï¼Œä½†æ˜¯ä¸æ™®é€šä»£æ•°å·®å¼‚è¾ƒå¤§ã€‚ è¯æ˜ï¼š(A + B)(A + C) = A + AB + AC + BC = A(1 + B + C) + BC = A + BC æ‘©æ ¹å®šå¾‹ (A + B)' = A'B' (AB)' = A' + B' è¿™ä¸€è§„å¾‹å¯ä»¥æ€»ç»“ä¸ºï¼šæˆ–çš„éæ˜¯éçš„ä¸ï¼Œä¸çš„éæ˜¯éçš„æˆ–ï¼Œæˆ–è€…ç”¨é›†åˆçš„æ¦‚å¿µè®²ï¼š å¹¶é›†çš„è¡¥é›†æ˜¯è¡¥é›†çš„äº¤é›†ï¼Œäº¤é›†çš„è¡¥é›†æ˜¯è¡¥é›†çš„å¹¶é›† è¿™ä¸ªå…¬å¼ååˆ†é‡è¦ï¼Œåœ¨é€»è¾‘å‡½æ•°åŒ–ç®€å’Œé€»è¾‘è½¬æ¢ä¸­å¿…ä¸å¯ç¼ºã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨å®ƒå°†ä¸é€»è¾‘è½¬æ¢ä¸ºæˆ–é€»è¾‘å’Œéé€»è¾‘â€”â€”AB = (A' + B')'ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥â€”â€”A + B = (A'B')' æ ¹æ®è¿™ä¸€å®šå¾‹çš„æ€æƒ³å¯ä»¥æ¨å‡ºä¸¤æ¡è§„åˆ™ åæ¼”è§„åˆ™ï¼šåœ¨å¯¹é€»è¾‘å‡½æ•°å–åæ—¶ï¼Œæˆ–å˜ä¸ºä¸ï¼Œä¸å˜ä¸ºæˆ–ï¼Œç„¶åå¯¹æ¯ä¸ªé‡å–åï¼Œä½†è¦ä¿ç•™ç»„åˆé‡çš„éå·ã€‚ å¦‚ï¼š(((A + B)C + D)(E + F))' = ((A'B' + C')D') + E'F' å¯¹å¶è§„åˆ™ï¼šè¿™ä¸ªè§„åˆ™æ˜¯ä¸Šé¢æåˆ°çš„ä¸æˆ–é€»è¾‘è½¬æ¢çš„ä¸€ä¸ªä¸¥è°¨å®šä¹‰ã€‚å®ƒçš„å†…å®¹æ˜¯ï¼šè‹¥ä¸¤ä¸ªé€»è¾‘å¼F1=F2F_1 = F_2F1â€‹=F2â€‹æˆç«‹ï¼Œé‚£ä¹ˆå®ƒä»¬çš„å¯¹å¶å¼F1D=F2DF_1^D = F_2^DF1Dâ€‹=F2Dâ€‹ä¹Ÿæˆç«‹ã€‚ å¦‚ï¼šA(B + C) = AB + ACï¼Œåˆ†åˆ«æ±‚å·¦å³ä¸¤è¾¹çš„å¯¹å¶å¼ï¼šA + BC = (A + B)(A + C)ã€‚ å–å¯¹å¶å¼çš„è§„åˆ™æ˜¯ï¼šæˆ–å˜ä¸ï¼Œä¸å˜æˆ–ï¼Œä¿è¯è¿ç®—é¡ºåºä¸å˜ï¼›å¸¸æ•°é¡¹0å˜1ï¼Œ1å˜0 å¸¸ç”¨å…¬å¼ è¿™ä¸€éƒ¨åˆ†ä¸­çš„å…¬å¼æ˜¯æ ¹æ®ä¸Šé¢åŸºæœ¬å…¬å¼æ¨å¯¼è€Œæ¥ï¼Œåœ¨é€»è¾‘å‡½æ•°åŒ–ç®€æ—¶ç»å¸¸ç”¨åˆ°ã€‚ å¸æ”¶å…¬å¼ï¼šA + AB = A æ¶ˆå› å­å…¬å¼ï¼šA + A'B = A + B å¹¶é¡¹å…¬å¼ï¼šAB + AB' = A æ¶ˆé¡¹å…¬å¼ï¼šAB + A'C + BC = AB + A'C å…¶ä¸­æ¶ˆå› å­å…¬å¼åˆ©ç”¨äº†æˆ–å¯¹ä¸çš„åˆ†é…å¾‹ï¼Œå¸æ”¶å…¬å¼å’Œå¹¶é¡¹å…¬å¼åˆ©ç”¨äº†ä¸å¯¹æˆ–çš„åˆ†é…å¾‹çš„é€†è¿ç®—ï¼Œæ¶ˆé¡¹å…¬å¼çš„è¯æ˜å¦‚ä¸‹ï¼š 12345AB + A&#x27;C + BC= AB + A&#x27;C + (A + A&#x27;)BC= AB + A&#x27;C + ABC + A&#x27;BC= AB(1 + C) + A&#x27;C(1 + B)= AB + A&#x27;C é€»è¾‘å‡½æ•°åŒ–ç®€ä¸å¡è¯ºå›¾ ï¼ˆè¿™éƒ¨åˆ†ç­‰åˆ°éœ€è¦ç”¨äº†å†å†™â€¦ 0xFF å‚è€ƒ [^wikipedia] ç»´åŸºç™¾ç§‘-é€»è¾‘ä»£æ•° [^BooleGeorge] Boole, George. An Investigation of the Laws of Thought. Prometheus Books. 2003 [1854]. ISBN 978-1-59102-089-9. [^Shannon] Shannon C E. A symbolic analysis of relay and switching circuits[J]. Electrical Engineering, 1938, 57(12): 713-723.","categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"}],"tags":[{"name":"é€»è¾‘ä»£æ•°","slug":"é€»è¾‘ä»£æ•°","permalink":"https://blog.zhuwenq.cc/tags/%E9%80%BB%E8%BE%91%E4%BB%A3%E6%95%B0/"}]},{"title":"leftmost_one","slug":"leftmost-one","date":"2021-07-22T11:16:50.000Z","updated":"2023-06-21T06:51:28.936Z","comments":true,"path":"leftmost-one/","link":"","permalink":"https://blog.zhuwenq.cc/leftmost-one/","excerpt":"CS:APP homework 2.66 é¢˜ï¼š å†™å‡ºä»£ç å®ç°å¦‚ä¸‹å‡½æ•°ï¼š /* Generate mask indicating leftmost 1 in x, Assume w = 32. For example, 0xFF00 -&gt; 0x8000, and 0x6000 -&gt; 0x4000. If x = 0, return 0 */ int leftmost_one(unsigned x); å‡½æ•°åº”è¯¥éµå¾ªä½çº§æ•´æ•°ç¼–ç è§„åˆ™ï¼Œä¸è¿‡å¯ä»¥å‡è®¾æ•°æ®ç±»å‹ int æœ‰ w=32 ä½ã€‚ ä½ çš„ä»£ç æœ€å¤šåªèƒ½åŒ…å«15ä¸ªç®—æœ¯è¿ç®—ï¼Œä½è¿ç®—å’Œé€»è¾‘è¿ç®—ã€‚ æç¤ºï¼šå…ˆå°† x è½¬æ¢æˆå½¢å¦‚[0â€¦011â€¦1]çš„ä½å‘é‡ã€‚","text":"CS:APP homework 2.66 é¢˜ï¼š å†™å‡ºä»£ç å®ç°å¦‚ä¸‹å‡½æ•°ï¼š /* Generate mask indicating leftmost 1 in x, Assume w = 32. For example, 0xFF00 -&gt; 0x8000, and 0x6000 -&gt; 0x4000. If x = 0, return 0 */ int leftmost_one(unsigned x); å‡½æ•°åº”è¯¥éµå¾ªä½çº§æ•´æ•°ç¼–ç è§„åˆ™ï¼Œä¸è¿‡å¯ä»¥å‡è®¾æ•°æ®ç±»å‹ int æœ‰ w=32 ä½ã€‚ ä½ çš„ä»£ç æœ€å¤šåªèƒ½åŒ…å«15ä¸ªç®—æœ¯è¿ç®—ï¼Œä½è¿ç®—å’Œé€»è¾‘è¿ç®—ã€‚ æç¤ºï¼šå…ˆå°† x è½¬æ¢æˆå½¢å¦‚[0â€¦011â€¦1]çš„ä½å‘é‡ã€‚ ä¸€å¼€å§‹æ²¡æœ‰æ³¨æ„åˆ°æç¤ºæ˜¯ä»€ä¹ˆæ„æ€ï¼Œåæ¥æ‰ååº”è¿‡æ¥æ˜¯è¦å°†ä»å·¦ä¾§ç¬¬ä¸€ä¸ª1å¼€å§‹å‘å³éƒ½è®¾ç½®ä¸º1ã€‚çœ‹äº†ç­”æ¡ˆå‘ç°è§£æ³•ä¸2.65é¢˜å¶æ•°ä¸ª1ååˆ†ç›¸ä¼¼ï¼š 123456789int leftmost_one(unsigned x)&#123; x |= x &gt;&gt; 1; x |= x &gt;&gt; 2; x |= x &gt;&gt; 4; x |= x &gt;&gt; 8; x |= x &gt;&gt; 16; return (x &gt;&gt; 1) + (x &amp;&amp; 0x1);&#125; ç»“åˆ2.65é¢˜çš„å¯ç¤ºï¼Œè¿™é“é¢˜çš„è§£æ³•å¯èƒ½æ˜¯è¦åšåˆ°æ¯ä¸€ä½çš„æˆ–è¿ç®—ã€‚ç»è¿‡æ¨å¯¼ w = 4 çš„æƒ…å†µï¼š x=[x3,x2,x1,x0]x = [x_3, x_2, x_1, x_0] x=[x3â€‹,x2â€‹,x1â€‹,x0â€‹] åˆ™æœ€ç»ˆ (x |= x &gt;&gt; 16) çš„ç»“æœä¸ºï¼š x=[x0,x0âˆ£x1,x0âˆ£x1âˆ£x2,x0âˆ£x1âˆ£x2âˆ£x3]x = [x_0, x_0 | x_1, x_0 | x_1 | x_2, x_0 | x_1 | x_2 | x_3] x=[x0â€‹,x0â€‹âˆ£x1â€‹,x0â€‹âˆ£x1â€‹âˆ£x2â€‹,x0â€‹âˆ£x1â€‹âˆ£x2â€‹âˆ£x3â€‹] è¿™ä¸€ç»“æœå¯ä»¥å°†ä»æœ€å·¦ä¾§çš„1çš„ä½ç½®ä»¥å³çš„æ‰€æœ‰ä½éƒ½ç½®ä¸º1ï¼Œå…·ä½“çš„æƒ…å½¢æ˜¯ï¼šè¿™ä¸€ç»“æœçš„ä½æ¨¡å¼ä»æœ€å·¦ä¾§å¼€å§‹åˆ†åˆ«æ˜¯åŸä½å‘é‡çš„æœ€å·¦ä¾§å‘å³é€æ­¥å–æˆ–ï¼Œè¿™æ ·ä¸€æ—¦åŸä½æ¨¡å¼ä¸­æœ‰1å­˜åœ¨ï¼Œåˆ™è¯¥ä½ç½®å¼€å§‹å‘å³éƒ½å°†å˜ä¸º1ã€‚ å®Œæˆä¸Šè¿°è¿‡ç¨‹åï¼Œå°†æ‰€å¾—çš„ç»“æœå‘å³é€»è¾‘ç§»åŠ¨1ä½ï¼Œç›¸å½“äºæœ€å·¦ä¾§ä½ç½®å†å‘å³ä¸€ä½å¼€å§‹çš„ä½éƒ½ä¸º1ï¼Œæ­¤æ—¶è‹¥å†åŠ 1ï¼Œåˆ™ç”±äºè¿›ä½ï¼ŒåŸä½å‘é‡ä¸­æœ€å·¦ä¾§1çš„ä½ç½®å°†è¿›ä½ä¸º1ï¼Œè€Œå…¶ä½™ä½ç½®ä¸º0ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†é¢˜ç›®è¦æ±‚ã€‚å½“ x == 0 æ—¶ï¼Œx &amp;&amp; 0x1 å¾—åˆ°ç»“æœ0ï¼Œæœ€ç»ˆè¿”å›0ã€‚ å…³äºæœ€å·¦ä¾§çš„1çš„æƒ…å†µå°±æ˜¯è¿™æ ·ã€‚","categories":[{"name":"é¢˜è§£ç±»","slug":"é¢˜è§£ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E9%A2%98%E8%A7%A3%E7%B1%BB/"}],"tags":[{"name":"CS:APP","slug":"CS-APP","permalink":"https://blog.zhuwenq.cc/tags/CS-APP/"},{"name":"ä½è¿ç®—","slug":"ä½è¿ç®—","permalink":"https://blog.zhuwenq.cc/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"}]},{"title":"åˆ¤æ–­æ•´æ•°ä½æ¨¡å¼ä¸­æ˜¯å¦æœ‰å¶æ•°ä¸ª1","slug":"åˆ¤æ–­æ•´æ•°ä½æ¨¡å¼ä¸­æ˜¯å¦æœ‰å¶æ•°ä¸ª1","date":"2021-07-19T11:02:08.000Z","updated":"2023-06-21T06:51:28.936Z","comments":true,"path":"åˆ¤æ–­æ•´æ•°ä½æ¨¡å¼ä¸­æ˜¯å¦æœ‰å¶æ•°ä¸ª1/","link":"","permalink":"https://blog.zhuwenq.cc/%E5%88%A4%E6%96%AD%E6%95%B4%E6%95%B0%E4%BD%8D%E6%A8%A1%E5%BC%8F%E4%B8%AD%E6%98%AF%E5%90%A6%E6%9C%89%E5%81%B6%E6%95%B0%E4%B8%AA1/","excerpt":"CS:APP å®¶åº­ä½œä¸š 2.65 é¢˜ï¼š å†™å‡ºä»£ç å®ç°å¦‚ä¸‹å‡½æ•°ï¼š /* Return 1 when x contains an odd number of 1s; 0 otherwise Assume w=32*/ int odd_ones(unsigned x); å‡½æ•°åº”è¯¥éµå¾ªä½çº§æ•´æ•°ç¼–ç è§„åˆ™ï¼Œä¸è¿‡ä½ å¯ä»¥å‡è®¾æ•°æ®ç±»å‹intæœ‰w=32ä½ã€‚ ä½ çš„ä»£ç æœ€å¤šåªèƒ½åŒ…å«12ä¸ªç®—æœ¯è¿ç®—ï¼Œä½è¿ç®—å’Œé€»è¾‘è¿ç®—ã€‚","text":"CS:APP å®¶åº­ä½œä¸š 2.65 é¢˜ï¼š å†™å‡ºä»£ç å®ç°å¦‚ä¸‹å‡½æ•°ï¼š /* Return 1 when x contains an odd number of 1s; 0 otherwise Assume w=32*/ int odd_ones(unsigned x); å‡½æ•°åº”è¯¥éµå¾ªä½çº§æ•´æ•°ç¼–ç è§„åˆ™ï¼Œä¸è¿‡ä½ å¯ä»¥å‡è®¾æ•°æ®ç±»å‹intæœ‰w=32ä½ã€‚ ä½ çš„ä»£ç æœ€å¤šåªèƒ½åŒ…å«12ä¸ªç®—æœ¯è¿ç®—ï¼Œä½è¿ç®—å’Œé€»è¾‘è¿ç®—ã€‚ è¿™é“é¢˜å·¦è¾¹æœ‰å››é¢—æ˜Ÿï¼Œå®é™…çš„éš¾åº¦ä¹Ÿç¡®å®å¾ˆé«˜ã€‚åœ¨è‹¦æ€å†¥æƒ³æ²¡æœ‰ç»“æœä¹‹åï¼Œæˆ‘åœ¨githubä¸Šæ‰¾åˆ°äº†ç­”æ¡ˆã€‚ä»¤äººå¤‡å—æ‰“å‡»çš„æ˜¯ç­”æ¡ˆä¸€æ—¶ä¹Ÿæ²¡æœ‰çœ‹æ‡‚ï¼Œåœ¨çº¸ä¸Šæ¨å¯¼ä¹‹åæ‰æ˜ç™½ç­”æ¡ˆä¸ºä½•æ˜¯æ­£ç¡®çš„ã€‚å¦‚æœè®©æˆ‘æ¥åšï¼Œæ–­ç„¶æ˜¯æƒ³ä¸åˆ°è¿™ç§å·§å¦™çš„æ–¹æ³•ã€‚ è¿™é“é¢˜ç›®æ˜¯è¦åˆ¤æ–­ä¸€ä¸ª32ä½æ•´æ•°çš„ä½æ¨¡å¼ä¸­æ˜¯å¦å«æœ‰å¶æ•°ä¸ª1ï¼Œéœ€è¦åšçš„å°±æ˜¯åœ¨è¯¥æ•´æ•°ç¡®å®æœ‰å¶æ•°ä¸ª1æ—¶è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚ç”±äºå¶æ•°ä¸ª1çš„ä½æ¨¡å¼æœ‰å¤ªå¤šç§å½¢å¼ï¼Œå¿…ç„¶æ— æ³•ç”¨æ©ç çš„æ–¹å¼æå–å‡ºè¿™ç§ç‰¹å¾ã€‚ç”±äºæˆ‘ç¡®å®æ²¡æœ‰æ›´å¥½çš„æ€è·¯ï¼Œä¸‹é¢ç›´æ¥çœ‹åˆ«äººçš„è§£ç­”ï¼š 12345678910int odd_ones(unsigned x)&#123; x ^= x &gt;&gt; 16; x ^= x &gt;&gt; 8; x ^= x &gt;&gt; 4; x ^= x &gt;&gt; 2; x ^= x &gt;&gt; 1; x &amp;= 0x1; return !x;&#125; è¿™ä¸ªç­”æ¡ˆä¸€çœ¼çœ‹ä¸Šå»å°±ç»™äººæå¤§çš„å¯å‘ï¼Œåœ¨è¿™ç§æå¤§å¯å‘å¸¦æ¥çš„æ¬£å–œä¸‹æˆ‘ä»¥ä¸ºå¯ä»¥çœ‹å‡ºè¿™ç§åšæ³•çš„åˆç†æ€§ï¼Œæœ€åè¿˜æ˜¯å¾—æ¨å¯¼æ¯ä¸€æ­¥æ‰æ˜ç™½ã€‚ é¢˜ç›®æ˜¯å…³äº32ä½æ•´æ•°çš„ï¼Œä¸ºäº†æ¨å¯¼æ—¶çš„æ–¹ä¾¿ï¼Œä¸å¦¨ä»¥8ä½ä¸ºä¾‹ï¼š 12345678int odd_ones(uint8_t x)&#123; x ^= x &gt;&gt; 4; x ^= x &gt;&gt; 2; x ^= x &gt;&gt; 1; x &amp;= 0x1; return !x;&#125; è¾“å…¥8ä½æ•´æ•°xçš„ä½æ¨¡å¼å¯ä»¥å†™ä½œï¼šx0=[x7,x6,x5,x4,x3,x2,x1,x0]x^0 = [x_7, x_6, x_5, x_4, x_3, x_2, x_1, x_0]x0=[x7â€‹,x6â€‹,x5â€‹,x4â€‹,x3â€‹,x2â€‹,x1â€‹,x0â€‹]ï¼Œåˆ™ç¬¬ä¸€è¡Œx ^= x &gt;&gt; 4å³æ˜¯ï¼š [x7,x6,x5,x4,x3,x2,x1,x0]âˆ§[0,0,0,0,x7,x6,x5,x4]\\begin{aligned} [&amp;x_7, &amp;x_6, &amp;x_5, &amp;x_4, &amp;x_3, &amp;x_2, &amp;x_1, &amp;x_0&amp;] \\wedge \\\\ [&amp;0, &amp;0, &amp;0, &amp;0, &amp;x_7, &amp;x_6, &amp;x_5, &amp;x_4&amp;] \\end{aligned}[[â€‹x7â€‹,0,â€‹x6â€‹,0,â€‹x5â€‹,0,â€‹x4â€‹,0,â€‹x3â€‹,x7â€‹,â€‹x2â€‹,x6â€‹,â€‹x1â€‹,x5â€‹,â€‹x0â€‹x4â€‹â€‹]âˆ§]â€‹ è¿™ä¸ªè¿ç®—çš„ç»“æœå¯ä»¥ç®€è¿°å¦‚ä¸‹ï¼šxçš„é«˜å››ä½ä¿æŒä¸å˜ï¼Œç¬¬å››ä½å˜ä¸ºåŸxçš„ç¬¬å››ä½å’Œé«˜å››ä½æŒ‰ä½å¼‚æˆ–ã€‚è¿™ä¸ªç»“æœåˆå¯ä»¥è¯¦ç»†æè¿°å¦‚ä¸‹ï¼š x1=[x7,x6,x5,x4,x3âˆ§x7,x2âˆ§x6,x1âˆ§x5,x0âˆ§x4]x^1 = [x_7, x_6, x_5, x_4, x_3 \\wedge x_7, x_2 \\wedge x_6, x_1 \\wedge x_5, x_0 \\wedge x_4] x1=[x7â€‹,x6â€‹,x5â€‹,x4â€‹,x3â€‹âˆ§x7â€‹,x2â€‹âˆ§x6â€‹,x1â€‹âˆ§x5â€‹,x0â€‹âˆ§x4â€‹] å¦‚æ­¤ç§è¿‡ç¨‹å‘ä¸‹æ¨å¹¿ï¼Œåˆ™ç¬¬äºŒè¡Œè¿ç®—æ˜¯ [x7,x6,x5,x4,x3âˆ§x7,x2âˆ§x6,x1âˆ§x5,x0âˆ§x4]âˆ§[0,0,x7,x6,x5,x4,x3âˆ§x7,x2âˆ§x6]\\begin{aligned} [&amp;x_7, &amp;x_6, &amp;x_5, &amp;x_4, &amp;x_3 \\wedge x_7, &amp;x_2 \\wedge x_6, &amp;x_1 \\wedge x_5, &amp;x_0 \\wedge x_4&amp;] \\wedge \\\\ [&amp;0, &amp;0, &amp;x_7, &amp;x_6, &amp;x_5, &amp;x_4, &amp;x_3 \\wedge x_7, &amp;x_2 \\wedge x_6&amp;] \\end{aligned}[[â€‹x7â€‹,0,â€‹x6â€‹,0,â€‹x5â€‹,x7â€‹,â€‹x4â€‹,x6â€‹,â€‹x3â€‹âˆ§x7â€‹,x5â€‹,â€‹x2â€‹âˆ§x6â€‹,x4â€‹,â€‹x1â€‹âˆ§x5â€‹,x3â€‹âˆ§x7â€‹,â€‹x0â€‹âˆ§x4â€‹x2â€‹âˆ§x6â€‹â€‹]âˆ§]â€‹ è¿™ä¸ªç»“æœæ˜¯ï¼š x2=[x7,x6,x5âˆ§x7,x4âˆ§x6,x3âˆ§x5âˆ§x7,x2âˆ§x4âˆ§x6,x1âˆ§x3âˆ§x5âˆ§x7,x0âˆ§x2âˆ§x4âˆ§x6]x^2 = [x_7, x_6, x_5 \\wedge x_7, x_4 \\wedge x_6, x_3 \\wedge x_5 \\wedge x_7, x_2 \\wedge x_4 \\wedge x_6, x_1 \\wedge x_3 \\wedge x_5 \\wedge x_7, x_0 \\wedge x_2 \\wedge x_4 \\wedge x_6] x2=[x7â€‹,x6â€‹,x5â€‹âˆ§x7â€‹,x4â€‹âˆ§x6â€‹,x3â€‹âˆ§x5â€‹âˆ§x7â€‹,x2â€‹âˆ§x4â€‹âˆ§x6â€‹,x1â€‹âˆ§x3â€‹âˆ§x5â€‹âˆ§x7â€‹,x0â€‹âˆ§x2â€‹âˆ§x4â€‹âˆ§x6â€‹] ç¬¬ä¸‰è¡Œè¿ç®—æ˜¯ï¼š [x7,x6,x5âˆ§x7,x4âˆ§x6,x3âˆ§x5âˆ§x7,x2âˆ§x4âˆ§x6,x1âˆ§x3âˆ§x5âˆ§x7,x0âˆ§x2âˆ§x4âˆ§x6]âˆ§[0,x7,x6,x5âˆ§x7,x4âˆ§x6,x3âˆ§x5âˆ§x7,x2âˆ§x4âˆ§x6,x1âˆ§x3âˆ§x5âˆ§x7]\\begin{aligned} [&amp;x_7, &amp;x_6, &amp;x_5 \\wedge x_7, &amp;x_4 \\wedge x_6, &amp;x_3 \\wedge x_5 \\wedge x_7, &amp;x_2 \\wedge x_4 \\wedge x_6, &amp;x_1 \\wedge x_3 \\wedge x_5 \\wedge x_7, &amp;x_0 \\wedge x_2 \\wedge x_4 \\wedge x_6&amp;] \\wedge \\\\ [&amp;0, &amp;x_7, &amp;x_6, &amp;x_5 \\wedge x_7, &amp;x_4 \\wedge x_6, &amp;x_3 \\wedge x_5 \\wedge x_7, &amp;x_2 \\wedge x_4 \\wedge x_6, &amp;x_1 \\wedge x_3 \\wedge x_5 \\wedge x_7&amp;] \\end{aligned}[[â€‹x7â€‹,0,â€‹x6â€‹,x7â€‹,â€‹x5â€‹âˆ§x7â€‹,x6â€‹,â€‹x4â€‹âˆ§x6â€‹,x5â€‹âˆ§x7â€‹,â€‹x3â€‹âˆ§x5â€‹âˆ§x7â€‹,x4â€‹âˆ§x6â€‹,â€‹x2â€‹âˆ§x4â€‹âˆ§x6â€‹,x3â€‹âˆ§x5â€‹âˆ§x7â€‹,â€‹x1â€‹âˆ§x3â€‹âˆ§x5â€‹âˆ§x7â€‹,x2â€‹âˆ§x4â€‹âˆ§x6â€‹,â€‹x0â€‹âˆ§x2â€‹âˆ§x4â€‹âˆ§x6â€‹x1â€‹âˆ§x3â€‹âˆ§x5â€‹âˆ§x7â€‹â€‹]âˆ§]â€‹ å¯¹äºè¿™ä¸€æ­¥è¿ç®—ï¼Œä½†çœ‹å…¶æœ€ä½ä½ï¼Œå€¼ä¸ºï¼š x1âˆ§x3âˆ§x5âˆ§x7âˆ§x0âˆ§x2âˆ§x4âˆ§x6\\begin{aligned} &amp;x_1 \\wedge x_3 \\wedge x_5 \\wedge x_7 \\wedge \\\\ &amp;x_0 \\wedge x_2 \\wedge x_4 \\wedge x_6 \\end{aligned}â€‹x1â€‹âˆ§x3â€‹âˆ§x5â€‹âˆ§x7â€‹âˆ§x0â€‹âˆ§x2â€‹âˆ§x4â€‹âˆ§x6â€‹â€‹ å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸€ä½çš„å€¼å®é™…ä¸Šæ˜¯è¯¥æ•´æ•°xçš„æ‰€æœ‰ä½çš„å¼‚æˆ–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦è¯¥æ•´æ•°çš„ä½æ¨¡å¼æœ‰å¶æ•°ä¸ª1(åŒæ—¶0ä¹Ÿæ˜¯å¶æ•°ä¸ª)ï¼Œé‚£ä¹ˆè¯¥ä½æœ€ç»ˆçš„å¼‚æˆ–ç»“æœå°±ä¸€å®šæ˜¯1 ^ 1 = 0ï¼Œå¦åˆ™å°±ä¸€å®šä¸º1 ^ 0 = 1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“xæœ‰å¶æ•°ä¸ª1æ—¶ï¼Œè¯¥æœ€ä½ä½æ˜¯0ï¼Œåä¹‹åˆ™ä¸º1ã€‚å› æ­¤å¯ä»¥é€šè¿‡æå–è¯¥æœ€ä½ä¸ºå†å–åæ¥ä½œä¸ºå‡½æ•°çš„è¿”å›ç»“æœã€‚ æ€»ç»“ å½“å‡ºç°åˆ¤æ–­æŸå€¼æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­å‡ºç°å¶æ•°æ¬¡æˆ–å¥‡æ•°æ¬¡æ—¶ï¼Œåº”è¯¥è€ƒè™‘å¼‚æˆ–çš„ä½¿ç”¨ã€‚ å½“éœ€è¦åšåˆ°å°†ä¸€ä¸ªé›†åˆä¸­æ‰€æœ‰çš„æ•°å€¼åšå¼‚æˆ–ï¼Œä¸”è¿™ä¸ªæ‰€æœ‰å€¼çš„å¼‚æˆ–åº”å‡ºç°åœ¨é›†åˆçš„èµ·å§‹æˆ–ç»“å°¾ä½ç½®æ—¶ï¼Œåº”è€ƒè™‘è¿™ç§é€æ­¥ç§»ä½ï¼Œæ¯æ¬¡å‡åŠçš„åšæ³•ã€‚","categories":[{"name":"é¢˜è§£ç±»","slug":"é¢˜è§£ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E9%A2%98%E8%A7%A3%E7%B1%BB/"}],"tags":[{"name":"CS:APP","slug":"CS-APP","permalink":"https://blog.zhuwenq.cc/tags/CS-APP/"},{"name":"ä½è¿ç®—","slug":"ä½è¿ç®—","permalink":"https://blog.zhuwenq.cc/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"}]},{"title":"èŠ‚é€‰è‡ªã€Šå…¨æ–‡ã€‹","slug":"hello-world","date":"2021-07-08T02:57:59.000Z","updated":"2023-06-21T06:51:28.932Z","comments":true,"path":"hello-world/","link":"","permalink":"https://blog.zhuwenq.cc/hello-world/","excerpt":"","text":"æˆ‘æŠŠçŸ³å¤´è¿˜ç»™çŸ³å¤´ ä»Šå¤œé’ç¨åªå±äºå¥¹è‡ªå·± ä¸€åˆ‡éƒ½åœ¨ç”Ÿé•¿ ä»Šå¤œæˆ‘åªæœ‰ç¾ä¸½çš„æˆˆå£ ç©ºç©º å§å§ï¼Œä»Šå¤œæˆ‘ä¸å…³å¿ƒäººç±»ï¼Œæˆ‘åªæƒ³ä½  æµ·å­ 1988.7.25 ç«è½¦ç»å¾·ä»¤å“ˆ","categories":[{"name":"poem","slug":"poem","permalink":"https://blog.zhuwenq.cc/categories/poem/"}],"tags":[{"name":"hello","slug":"hello","permalink":"https://blog.zhuwenq.cc/tags/hello/"},{"name":"poem","slug":"poem","permalink":"https://blog.zhuwenq.cc/tags/poem/"}]},{"title":"hexoå»ºç«™å¹¶éƒ¨ç½²åˆ°GitHub Pages","slug":"hello-world_old","date":"2020-03-01T16:00:00.000Z","updated":"2023-06-21T06:51:28.936Z","comments":true,"path":"hello-world_old/","link":"","permalink":"https://blog.zhuwenq.cc/hello-world_old/","excerpt":"GitHub Pages æ˜¯ä¸€é¡¹é™æ€ç«™ç‚¹æ‰˜ç®¡æœåŠ¡ï¼Œå®ƒç›´æ¥ä» GitHub ä¸Šçš„ä»“åº“è·å– HTMLã€CSS å’Œ JavaScript æ–‡ä»¶ï¼Œï¼ˆå¯é€‰ï¼‰é€šè¿‡æ„å»ºè¿‡ç¨‹è¿è¡Œæ–‡ä»¶ï¼Œç„¶åå‘å¸ƒç½‘ç«™ã€‚å¯¹äºæ²¡æœ‰æœåŠ¡å™¨å’ŒåŸŸåçš„å¹¿å¤§äººæ°‘ç¾¤ä¼—æ¥è¯´ï¼Œå®ƒç®€ç›´å°±æ˜¯æ­å»ºä¸ªäººåšå®¢çš„é¦–é€‰æ‰˜ç®¡å¹³å°ã€‚ Hexoæ˜¯ä¸€ä¸ªåšå®¢ç±»çš„å¿«é€Ÿå»ºç«™ï¼Œå¿«é€Ÿéƒ¨ç½²è„šæ‰‹æ¶ï¼Œé€šè¿‡å®ƒï¼Œå³ä½¿ä¸å…·æœ‰ä»»ä½•å‰ç«¯çŸ¥è¯†ï¼Œä¹Ÿå¯ä»¥å¿«é€Ÿåœ°å»ºç«‹ç²¾ç¾çš„ä¸ªäººåšå®¢ç½‘é¡µã€‚","text":"GitHub Pages æ˜¯ä¸€é¡¹é™æ€ç«™ç‚¹æ‰˜ç®¡æœåŠ¡ï¼Œå®ƒç›´æ¥ä» GitHub ä¸Šçš„ä»“åº“è·å– HTMLã€CSS å’Œ JavaScript æ–‡ä»¶ï¼Œï¼ˆå¯é€‰ï¼‰é€šè¿‡æ„å»ºè¿‡ç¨‹è¿è¡Œæ–‡ä»¶ï¼Œç„¶åå‘å¸ƒç½‘ç«™ã€‚å¯¹äºæ²¡æœ‰æœåŠ¡å™¨å’ŒåŸŸåçš„å¹¿å¤§äººæ°‘ç¾¤ä¼—æ¥è¯´ï¼Œå®ƒç®€ç›´å°±æ˜¯æ­å»ºä¸ªäººåšå®¢çš„é¦–é€‰æ‰˜ç®¡å¹³å°ã€‚ Hexoæ˜¯ä¸€ä¸ªåšå®¢ç±»çš„å¿«é€Ÿå»ºç«™ï¼Œå¿«é€Ÿéƒ¨ç½²è„šæ‰‹æ¶ï¼Œé€šè¿‡å®ƒï¼Œå³ä½¿ä¸å…·æœ‰ä»»ä½•å‰ç«¯çŸ¥è¯†ï¼Œä¹Ÿå¯ä»¥å¿«é€Ÿåœ°å»ºç«‹ç²¾ç¾çš„ä¸ªäººåšå®¢ç½‘é¡µã€‚ 1-åœ¨GitHubä¸Šæ–°å»ºrepositoryå¹¶è®¾ç½®GitHub-Pages é¦–å…ˆç™»é™†ä½ çš„GitHubå¸å·ï¼Œæ–°å»ºä¸€ä¸ªrepository æ³¨æ„Repository nameåº”è¯¥ä»¥è‡ªå·±çš„GitHubç”¨æˆ·å+.github.ioå‘½åå³ï¼šï¼ˆè¿™é‡Œå› ä¸ºæˆ‘å·²ç»æœ‰äº†åŒåä»“åº“æ‰€ä»¥æŠ¥é”™ï¼‰ .github.io è¿›å…¥repositoryçš„è®¾ç½®é¡µé¢ï¼Œè®¾ç½®GitHub Pages åœ¨Theme Chooser ä¸­éšä¾¿é€‰æ‹©ä¸€ä¸ªä¸»é¢˜æˆ–è€…ä¸é€‰æ‹©éƒ½å¯ä»¥ã€‚ å¦‚æœä½ æœ‰å…¶ä»–çš„åŸŸåï¼Œä¹Ÿå¯ä»¥ç»‘å®šåœ¨Custom domainä¸­ã€‚ 2-å®‰è£…hexoå¹¶åœ¨æœ¬åœ°å»ºç«™ ä½œä¸ºgithubç”¨æˆ·ï¼Œgitçš„å®‰è£…ä¸å†èµ˜è¿°ï¼Œå¯ä»¥ç›´æ¥åˆ°Gitå®˜ç½‘ä¸‹è½½å®‰è£…ã€‚ å®‰è£…Node.jsã€‚å¯ç›´æ¥åˆ°Node.jså®˜ç½‘ä¸‹è½½å®‰è£…ã€‚ å®‰è£…hexoå¹¶åˆå§‹åŒ–blogæ–‡ä»¶å¤¹ ä½¿ç”¨npmåŒ…ç®¡ç†å·¥å…·å®‰è£…hexo. æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥å‘½ä»¤ï¼š $ npm install -g hexo-cli å®‰è£…å®Œæˆä¹‹åï¼Œå‘½ä»¤è¡Œè¿›å…¥ä½ é¢„å¤‡çš„åšå®¢æ–‡ä»¶å¤¹(å¿…é¡»æ˜¯ç©ºæ–‡ä»¶å¤¹)ï¼Œè¾“å…¥ï¼š $ hexo init æ­¤æ—¶ä¼šå‘ç°æ–‡ä»¶å¤¹ä¸­å‘ˆä»¥ä¸‹ç»“æ„ï¼š 123456789â””â”€&lt;yourblogfolder&gt; â”œâ”€node_modules/ â”œâ”€scaffolds/ â”œâ”€source/ â”œâ”€themes/ â”œâ”€.gitignore â”œâ”€_config.yml â”œâ”€package.json â””â”€package_lock.json æ›´æ¢ä¸»é¢˜ åœ¨hexoçš„ä¸»é¢˜é¡µé¢ä¸Šæœ‰è®¸å¤šæ¼‚äº®çš„åšå®¢ä¸»é¢˜ï¼Œé€‰æ‹©ä¸€ä¸ªè¿›å…¥å®ƒçš„githubé¡µé¢ï¼Œæ‰¾åˆ°é¡¹ç›®åœ°å€ã€‚ è¾“å…¥ä»¥ä¸‹å‘½ä»¤å®‰è£…:(è¿™é‡Œæˆ‘ç”¨çš„ayerä¸»é¢˜) $ git clone https://github.com/Shen-Yu/hexo-theme-ayer.git themes/ayer å®Œæˆåæ‰“å¼€themesæ–‡ä»¶å¤¹ï¼Œå‘ç°å¤šäº†æ–‡ä»¶å¤¹ayer/ï¼Œé‡Œé¢ä¾¿æ˜¯ayerä¸»é¢˜çš„æ–‡ä»¶ã€‚ å›åˆ°blogæ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰“å¼€_config.ymlæ–‡ä»¶ï¼Œæ‰¾åˆ° 1234# Extensions## Plugins: https://hexo.io/plugins/## Themes: https://hexo.io/themes/theme: &#x27;&#x27; ä»£ç å—ï¼Œå°†å­—æ®µthemeæ”¹æˆä½ ä¸‹è½½çš„ä¸»é¢˜åã€‚ å…¶ä»–æ›´å¤šé…ç½®éƒ½åœ¨æ–‡ä»¶_config.ymlä¸­ï¼Œè®¿é—®hexoæ–‡æ¡£æŸ¥çœ‹è¯¦æƒ…ã€‚ 3-ç½‘ç«™éƒ¨ç½² åœ¨_config.ymlæ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ°ï¼š 123456# Deployment## Docs: https://hexo.io/docs/deployment.html |deploy:type: gitrepo: https://github.com/Leonezz/Leonezz.github.io.gitbranch: master å…¶ä¸­å­—æ®µrepoå¡«å†™ä½ åˆšåˆšæ–°å»ºçš„GitHub repositoryåœ°å€ã€‚ è¯¥ä»£ç æ®µå®é™…ä¸Šæ˜¯åœ¨é…ç½®Hexo Deployï¼Œå®ƒæè¿°äº†è¦ç½‘ç«™æ‰˜ç®¡çš„GitHubåœ°å€å’Œåˆ†æ”¯ã€‚ä½†æ˜¯hexoéœ€è¦å®‰è£…é¢å¤–çš„æ’ä»¶æ‰èƒ½æ­£ç¡®æ‰§è¡Œè¯¥deployã€‚åœ¨blogæ–‡ä»¶å¤¹ä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š $ npm install hexo-deployer-git --save å®Œæˆåï¼Œhexoçš„git éƒ¨ç½²æ’ä»¶ä¾¿å®‰è£…åˆ°äº†ä½ çš„blogæ–‡ä»¶å¤¹ã€‚ è¾“å…¥ä»¥ä¸‹ä¸‰æ¡å‘½ä»¤ï¼š 123hexo clean #æ¸…é™¤hexoç¼“å­˜hexo g #ç”Ÿæˆç½‘ç«™hexo d #å°†ç½‘ç«™éƒ¨ç½²åˆ°æ‰˜ç®¡æœåŠ¡å™¨ ä¾¿å®Œæˆäº†ç½‘ç«™çš„éƒ¨ç½²ï¼Œéšåä¾¿å¯åœ¨åŸŸåhttps://&lt;ä½ çš„githubç”¨æˆ·å&gt;.github.ioè®¿é—®ä½ çš„åšå®¢ç½‘ç«™äº†ã€‚ 4-hexo-å¸¸ç”¨å‘½ä»¤ 1234567&gt; hexo init #åˆå§‹åŒ–ç½‘ç«™æ–‡ä»¶å¤¹&gt; hexo clean #æ¸…é™¤ç¼“å­˜&gt; hexo g #ç”Ÿæˆç½‘ç«™&gt; hexo s #åœ¨localHosté¢„è§ˆç½‘ç«™&gt; hexo d #å°†ç½‘ç«™éƒ¨ç½²åˆ°æœåŠ¡å™¨&gt; hexo new page &quot;newMenu&quot; #æ–°å¢çš„èœå•é¡¹æ–‡ä»¶å¤¹&gt; hexo n &quot;åšå®¢åå­—&quot; #æ–°å»ºåšå®¢ References hexo Doc GitHub+Hexoæ­å»ºä¸ªäººç½‘ç«™è¯¦ç»†æ•™ç¨‹ å…¶ä»– åˆšåˆšå»ºç«‹å¥½åšå®¢ç½‘ç«™ï¼Œä½œä¸ºç¬¬ä¸€ç¯‡åšæ–‡ï¼Œå†™ä¸‹æˆ‘å»ºç«™æ—¶é‡åˆ°çš„é—®é¢˜å’ŒæŸ¥é˜…çš„èµ„æ–™ä»¥åŠè§£å†³çš„æ–¹æ³•å†åˆé€‚ä¸è¿‡äº†ã€‚","categories":[],"tags":[]}],"categories":[{"name":"çŸ¥è¯†ç±»","slug":"çŸ¥è¯†ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E7%9F%A5%E8%AF%86%E7%B1%BB/"},{"name":"Photograph","slug":"Photograph","permalink":"https://blog.zhuwenq.cc/categories/Photograph/"},{"name":"poem","slug":"poem","permalink":"https://blog.zhuwenq.cc/categories/poem/"},{"name":"Paper Note","slug":"Paper-Note","permalink":"https://blog.zhuwenq.cc/categories/Paper-Note/"},{"name":"è®°å½•å¤‡å¿˜","slug":"è®°å½•å¤‡å¿˜","permalink":"https://blog.zhuwenq.cc/categories/%E8%AE%B0%E5%BD%95%E5%A4%87%E5%BF%98/"},{"name":"é¢˜è§£ç±»","slug":"é¢˜è§£ç±»","permalink":"https://blog.zhuwenq.cc/categories/%E9%A2%98%E8%A7%A3%E7%B1%BB/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://blog.zhuwenq.cc/tags/C/"},{"name":"Concurrency","slug":"Concurrency","permalink":"https://blog.zhuwenq.cc/tags/Concurrency/"},{"name":"atomic","slug":"atomic","permalink":"https://blog.zhuwenq.cc/tags/atomic/"},{"name":"CPU Cache","slug":"CPU-Cache","permalink":"https://blog.zhuwenq.cc/tags/CPU-Cache/"},{"name":"thread","slug":"thread","permalink":"https://blog.zhuwenq.cc/tags/thread/"},{"name":"storage duration","slug":"storage-duration","permalink":"https://blog.zhuwenq.cc/tags/storage-duration/"},{"name":"basic concepts","slug":"basic-concepts","permalink":"https://blog.zhuwenq.cc/tags/basic-concepts/"},{"name":"C++ Template","slug":"C-Template","permalink":"https://blog.zhuwenq.cc/tags/C-Template/"},{"name":"é»‘é­”æ³•","slug":"é»‘é­”æ³•","permalink":"https://blog.zhuwenq.cc/tags/%E9%BB%91%E9%AD%94%E6%B3%95/"},{"name":"å¤šæ€","slug":"å¤šæ€","permalink":"https://blog.zhuwenq.cc/tags/%E5%A4%9A%E6%80%81/"},{"name":"å†…å­˜æ¨¡å‹","slug":"å†…å­˜æ¨¡å‹","permalink":"https://blog.zhuwenq.cc/tags/%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/"},{"name":"Memory Order","slug":"Memory-Order","permalink":"https://blog.zhuwenq.cc/tags/Memory-Order/"},{"name":"CS:APP","slug":"CS-APP","permalink":"https://blog.zhuwenq.cc/tags/CS-APP/"},{"name":"Computer System","slug":"Computer-System","permalink":"https://blog.zhuwenq.cc/tags/Computer-System/"},{"name":"Compute System","slug":"Compute-System","permalink":"https://blog.zhuwenq.cc/tags/Compute-System/"},{"name":"Linkage","slug":"Linkage","permalink":"https://blog.zhuwenq.cc/tags/Linkage/"},{"name":"Operating System","slug":"Operating-System","permalink":"https://blog.zhuwenq.cc/tags/Operating-System/"},{"name":"xv6","slug":"xv6","permalink":"https://blog.zhuwenq.cc/tags/xv6/"},{"name":"poem","slug":"poem","permalink":"https://blog.zhuwenq.cc/tags/poem/"},{"name":"PLM","slug":"PLM","permalink":"https://blog.zhuwenq.cc/tags/PLM/"},{"name":"NLP","slug":"NLP","permalink":"https://blog.zhuwenq.cc/tags/NLP/"},{"name":"BERT","slug":"BERT","permalink":"https://blog.zhuwenq.cc/tags/BERT/"},{"name":"Interpretability","slug":"Interpretability","permalink":"https://blog.zhuwenq.cc/tags/Interpretability/"},{"name":"FFN","slug":"FFN","permalink":"https://blog.zhuwenq.cc/tags/FFN/"},{"name":"Nueral Memory","slug":"Nueral-Memory","permalink":"https://blog.zhuwenq.cc/tags/Nueral-Memory/"},{"name":"Transfer Learning","slug":"Transfer-Learning","permalink":"https://blog.zhuwenq.cc/tags/Transfer-Learning/"},{"name":"Parameter-Efficient","slug":"Parameter-Efficient","permalink":"https://blog.zhuwenq.cc/tags/Parameter-Efficient/"},{"name":"Multimodal","slug":"Multimodal","permalink":"https://blog.zhuwenq.cc/tags/Multimodal/"},{"name":"Visual Knowledge","slug":"Visual-Knowledge","permalink":"https://blog.zhuwenq.cc/tags/Visual-Knowledge/"},{"name":"Aoustic Knowledge","slug":"Aoustic-Knowledge","permalink":"https://blog.zhuwenq.cc/tags/Aoustic-Knowledge/"},{"name":"éå†","slug":"éå†","permalink":"https://blog.zhuwenq.cc/tags/%E9%81%8D%E5%8E%86/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://blog.zhuwenq.cc/tags/%E7%AE%97%E6%B3%95/"},{"name":"çº¿ç´¢æ ‘","slug":"çº¿ç´¢æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E7%BA%BF%E7%B4%A2%E6%A0%91/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://blog.zhuwenq.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"å›¾","slug":"å›¾","permalink":"https://blog.zhuwenq.cc/tags/%E5%9B%BE/"},{"name":"æœ€çŸ­è·¯å¾„","slug":"æœ€çŸ­è·¯å¾„","permalink":"https://blog.zhuwenq.cc/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/"},{"name":"å“ˆå¤«æ›¼æ ‘","slug":"å“ˆå¤«æ›¼æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E5%93%88%E5%A4%AB%E6%9B%BC%E6%A0%91/"},{"name":"å †","slug":"å †","permalink":"https://blog.zhuwenq.cc/tags/%E5%A0%86/"},{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"name":"å¹³è¡¡äºŒå‰æ ‘","slug":"å¹³è¡¡äºŒå‰æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"name":"äºŒå‰æœç´¢æ ‘","slug":"äºŒå‰æœç´¢æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/"},{"name":"Latex","slug":"Latex","permalink":"https://blog.zhuwenq.cc/tags/Latex/"},{"name":"Citation Style","slug":"Citation-Style","permalink":"https://blog.zhuwenq.cc/tags/Citation-Style/"},{"name":"Knowledge Injection","slug":"Knowledge-Injection","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Injection/"},{"name":"Entity Signal","slug":"Entity-Signal","permalink":"https://blog.zhuwenq.cc/tags/Entity-Signal/"},{"name":"QA","slug":"QA","permalink":"https://blog.zhuwenq.cc/tags/QA/"},{"name":"æ ‘","slug":"æ ‘","permalink":"https://blog.zhuwenq.cc/tags/%E6%A0%91/"},{"name":"é˜Ÿåˆ—","slug":"é˜Ÿåˆ—","permalink":"https://blog.zhuwenq.cc/tags/%E9%98%9F%E5%88%97/"},{"name":"Entity Represention","slug":"Entity-Represention","permalink":"https://blog.zhuwenq.cc/tags/Entity-Represention/"},{"name":"Entity Lookup Table","slug":"Entity-Lookup-Table","permalink":"https://blog.zhuwenq.cc/tags/Entity-Lookup-Table/"},{"name":"æ ˆ","slug":"æ ˆ","permalink":"https://blog.zhuwenq.cc/tags/%E6%A0%88/"},{"name":"Adapter","slug":"Adapter","permalink":"https://blog.zhuwenq.cc/tags/Adapter/"},{"name":"Knowledge","slug":"Knowledge","permalink":"https://blog.zhuwenq.cc/tags/Knowledge/"},{"name":"Knowledge Represention","slug":"Knowledge-Represention","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Represention/"},{"name":"Knowledge Graph","slug":"Knowledge-Graph","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Graph/"},{"name":"Embedding","slug":"Embedding","permalink":"https://blog.zhuwenq.cc/tags/Embedding/"},{"name":"ML","slug":"ML","permalink":"https://blog.zhuwenq.cc/tags/ML/"},{"name":"Knowledge Embedding","slug":"Knowledge-Embedding","permalink":"https://blog.zhuwenq.cc/tags/Knowledge-Embedding/"},{"name":"Text Generation","slug":"Text-Generation","permalink":"https://blog.zhuwenq.cc/tags/Text-Generation/"},{"name":"TransE","slug":"TransE","permalink":"https://blog.zhuwenq.cc/tags/TransE/"},{"name":"Sequence Prediction","slug":"Sequence-Prediction","permalink":"https://blog.zhuwenq.cc/tags/Sequence-Prediction/"},{"name":"CGEC","slug":"CGEC","permalink":"https://blog.zhuwenq.cc/tags/CGEC/"},{"name":"Transformer","slug":"Transformer","permalink":"https://blog.zhuwenq.cc/tags/Transformer/"},{"name":"XLNet","slug":"XLNet","permalink":"https://blog.zhuwenq.cc/tags/XLNet/"},{"name":"Autoregressive","slug":"Autoregressive","permalink":"https://blog.zhuwenq.cc/tags/Autoregressive/"},{"name":"Prompt","slug":"Prompt","permalink":"https://blog.zhuwenq.cc/tags/Prompt/"},{"name":"Survey","slug":"Survey","permalink":"https://blog.zhuwenq.cc/tags/Survey/"},{"name":"Qt","slug":"Qt","permalink":"https://blog.zhuwenq.cc/tags/Qt/"},{"name":"æµ®ç‚¹æ•°","slug":"æµ®ç‚¹æ•°","permalink":"https://blog.zhuwenq.cc/tags/%E6%B5%AE%E7%82%B9%E6%95%B0/"},{"name":"ä½çº§è¡¨ç¤º","slug":"ä½çº§è¡¨ç¤º","permalink":"https://blog.zhuwenq.cc/tags/%E4%BD%8D%E7%BA%A7%E8%A1%A8%E7%A4%BA/"},{"name":"ä½è¿ç®—","slug":"ä½è¿ç®—","permalink":"https://blog.zhuwenq.cc/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"},{"name":"é€»è¾‘ä»£æ•°","slug":"é€»è¾‘ä»£æ•°","permalink":"https://blog.zhuwenq.cc/tags/%E9%80%BB%E8%BE%91%E4%BB%A3%E6%95%B0/"},{"name":"hello","slug":"hello","permalink":"https://blog.zhuwenq.cc/tags/hello/"}]}